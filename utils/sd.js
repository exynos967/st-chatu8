(function(_0x9e8155,_0x21fc7f){function _0x33ee33(_0x1af1b5,_0x31b8cc,_0x4aaecd,_0x246401){return _0x3aa9(_0x1af1b5-0x49,_0x31b8cc);}const _0x1e79fe=_0x9e8155();function _0x285c2f(_0x53ceda,_0x1bd757,_0x3bf20c,_0x150dfe){return _0x3aa9(_0x150dfe-0x2fc,_0x1bd757);}while(!![]){try{const _0x1bb748=parseInt(_0x285c2f(0x527,0x536,0x4fb,0x556))/(-0x1b94+-0x997+0x252c)+parseInt(_0x33ee33(0x30e,0x2eb,0x2bf,0x308))/(0x3*-0xad5+-0x20*-0x74+0x1201)*(parseInt(_0x285c2f(0x58c,0x5fe,0x619,0x59e))/(0x227c+-0x25*-0x8b+-0x123*0x30))+parseInt(_0x285c2f(0x527,0x4cf,0x52a,0x547))/(0x2551*-0x1+0xf57+-0xa*-0x233)+parseInt(_0x33ee33(0x301,0x35d,0x2e4,0x2d2))/(0x156c+-0x227f*0x1+-0x4*-0x346)+parseInt(_0x285c2f(0x465,0x4a9,0x512,0x4f3))/(-0xceb+0x2520+-0x29*0x97)+-parseInt(_0x33ee33(0x25c,0x239,0x2ba,0x20a))/(-0xafe*-0x2+-0x1e0b+0x816)+-parseInt(_0x33ee33(0x235,0x21c,0x1d6,0x19c))/(-0x13*0x151+-0x2076+0x1*0x3981);if(_0x1bb748===_0x21fc7f)break;else _0x1e79fe['push'](_0x1e79fe['shift']());}catch(_0x1c5946){_0x1e79fe['push'](_0x1e79fe['shift']());}}}(_0x1cbd,0x3ef23+-0x21a1c*-0x1+-0x36d92));function _0x3aa9(_0xaa5370,_0x253845){_0xaa5370=_0xaa5370-(0x4*-0x1d8+-0x35*0x3b+0xab2*0x2);const _0x2326d4=_0x1cbd();let _0x2e99ed=_0x2326d4[_0xaa5370];if(_0x3aa9['sAuGrU']===undefined){var _0x1352cd=function(_0x1a83a4){const _0x588c28='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x88b019='',_0x49b8a2='',_0x270127=_0x88b019+_0x1352cd;for(let _0xb44fc9=0x3e*0x5e+-0x8*0xe9+0x7be*-0x2,_0x1e9953,_0x2c41d4,_0x96f384=0x9f5*0x1+0xc83+-0x1678;_0x2c41d4=_0x1a83a4['charAt'](_0x96f384++);~_0x2c41d4&&(_0x1e9953=_0xb44fc9%(0x133*0x11+0x1db2+-0x727*0x7)?_0x1e9953*(-0x1042+-0x2536+0x24*0x17e)+_0x2c41d4:_0x2c41d4,_0xb44fc9++%(0x1d*-0x151+0x1*0x2214+0x15f*0x3))?_0x88b019+=_0x270127['charCodeAt'](_0x96f384+(-0x2d0+-0x188+0x16*0x33))-(-0x1003*0x1+-0x2635+0x56d*0xa)!==-0x34+-0x1529*0x1+0x155d?String['fromCharCode'](-0x124*0x1f+0xed*-0x2+0x2635&_0x1e9953>>(-(0x1*-0x14cb+-0x721+0x1bee)*_0xb44fc9&-0x68+-0x1*-0x164f+-0x74b*0x3)):_0xb44fc9:-0x16*0xb3+0x3*0x4fd+-0x1*-0x6b){_0x2c41d4=_0x588c28['indexOf'](_0x2c41d4);}for(let _0x4331ce=-0xc*0x16+-0x1b90+-0x4c4*-0x6,_0x366378=_0x88b019['length'];_0x4331ce<_0x366378;_0x4331ce++){_0x49b8a2+='%'+('00'+_0x88b019['charCodeAt'](_0x4331ce)['toString'](0x8*0x3f1+-0x2*-0x9c1+-0x87f*0x6))['slice'](-(-0x43*-0x5f+-0x121a*0x1+-0x6c1));}return decodeURIComponent(_0x49b8a2);};_0x3aa9['tRMEno']=_0x1352cd,_0x3aa9['WcNZgL']={},_0x3aa9['sAuGrU']=!![];}const _0x27729d=_0x2326d4[0x35*-0xac+0x73d+0x1b*0x10d],_0x37929d=_0xaa5370+_0x27729d,_0x5b8b8a=_0x3aa9['WcNZgL'][_0x37929d];if(!_0x5b8b8a){const _0x3e2538=function(_0x4e9985){this['Xubenz']=_0x4e9985,this['OgjCfC']=[-0x918+-0x1*-0x109d+-0x784,-0x14*-0xae+-0x396+-0xa02,0x2*0x593+0x267c+0x18d1*-0x2],this['Ojjqkr']=function(){return'newState';},this['TUiWvK']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['ZDZHAq']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3e2538['prototype']['kCyyhB']=function(){const _0x7108ba=new RegExp(this['TUiWvK']+this['ZDZHAq']),_0xa8e488=_0x7108ba['test'](this['Ojjqkr']['toString']())?--this['OgjCfC'][0x1117+-0x4f*-0x49+-0x1*0x279d]:--this['OgjCfC'][-0x1119+0x50d*0x1+0x101*0xc];return this['LKxSGm'](_0xa8e488);},_0x3e2538['prototype']['LKxSGm']=function(_0x147c1c){if(!Boolean(~_0x147c1c))return _0x147c1c;return this['AltMEC'](this['Xubenz']);},_0x3e2538['prototype']['AltMEC']=function(_0x34c167){for(let _0x4e9717=-0x1efc+0x1bf7+0x305,_0x1ca054=this['OgjCfC']['length'];_0x4e9717<_0x1ca054;_0x4e9717++){this['OgjCfC']['push'](Math['round'](Math['random']())),_0x1ca054=this['OgjCfC']['length'];}return _0x34c167(this['OgjCfC'][-0x1*-0x2048+-0x2324+0x2dc]);},new _0x3e2538(_0x3aa9)['kCyyhB'](),_0x2e99ed=_0x3aa9['tRMEno'](_0x2e99ed),_0x3aa9['WcNZgL'][_0x37929d]=_0x2e99ed;}else _0x2e99ed=_0x5b8b8a;return _0x2e99ed;}const _0x3a3927=(function(){const _0x4e03ac={'XCiTr':function(_0x244770,_0x15e6ba){return _0x244770(_0x15e6ba);},'GQEsu':function(_0x3ad7a4,_0x137107){return _0x3ad7a4+_0x137107;},'fKeKh':function(_0x1947d5,_0x5e31ca){return _0x1947d5===_0x5e31ca;},'srBZj':_0x535b68(0x197,0x133,0x1d6,0x198),'gPbRD':_0x535b68(0x8d,0x52,0x16e,0xe7)};function _0x535b68(_0x32f93e,_0x212e77,_0x1f35cc,_0x3b7f5b){return _0x3aa9(_0x3b7f5b- -0x16f,_0x1f35cc);}let _0x20e32b=!![];function _0x30158b(_0x96060a,_0x201dd6,_0x316b3e,_0x5b7f7e){return _0x3aa9(_0x96060a-0x1cb,_0x316b3e);}return function(_0x283ded,_0x49398a){const _0x41060e={'WNkCt':'分角色模式:\x20解析带'+_0x2d3556(0x2ae,0x266,0x241,0x1f0),'kpjYg':function(_0x1e9192,_0x7701a3){function _0x315398(_0x562c6b,_0xedff00,_0xe44925,_0x4c629d){return _0x2d3556(_0x562c6b-0xc6,_0xedff00-0x13c,_0xe44925-0x3e8,_0x562c6b);}return _0x4e03ac[_0x315398(0x5af,0x5f9,0x586,0x5c5)](_0x1e9192,_0x7701a3);},'nYYft':function(_0x1c3b1f,_0x1b26e2){return _0x4e03ac['GQEsu'](_0x1c3b1f,_0x1b26e2);},'rCvKm':function(_0x3103c8,_0x4ba416){function _0x132ee8(_0x578632,_0x1c95ba,_0x56663a,_0x276f6c){return _0x2d3556(_0x578632-0x16b,_0x1c95ba-0xce,_0x56663a-0x64,_0x578632);}return _0x4e03ac[_0x132ee8(0x23d,0x290,0x2ae,0x2ac)](_0x3103c8,_0x4ba416);},'qqFrv':function(_0x5a308c,_0x15ac14){function _0x59261f(_0x16a04e,_0x362874,_0x18d3b1,_0x3d8b16){return _0x2d3556(_0x16a04e-0x62,_0x362874-0xa4,_0x16a04e-0xa1,_0x18d3b1);}return _0x4e03ac[_0x59261f(0x1b7,0x19a,0x11e,0x24a)](_0x5a308c,_0x15ac14);},'GRnQG':_0x42b3d9(-0x119,-0x5f,-0xfc,-0xc5),'ZdVfS':function(_0xa1cac5,_0x5da990){function _0x1cfc87(_0x29b7ce,_0xf69fbd,_0xdd99d3,_0x82cf26){return _0x42b3d9(_0x29b7ce-0x12b,_0xf69fbd,_0x82cf26-0x427,_0x82cf26-0x69);}return _0x4e03ac[_0x1cfc87(0x18b,0x201,0x289,0x234)](_0xa1cac5,_0x5da990);},'Zjidv':_0x4e03ac['srBZj'],'SkNge':_0x4e03ac['gPbRD']};function _0x42b3d9(_0x149534,_0x5a1704,_0x26216d,_0x2f1715){return _0x535b68(_0x149534-0x5c,_0x5a1704-0xba,_0x5a1704,_0x26216d- -0x271);}const _0x4b6ebe=_0x20e32b?function(){function _0x1acb96(_0x115eb4,_0x28211c,_0x32f672,_0x4372a1){return _0x42b3d9(_0x115eb4-0x1d6,_0x115eb4,_0x32f672-0x4bc,_0x4372a1-0x113);}function _0x4ed115(_0x2218b0,_0x210764,_0xfe51ee,_0x237ed1){return _0x42b3d9(_0x2218b0-0x1d3,_0xfe51ee,_0x237ed1-0x2c,_0x237ed1-0x18a);}if(_0x41060e[_0x1acb96(0x356,0x41c,0x38f,0x407)](_0x41060e[_0x1acb96(0x40d,0x404,0x3d0,0x467)],_0x41060e[_0x1acb96(0x3b7,0x445,0x3d0,0x3ff)])){if(_0x49398a){if(_0x41060e[_0x1acb96(0x29c,0x2a4,0x2b8,0x28b)](_0x41060e[_0x4ed115(-0x24b,-0x169,-0x1f1,-0x1b0)],_0x41060e[_0x1acb96(0x36e,0x292,0x33a,0x2d4)])){_0x164ff0(_0x41060e[_0x1acb96(0x358,0x2ee,0x388,0x39e)]),_0x26fcf5=_0x41060e[_0x1acb96(0x46d,0x467,0x3e1,0x368)](_0x4c813c,_0x346f44),_0x9c04fb=_0x251e03['Scene\x20Comp'+_0x4ed115(-0x31,-0x43,-0x17d,-0xdf)];for(let _0x1d690a=0x7f*-0x2f+0x21e6*-0x1+0x1c9c*0x2;_0x1d690a<=0x1671*-0x1+-0xd*-0x2fe+-0x1071;_0x1d690a++){_0x41f4a3['Character\x20'+_0x1d690a+'\x20Prompt']&&(_0x46de33=_0x41060e[_0x1acb96(0x404,0x39f,0x3e4,0x468)](_0x41060e['rCvKm'](_0x4c3cc0,',\x20'),_0x1c2e6e['Character\x20'+_0x1d690a+'\x20Prompt']));}}else{const _0xfd9d25=_0x49398a['apply'](_0x283ded,arguments);return _0x49398a=null,_0xfd9d25;}}}else{_0x41060e[_0x1acb96(0x446,0x41e,0x3e1,0x35d)](_0x366378,_0x1acb96(0x3c4,0x405,0x3fe,0x3c1)+_0x3e2538['status']+'\x20'+_0x4e9985[_0x4ed115(-0x1c1,-0xca,-0x177,-0x14f)]);throw new _0x7108ba(_0x4ed115(-0x129,-0x88,-0x103,-0x92)+_0xa8e488['status']+'\x20'+_0x147c1c[_0x4ed115(-0x10e,-0x174,-0xfd,-0x14f)]);}}:function(){};function _0x2d3556(_0x2808e2,_0x4b9e22,_0x165281,_0x1c5e31){return _0x30158b(_0x165281- -0x2a2,_0x4b9e22-0x3b,_0x1c5e31,_0x1c5e31-0x12);}return _0x20e32b=![],_0x4b6ebe;};}()),_0x38b160=_0x3a3927(this,function(){function _0x8bbe6c(_0x3f35b3,_0x5e9360,_0x26a530,_0x40301a){return _0x3aa9(_0x5e9360- -0x1fa,_0x26a530);}const _0x4d7939={};_0x4d7939[_0x8bbe6c(0xdd,0xdc,0x169,0x8c)]='(((.+)+)+)'+'+$';const _0x268e2e=_0x4d7939;function _0x4e29d6(_0x2e5225,_0x26f0a0,_0x3c2d27,_0x4150bf){return _0x3aa9(_0x3c2d27- -0x1eb,_0x2e5225);}return _0x38b160[_0x4e29d6(-0x2b,-0x14,0x4d,0x5a)]()[_0x8bbe6c(0xf7,0xe0,0x103,0x17c)]('(((.+)+)+)'+'+$')['toString']()['constructo'+'r'](_0x38b160)[_0x4e29d6(0xa3,0xc4,0xef,0x166)](_0x268e2e[_0x4e29d6(0x134,0x15a,0xeb,0xf8)]);});_0x38b160();import{sleep,zhengmian,fumian,deepMerge,getSDMode,setSDMode,addLog,getRequestHeaders,clearLog,prompt_replace,getsdAuth,parsePromptStringWithCoordinates,prompt_replace_for_character,stripChineseAnnotations}from'./utils.js';import{setItemImg}from'./database.js';import{extension_settings}from'../../../../extensions.js';import{extensionName,EventType}from'./config.js';import{saveSettingsDebounced,eventSource}from'../../../../../script.js';import{initializeImageProcessing}from'./iframe.js';import{processCharacterPrompt}from'./characterprompt.js';import{bananaGenerate}from'./banana.js';function _0x1cbd(){const _0x470a7=['y21VzgvSmJiYmG','vxPYzvi','6k6+572U5QIH5z6llI4U5lI6','y2vZioIeUoMdQos/RUwKJsdKUlO','icHjrdOG','odiWodK4ngnYEuXpAG','zKTLs2G','5BcD6k+v5l2C5lI65y6F5AEliejHCW','wgLXq0S','zw5HyMXLx2HYia','C2rFy2nOyxr1xW','wKvcEvC','rvjiu0K','zML4zwrqCM9TCa','zty0ioAvSoAnRUwKHoEqHUoaGG','C3vJy2vZCW','mtq4ndeXofHur29Hza','ktOG','BLv4rxe','C2rdzMDty2fSzq','uuPNwhi','A3fwshe','ChqPoIOQia','5lU75yQH5BEY6kkR55sO5OI35y+w5RAi44cc','z01urhG','sfnst0e','y29UC3rYDwn0BW','CLrMt3C','u0qGqvbjioI/LowBNUMuMq','wMPPzhy','CgfYC2u','Bg9N','u0tNLj/LM77MTyhNQiVMJzxOJRFLIldLVii','C2rFy2HLAwDODa','5yIh5O2I5QIH5z6l5AsX6lsLoIa','v2vPC00','D3nbENu','zNzxu3i','Aw5JBhvKzxm','C2rFDMfL','l3nKyxbPl3yXlW','DxbKyxrLu3rHDa','ENHyBKS','kcGOlISPkYKRkq','mtu3ntKXquHlu0H0','77Ym6k+35Qoa5P+LC2r3zwj1','ChjVBxb0','ywnLCYK6kIOG','B2rLBcK6kIOG','qKTJyKC','DMzdteO','suPQyNm','zxH0zw5ZAw9UxW','B3iGChjVBxb0oG','CMf0Aw5Nifneia','BMvNyxrPDMvqCG','Axzgtvi','56cboIa','C2rFC3rVCf9Nzq','C2rFy2HPCMvZxW','y2zNx3nJywXL','cI0GkIPdBgLWia','ugjLrvq','5Q2J5zYO5yIh5O2I5QIH5z6l5lI6','tufhrv9srvnqtW','ifbYB21WDa','y29TCgXLDgvuyq','5y+r6ycbu0tNLj/LM77MIjdLIP/LK43LUPq','ic0Gq2HHBMDLoG','C2vLza','44cc6k+35Qoa5P+LC2r3zwj1','wNHrrNK','ue9tva','wwTzwwe','zxvL','q2HHCMfJDgvYia','r2rODwS','cI0GkIRPH4FMOlFMLRNMS5uG','of9Zy2HLzhvSzq','rMPWu1y','5P+L5QIH5z6l5PIV5zcM5Q2J56gU44cc','Dg9tDhjPBMC','D0zVDfe','sLLkCxm','BgDftMS','BKLjsu4','u2TPCdOQkIa','qvfux3nK','z1HYBNq','y3fUveO','cI0GkIRPQ5JMUixKV67LPi0G','B2DXswW','uu9ND2O','u3bouK0','sgz5yLq','zxr0Aw5NCW','Dujry0q','z2u6','yw1L','AEAyR+wqPUATO+w4UowqR+wkQo+8Jow5TUAJGa','oti5nZaWvgfczLnW','C2tOR7FMSylNLj/LM77PLjNOR686ia','of91ChnJywXLCG','EgLHBMnOzw5N','zKfcuxu','u2nLBMuGq29TCa','q2HABuu','Aw5Nx3n0CMvUzW','kfjLC3rVCMuGrG','wgLSqKW','CKHhwuK','zvblq2G','Aw1Hz2veyxrH','C3rYzw5NDgG','Ae9fuxi','mtu3mZu2y0rlBhDq','5BEY5yID5AEl5yYw44cc','cI0GkIRNP43LRzaGkfm','A2DKALK','u2Toz2u','tMLxC2C','AML1z3vHBG','rNLQzfe','B3zLCNjPzgvFCW','BgvY','CMvZDg9Yzv9Myq','C3rHDhvZvgv4Da','zwflEve','EgLoC3a','5lIT55QeihbYB21WDooaGG','Aw1Hz2u','uKXtCKW','5lU75yQH5BEY5y+w5RAi','BKzuwLK','yxbWBgLJyxrPBW','BI9QC29U','yxv0B191CMW','6i635y+w5OIw6icf5yIh5O2I5QIH5z6l5AsX6lsL','55sO5lQo55sF5OIq55QevgfNoIa','CNvUBMLUzW','zML4','C2rFy3vWC2nHBa','wenPvhi','6zsz6k+VoIa','5BEY5ywZ6zET44cc','rMP2qwm','AKnquLO','5yIg6kEs6iMY5QIH5BYpoIdOP6pMNPdLUky','quTmCuW','tenkDeq','D2DLzNi','5Q2J5zYO6k6+572U5QIH5z6llI4U5lI6','tufhrv9srvfvrq','B3fADxi','AvnYr3i','B21WDa','Be5OrMK','44cc5zon5BQu5yAf5A65oIa','A211r00','5PIV5zcM5zcV55sO5yIg6kEs6iMY5QIH5BYpia','ExvZAgu','v3Hkr0C','rxjYB3iGz2vUzq','s1jWt2O','C2r3zwj1AEEuN+wBVUwpGG','Dgv4Da','z1Ldruq','sLPNqKW','zMfJzv95B2XVDG','tvjdEwi','CKfYtvC','rfrxrMm','5zU+5yop5BEY5A2y5ywL5PwW5O2U5BQtigy','zezXrNq','5Ps25yIWu0tNLj/LM77OR7FMSyiGka','Aw1Hz2vZ','5yYw5lI6igrHDgeGvvi','Bw9Kzq','keHPCMvZiezPEa','Cgf5Bg9Hza','zMfJzsdKUlRLVidLKk8','AhbWAKi','ywrLDgfPBgvYxW','vvH1wKW','5y+r6ycbu0tNLj/LM77LPlhOTkxLK43LUPq','kfnHBxbSzxiPoG','BgvZktOG','odfOzwvgthu','5zU+5y+c5PwW5OQL5zgkcI0GkIO','BwjUwva','C3rLChm','tKzmv2G','BwvZC2fNzq','Dg9Rzw4','zv9Mywn0B3i','5yop5PwW5O2U44cc','uMnxEvy','v05Rq3q','AvPVDxC','C2rFy3DPzhrO','ksaTifbYB21WDa','kIOG','Aw5PDgLHBgL6zq','v09JzLi','CxfgCNy','kfvWC2nHBguGrG','cI0GkIRMRAxMLBaGkfm','cI0GkIPwquu6kG','tLnf','mtuWmdq0mez3AKHVCq','5BI4icHjrdOG','6zQp5PY6kc0Xkq','CMvZDg9YzuzHyW','uwz4shy','swrbr3O','C3rFy2HHDhu4xW','6k+35Rgc5AsX6lsLloEkTUAaGEEGGtOG','y2XPzw50','tNrUrKe','AwXLCJOQkIa','rhf5r0O','Dhj1zq','mJa5mtrhExniBMq','C2fTCgXLCL9Uyq','C2rFyxv0Aa','of9TB2rLBa','zwvKktOQkIa','zg1xB0e','D0PwANq','cI0TlqOGicaG','rNrUsxi','uhjVBxb0ktOQkG','C2rFy2nSAxbFCW','u0qG55sF5zU+5lQl5lU255Ur5zcS5zMO','r0vorvjbvevFsq','mJiYmG','vunqx3nK','cI0TlqOJiYmG55sF','B3nPDgLVBG','uKT1zKi','EMn1CMi','DhH0mMLTzW','qNLUvhG','C2vHCMnO','sLnptIdOP6pMNPdLPlhOTkxVViW','ywrKvgfZAW','DxjS','zhzODeC','5zon5BQu5yAf5A65oG','57Yt5A2y6k6+572U5lI65lIn5A2y5ywL5PwW5O2U','Bg9Hza','uur6wvK','uxvXuei','D2nhu3O','vvj5wKW','5zU+5yop5BEY5OIq5yQF6i635y+w5BM25Qc85BYp','lI4U','CMvTB3zLtgLZDa','sLDlsuq','r0rxuLC','suq6ia','C3reBKG','C3PNBMS','u0rmAxn0zw5LCG','su1UqvG','BMvYyxrPB24','ANz3AKm','AxPLktOQkIa','cI0GkIRMLl7LPkFLGi3NJOCG','r1jUuuC','wvDXwuu','tLbtAve','r1zIyvq','BvLOsM4','6AUy5RIf5l+U5Asnios4UG','cI0GkIPbrgv0yq','AwHRAgS','og4UChq','AMXsA0m','vxfyDMu','DePmsuG','C2rvCMW','uxPrChG','5Q2J5zYO6ycA6l+hC2r3zwj1','q256z3e','AK5ptw0','A3bQwwC','5Qch5yEg5QIH5BYpoIdKVB/NLkJOR7FMSyi','vxHOyvG','BLLzzNq','BgvUz3rO','zw5HyMXLx2HY','AxnuyxnRsw5rDq','A2LW','AgvPz2H0','C2rFy2fKzxrHAq','q0Xjuf9ZDg9WxW','zxvXuKy','EwvYCW','C3vIC3rYAw5N','rfb1DxO','y2HHBMDL','AMDJzuW','rvjhDgu','tMTdrKS','5z2q5Qch55Qe5O+q56s66k+n5A2x56YM5lIY44cc','zxHzvhK','Ae15vfG','uePJDwG','z2jMsLa','C2rFy3nLzwq','zw1PDa','ywLqCMm','C3rHDhvZ','r1ffC3u','6i635y+w5QIH5z6l5AsX6lsLoIa','reD2vui','uhPNCve','6lsF6z2I5lI6oIa','yxH5Ce8','kerLBM9PC2LUzW','C3rYAw5NAwz5','Aw1Hz2u6','lcdOR6BMG4u6ia','DtHFC2rFyxv0Aa','uhfAqNe','6yws6AAgioI/LowBNUMuMEIVR+oaGUEkTUAaGq','s3vRC1G','5Q2J6z2I5O+q56s6icHqCM9T','oIOQia','yxv0Aa','6k+V44cc54Q25Ocb56cboIa','ywn0B3iPoIOQia','A2D2Bxu','DKzZu3i','AEEuN+AiKowBVUEjHY4UlUwUOUAiTW','of9Zyw1WBgvYtG','wMrwzLm','sfrKr1O','cI0GkIRMQkhLNOSGke0','ExvZAgvPzf9Zza','zxjYB3i','kerPDMLKzv9YBW','Dc1TB2rLBa','z1PtuLm','ktOQkIa','y2vZ','wNrXueK'];_0x1cbd=function(){return _0x470a7;};return _0x1cbd();}import{taskQueue,TaskType}from'./taskQueue.js';let currentTaskId=null;async function generateSDImage({prompt:_0xcc21ec,width:_0x57daf6,height:_0x34dc26,change:_0x319b50}){const _0x5e9220={'KRpOj':function(_0x388d2f,_0x3b5385){return _0x388d2f(_0x3b5385);},'eaKyQ':_0x140354(0x4db,0x4c9,0x4f2,0x4d9)+_0x984ba3(0x106,0x110,0x18d,0x17e),'NtnFA':_0x984ba3(0x124,0x16c,0x183,0x18e),'XilBL':function(_0x1e105a,_0x454b76){return _0x1e105a===_0x454b76;},'kVagZ':_0x984ba3(0x207,0x16e,0x10d,0x1ac)+'rating\x20ima'+_0x140354(0x490,0x3f9,0x4eb,0x451),'IJjbs':function(_0x4db868,_0x460caf){return _0x4db868(_0x460caf);},'FjvAc':function(_0x55cf4f,_0x43bc3e){return _0x55cf4f+_0x43bc3e;},'QuqPB':'(((.+)+)+)'+'+$','gMTDx':function(_0x3f0fdd,_0x3eb986){return _0x3f0fdd(_0x3eb986);},'nIIIN':function(_0x3db58b,_0xeffea7){return _0x3db58b(_0xeffea7);},'PbeET':function(_0x1795fb,_0x1dd985){return _0x1795fb+_0x1dd985;},'ivFMR':function(_0x4b1aa4,_0x566e0e){return _0x4b1aa4+_0x566e0e;},'nFTZY':function(_0x3c014c,_0x1918bf){return _0x3c014c+_0x1918bf;},'DPuuz':function(_0x4a4282){return _0x4a4282();},'BbxMN':function(_0x36d3f7,_0x16b1b3){return _0x36d3f7+_0x16b1b3;},'dFqFt':function(_0x47c9ae,_0x1672ac){return _0x47c9ae||_0x1672ac;},'nUxEq':function(_0x274e0c,_0x4bd82d){return _0x274e0c(_0x4bd82d);},'DTWFc':function(_0x441f5b,_0x52d793){return _0x441f5b(_0x52d793);},'DGvUB':function(_0x4b726a,_0x428a81){return _0x4b726a(_0x428a81);},'rArMW':function(_0x4a550e,_0x337c86){return _0x4a550e!==_0x337c86;},'kgvmu':_0x984ba3(0x1b7,0xff,0xff,0x182),'UqXve':_0x984ba3(0x1b1,0x12b,0x23e,0x19d)+_0x984ba3(0x1a4,0x27e,0x238,0x23b),'stDnH':_0x984ba3(0x1f5,0x17c,0x15c,0x173)+_0x984ba3(0x248,0x1ae,0x19a,0x1f8),'kqVHq':function(_0x504c5d,_0x3a0dce){return _0x504c5d<=_0x3a0dce;},'ejpAK':_0x984ba3(0x1a1,0x2cc,0x27c,0x229)+_0x140354(0x49f,0x4fa,0x45f,0x471),'xiNsp':_0x984ba3(0x25c,0x187,0x217,0x210),'sElZr':function(_0x4c8684,_0x1c6432){return _0x4c8684+_0x1c6432;},'cJxzN':function(_0x2c4590,_0x529de4,_0x6537de,_0xcc7008,_0x146dcc,_0xd15442){return _0x2c4590(_0x529de4,_0x6537de,_0xcc7008,_0x146dcc,_0xd15442);},'FjpSV':function(_0x45e962,_0x58a653,_0x474ffd){return _0x45e962(_0x58a653,_0x474ffd);},'jowYH':_0x984ba3(0x186,0x1cb,0x174,0x192),'Gdhuk':function(_0x555f5e){return _0x555f5e();},'ERHSI':function(_0x18959d,_0x47b446){return _0x18959d===_0x47b446;},'gZSRS':_0x984ba3(0x1f7,0xec,0x14d,0x183),'WSSfz':'/api/sd/ge'+_0x140354(0x400,0x466,0x47d,0x3eb),'GDWRW':_0x140354(0x496,0x468,0x4e2,0x438),'wJVjt':function(_0x205957,_0xf736f8){return _0x205957(_0xf736f8);},'tJLIH':_0x140354(0x399,0x3ad,0x498,0x424)+'settingss.'+_0x984ba3(0xa7,0x17a,0x171,0x114)+_0x984ba3(0x16c,0x1cc,0x189,0x1eb),'fABQu':function(_0x1ebd53,_0x3f5bce){return _0x1ebd53!=_0x3f5bce;},'UzreR':_0x140354(0x453,0x3f8,0x449,0x44c),'zcurb':'/api/sd/se'+'t-model','aiPrc':function(_0x1b2e1a,_0x1c35e9){return _0x1b2e1a===_0x1c35e9;},'xXflq':'Nfntk','HTdGZ':function(_0x41a7f3,_0x4e625b){return _0x41a7f3(_0x4e625b);},'fvWSr':'HQAcp','LCJtD':_0x140354(0x3e3,0x439,0x3e5,0x45e),'oqZur':function(_0x3782e4,_0xbf42ab){return _0x3782e4!=_0xbf42ab;},'IMnAX':_0x984ba3(0xb2,0xd5,0xcd,0xfc),'ogqIl':_0x140354(0x526,0x462,0x43e,0x4a7),'gktuJ':function(_0x55d24d,_0x2368ab){return _0x55d24d(_0x2368ab);},'FtnIr':function(_0x31ea8c,_0xcb5a70){return _0x31ea8c(_0xcb5a70);},'PJcuh':function(_0x279fd2,_0xa33c11){return _0x279fd2>=_0xa33c11;},'ZxQFy':'true','iXwEK':function(_0x2e92ee,_0x11917d){return _0x2e92ee==_0x11917d;},'BKcbG':function(_0x2bfb9b,_0x5eccd1){return _0x2bfb9b(_0x5eccd1);},'qAEgo':_0x984ba3(0x26a,0x232,0x1fe,0x1e0),'zxXnK':_0x140354(0x453,0x477,0x52d,0x4c5),'wgefr':function(_0x46d4de,_0x17e16c){return _0x46d4de(_0x17e16c);},'hMyTX':_0x140354(0x468,0x41c,0x414,0x4a6)+_0x140354(0x4e8,0x40e,0x407,0x4a4),'XiqCK':_0x140354(0x40c,0x4c8,0x433,0x498)+_0x140354(0x480,0x4b3,0x569,0x505),'WvSYs':function(_0x35db44,_0x488251){return _0x35db44===_0x488251;},'NPSiQ':function(_0x52f6af,_0x2ef368){return _0x52f6af(_0x2ef368);},'gXrnt':_0x984ba3(0x27b,0x18d,0x1c8,0x214),'HSROA':function(_0x1fe2cc,_0x5c9c21){return _0x1fe2cc(_0x5c9c21);},'YkYYa':_0x140354(0x518,0x4f9,0x4ff,0x51e),'ChZmE':_0x140354(0x4cf,0x430,0x3ff,0x47b),'RcWyV':function(_0x4563e6,_0xeed6e5){return _0x4563e6===_0xeed6e5;},'bfwyU':'nkHRJ','cqnTJ':_0x140354(0x3d3,0x4cb,0x460,0x42a)+_0x984ba3(0x16a,0x27c,0x24a,0x213),'NFLWh':'payst_chat'+_0x140354(0x38a,0x3de,0x475,0x3d8)+_0x984ba3(0x1aa,0x1bf,0x206,0x204),'wFotQ':_0x140354(0x5b3,0x50e,0x4b2,0x519),'jCPRZ':_0x140354(0x4ab,0x44d,0x439,0x4bb),'MRCyb':function(_0x37b606,_0x4af9ed){return _0x37b606(_0x4af9ed);},'JWKID':_0x984ba3(0x16f,0x21e,0x191,0x1fe)+_0x140354(0x3ba,0x414,0x4a3,0x3f7)+_0x984ba3(0xb5,0x161,0x166,0x118),'gbfJP':'data:image'+'/png;base6'+'4,','mGGdP':_0x140354(0x4d1,0x524,0x536,0x4ef)+'化为\x20data\x20UR'+'L。','QDzYY':_0x140354(0x411,0x4a9,0x449,0x407),'JZgBL':_0x984ba3(0xe2,0x15c,0x1cf,0x132)+_0x140354(0x4e1,0x495,0x45a,0x4e1),'VZJBr':function(_0x20da37,_0xddad6d,_0x420099){return _0x20da37(_0xddad6d,_0x420099);},'DqyGJ':_0x984ba3(0xf8,0x11c,0x144,0x190)+_0x140354(0x4e0,0x50b,0x3f5,0x477),'iSrGr':_0x140354(0x43b,0x50b,0x4f7,0x4e8),'dmWoA':_0x140354(0x3ba,0x460,0x3ab,0x3db),'gYCED':'tszmV','lgENk':'API响应中未找到图'+_0x984ba3(0x26d,0x24f,0x24a,0x1cd),'rTfOw':function(_0x177085,_0x3e33cf){return _0x177085+_0x3e33cf;},'iZouw':function(_0x6b2ba8,_0x49c676){return _0x6b2ba8(_0x49c676);},'BeohD':function(_0x9ea1b6,_0x3a6282){return _0x9ea1b6===_0x3a6282;},'AKLqL':_0x140354(0x547,0x589,0x466,0x500),'PzgqQ':_0x984ba3(0x294,0x236,0x24c,0x224),'ZEByW':function(_0x1d08a0,_0x3c125f){return _0x1d08a0(_0x3c125f);}};_0x5e9220[_0x984ba3(0x2da,0x232,0x1be,0x236)](clearLog);const _0x43968f=taskQueue[_0x140354(0x43c,0x4ce,0x4fe,0x4e5)]({'name':_0x5e9220['BbxMN'](_0x5e9220[_0x984ba3(0x1d8,0x160,0x228,0x1b7)](_0xcc21ec,'')[_0x140354(0x49f,0x53b,0x5be,0x51b)](-0x1eb*-0x5+-0x527*-0x4+-0x1*0x1e33,0xf97+0x4*-0xea+-0xbd1),_0xcc21ec&&_0xcc21ec[_0x984ba3(0x18c,0x24c,0x1ca,0x22c)]>0x6*-0x655+-0x17*0x71+0x3043?'...':''),'type':TaskType['SD'],'prompt':_0xcc21ec});currentTaskId=_0x43968f;let _0x1513cf=_0x319b50;_0xcc21ec=_0x5e9220[_0x984ba3(0x16b,0xe8,0xf8,0x11c)](processCharacterPrompt,_0xcc21ec),_0x319b50=processCharacterPrompt(_0x319b50),_0xcc21ec=await _0x5e9220[_0x140354(0x476,0x4a9,0x471,0x49b)](stripChineseAnnotations,_0xcc21ec),_0x319b50=await stripChineseAnnotations(_0x319b50);const _0x178d44=extension_settings[extensionName][_0x140354(0x51d,0x502,0x51a,0x509)]['trim'](),_0x1c2120=extension_settings[extensionName];_0x5e9220[_0x140354(0x559,0x57f,0x4cc,0x52c)](addLog,_0x984ba3(0x266,0x21d,0x1cf,0x225)+_0x984ba3(0xfb,0xb2,0x189,0xfd)+'端为'+_0x1c2120[_0x984ba3(0x156,0x280,0x258,0x1e3)]+',模型为'+_0x1c2120[_0x984ba3(0x8b,0x70,0x157,0x114)+'8_model']);const _0x3abb67=_0x319b50&&_0x5e9220[_0x984ba3(0x21b,0x17f,0x120,0x1b4)](_0x319b50['trim'](),'')?_0x319b50:_0xcc21ec;function _0x140354(_0x4df77f,_0x56cb25,_0x54d867,_0x3ea0dd){return _0x3aa9(_0x3ea0dd-0x209,_0x4df77f);}_0x5e9220['DGvUB'](addLog,_0x140354(0x513,0x3fb,0x3d8,0x47a)+_0x3abb67);let _0xca6371=![];_0x3abb67[_0x140354(0x3ad,0x3f1,0x4b6,0x416)](_0x984ba3(0xf8,0xe9,0x127,0x173)+'osition')&&(_0xca6371=!![]);_0x5e9220[_0x984ba3(0x159,0x1bb,0x1fb,0x1ad)](addLog,_0x140354(0x429,0x4df,0x40c,0x48f)+_0x140354(0x37b,0x36b,0x3e6,0x3ea)+_0x984ba3(0x23c,0x139,0x192,0x1c4)+_0xca6371);let _0x55aa7d={},_0x179f86='',_0x58dc09='';if(_0xca6371){if(_0x5e9220['XilBL'](_0x5e9220[_0x140354(0x428,0x48a,0x348,0x3e1)],_0x5e9220[_0x984ba3(0x124,0x19e,0x117,0xfb)])){_0x5e9220['DGvUB'](addLog,_0x5e9220[_0x140354(0x45d,0x4d3,0x541,0x507)]),_0x55aa7d=_0x5e9220[_0x984ba3(0x194,0x106,0x141,0x11c)](parsePromptStringWithCoordinates,_0x3abb67),_0x179f86=_0x55aa7d[_0x5e9220[_0x140354(0x45b,0x547,0x464,0x4f5)]];for(let _0x1cda5d=-0x10*-0x10+-0x9de+0x8df;_0x5e9220[_0x984ba3(0x184,0x186,0x152,0x11f)](_0x1cda5d,-0x2*0x42+0x2fa+-0x139*0x2);_0x1cda5d++){_0x55aa7d[_0x140354(0x4af,0x4e8,0x4b1,0x43b)+_0x1cda5d+'\x20Prompt']&&(_0x58dc09=_0x5e9220[_0x984ba3(0x12f,0x126,0x1f1,0x18f)](_0x58dc09+',\x20',_0x55aa7d['Character\x20'+_0x1cda5d+_0x140354(0x455,0x49d,0x3e9,0x431)]));}}else _0x2b069f['on'](_0x4ddd43[_0x140354(0x551,0x522,0x473,0x4da)+'MAGE_REQUE'+'ST'],_0x1550ca),_0x5e9220[_0x140354(0x4f4,0x4d1,0x40a,0x493)](_0x21751c,_0x5e9220[_0x984ba3(0xdd,0x22c,0x14c,0x189)]);}else _0x5e9220[_0x984ba3(0x1b6,0x1b1,0x10a,0x11c)](addLog,_0x5e9220['ejpAK']),_0x179f86=_0x3abb67;let {modifiedPrompt:_0x48830d,insertions:_0x27b3a0}=await prompt_replace(_0x179f86,_0x58dc09);if(_0xca6371)for(let _0xfee64d=-0x652+0x1090+-0xa3d;_0x5e9220[_0x140354(0x463,0x426,0x428,0x405)](_0xfee64d,0x892+0x131b+0x49*-0x61);_0xfee64d++){_0x55aa7d['Character\x20'+_0xfee64d+_0x984ba3(0x1a3,0x164,0x184,0x14b)]&&(_0x5e9220[_0x984ba3(0x110,0x1c6,0xd6,0x177)](_0x5e9220[_0x140354(0x439,0x3d9,0x4e0,0x470)],_0x5e9220['xiNsp'])?_0x48830d=_0x5e9220[_0x140354(0x3ee,0x3e4,0x435,0x42e)](_0x5e9220['sElZr'](_0x48830d,',\x20'),prompt_replace_for_character(_0x55aa7d['Character\x20'+_0xfee64d+_0x984ba3(0x18b,0x109,0x1e2,0x14b)])):_0x71bc9b=![]);}let _0x49c5d7=await _0x5e9220['cJxzN'](zhengmian,extension_settings[extensionName][_0x984ba3(0x180,0x17a,0x255,0x1aa)][extension_settings[extensionName][_0x140354(0x468,0x354,0x40a,0x3e8)]]['fixedPromp'+'t'],_0x48830d,extension_settings[extensionName]['yushe'][extension_settings[extensionName][_0x984ba3(0x17a,0xce,0x176,0x102)]][_0x140354(0x3d2,0x4a2,0x497,0x3fd)+'t_end'],extension_settings[extensionName][_0x984ba3(0xe4,0x16d,0x127,0x161)],_0x27b3a0),_0x3c61ed=await _0x5e9220[_0x140354(0x3c9,0x4a4,0x40d,0x43f)](fumian,extension_settings[extensionName][_0x140354(0x480,0x4fe,0x46c,0x490)][extension_settings[extensionName][_0x984ba3(0xcc,0x168,0x174,0x102)]][_0x984ba3(0xc2,0x1a8,0x1ec,0x141)+_0x140354(0x4ff,0x3e7,0x4b0,0x48b)],extension_settings[extensionName][_0x140354(0x4cf,0x4fe,0x55f,0x4dc)]);addLog(_0x984ba3(0x2c0,0x21a,0x2e7,0x248)+_0x3c61ed),extension_settings['sd'][_0x5e9220['jowYH']]=_0x178d44,await _0x5e9220[_0x984ba3(0x1ae,0x1c1,0x157,0x156)](saveSettingsDebounced);try{if(_0x5e9220[_0x140354(0x405,0x4a3,0x364,0x3fc)](_0x1c2120[_0x140354(0x573,0x42e,0x4b0,0x4c9)],_0x5e9220[_0x140354(0x343,0x36e,0x484,0x3ec)])){const _0x52b3bb={};_0x52b3bb[_0x140354(0x3a4,0x399,0x33a,0x3de)]=_0x1c2120[_0x984ba3(0x1cb,0x27f,0x163,0x1e1)+_0x140354(0x457,0x51a,0x501,0x4d0)]?_0x1c2120[_0x984ba3(0x1be,0x23a,0x204,0x1e1)+'sd_auth']:'',_0x52b3bb[_0x140354(0x4ae,0x499,0x58a,0x4e6)]=_0x178d44;const _0x520215=await fetch(_0x5e9220['WSSfz'],{'method':_0x5e9220[_0x140354(0x55a,0x52b,0x55a,0x4f3)],'body':JSON['stringify'](_0x52b3bb),'headers':_0x5e9220[_0x984ba3(0x19c,0x1f3,0x1cc,0x1ee)](getRequestHeaders,window[_0x984ba3(0x23c,0x1f5,0x135,0x1cb)])});if(!_0x520215['ok']){addLog(_0x984ba3(0x27f,0x28b,0x199,0x245)+_0x520215[_0x984ba3(0x224,0x2bf,0x258,0x243)]+'\x20'+_0x520215['statusText']);throw new Error(_0x984ba3(0x2db,0x1c6,0x213,0x245)+_0x520215[_0x140354(0x599,0x4fd,0x5b1,0x529)]+'\x20'+_0x520215[_0x984ba3(0xf2,0x103,0x11d,0x188)]);}let _0x4d2b9c=await _0x520215[_0x140354(0x48b,0x49e,0x528,0x495)]();console[_0x984ba3(0xdb,0x142,0x1ba,0x129)](_0x140354(0x34d,0x351,0x384,0x3f0)+_0x984ba3(0x1b8,0x14d,0x1ec,0x1f5),_0x4d2b9c),console[_0x140354(0x3ac,0x3db,0x41e,0x40f)](_0x5e9220[_0x140354(0x471,0x4a7,0x5af,0x508)],_0x1c2120[_0x984ba3(0x10a,0x83,0x10d,0x114)+_0x984ba3(0x1dc,0x27e,0x27c,0x1eb)]);if(_0x5e9220[_0x140354(0x4ef,0x3e0,0x497,0x458)](_0x4d2b9c,_0x1c2120[_0x140354(0x383,0x471,0x44c,0x3fa)+_0x984ba3(0x1ea,0x296,0x1e0,0x1eb)])){if(_0x140354(0x40b,0x3fb,0x47a,0x44c)===_0x5e9220[_0x140354(0x3d7,0x3e5,0x48b,0x3f1)]){addLog('正在设置模型为'+_0x1c2120[_0x140354(0x3c4,0x483,0x351,0x3fa)+_0x984ba3(0x194,0x1fd,0x1fd,0x1eb)]+_0x984ba3(0x24e,0x2aa,0x1d2,0x20a)),toastr['info'](_0x140354(0x3dc,0x4ed,0x4dd,0x487)+_0x1c2120['sd_cchatu_'+_0x140354(0x515,0x572,0x53f,0x4d1)]);const _0x17d8d0={};_0x17d8d0['auth']=_0x1c2120[_0x140354(0x564,0x467,0x465,0x4c7)+_0x984ba3(0x241,0x162,0x279,0x1ea)]?_0x1c2120[_0x984ba3(0x182,0x1c5,0x1dd,0x1e1)+_0x140354(0x48a,0x52d,0x53a,0x4d0)]:'',_0x17d8d0[_0x984ba3(0x22f,0x1b9,0x216,0x200)]=_0x178d44,_0x17d8d0['model']=_0x1c2120[_0x984ba3(0x15a,0x152,0xe8,0x114)+'8_model'];const _0x27c6a1=await fetch(_0x5e9220[_0x984ba3(0x23d,0x262,0x1cb,0x1fa)],{'method':_0x5e9220[_0x984ba3(0x2b8,0x242,0x241,0x20d)],'body':JSON[_0x984ba3(0x286,0x232,0x2f8,0x24b)](_0x17d8d0),'headers':getRequestHeaders(window[_0x984ba3(0x1cb,0x1ac,0x15a,0x1cb)])});if(!_0x27c6a1['ok']){if(_0x5e9220[_0x140354(0x58f,0x555,0x4b1,0x528)](_0x5e9220['xXflq'],_0x5e9220['xXflq'])){_0x5e9220[_0x984ba3(0x131,0x129,0x5e,0x100)](addLog,_0x140354(0x3b9,0x4b2,0x489,0x412)+_0x27c6a1[_0x984ba3(0x2f0,0x2db,0x1b5,0x243)]+'\x20'+_0x27c6a1[_0x140354(0x4af,0x50f,0x4b3,0x46e)]);throw new Error('切换模型失败:\x20'+_0x27c6a1[_0x140354(0x537,0x505,0x50c,0x529)]+'\x20'+_0x27c6a1['statusText']);}else{_0x5e9220['KRpOj'](_0x624b91,_0x140354(0x44d,0x402,0x490,0x407));throw new _0x43eed5(_0x5e9220[_0x140354(0x47b,0x4b5,0x4f6,0x4ca)]);}}toastr['info'](_0x984ba3(0x170,0xec,0x17c,0x10c)+_0x1c2120['sd_cchatu_'+'8_model']+'成功');}else _0x5e9220[_0x140354(0x478,0x493,0x4e5,0x493)](_0xb52977,_0x140354(0x4e4,0x51e,0x57c,0x4e9)+'库');}}else{if(_0x5e9220[_0x984ba3(0x287,0x2ee,0x28b,0x242)](_0x5e9220[_0x984ba3(0x17f,0xa6,0x1af,0x12f)],_0x5e9220[_0x984ba3(0x213,0x187,0x135,0x19f)])){_0x474365[_0x984ba3(0xdc,0x1eb,0xee,0x171)]=!![];if(_0x5e9220[_0x140354(0x4f1,0x3b6,0x414,0x45d)](_0x88a4a2[_0x140354(0x456,0x425,0x528,0x4b0)],_0x5e9220[_0x140354(0x538,0x4ae,0x4fc,0x4ca)])){}else _0x4f4748[_0x984ba3(0x163,0xe7,0xe2,0x14c)+'sk'](_0x3aaa2d,![]);_0x15a92a=null,_0x5e9220[_0x984ba3(0x165,0x143,0x164,0x1ad)](_0x377d05,_0x140354(0x4a6,0x3b0,0x41d,0x455)+_0x4f1b3e[_0x140354(0x4f0,0x485,0x42e,0x4b0)]),_0x2dc0f7['error'](_0x5e9220['kVagZ'],_0x29b78b);throw _0x10f870;}else{let _0x30d2b1=await _0x5e9220[_0x140354(0x409,0x475,0x36f,0x408)](getSDMode,_0x178d44);if(_0x5e9220[_0x140354(0x3fb,0x47b,0x4d2,0x489)](_0x30d2b1,_0x1c2120[_0x140354(0x480,0x3ef,0x418,0x3fa)+_0x140354(0x563,0x50e,0x461,0x4d1)])){if(_0x140354(0x3ef,0x386,0x385,0x3e2)===_0x5e9220[_0x984ba3(0x249,0x2b2,0x232,0x212)])_0x5e9220[_0x984ba3(0x1be,0x1c5,0x258,0x1ad)](addLog,_0x140354(0x3e4,0x4d3,0x3be,0x42f)+_0x1c2120[_0x140354(0x3bb,0x46f,0x46f,0x3fa)+_0x140354(0x471,0x4de,0x57b,0x4d1)]+_0x984ba3(0x286,0x2a8,0x2b5,0x20a)),await _0x5e9220[_0x984ba3(0x13a,0x125,0x1d6,0x159)](setSDMode,_0x178d44,_0x1c2120['sd_cchatu_'+'8_model']);else{const _0x39bdc1='SD生图流程捕获到异'+_0x984ba3(0x28a,0x180,0x283,0x1dc)+_0xdd319d+_0x984ba3(0x140,0x189,0x193,0x11b)+_0xc3eee7['message'];_0x5e9220[_0x140354(0x46d,0x4ba,0x3ef,0x423)](_0x1df350,'错误:\x20'+_0x39bdc1),_0xdc629d[_0x140354(0x36f,0x3f3,0x432,0x3e9)](_0x984ba3(0x22f,0x21f,0x1b4,0x1ac)+_0x140354(0x41f,0x475,0x3d4,0x426)+_0x140354(0x36e,0x351,0x422,0x3d6),_0x286b61);const _0x5cfe26={};_0x5cfe26['id']=_0x408648,_0x5cfe26[_0x984ba3(0xac,0x144,0xfc,0x119)]=![],_0x5cfe26[_0x140354(0x38b,0x444,0x37a,0x3e9)]=_0x477ad8['message'],_0x5cfe26['prompt']=_0x564499,_0x1b2c0b[_0x140354(0x51e,0x51d,0x488,0x527)](_0xa94a4e['GENERATE_I'+_0x140354(0x403,0x4d0,0x452,0x430)+_0x140354(0x446,0x508,0x4e1,0x4c0)],_0x5cfe26),_0x402b36(_0x984ba3(0x1dc,0x23a,0x25c,0x1c2)+_0x140354(0x492,0x431,0x3e4,0x3f4)+_0x2d8c6e+')');}}}}}catch(_0x3c8551){if(_0x5e9220[_0x984ba3(0x231,0x20e,0x241,0x1b4)](_0x984ba3(0x168,0x1b5,0x1b4,0x13c),_0x5e9220[_0x984ba3(0xd1,0x1e6,0x108,0x165)])){_0x5e9220[_0x140354(0x3b2,0x414,0x43e,0x445)](addLog,_0x140354(0x4cc,0x4c2,0x524,0x479)+':\x20'+_0x3c8551[_0x140354(0x50f,0x484,0x40d,0x4b0)]+(_0x984ba3(0xf0,0xa7,0x1c9,0x150)+'i是否正常启动，并检'+_0x140354(0x3e2,0x42c,0x3d9,0x440))),taskQueue[_0x140354(0x45b,0x4a6,0x3d0,0x432)+'sk'](_0x43968f,![]),currentTaskId=null;throw new Error(_0x984ba3(0xe9,0x135,0x1f3,0x193)+_0x140354(0x408,0x39d,0x476,0x41d)+_0x984ba3(0x178,0x1b0,0x14b,0x16d)+_0x984ba3(0x1e6,0x114,0x1b3,0x15a));}else{const _0x2fe4e5=_0x4e7110[_0x140354(0x379,0x3ee,0x3c8,0x40e)](_0x49e58f);_0x441d23=_0x2fe4e5[_0x984ba3(0x11f,0x179,0x143,0x1b9)][0x13d*-0x11+-0x3*0x234+0x1ba9];}}let _0x4c7b58=-(0x448+0x1*0x16f7+0xb*-0x27a);const _0x569f2f=_0x1c2120[_0x984ba3(0x1bf,0x1bb,0x258,0x240)];_0x5e9220[_0x984ba3(0x13a,0x10b,0x1b3,0x1b4)](_0x569f2f,'')&&_0x5e9220[_0x140354(0x48c,0x436,0x4db,0x49a)](_0x569f2f,null)&&!_0x5e9220['gktuJ'](isNaN,_0x5e9220[_0x140354(0x442,0x4ef,0x4fa,0x4d6)](Number,_0x569f2f))&&_0x5e9220[_0x984ba3(0x204,0x276,0x1f3,0x23e)](_0x5e9220[_0x984ba3(0x113,0x18a,0x186,0x100)](Number,_0x569f2f),0x40c+-0x1d78+0xcb6*0x2)&&(_0x4c7b58=_0x5e9220[_0x140354(0x5d3,0x49a,0x49d,0x52c)](Number,_0x569f2f));let _0x2d7d8e={'prompt':_0x49c5d7,'negative_prompt':_0x3c61ed,'sampler_name':_0x1c2120['sd_cchatu_'+_0x984ba3(0x96,0x98,0xfc,0xfe)+_0x140354(0x47d,0x4a0,0x4ae,0x452)],'scheduler':_0x1c2120['sd_cchatu_'+_0x984ba3(0xef,0x171,0xfc,0x158)+'r'],'steps':_0x1c2120['sd_csteps'],'cfg_scale':_0x1c2120[_0x140354(0x36d,0x49f,0x3a0,0x403)],'width':_0x57daf6?_0x57daf6:_0x1c2120[_0x984ba3(0x218,0x275,0x155,0x1d1)],'height':_0x34dc26?_0x34dc26:_0x1c2120[_0x984ba3(0xfe,0x142,0x1d7,0x12b)],'restore_faces':_0x1c2120[_0x140354(0x453,0x53e,0x556,0x4c4)+'es']==_0x5e9220[_0x984ba3(0x1c9,0x16f,0x1a3,0x151)],'enable_hr':_0x5e9220['iXwEK'](_0x1c2120['sd_chires_'+_0x140354(0x4ba,0x3d0,0x4b6,0x47c)],'true'),'hr_upscaler':_0x1c2120[_0x140354(0x492,0x4a4,0x399,0x3fa)+_0x140354(0x4ed,0x3d7,0x42e,0x456)],'hr_scale':_0x1c2120[_0x984ba3(0x1da,0x1e6,0x140,0x197)+_0x140354(0x517,0x522,0x54b,0x4b2)],'hr_additional_modules':[],'denoising_strength':_0x1c2120['sd_cdenois'+_0x140354(0x407,0x4be,0x4aa,0x45b)+'th'],'hr_second_pass_steps':_0x1c2120[_0x984ba3(0x139,0x1db,0xe2,0x145)+_0x140354(0x54c,0x419,0x4bd,0x4ae)],'seed':_0x4c7b58,'override_settings':{'CLIP_stop_at_last_layers':Number(_0x1c2120[_0x140354(0x523,0x4a5,0x453,0x4d8)+_0x984ba3(0x239,0x18a,0x21e,0x22f)]),'sd_vae':_0x1c2120['sd_cchatu_'+'8_vae']},'override_settings_restore_afterwards':!![],'save_images':!![],'send_images':!![],'do_not_save_grid':![],'do_not_save_samples':![]};_0x5e9220[_0x140354(0x4cc,0x405,0x4d3,0x493)](addLog,_0x984ba3(0x217,0x137,0x1fb,0x187)+_0x140354(0x367,0x3c6,0x3c3,0x3f3)+_0x2d7d8e['restore_fa'+_0x140354(0x3cf,0x480,0x3a8,0x3ee)]),_0x5e9220[_0x140354(0x3d4,0x3fa,0x488,0x421)](addLog,_0x140354(0x427,0x40e,0x412,0x3f9)+_0x984ba3(0x17a,0x260,0x2c4,0x21c)+_0x2d7d8e['enable_hr']);_0x1c2120[_0x984ba3(0x2ab,0x2ac,0x2da,0x231)+_0x140354(0x439,0x448,0x50d,0x46c)]==_0x984ba3(0x23b,0x272,0x27a,0x1e7)&&(_0x5e9220['qAEgo']!==_0x5e9220[_0x984ba3(0x194,0x1e2,0x16a,0x134)]?(_0x5e9220[_0x984ba3(0x198,0x1da,0x159,0x1a0)](addLog,_0x5e9220[_0x140354(0x509,0x5bc,0x54e,0x523)]),_0x2d7d8e=_0x5e9220['FjpSV'](deepMerge,_0x2d7d8e,{'alwayson_scripts':{'ADetailer':{'args':[!![],!![],{'ad_model':_0x5e9220[_0x140354(0x34f,0x48f,0x431,0x3f8)]}]}}})):_0x51d186[_0x984ba3(0x1a4,0x115,0x111,0x155)+_0x1646cc+'\x20Prompt']&&(_0x2d536c=_0x5e9220[_0x984ba3(0x1bf,0x1ff,0x1db,0x19b)](_0x5e9220[_0x984ba3(0x1db,0x14b,0x1cf,0x19b)](_0x21ba7f,',\x20'),_0x5e9220[_0x984ba3(0x176,0xe1,0x1ab,0x13d)](_0x1fd566,_0xaa5370['Character\x20'+_0x253845+_0x984ba3(0xc3,0x121,0x1d6,0x14b)]))));const _0x4c5e83=_0x140354(0x52e,0x4bf,0x482,0x4dd)+_0x140354(0x45f,0x53a,0x481,0x4ac)+_0x984ba3(0x13e,0xa9,0xa0,0xf6)+_0x140354(0x3f9,0x452,0x368,0x406)+_0x49c5d7+('\x0a-\x20**负面提示\x20'+'(Negative\x20'+_0x984ba3(0x1e4,0x23b,0x282,0x1f1)+'\x20')+_0x3c61ed+(_0x140354(0x437,0x3ad,0x4b1,0x43d)+_0x984ba3(0x15b,0x224,0x181,0x1c3)+_0x140354(0x50c,0x4d4,0x43a,0x4b9))+_0x2d7d8e[_0x140354(0x43b,0x430,0x510,0x4cf)+'me']+(_0x140354(0x417,0x42d,0x466,0x4be)+'teps):**\x20')+_0x2d7d8e[_0x140354(0x4a5,0x40e,0x414,0x4ae)]+('\x0a-\x20**CFG\x20S'+'cale:**\x20')+_0x2d7d8e[_0x140354(0x495,0x443,0x4ae,0x42c)]+('\x0a-\x20**尺寸\x20(S'+_0x140354(0x4b7,0x57a,0x530,0x4fb))+_0x2d7d8e['width']+'x'+_0x2d7d8e[_0x140354(0x5aa,0x51d,0x4ee,0x516)]+(_0x140354(0x4da,0x488,0x461,0x465)+_0x984ba3(0x195,0x145,0x152,0x1ec))+(_0x5e9220['WvSYs'](_0x2d7d8e[_0x140354(0x3f9,0x3be,0x476,0x435)],-(0x2107+-0x1cce+0x12*-0x3c))?_0x140354(0x434,0x4b7,0x46e,0x4c3):_0x2d7d8e[_0x984ba3(0x132,0x1af,0x1d0,0x14f)])+(_0x140354(0x409,0x3c7,0x3a0,0x3e7)+_0x140354(0x372,0x453,0x47b,0x420))+_0x1c2120[_0x984ba3(0x17f,0x92,0xd7,0x114)+'8_model']+(_0x984ba3(0x26d,0x27e,0x178,0x1d9)+'*\x20')+_0x2d7d8e[_0x984ba3(0x1b8,0x14d,0xe4,0x185)+_0x984ba3(0x126,0x14d,0x15a,0x169)][_0x984ba3(0xe8,0xc4,0x189,0x131)]+(_0x984ba3(0x128,0x1a5,0x1cb,0x147)+_0x984ba3(0x189,0x207,0x113,0x160))+_0x2d7d8e[_0x140354(0x498,0x419,0x4b0,0x46b)+_0x140354(0x4a5,0x3df,0x46f,0x44f)][_0x984ba3(0x27d,0x1de,0x24f,0x232)+'at_last_la'+_0x140354(0x4ae,0x48b,0x4e7,0x51a)]+(_0x140354(0x3f9,0x4a5,0x3a5,0x44a)+_0x984ba3(0x217,0x19a,0x19e,0x1bc)+_0x140354(0x35c,0x47b,0x417,0x3ed))+_0x2d7d8e[_0x140354(0x59a,0x52c,0x531,0x513)]+(_0x984ba3(0x174,0x19b,0x273,0x216)+_0x140354(0x51c,0x412,0x416,0x4bd)+_0x984ba3(0x62,0x103,0xc7,0xfa))+_0x2d7d8e['hr_scale']+('\x0a-\x20**重绘幅度\x20'+_0x984ba3(0x2db,0x1ce,0x2bd,0x24a)+'\x20Strength)'+_0x140354(0x3a6,0x34f,0x453,0x3dd))+_0x2d7d8e['denoising_'+_0x984ba3(0x1e7,0x14a,0xe0,0x17b)]+('\x0a-\x20**脸部修复\x20'+_0x140354(0x4e8,0x4c3,0x448,0x45c)+_0x140354(0x4b5,0x3e0,0x395,0x41f))+_0x2d7d8e[_0x140354(0x3d5,0x414,0x4f6,0x46d)+_0x984ba3(0x90,0x83,0x89,0x108)]+(_0x140354(0x520,0x46f,0x592,0x503)+_0x140354(0x47f,0x479,0x547,0x4cb))+(_0x1c2120[_0x140354(0x5ae,0x5bd,0x52c,0x517)+_0x140354(0x431,0x3ec,0x3e4,0x46c)]==_0x5e9220[_0x984ba3(0xb1,0x194,0x1b8,0x151)])+_0x140354(0x4da,0x4a3,0x4b3,0x4d5);_0x5e9220[_0x984ba3(0x297,0x1d1,0x1cf,0x219)](addLog,_0x4c5e83),_0x5e9220['DGvUB'](addLog,_0x984ba3(0x184,0x13f,0x148,0x1ae)+'数为'+JSON[_0x140354(0x566,0x594,0x514,0x531)](_0x2d7d8e)),console[_0x140354(0x465,0x480,0x37d,0x40f)](_0x984ba3(0x14d,0x22f,0x248,0x1bd),_0x2d7d8e);let _0x47e08e=!![];while(_0x47e08e){if(window[_0x140354(0x446,0x43f,0x3fc,0x457)]){if(_0x5e9220[_0x140354(0x512,0x3f6,0x462,0x49a)](_0x5e9220[_0x984ba3(0x1d6,0x118,0x201,0x162)],_0x984ba3(0x275,0x18b,0x1ee,0x214)))return _0x4e908d['toString']()[_0x984ba3(0x170,0x18b,0x1b3,0x1fd)](rEOeRk[_0x984ba3(0x27f,0x1a5,0x280,0x206)])['toString']()[_0x140354(0x3d6,0x39e,0x376,0x40a)+'r'](_0x2f7047)[_0x140354(0x484,0x471,0x4dc,0x4e3)](_0x140354(0x38e,0x47e,0x38d,0x41b)+'+$');else _0x47e08e=![];}else await _0x5e9220[_0x984ba3(0xae,0xa8,0xe2,0x123)](sleep,-0x62e+-0x1*0x3b3+0xdc9);};function _0x984ba3(_0x3a68aa,_0x5e99a7,_0xf9d8cd,_0x5eae22){return _0x3aa9(_0x5eae22- -0xdd,_0x3a68aa);}try{if(_0x5e9220['rArMW'](_0x5e9220[_0x140354(0x3c0,0x41c,0x4c4,0x439)],_0x984ba3(0x205,0x1b4,0x141,0x1bf))){window[_0x984ba3(0x1c9,0x1f9,0x1e4,0x171)]=!![],taskQueue[_0x984ba3(0x1cd,0x110,0x139,0x133)+'us'](_0x43968f,_0x5e9220[_0x984ba3(0x1ec,0x11b,0x1bd,0x174)]);if(_0x5e9220[_0x984ba3(0x188,0x1e2,0x171,0x1ce)](_0x1c2120[_0x140354(0x43d,0x507,0x4a4,0x4c9)],_0x5e9220[_0x984ba3(0xd8,0x167,0x67,0x106)])){if(!taskQueue['isTaskInQu'+_0x140354(0x392,0x431,0x4e3,0x43a)](_0x43968f)){if(_0x5e9220[_0x140354(0x45a,0x546,0x489,0x49a)](_0x5e9220['bfwyU'],_0x5e9220['bfwyU'])){_0x5e9220[_0x984ba3(0x1a2,0xbb,0x15d,0x122)](_0x1d84ce,_0x466a50);return;}else{addLog(_0x140354(0x4b2,0x491,0x3ad,0x407)),eventSource[_0x984ba3(0x29d,0x230,0x221,0x241)](_0x5e9220[_0x984ba3(0x10b,0xba,0x149,0x163)]);throw new Error('任务已取消');}}_0x2d7d8e[_0x984ba3(0x21a,0x222,0x1fe,0x200)]=_0x178d44,console[_0x140354(0x44b,0x3a1,0x363,0x40f)](_0x5e9220[_0x140354(0x4f1,0x4bf,0x4eb,0x4af)],_0x1c2120['st_chatu8_'+_0x984ba3(0x1dc,0x1e1,0x293,0x1ea)]),_0x2d7d8e[_0x984ba3(0x135,0x9f,0xdc,0xf8)]=_0x1c2120[_0x140354(0x4aa,0x437,0x432,0x4c7)+_0x140354(0x4e5,0x520,0x484,0x4d0)]?_0x1c2120[_0x984ba3(0x1db,0x23a,0x275,0x1e1)+_0x140354(0x4e4,0x422,0x4d5,0x4d0)]:'';const _0x20fc7f=await _0x5e9220[_0x984ba3(0x102,0x1b7,0x1ef,0x159)](fetch,'/api/sd/ge'+'nerate',{'method':_0x5e9220[_0x140354(0x4ba,0x586,0x524,0x4f3)],'headers':_0x5e9220[_0x984ba3(0x119,0x19f,0x20d,0x1a0)](getRequestHeaders,window['token']),'body':JSON[_0x140354(0x4ef,0x4c6,0x593,0x531)](_0x2d7d8e)});if(!_0x20fc7f['ok']){if(_0x5e9220[_0x984ba3(0x14c,0x15c,0x207,0x1b4)](_0x5e9220[_0x984ba3(0x136,0xef,0x105,0x15c)],_0x5e9220[_0x984ba3(0xc1,0x1aa,0x176,0x15c)]))_0x228dd0=!![];else{const _0x1fea5c=await _0x20fc7f['text']();addLog(_0x140354(0x3a0,0x45a,0x3e8,0x3da)+_0x984ba3(0x1e5,0xdc,0x188,0x143)+_0x20fc7f[_0x984ba3(0x2d4,0x19c,0x246,0x243)]+_0x984ba3(0x174,0x15e,0x23b,0x1a7)+_0x1fea5c),console['log']('响应内容:',_0x1fea5c);throw new Error(_0x140354(0x4df,0x46f,0x501,0x4c8)+_0x20fc7f[_0x140354(0x4fd,0x5cd,0x4ed,0x529)]+_0x984ba3(0xe8,0xc6,0xad,0xf1)+_0x1fea5c);}}const _0x31b427=await _0x20fc7f[_0x984ba3(0x196,0x160,0x19c,0x1af)]();let _0x2c7842='';try{if(_0x5e9220[_0x140354(0x451,0x4c7,0x533,0x49a)](_0x5e9220[_0x984ba3(0x232,0x195,0x219,0x19c)],_0x5e9220['jCPRZ']))_0x5e9220[_0x140354(0x4c0,0x4de,0x44c,0x445)](_0x476b38,_0x140354(0x5b8,0x4ed,0x46e,0x50f)+_0x140354(0x3e0,0x499,0x3da,0x471)),_0x249713=_0x43f761;else{const _0x3b911c=JSON[_0x140354(0x403,0x47d,0x3b2,0x40e)](_0x31b427);_0x2c7842=_0x3b911c['images'][-0x1d94+0x16*-0x18e+0x13a*0x34];}}catch(_0x112852){_0x5e9220[_0x984ba3(0x1ff,0x212,0x217,0x1b3)](addLog,_0x5e9220[_0x140354(0x4ca,0x4f6,0x4dd,0x4f2)]),_0x2c7842=_0x31b427;}const _0x118bb2=_0x5e9220[_0x984ba3(0x1e5,0x208,0x224,0x23f)]+_0x2c7842;_0x5e9220[_0x140354(0x432,0x445,0x509,0x499)](addLog,_0x5e9220['mGGdP']),taskQueue[_0x140354(0x3b2,0x407,0x444,0x432)+'sk'](_0x43968f,!![]),currentTaskId=null;const _0x266424={};return _0x266424[_0x140354(0x4db,0x4ab,0x479,0x472)]=_0x118bb2,_0x266424['change']=_0x319b50||'',_0x266424;}else{if(!taskQueue[_0x140354(0x5ad,0x4a3,0x4ee,0x514)+_0x984ba3(0x138,0x10f,0xaa,0x154)](_0x43968f)){_0x5e9220['HSROA'](addLog,_0x5e9220[_0x984ba3(0x206,0x24f,0x19a,0x205)]);throw new Error(_0x5e9220[_0x984ba3(0x23b,0x20a,0x1b1,0x1e4)]);}const _0x246b09=new URL(_0x178d44+_0x5e9220[_0x140354(0x45d,0x462,0x413,0x497)]);window['xiancheng']=![];const _0x550b26=await _0x5e9220['VZJBr'](fetch,_0x246b09,{'method':_0x5e9220['GDWRW'],'body':JSON[_0x140354(0x5b3,0x512,0x557,0x531)](_0x2d7d8e),'headers':{'Content-Type':_0x5e9220[_0x984ba3(0x140,0x270,0x19d,0x1e6)],'Authorization':getsdAuth()}});window[_0x984ba3(0x12e,0xec,0x21b,0x171)]=!![];if(!_0x550b26['ok']){const _0x586dbb=await _0x550b26[_0x984ba3(0x253,0x1c4,0x167,0x1af)]();_0x5e9220['gMTDx'](addLog,_0x140354(0x482,0x406,0x3dc,0x40c)+_0x984ba3(0x134,0xdb,0x18a,0xf9)+_0x550b26[_0x984ba3(0x2e1,0x27f,0x295,0x243)]+'。响应内容:\x20'+_0x586dbb),console['log'](_0x5e9220[_0x984ba3(0x157,0x201,0x208,0x1a4)],_0x586dbb);throw new Error('请求失败,状态码:\x20'+_0x550b26[_0x984ba3(0x25d,0x1b4,0x2a0,0x243)]+',\x20详情:\x20'+_0x586dbb);}const _0xebc532=await _0x550b26['json']();if(!_0xebc532[_0x984ba3(0x192,0x204,0x1c2,0x1b9)]||_0xebc532[_0x984ba3(0x266,0x23f,0x17c,0x1b9)][_0x984ba3(0x241,0x2ad,0x259,0x22c)]===0x1d24+0x5*-0x2c9+0x13*-0xcd){if(_0x5e9220[_0x984ba3(0x1c4,0x255,0x275,0x1ed)]!==_0x5e9220[_0x140354(0x49e,0x4f1,0x52f,0x496)])throw new Error(_0x5e9220[_0x140354(0x4e4,0x3cb,0x497,0x444)]);else _0x5b8b8a=_0x5e9220['PbeET'](_0x5e9220[_0x140354(0x46e,0x3fd,0x4b9,0x428)](_0x1a83a4,',\x20'),_0x5e9220[_0x140354(0x36a,0x37c,0x460,0x408)](_0x588c28,_0x88b019[_0x984ba3(0xf3,0x1af,0x136,0x155)+_0x49b8a2+_0x140354(0x41d,0x3cc,0x385,0x431)]));}const _0x780fa8=_0xebc532[_0x140354(0x49d,0x524,0x494,0x49f)][0xdf+-0x1*-0x763+-0x842],_0x86fb88=_0x5e9220[_0x984ba3(0x11d,0x140,0x168,0x125)](_0x5e9220[_0x140354(0x5a4,0x532,0x562,0x525)],_0x780fa8);return _0x5e9220[_0x140354(0x4e8,0x514,0x503,0x4b6)](addLog,_0x140354(0x4ac,0x479,0x479,0x4ef)+_0x984ba3(0x183,0x22c,0x239,0x1ba)+'L。'),taskQueue['completeTa'+'sk'](_0x43968f,!![]),currentTaskId=null,{'image':_0x86fb88,'change':_0x5e9220['dFqFt'](_0x1513cf,'')};}}else _0x3e0d44=_0x3c879a(_0x44549d);}catch(_0x51d1c9){window[_0x984ba3(0x21f,0x178,0x21b,0x171)]=!![];if(_0x5e9220[_0x984ba3(0x2d2,0x200,0x21d,0x242)](_0x51d1c9[_0x984ba3(0x215,0x26c,0x1a1,0x1ca)],_0x5e9220[_0x984ba3(0x210,0x20c,0x19b,0x1e4)])){}else _0x5e9220['BeohD'](_0x5e9220[_0x140354(0x3f1,0x4c9,0x44c,0x484)],_0x5e9220[_0x140354(0x4d6,0x4a7,0x5d3,0x52d)])?_0x562c0d[_0x984ba3(0x18c,0x1e9,0x1b5,0x155)+_0x477f94+_0x984ba3(0x19a,0xa4,0xbf,0x14b)]&&(_0x43b937=_0x5e9220[_0x140354(0x3db,0x3c5,0x3ae,0x42e)](_0x5e9220[_0x140354(0x418,0x49d,0x4c9,0x475)](_0x60617f,',\x20'),_0x4e0918[_0x984ba3(0x1c0,0x130,0x1bb,0x155)+_0x19984a+_0x984ba3(0x196,0x134,0x13d,0x14b)])):taskQueue['completeTa'+'sk'](_0x43968f,![]);currentTaskId=null,_0x5e9220[_0x140354(0x377,0x3f3,0x462,0x3fb)](addLog,_0x140354(0x3c3,0x3f7,0x3e0,0x455)+_0x51d1c9['message']),console[_0x140354(0x44a,0x488,0x38d,0x3e9)](_0x5e9220['kVagZ'],_0x51d1c9);throw _0x51d1c9;}}async function sdGenerate(_0x37c704){const _0x226e76={'hOEQr':function(_0x49a54f,_0x4f1fe2){return _0x49a54f(_0x4f1fe2);},'Cnzgq':_0x11b8da(0x4cb,0x4b6,0x524,0x501)+_0x576dfb(0x185,0x16f,0x13d,0x1c7),'wsAzu':function(_0x37e978){return _0x37e978();},'QJgXr':function(_0x43e11e,_0x4cb713){return _0x43e11e(_0x4cb713);},'SpNRM':function(_0x2dabd9,_0x5176dc){return _0x2dabd9(_0x5176dc);},'ERGte':'{修图}','ngfkY':function(_0x112bcc,_0x2152f6){return _0x112bcc!==_0x2152f6;},'ZtqPI':'KBgCi','ihkhk':_0x576dfb(0x95,0xa3,0xe4,0x120),'vgUyG':function(_0x196567,_0x2ec6ae){return _0x196567(_0x2ec6ae);},'axypO':function(_0x3cf3e1,_0x1a5f73){return _0x3cf3e1===_0x1a5f73;},'PRvMP':_0x11b8da(0x4f8,0x458,0x510,0x497),'JZxxh':function(_0x4e6269,_0x264749,_0x347880,_0x2d49e9){return _0x4e6269(_0x264749,_0x347880,_0x2d49e9);},'mbnYP':function(_0x63bc13,_0x1599c5){return _0x63bc13(_0x1599c5);},'lVcKh':'YvzRe','WxJGG':function(_0x2614bf,_0x362a85){return _0x2614bf(_0x362a85);},'kgdjY':_0x11b8da(0x484,0x4af,0x466,0x3ee)+_0x576dfb(0x1ce,0x1b4,0x18e,0x16d)+'image:'},{id:_0x532855,prompt:_0x1baa9a,width:_0x407ea3,height:_0x27497f,change:_0x1a8f4f}=_0x37c704;_0x226e76[_0x576dfb(0x1d0,0x192,0x215,0x194)](addLog,_0x11b8da(0x490,0x4b0,0x49d,0x3e9)+_0x11b8da(0x4e6,0x4cf,0x44a,0x43c)+_0x532855+(_0x576dfb(0x22c,0x189,0x220,0x1ff)+':\x20')+_0x1baa9a+(_0x1a8f4f?_0x11b8da(0x426,0x417,0x3a3,0x4bc)+'\x20'+_0x1a8f4f:''));if(_0x1a8f4f&&_0x1a8f4f[_0x576dfb(0x20a,0x111,0x117,0x15d)](_0x226e76[_0x576dfb(0x27a,0x1f5,0x22e,0x266)])){if(_0x226e76['ngfkY'](_0x226e76[_0x11b8da(0x3e1,0x46d,0x36e,0x458)],_0x226e76[_0x576dfb(0x1c7,0x1b2,0x224,0x24b)])){bananaGenerate(_0x37c704);return;}else _0x574ebf[_0x576dfb(0x20c,0x232,0x221,0x238)+'ener'](_0x53e41e[_0x576dfb(0x268,0x2a8,0x1d2,0x221)+_0x576dfb(0x1b0,0x1df,0x198,0x1cf)+'ST'],_0x526076),_0x302f8f[_0x11b8da(0x4ac,0x4fb,0x410,0x50e)+'SDListener']=![],_0x226e76[_0x11b8da(0x454,0x404,0x4ab,0x406)](_0x52db6d,_0x226e76[_0x11b8da(0x4fe,0x465,0x4f3,0x598)]);}function _0x11b8da(_0x440081,_0x3d453f,_0x4537f7,_0x871dd5){return _0x3aa9(_0x440081-0x1fb,_0x4537f7);}function _0x576dfb(_0x4aaf3d,_0x1245d9,_0x1b729a,_0x523f93){return _0x3aa9(_0x523f93- -0xb0,_0x1b729a);}try{const {image:_0x4a93fb,change:_0x194006}=await _0x226e76['vgUyG'](generateSDImage,{'prompt':_0x1baa9a,'width':_0x407ea3,'height':_0x27497f,'change':_0x1a8f4f});if(extension_settings[extensionName]['cache']!='0'){if(_0x226e76[_0x576dfb(0x23a,0x31e,0x31f,0x276)](_0x226e76['PRvMP'],_0x226e76['PRvMP'])){const _0x425aae={};_0x425aae[_0x11b8da(0x50f,0x533,0x4df,0x4b0)]=_0x194006,await _0x226e76['JZxxh'](setItemImg,_0x1baa9a,_0x4a93fb,_0x425aae),_0x226e76[_0x11b8da(0x49f,0x4f8,0x4f7,0x4ad)](addLog,_0x11b8da(0x48e,0x4f7,0x4e5,0x4cd)+_0x11b8da(0x417,0x37c,0x3fe,0x4bf)+'\x20'+_0x1baa9a);}else!_0x1b9092[_0x576dfb(0x222,0x292,0x27d,0x201)+_0x576dfb(0x2d5,0x1d5,0x1fd,0x23e)]&&(_0x3e682d[_0x576dfb(0x1f4,0x23b,0x2ab,0x201)+'SDListener']=!![],_0x226e76[_0x576dfb(0xdd,0x193,0xfb,0x15b)](_0xc5ab4)),_0x3ad86e();}else{if(_0x11b8da(0x480,0x475,0x4c2,0x4e6)!==_0x226e76['lVcKh'])addLog(_0x576dfb(0x1a8,0x280,0x254,0x230)+'库');else{_0x226e76[_0x576dfb(0xf5,0x15a,0xf2,0x14b)](_0x4dea53,_0x576dfb(0x11f,0xe0,0x1ca,0x159)+_0xd25aa4[_0x11b8da(0x51b,0x57c,0x5c8,0x498)]+'\x20'+_0x1b220e[_0x576dfb(0x1f2,0x249,0x254,0x1b5)]);throw new _0x2210f2(_0x11b8da(0x404,0x431,0x37e,0x378)+_0x58326a[_0x576dfb(0x1fa,0x296,0x214,0x270)]+'\x20'+_0x4b9f0e[_0x11b8da(0x460,0x3ee,0x4ab,0x3f0)]);}}const _0x5a0f5b={};_0x5a0f5b['id']=_0x532855,_0x5a0f5b[_0x11b8da(0x3f1,0x344,0x3a3,0x368)]=!![],_0x5a0f5b[_0x11b8da(0x452,0x3cc,0x3be,0x4e2)]=_0x4a93fb,_0x5a0f5b[_0x576dfb(0x14f,0x1e8,0x11b,0x165)]=_0x1baa9a,_0x5a0f5b[_0x576dfb(0x2f3,0x2fc,0x2ff,0x264)]=_0x194006,eventSource['emit'](EventType[_0x11b8da(0x4cc,0x57a,0x4be,0x422)+_0x576dfb(0x1de,0x13f,0x1bf,0x177)+_0x11b8da(0x4b2,0x438,0x4f5,0x491)],_0x5a0f5b),addLog(_0x11b8da(0x425,0x3e8,0x3e0,0x478)+_0x576dfb(0x134,0x126,0x91,0x13b)+_0x532855+')');}catch(_0x3d56f6){const _0x283c4a=_0x576dfb(0xbb,0x118,0xc0,0x157)+'常\x20(ID:\x20'+_0x532855+'):\x20'+_0x3d56f6[_0x11b8da(0x4a2,0x452,0x46a,0x518)];_0x226e76[_0x576dfb(0x151,0x205,0x1b3,0x1d8)](addLog,_0x11b8da(0x471,0x400,0x471,0x3f6)+_0x283c4a),console[_0x11b8da(0x3db,0x42e,0x34b,0x381)](_0x226e76[_0x576dfb(0x253,0x11b,0x178,0x1ad)],_0x3d56f6);const _0x1374f8={};_0x1374f8['id']=_0x532855,_0x1374f8[_0x11b8da(0x3f1,0x3c1,0x442,0x38c)]=![],_0x1374f8[_0x576dfb(0xf0,0x88,0x129,0x130)]=_0x3d56f6[_0x576dfb(0x1b4,0x266,0x22c,0x1f7)],_0x1374f8[_0x576dfb(0x129,0x179,0x1dd,0x165)]=_0x1baa9a,eventSource[_0x11b8da(0x519,0x557,0x530,0x4e5)](EventType[_0x576dfb(0x1a0,0x1cf,0x2c3,0x221)+_0x576dfb(0x1b0,0x20d,0x1f2,0x177)+_0x576dfb(0x25e,0x26f,0x1f4,0x207)],_0x1374f8),_0x226e76[_0x11b8da(0x3f6,0x471,0x3a0,0x41b)](addLog,'发送SD生图失败响应'+'\x20(ID:\x20'+_0x532855+')');}}function initializeSDListener(){const _0x44900b={'SWqIL':function(_0x35c7d1,_0x314444){return _0x35c7d1(_0x314444);},'mYhJn':_0x1fb130(0x451,0x40e,0x3a3,0x3a6)+_0x1fb130(0x3dc,0x3ec,0x3ed,0x341)};function _0x1fb130(_0x3d5f52,_0x861ee6,_0x8dbd9,_0xf4b625){return _0x3aa9(_0x3d5f52-0x181,_0x861ee6);}eventSource['on'](EventType[_0x4159c1(0x52b,0x4ab,0x4cb,0x497)+_0x1fb130(0x400,0x417,0x393,0x354)+'ST'],sdGenerate);function _0x4159c1(_0x3538d1,_0x34472c,_0xbc7fc0,_0x4570b6){return _0x3aa9(_0x4570b6-0x1c6,_0x3538d1);}_0x44900b['SWqIL'](addLog,_0x44900b[_0x4159c1(0x529,0x54f,0x474,0x4be)]);}export async function replaceWithSd(){const _0x1bb9a4={'FyjdQ':function(_0x3da54b,_0x20bb77){return _0x3da54b+_0x20bb77;},'BynTx':function(_0x1374d1,_0x10496a){return _0x1374d1==_0x10496a;},'dvhtG':function(_0x424e77,_0x7102ce){return _0x424e77!==_0x7102ce;},'YWqYE':'FccFN','RLSrL':'hMqew','JYJqs':function(_0x2c17ba,_0x59eb03){return _0x2c17ba===_0x59eb03;},'HfybT':_0x1b0900(-0x6,0xc3,0x5e,0xb8),'NkCFK':function(_0x19cc27){return _0x19cc27();},'WeisM':function(_0x1855c2){return _0x1855c2();},'URyZL':_0x5ebd73(0x7f,0x116,0xcd,0x14a),'jNOMm':function(_0xf6be2e,_0x58712e){return _0xf6be2e(_0x58712e);}};function _0x1b0900(_0x281399,_0x1f2ee6,_0x198ec8,_0x4f522d){return _0x3aa9(_0x198ec8- -0x1e9,_0x1f2ee6);}function _0x5ebd73(_0x34320c,_0x29b853,_0x49fcfd,_0x1a9cbd){return _0x3aa9(_0x29b853- -0x203,_0x34320c);}if(_0x1bb9a4[_0x1b0900(0x105,0x197,0xf0,0xef)](extension_settings[extensionName][_0x1b0900(0xb9,0x14b,0xaf,0x14b)],'sd'))_0x1bb9a4[_0x5ebd73(0x89,0xdb,0xc2,0x76)](_0x1bb9a4[_0x5ebd73(0x50,0xf2,0x12a,0x15a)],_0x1bb9a4[_0x5ebd73(0x109,0x67,0x9b,0x13)])?(!window[_0x1b0900(0x32,0x84,0xc8,0x132)+'SDListener']&&(_0x1bb9a4[_0x5ebd73(0x8,0x37,0x5c,-0x11)]('iZQfC',_0x1bb9a4[_0x5ebd73(0x2a,0x42,-0x10,-0x68)])?_0x2fc89b['completeTa'+'sk'](_0x3c881a,![]):(window[_0x1b0900(0x129,0x6a,0xc8,0x158)+_0x1b0900(0x142,0xd9,0x105,0x6a)]=!![],_0x1bb9a4[_0x1b0900(0x14d,0xdb,0x12e,0x190)](initializeSDListener))),_0x1bb9a4[_0x5ebd73(0xa1,0x7,-0x1b,-0x1)](initializeImageProcessing)):_0x1ce7fe=_0x1bb9a4[_0x1b0900(0x89,0x21,0x78,0xf2)](_0x1bb9a4[_0x5ebd73(0x5f,0x5e,0x34,-0x3)](_0x4397e0,',\x20'),_0x38866c['Character\x20'+_0x3ede8e+_0x5ebd73(0xd1,0x25,-0x84,0xc0)]);else{if(_0x1bb9a4[_0x1b0900(0x14a,0xfd,0xf5,0x8f)](_0x5ebd73(0x112,0x80,0xa3,0x1c),_0x1bb9a4[_0x1b0900(0xeb,0x14a,0xfc,0x125)]))window['initialize'+_0x5ebd73(0x131,0xeb,0xf1,0x13d)]&&(eventSource[_0x1b0900(0x116,0x97,0xff,0x107)+'ener'](EventType['GENERATE_I'+_0x5ebd73(0x38,0x7c,0xd,0xf)+'ST'],sdGenerate),window[_0x5ebd73(0xcb,0xae,0x26,0x5e)+_0x5ebd73(0x192,0xeb,0xcf,0x45)]=![],_0x1bb9a4[_0x5ebd73(0x16e,0x101,0x106,0xa1)](addLog,_0x1b0900(0xb6,0x8f,0xe7,0xbd)+_0x5ebd73(0xe1,0x74,0x33,0xa9)));else{_0x1a2a61(_0x5ebd73(0xc0,0x6d,0x38,0xa1)+':\x20'+_0x2272e0['message']+(_0x1b0900(0xe6,0xa1,0x44,0xc9)+_0x5ebd73(-0x61,0x47,-0x66,0xeb)+_0x5ebd73(0x8d,0x34,-0x78,-0x74))),_0x1336d0[_0x1b0900(0x94,-0x29,0x40,0xeb)+'sk'](_0x86b323,![]),_0x36d0d2=null;throw new _0x4c8f74('获取或者切换模型失败'+'，请检查sdwebu'+_0x5ebd73(0xd1,0x47,0xe8,-0x34)+_0x1b0900(0x75,-0x1b,0x4e,0x61));}}}