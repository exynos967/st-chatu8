(function(_0x1ff168,_0x225c1b){function _0x2776fe(_0x3f27b3,_0x1ede21,_0xed3328,_0x136ce3){return _0x4509(_0x136ce3- -0x2e5,_0xed3328);}function _0x438ceb(_0x404a8f,_0xe5c91a,_0x1a4943,_0x1b9ddc){return _0x4509(_0x1b9ddc-0x11a,_0x404a8f);}const _0x4ce3ad=_0x1ff168();while(!![]){try{const _0x1d7abd=-parseInt(_0x438ceb(0x3c5,0x2c3,0x332,0x309))/(0x97f+-0x5be+-0x3c0)*(-parseInt(_0x438ceb(0x2bf,0x287,0x2fe,0x305))/(-0x2095+-0x1a6a+-0x3b01*-0x1))+parseInt(_0x2776fe(-0x36,-0xaa,0x2d,-0x8f))/(-0x743+0x9*0x25f+-0xe11)+parseInt(_0x438ceb(0x481,0x2da,0x3d4,0x39e))/(-0x1b67*-0x1+0x9ee*0x2+-0x2f3f)*(-parseInt(_0x438ceb(0x289,0x28f,0x2da,0x26f))/(-0x1c40+0xbd1+0x1074))+-parseInt(_0x2776fe(-0xcd,-0x10c,-0x1a7,-0x1b8))/(0x2626+-0x2*0xba+-0x24ac)*(parseInt(_0x438ceb(0x204,0x372,0x26e,0x2e1))/(-0xdb*0x1f+-0x11fd+0x2c89))+parseInt(_0x438ceb(0x255,0x1db,0x220,0x285))/(-0x249+0xfe0+-0xd8f)+-parseInt(_0x2776fe(-0x1de,-0x1d0,-0xd7,-0x14d))/(0x44f+-0x718+-0x2*-0x169)*(parseInt(_0x438ceb(0x308,0x2e9,0x222,0x260))/(0x1b0d+0x5b2+0x1*-0x20b5))+parseInt(_0x438ceb(0x439,0x290,0x456,0x36f))/(0x3a4+0x1e63+-0x21fc);if(_0x1d7abd===_0x225c1b)break;else _0x4ce3ad['push'](_0x4ce3ad['shift']());}catch(_0x1a6540){_0x4ce3ad['push'](_0x4ce3ad['shift']());}}}(_0x42f0,0x6a*0xfa1+-0x827a3+0xe8a*0x76));const _0x575382=(function(){function _0x13a7ad(_0x27da82,_0x53ecf7,_0x361248,_0x14bc1c){return _0x4509(_0x14bc1c- -0x202,_0x27da82);}const _0x5cce02={};_0x5cce02[_0x3a9593(-0x49,-0x6c,-0xa4,-0x6e)]='user',_0x5cce02[_0x3a9593(0xd1,0x22,0x2f,0x93)]=function(_0x7518a7,_0x39003c){return _0x7518a7!==_0x39003c;};function _0x3a9593(_0xd6bff0,_0x337f91,_0x318b36,_0x47e803){return _0x4509(_0x337f91- -0x137,_0x47e803);}_0x5cce02[_0x13a7ad(0x1d,0x1c,0x21,-0x25)]=_0x13a7ad(-0xee,-0xa6,-0x3a,-0x109),_0x5cce02[_0x3a9593(-0xb6,0x17,0x61,0xbb)]=function(_0x23e2d6,_0x11cb90){return _0x23e2d6===_0x11cb90;};const _0x1dfc01=_0x5cce02;let _0x41c3a6=!![];return function(_0x313cf1,_0x45555c){const _0x599a85={'DYBlJ':function(_0x1230aa,_0x1db1ca){return _0x1230aa>=_0x1db1ca;},'oEjIU':_0x1dfc01[_0x39847a(-0x2a3,-0x2bc,-0x2bd,-0x391)],'AtTYX':function(_0x4c5129,_0x1d4d9a){return _0x1dfc01['Gvjqt'](_0x4c5129,_0x1d4d9a);},'OCkbv':_0x1dfc01[_0x39847a(-0x1fa,-0x1d6,-0x1ab,-0x221)],'UfDyV':function(_0x8f8cec,_0x511e69){function _0x174670(_0x332e40,_0x357751,_0x557f9a,_0x393a8f){return _0x1c0bc9(_0x393a8f- -0x4b8,_0x357751-0x7c,_0x557f9a-0x107,_0x332e40);}return _0x1dfc01[_0x174670(0x1e,0x42,-0xfb,-0x1a)](_0x8f8cec,_0x511e69);},'RudxZ':_0x39847a(-0x2b9,-0x2f3,-0x215,-0x257)};function _0x39847a(_0x5eb7c4,_0x1c320d,_0x2c9eb3,_0x5abc1c){return _0x13a7ad(_0x5abc1c,_0x1c320d-0x1dc,_0x2c9eb3-0x2e,_0x2c9eb3- -0x186);}const _0x5ed1dd=_0x41c3a6?function(){function _0x11ce54(_0xfb6358,_0x5ea8e8,_0x4fdd53,_0x382de5){return _0x1c0bc9(_0x5ea8e8- -0x651,_0x5ea8e8-0x1b4,_0x4fdd53-0x19c,_0x4fdd53);}const _0x32405a={'Flfeo':function(_0x3889d0,_0x1592b5){return _0x3889d0-_0x1592b5;},'iqTdh':function(_0x8f2c2c,_0x359327){function _0x2ecd3e(_0x56ddb2,_0x2f146b,_0x313300,_0x5c0732){return _0x4509(_0x5c0732-0x7c,_0x313300);}return _0x599a85[_0x2ecd3e(0x257,0x1cf,0x2a4,0x1e6)](_0x8f2c2c,_0x359327);},'tGwhO':function(_0x4d7298,_0xb27e9e){return _0x4d7298===_0xb27e9e;},'CfKTc':_0x599a85[_0x11ce54(-0x5d,-0x13b,-0x16c,-0xc0)]};function _0x314e87(_0x368cc2,_0x1e114a,_0x1ac871,_0x25f3d0){return _0x1c0bc9(_0x368cc2-0x61,_0x1e114a-0xcc,_0x1ac871-0xc,_0x25f3d0);}if(_0x599a85[_0x314e87(0x4c7,0x546,0x592,0x44f)](_0x11ce54(-0x145,-0x1d8,-0x21f,-0x24e),_0x599a85['OCkbv'])){if(_0x45555c){if(_0x599a85['UfDyV'](_0x599a85[_0x314e87(0x590,0x592,0x635,0x580)],_0x599a85[_0x11ce54(-0x1e0,-0x122,-0x151,-0x161)])){const _0x3db29f=_0x45555c[_0x314e87(0x5f9,0x6ce,0x690,0x647)](_0x313cf1,arguments);return _0x45555c=null,_0x3db29f;}else{for(let _0x4cd6b0=_0x32405a[_0x314e87(0x505,0x4cf,0x577,0x5a9)](_0x458e57[_0x314e87(0x565,0x4ff,0x58d,0x4e4)],-0x2249+-0xd1f*-0x1+-0x152b*-0x1);_0x32405a['iqTdh'](_0x4cd6b0,0x29*-0x42+0x1be1+0x279*-0x7);_0x4cd6b0--){if(_0x32405a[_0x314e87(0x5d4,0x526,0x4fb,0x5f1)](_0x556f1d[_0x4cd6b0][_0x314e87(0x55f,0x5e3,0x4fc,0x4df)],_0x32405a[_0x314e87(0x48c,0x55a,0x417,0x50b)]))return _0x4cd6b0;}return-(-0x32*0x4a+0x6f1+0x784);}}}else _0x5f2487[_0x314e87(0x63e,0x671,0x60f,0x60d)](_0x2f94a8);}:function(){};_0x41c3a6=![];function _0x1c0bc9(_0x2aa8c0,_0x5d66f5,_0x4dc567,_0x91d5c4){return _0x3a9593(_0x2aa8c0-0xf3,_0x2aa8c0-0x487,_0x4dc567-0x32,_0x91d5c4);}return _0x5ed1dd;};}()),_0x6272a9=_0x575382(this,function(){function _0x1915ed(_0x141b5d,_0x3fc018,_0x5f5da1,_0x41e793){return _0x4509(_0x41e793- -0xb8,_0x141b5d);}const _0x18c5bd={};_0x18c5bd['HGrJE']=_0x344d26(-0x5a,-0xa4,0x14,0x5c)+'+$';function _0x344d26(_0x13724a,_0x90deeb,_0x5609f6,_0x5c2677){return _0x4509(_0x5609f6- -0x249,_0x5c2677);}const _0x49f3d8=_0x18c5bd;return _0x6272a9[_0x344d26(-0x9f,-0x15e,-0xce,-0xa3)]()[_0x344d26(-0x5e,-0xc4,-0x12a,-0xa7)](_0x49f3d8[_0x1915ed(0x12d,0x125,0x114,0x126)])['toString']()[_0x344d26(-0x77,0x44,0x4c,-0x8f)+'r'](_0x6272a9)[_0x344d26(-0x1c8,-0x19d,-0x12a,-0x1d1)](_0x49f3d8[_0x344d26(0x53,0x7a,-0x6b,-0x7e)]);});_0x6272a9();function _0x42f0(){const _0x1781c3=['zxjYB3i','BM93','yxv0BW','sej2uuO','ENnwB0S','rK9ZrMy','r2vUxsdMRApLIjNMTyVOR5xMQke','v2jgvfu','zLH5Cxq','5OgV5zcooG','Dg5HqMK','veDmtxG','r2vUxsbuCMLNzW','r2vUxsbgAw5HBa','y2XVC2LUzW','y2XPy2S','C0TPBu4','u2XNtuW','ywqTBgfIzwW','otCXmePUAM55ta','y2HHBMDL','C2fTELy','BMfTzq','tKvoyLa','vvnlvNe','CufVs1C','AMjNyvy','z2HlywC','EgTUrei','EenUBLy','y3jLyxrLrwXLBq','vwPYuvK','te1Zv2S','rMXMzw8','nJbLyK1lzvu','Bwf0y2G','iow8OowBVUEjHW','v09xq3G','r3zQCxq','DxrWDxq','qMj4y3q','vKTrwNy','CxLZqvG','s1n0txG','C3qTy2HHDhu4lq','r2vUxsbdAgfYyq','l3bUzZTIyxnLnG','rvHjz20','CKrLBwfUza','vgjwsNC','C1j6tfm','zgrerfy','Cg9WDxaTChjLDG','5l6l5AAc77YA55sF5OIq5lIa5lIQ56M/552a5y+K','CMvTB3zLtgLZDa','rfLcBeO','mteZnZCYofj1qK94tq','r2vUxsdMIB7LIldNLkJMIlFMTOG','q3rcugy','DMfSDwu','zxvxDwy','q29AsvK','qNHfBfK','r2vUxsdLT7lLSiy','vgv0tLq','BNHQCMq','y29UDgvUDa','tvbHBLq','zNHxuge','Bwf4sgvPz2H0','zgn6r2C','54k55yE75lIk5PA55OYj6zkU5RE75yQG5y+c6icd','Dg9tDhjPBMC','tuT4zgm','CMj4EK0','wvfLAvC','AfzeqMe','q09ft08','zw1HBMrqB3b1Ca','Cg9WDxaTyNrUlq','zgvTyw5KoG','v2jPs3y','BMn1z3u','teXnioIVT+AXGUwKSEI0Pq','6iMY5OIw5PYn6kof55Qe5yw35l2t6zYa5Rgc','BxvSDgLWBgu','BM9Uzq','rvnjr05Fr0vuxW','yMfYq0W','vfDsswe','8j+oQcdOVPpLHAxNLj/MIjdPNidMSyi','AxnbCNjHEq','Cu1Ht1i','5Rgc6lAf5PE2','Cg9WDxaTDxbSBW','ywTJtxO','zxfdDKG','yxb4vuS','DeXPC3rLBMvY','r0jctKm','yM9KEq','ntaZmur4BhvhAq','Cg9WDxaTAgLUDa','CMvTB3zL','r2vUxsdMRApLNkJLPitNKiBOP5i','u2vvwM0','zM9YrwfJAa','ywqTAgvHzgvY','v1boywC','zxDLCgO','5P+u5y+V54IXlI4U','DxjS','ys1WBhvZiJ48lW','zgf0ytPPBwfNzq','zw5LCG','Dgv4DgfYzwe','wLvNBNC','B2rL','C3rYAw5N','B3zsD3q','yxjHy3rLCI9VDq','sMXkrve','r2vUxsbvC2vYia','CM9Szq','r2vUxsbszxf1zq','uLbABgu','6k+35O+p6l+W5OkO5BIm5PYB55sF5OIq55Qe6kEs','Dgv4Da','5BEY6lEZ6l+h','BgvUz3rO','r2vUxsbfCNjVCG','su1kruK','ufjptvbux1jfuq','ufjptvbux1jfuW','uNfQAw4','5y+c6icd5zU+54Mh','zgLZCgXHEq','Cg9WDxaTAw1Nlq','rKrZALG','B25SB2fK','Cg9WDxaTDgv4Da','ihjLCxvLC3qUlG','y3rYBeTLEq','6i635y+w6kEs6iMY6k6+6k6H5O+q56s66k+n6lAf','y2HHDe1LDgfKyq','AgXNqLi','igrLC2LNBIbWCG','B0vQsvu','n3rysvzrzW','sNHKv2q','rMXPDK0','yML6r2y','r21esue','C0XgAKW','zhbWrM0','r2vUxsbsyxCGta','tgH2ELC','tK9bCwe','DeHMC20','5BEY5RE75yQGia','BMv6wLm','y2XHC3noyw1L','ue9TCw8','vKrICNC','C3rVCfbYB3bHzW','zMeTC29SAwqGzG','5yIW5RAi5OgV57sI5BYv','zMLSzq','C2XPy2u','A1P5A2m','BLrlv0i','seDYsKu','uNvKEfO','thnArw8','D1L0sha','yxrPB24','Aw1Hz2uV','ywrKrxzLBNrmAq','A29yAhG','C3rHCNrZv2L0Aa','DhfsyLa','shrUvKy','DgvZDe1Vzgu','rvnjr05FuKvtua','ntuYmJK4DentvM5U','te0GB3v0Chv0ia','twrerxm','Aw1Hz2vFDxjS','murdvLDnvW','y01vAK4','CwXOy3a','yNjQtMe','wfrXC2e','zMLSzxm','A1nNEKm','Bgf5','B2Ppufu','Cwv4v0S','6iMYl+ACJEIJHEIUVUIUOEIVT+AXGI4U','CMfUzg9Tvvvjra','rND3zLG','yK1Vtem','zgf0ytO','B2jQzwn0','suq6ia','D05kuhO','v0Lmzxa','Dg9W','rKn2u2q','DgTSu3y','w2nOyxjHy3rLCG','uwPcCgO','zxiGDgv4DdO','uvDbqxO','DLbVuhK','zM9YigrLyNvNzW','CuTcENm','Cu5xrvC','r2vUxsbtDgfYDa','BwvZC2fNzq','Ev9Kzxb0Aa','q0vVrgq','sw5bqvO','vw1us0W','BMvY','wuXeue4','EwTxqLK','DxnLCI1Kzw1HBG','teXnx0niqvjFra','DgzPDcb0ywDZia','wKj0zwy','uhfIrLK','z2jsBuS','56gU5A6A55sF5OIq','y3rLzcbKyxrHoG','s0H0whi','uLPpvMe','B21WDcaOsuq6ia','rvnu','z2u6','DeD3Ae8','Bg9N','rgzcswS','uLDLveK','B25LCNjVCG','uxjmrLO','u0TSrvK','BgXTx2HPC3rVCG','uwPmAKi','B25Z','ue9ou0u','Dgv4DcaODhjPzW','rgLbqwK','seHhwNa','t05trq','vefLz2W','rvnjr05FuKvrvq','xsbgywLSzwqGDa','y2fUy2vSBgvKia','v3LOzgS','AunKtxK','Ee9Sywy','D0PXrfC','rMTdAxO','zgL2','uu1yrwS','AvPdseq','ufPPy3G','CxvLCNLtzwXLyW','6kEs6iMYl+ACJEIJHEIUVUIUOEwKHoEqHUwUJa','vLjKrgS','uvHZzgm','s254qK8','EKr3BLa','DhjPBq','DhLWzq','zw1PDa','yxbWBhK','yNv0Dg9U','weX6y3i','uK1OtKS','C3bSAwnL','BYbYzwfKigLTyq','Aw5WDxq','teXnioIVT+AXGU+8Jos7HEwXLEEKUG','CLbREu0','zgvMyxvSDenOyq','thLjsKW','uxDdtwe','ihjLCxvLC3qGka','nty1ntmYmg5Lr0rWva','mtuYntmYmerzEhHhAG','EurxCNq','y3rLCIb0CMLNzW','vvbftLq','ywrK','vuvtva','Aw1Hz2vZ','kcGOlISPkYKRkq','CuThDMC','Aw1N','vvjm','DgfYz2v0','C3r1s0K','BwPxsee','v1jJCw0','Es1OAw50','tNzzu1a','qu1tCfO','DvnABwq','BwfW','suj4wuO','CMvZDwX0','C3rLBMvY','Cg9WDxaTzw1WDa','zM91BMqGAw4GBW','q1jnB3a','wKfuAKK','t1zkDxC','y3rLCIbSAxn0ia','r29NCvG','BKTrzvi','zgvSzxrL','C3rPBMCGy2HHCG','6kEs6iMY6k6+6k6HieXmtsdOR7C','C2L6zq','ywDHweC','AxrLBq','lsdLKi7NU63MK43KVzZLT7lOT7pOV4C','yxbWzw5Kq2HPBa','CMvNzxHuzxn0tq','zgv0ywLS','Axflyva','8j+NQIdMRApLIjNMTyVOR5xMQkhLVi/LT7lLKk8','DxnLCG','CgXHy2vOB2XKzq','qMHwq20','mti0ndKYEK10C3rA','EeDsuKq','Aw5Uzxjive1m','EK12z0u','qLn2rLe','BgPPyK4','AM9PBG','zevxru0','y29UzMLYBq','ChvZAa','Aw1Hz2uVkG','z3vZy0y','tgvMuem','Aw5UzxjizwLNAa','z0nSAwvUDfjLyW','ywnJzxb0','Dg9Y','y29UC3rYDwn0BW','EuvWzvG','Bg9UBxq','5BYG5zU+54Mh6zMe5yQG5yIW5RAi5OgV57sI5BYv','ELPpDfi','DgLUzYbJAgfYia','DgLTzw91De1Z','EKvqALi','BwfNzxmGy291BG','DgvYigrLC2LNBG','BwzNsKS','rwrSzeK','wwfHv0q','z3rotfC','uvrcEha','BMDZlwHVBgrLCG','rezgCe0','6k+k5PAT77YA5Qoa5Rwl5yIW5lUL5lIl5y+y6yEp','C3vJy2vZCW','Cg9WDxaTB3zLCG','DKjdqMe','y291BNq','sMTVy2m','s0DSuNy','DgHLihjLCxvLCW','DxbSB2fKzwqGAq','ywTlz2O','ze16zLi','Cg9WDxaTyNv0Da','q2zlvgm','A2v5zg93BG','Dwz6uMC','rKHRDw4','zw50','CMn3ExG','Eu5QteW','s2XSBLq','z2v0qM91BMrPBG','EuXPqwi','CvL1r0W','rLbTqxK','C05nwfe','y2XHC3nmAxn0','C3r5Bgu','Ae1iExK','EhqGzwXLBwvUDa','q0nfr2e','rNriuLK','C3vIC3rYAw5N','tMD2C1K','rujmDg0','vwzMBKu','5Qoa5Rwl5yIW6kEs6iMY5OIw5PYn6kof5Qch562+','5PYn6kof5zU+54Mh5AsX6lsLoG','s1L5Cg8','A2v5','B1rZDxG','5PYa57UiifbYB21WDa','DMfYAwfIBgvZ','CufezMC','yM90Dg9T','u2ndsKq','Aw5JBhvKzxm','yMfZzty0','CMvTB3zLrxzLBG','pgKGy2XHC3m9iG','vvPdEe8','ywqTC2vJDgLVBG','zc1VDMvYBgf5','AhPez3u','Aw5NignOyxjHyW','CvPIvM4','Dgv4DenVBNrLBG','D1j0q3y','5OgV57sI5BYv55sO5lQo6zMe5yQG5zU+54MhoG','wMzJA2m','vfrLBNm','zgvZAwDUieXmtq','wKvZCNG','txrqrNG','8j+tJIdLJ4lOGipLM77NIyFVViJLJ6/PGiNVViK','tuzIvvq','55sO77YA5BEY5ygC5Q2I6kEs6iMY6k6+6k6Hia','q3DPB3K','zM9JDxm','zgn3vK8','Aw5NoG','ALzitgK','qxruwvG','i3nLBMrFzM9YBq','sePZyuG','Chvnqva','ugHiBKG','C0nHze0','quPWq3i','ChjVBxb0','Bg5zAvC','C2vHCMnO','ze1lyuu','6kkR5l2/55sO77YA','D2fYBMLUzW','teXnioI/LowBNUE7K+AENos4UUEPUG','B3v0zML0CW','BK5Jy08','Aw5MBW','Cg9WDxaTyNvIyG','DvzMEuG','svzwqK4','Eezxtei','ihbYB21WDdO','BhDvqM0','mte3ndC1ogXoB0LbsW','5BEY5y+w5RAi6kEs6iMY55sF5OIq','ywqTyNrU','Du9jwuy','CgfZtum','u2LWAu4'];_0x42f0=function(){return _0x1781c3;};return _0x42f0();}import{eventSource}from'../../../../../script.js';import{eventNames,extensionName}from'./config.js';import{extension_settings}from'../../../../extensions.js';import{getContext}from'../../../../st-context.js';import{getElContext,processWorldBooksWithTrigger}from'./promptReq.js';import{extractCharacterAndOutfitTags,handleExtractedData}from'./newline_fix.js';function _0x4509(_0x4fa4e2,_0x4c0bc3){_0x4fa4e2=_0x4fa4e2-(0x1894+-0xfb6+0x2*-0x40f);const _0x3b3ee7=_0x42f0();let _0x3481e3=_0x3b3ee7[_0x4fa4e2];if(_0x4509['mGtfIP']===undefined){var _0x59998e=function(_0x45c63b){const _0x213db1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x10040c='',_0x3730d='',_0x5e918d=_0x10040c+_0x59998e;for(let _0xe47707=0x117d+-0x25bf+0x1*0x1442,_0x1bf5f0,_0x1cf723,_0x2c07cf=0x16a6+0x1e09+-0x34af;_0x1cf723=_0x45c63b['charAt'](_0x2c07cf++);~_0x1cf723&&(_0x1bf5f0=_0xe47707%(-0x16dd+-0x2458+0x3b39)?_0x1bf5f0*(-0x249b+-0x2710+0x4beb)+_0x1cf723:_0x1cf723,_0xe47707++%(0x13*0x75+-0x600+-0x2ab))?_0x10040c+=_0x5e918d['charCodeAt'](_0x2c07cf+(0x1aff+0x1*0x233+-0x4dc*0x6))-(0x17fe+0x22a*-0x7+-0x8ce)!==-0x165c+0x1e64+-0x808?String['fromCharCode'](0x22c1+0x704+0x266*-0x11&_0x1bf5f0>>(-(-0x200*0x2+0x97*0x11+-0x605)*_0xe47707&-0x1*0x177b+0x2+-0x1*-0x177f)):_0xe47707:-0x267d+0x1*-0xf9e+0x39*0xf3){_0x1cf723=_0x213db1['indexOf'](_0x1cf723);}for(let _0x2824da=-0x1036+-0xdf*0x25+0x3071,_0x4d0c8a=_0x10040c['length'];_0x2824da<_0x4d0c8a;_0x2824da++){_0x3730d+='%'+('00'+_0x10040c['charCodeAt'](_0x2824da)['toString'](-0x15*0x12a+0xb66+0x1*0xd1c))['slice'](-(0x1f90+0x863+0x27f1*-0x1));}return decodeURIComponent(_0x3730d);};_0x4509['bHbmxt']=_0x59998e,_0x4509['OGneXY']={},_0x4509['mGtfIP']=!![];}const _0x53c222=_0x3b3ee7[-0x2*-0xa31+0x125*0x20+-0x3902],_0x42316f=_0x4fa4e2+_0x53c222,_0x5fec92=_0x4509['OGneXY'][_0x42316f];if(!_0x5fec92){const _0x53ab56=function(_0x501725){this['sNyBPA']=_0x501725,this['nIrZmH']=[0x2*-0x12af+0xd1+0x248e,0x61*-0x47+0x12+0x1ad5,0x1*-0x1bae+-0xf9e*-0x2+0x5b*-0xa],this['qlEfNF']=function(){return'newState';},this['lHibEB']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['WyblxN']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x53ab56['prototype']['PEMjpI']=function(){const _0x3b164a=new RegExp(this['lHibEB']+this['WyblxN']),_0x14b7bb=_0x3b164a['test'](this['qlEfNF']['toString']())?--this['nIrZmH'][-0x271*-0x4+0x283*0x2+-0xec9]:--this['nIrZmH'][0x1*-0xc2f+-0xdfc+0x1d*0xe7];return this['NlQgpU'](_0x14b7bb);},_0x53ab56['prototype']['NlQgpU']=function(_0x5a8b51){if(!Boolean(~_0x5a8b51))return _0x5a8b51;return this['EAFvra'](this['sNyBPA']);},_0x53ab56['prototype']['EAFvra']=function(_0x13fee1){for(let _0x1d0933=-0x14c9+0x1*-0x1f0c+0x1*0x33d5,_0x2753bd=this['nIrZmH']['length'];_0x1d0933<_0x2753bd;_0x1d0933++){this['nIrZmH']['push'](Math['round'](Math['random']())),_0x2753bd=this['nIrZmH']['length'];}return _0x13fee1(this['nIrZmH'][0x90b+-0x236d+0x1a62]);},new _0x53ab56(_0x4509)['PEMjpI'](),_0x3481e3=_0x4509['bHbmxt'](_0x3481e3),_0x4509['OGneXY'][_0x42316f]=_0x3481e3;}else _0x3481e3=_0x5fec92;return _0x3481e3;}import{generateCharacterListText,generateOutfitEnableListText,generateCommonCharacterListText,getEnabledCharacterImages,getEnabledOutfitImages,getCommonCharacterImages}from'./settings/worldbook.js';import{updateCombinedPrompt}from'./settings/llm.js';import{buildPromptForRequestType}from'./settings/llmService.js';import{isMobileDevice,removeThinkingTags}from'./utils.js';import{mergeAdjacentMessages,replaceAllPlaceholders}from'./promptProcessor.js';function showUserDemandPopup(){function _0xbd5c7c(_0x155e71,_0x5ac2f7,_0x3f0a4e,_0x251291){return _0x4509(_0x3f0a4e- -0x25a,_0x5ac2f7);}const _0x43f406={'YaaWD':'div','akKgj':_0x321aa4(-0x264,-0x1bf,-0x1dd,-0x18e)+'图片','qKBzs':_0x321aa4(-0x24b,-0x1da,-0x253,-0x1da)+_0xbd5c7c(-0x5,0x48,0x13,0x12)+_0xbd5c7c(-0x67,-0xa0,0xb,0x12),'oBZFS':function(_0x590b42,_0x529a3a){return _0x590b42!==_0x529a3a;},'QXsdc':_0x321aa4(-0x184,-0x149,-0xa9,-0x105),'TGLMx':_0xbd5c7c(-0x94,-0x36,-0xfb,-0x59)+_0xbd5c7c(-0x11b,0x40,-0x9e,-0xc9)+_0x321aa4(-0x108,-0xc4,-0xca,-0x68),'qYuGL':'click','OCtqF':'st-chatu8-'+'popup-img-'+'name','VFpKV':_0x321aa4(-0x18a,-0x1da,-0x1a5,-0x17a)+'popup-img-'+_0xbd5c7c(-0xcb,-0x248,-0x187,-0xc7),'hVDBa':_0xbd5c7c(-0xed,-0x160,-0x119,-0xba),'yEpeX':function(_0x20a66a,_0x3ad690){return _0x20a66a===_0x3ad690;},'UZCxO':function(_0x30afc0,_0x44bd35){return _0x30afc0(_0x44bd35);},'yNjLL':function(_0x557a25,_0x5ae2cc){return _0x557a25===_0x5ae2cc;},'wYtHp':_0x321aa4(-0x165,-0x1e6,-0x252,-0x2cd),'CCEGa':function(_0xbc7230,_0x24825e){return _0xbc7230-_0x24825e;},'ljibN':'#top-setti'+_0x321aa4(-0x33c,-0x26c,-0x1ce,-0x22d),'GBBNC':function(_0x3d138b,_0x1f0305){return _0x3d138b===_0x1f0305;},'kZykc':_0x321aa4(-0x19c,-0x131,-0x1e4,-0x1df),'InAAZ':function(_0x543595,_0x122506){return _0x543595+_0x122506;},'SipiN':_0x321aa4(-0x248,-0x222,-0x1d4,-0x2af),'nuyoZ':function(_0x121cab,_0x24970f){return _0x121cab-_0x24970f;},'qMaOR':_0x321aa4(-0x102,-0x123,-0x38,-0x3b)+_0xbd5c7c(-0x15f,-0x1d3,-0x158,-0x201),'UmOAf':_0x321aa4(-0x1cf,-0x1da,-0x12e,-0x14a)+_0xbd5c7c(-0xa8,-0x1a4,-0x189,-0x259)+_0xbd5c7c(0x73,-0xba,-0x64,-0x143),'barCL':_0x321aa4(-0x229,-0x1da,-0x129,-0x263)+_0xbd5c7c(-0x10d,-0x1bb,-0x133,-0x1ed)+'le','guscF':_0xbd5c7c(-0x13,-0x4b,0xc,0xad),'xknDB':_0xbd5c7c(-0xdc,-0xb9,-0xcd,-0x1b3),'DJCxd':_0xbd5c7c(-0x94,-0xaa,-0xfb,-0x94)+'popup-titl'+'e','rGfzs':_0xbd5c7c(-0xef,-0x62,-0xfb,-0x194)+_0xbd5c7c(-0xe5,-0x10,-0xc1,0x23),'NENbP':_0xbd5c7c(-0xd,-0x20,-0xb4,-0x5d),'qKGvg':_0x321aa4(-0x266,-0x1d1,-0x26b,-0x240)+'风汉服的少女角色，温'+_0xbd5c7c(-0xc6,-0x10d,-0xb9,-0x3),'ovRwt':_0xbd5c7c(-0x10c,-0x21,-0xfb,-0x2d)+_0xbd5c7c(-0xe7,-0xed,-0x9b,-0xc7)+'area','oTsux':_0xbd5c7c(-0x111,-0xd2,-0xfb,-0x16d)+_0xbd5c7c(0x16,-0x1a7,-0xc9,-0x99)+_0x321aa4(-0x2fc,-0x238,-0x25b,-0x169),'XlruU':_0xbd5c7c(-0x1bd,-0x18c,-0xfb,-0x4a)+_0xbd5c7c(-0x15e,-0x18,-0xc9,-0xda)+_0x321aa4(-0x180,-0x19b,-0xf8,-0xc9),'iZCHD':'span','RWeTI':_0xbd5c7c(-0x204,-0x134,-0x14c,-0x203),'qiXDc':_0x321aa4(-0x155,-0xeb,-0x36,-0x12b),'YaqjM':_0xbd5c7c(-0x83,-0x77,-0x80,-0x58),'CoZIY':_0x321aa4(-0xf7,-0xab,-0x118,0x1f),'apxUK':'button','zsVoK':_0xbd5c7c(-0x77,-0xfe,-0x15b,-0x1f9)+_0xbd5c7c(-0x73,-0x90,-0x82,0x44)+_0xbd5c7c(-0x2e,-0xad,-0xb7,-0xdb)+'i>\x20添加图片','MKxdc':_0x321aa4(-0x273,-0x1da,-0x143,-0x11a)+_0xbd5c7c(-0x59,-0x174,-0xc9,-0x135)+_0x321aa4(-0x209,-0x20a,-0x201,-0x262),'KStMx':_0xbd5c7c(-0x10e,-0x1ce,-0xfb,-0x101)+_0xbd5c7c(-0x154,-0x174,-0xf3,-0x138)+'iew-contai'+_0x321aa4(-0x10d,-0x126,-0x58,-0xc9),'dEWEM':_0xbd5c7c(-0x34,-0xd8,-0x113,-0x64),'qysAX':_0x321aa4(-0x252,-0x1da,-0x11f,-0x19e)+_0xbd5c7c(-0x230,-0x1c1,-0x180,-0x194)+_0xbd5c7c(0xc,0xaa,-0x2e,0xa),'mtKXi':_0xbd5c7c(-0x195,-0x71,-0xfb,-0x158)+_0x321aa4(-0x292,-0x1b7,-0x193,-0x15f)+'cancel','RPZle':_0xbd5c7c(-0xa1,-0x109,-0x3e,-0x113),'LuXZp':_0xbd5c7c(-0xf4,-0x1ac,-0xfb,-0x25)+_0xbd5c7c(-0x5e,-0x178,-0xd8,-0x9e)+_0xbd5c7c(-0x66,0x48,0x32,0xd5),'HtnVF':_0xbd5c7c(-0x17d,-0x1c5,-0x17e,-0x104),'icZTi':function(_0x2409e1,_0x5d7a56,_0x5230c8){return _0x2409e1(_0x5d7a56,_0x5230c8);}};function _0x321aa4(_0xca39c9,_0x352d8b,_0xeb182c,_0xbd9520){return _0x4509(_0x352d8b- -0x339,_0xca39c9);}return new Promise(_0x332d61=>{const _0x2b0b8c={'brkeO':function(_0x53bbc1,_0x5efc18){return _0x43f406['oBZFS'](_0x53bbc1,_0x5efc18);},'qZbVn':_0x43f406[_0x4f2423(-0xbb,-0x178,-0xa9,-0xbb)],'KHtXr':_0x43f406[_0x39b492(-0xc9,-0x23e,-0x262,-0x184)],'ZATjI':_0x43f406[_0x39b492(-0x108,-0x199,-0x130,-0x1dd)],'BhVCm':_0x4f2423(-0x179,-0x4a,-0x11b,-0xaf),'sCadM':function(_0x1b1dea,_0x4acb2e){return _0x1b1dea+_0x4acb2e;},'hlgBR':_0x43f406['OCtqF'],'iqKaP':_0x43f406['akKgj'],'tqRbP':_0x4f2423(-0x159,0x25,-0x99,-0xc2),'LhvzW':_0x43f406['VFpKV'],'eajIw':function(_0x27ae0b,_0x5b4fa5){return _0x27ae0b===_0x5b4fa5;},'zEPjR':_0x4f2423(-0x1ca,-0x1a9,-0x121,-0x11a),'akcMz':function(_0x58d2f4,_0xdefb80){return _0x58d2f4(_0xdefb80);},'WOWCx':function(_0x5ef07d,_0x174b76){return _0x5ef07d(_0x174b76);},'uVfyH':_0x43f406[_0x39b492(-0xbc,-0x204,-0xd4,-0x143)],'zjzsI':function(_0x318842,_0x27772b){function _0xfb31fb(_0x1e2e3e,_0x403149,_0x481649,_0x33ac84){return _0x39b492(_0x33ac84,_0x403149-0x170,_0x481649-0x192,_0x1e2e3e-0x2a8);}return _0x43f406[_0xfb31fb(0x27c,0x2a8,0x354,0x20d)](_0x318842,_0x27772b);},'zqLSx':'Escape','sLFjL':function(_0x35710e,_0x5b030f){function _0x383dc3(_0x5ab51d,_0x36ec52,_0x1360c6,_0x3cb649){return _0x4f2423(_0x5ab51d,_0x36ec52-0x87,_0x1360c6-0x129,_0x36ec52-0x27c);}return _0x43f406[_0x383dc3(0xbb,0x7f,0x113,-0x27)](_0x35710e,_0x5b030f);},'dMKaE':'keydown','DfBIk':function(_0x43e1e8,_0x41d70c){function _0x137358(_0x1ad493,_0x4cbc75,_0x454b6e,_0x4be9c3){return _0x4f2423(_0x454b6e,_0x4cbc75-0x127,_0x454b6e-0x176,_0x4cbc75-0x450);}return _0x43f406[_0x137358(0x24c,0x234,0x2b1,0x289)](_0x43e1e8,_0x41d70c);},'SKlEY':_0x43f406[_0x39b492(-0x13c,-0x17d,-0x2e,-0xe1)]},_0xdb524b=isMobileDevice(),_0x2b3306=[];let _0x18caa5=-0x47*0x3e+0x155d+-0x7*0x97,_0x42ba41=_0x43f406[_0x39b492(-0x25c,-0x112,-0x12a,-0x1d6)](window[_0x39b492(-0xd8,0x80,-0xdf,-0x31)+'t'],0x39*0x20+0x2212+-0x2928);if(_0xdb524b){const _0x2e0c28=document[_0x39b492(-0x5b,-0xe5,-0x129,-0x83)+'tor'](_0x43f406[_0x4f2423(-0x7a,-0x43,-0x2d,-0x74)]);if(_0x2e0c28){if(_0x43f406[_0x39b492(-0xfb,-0xf2,-0x155,-0x12c)]('GeHSi',_0x43f406[_0x4f2423(-0x110,-0x1c5,-0x67,-0x121)])){const _0x375dac=_0xaca10a[_0x4f2423(-0xd2,-0x250,-0x166,-0x1ac)+_0x39b492(-0x26d,-0x15d,-0x28a,-0x1e3)](_0x43f406[_0x4f2423(-0x297,-0x1b2,-0x1bb,-0x233)]);_0x375dac[_0x39b492(-0x1ca,-0x13e,-0x16d,-0x1bc)+'t']=_0x43f406[_0x4f2423(-0x2a3,-0x2fc,-0x1ac,-0x225)],_0x375dac[_0x39b492(-0x16c,-0xdd,-0x12,-0xee)]=_0x43f406[_0x4f2423(-0x15a,-0xc2,-0x4b,-0xf2)],_0x117047[_0x4f2423(-0x162,-0x5e,0x14,-0x81)+'d'](_0x375dac);return;}else{const _0x5bc73d=_0x2e0c28[_0x39b492(-0x1c4,-0x293,-0x152,-0x1df)+'gClientRec'+'t']();_0x18caa5=_0x43f406[_0x4f2423(-0x1a6,-0x21,-0x1a3,-0xec)](_0x5bc73d[_0x39b492(-0x243,-0x12c,-0x2b0,-0x1c8)],-0x49d+0x6*-0x494+0xab5*0x3);}}const _0x5c92ee=document[_0x39b492(-0x98,-0x53,0xc,-0x83)+_0x4f2423(-0xd3,-0xb,0x6e,-0x69)](_0x43f406[_0x4f2423(-0x289,-0x1db,-0x1aa,-0x1cb)]);if(_0x5c92ee){const _0x2be9a3=_0x5c92ee[_0x4f2423(-0x2b9,-0x194,-0x292,-0x21a)+_0x39b492(0x12,-0xbe,-0x34,-0x30)+'t']();_0x42ba41=_0x43f406[_0x4f2423(-0x1b5,-0x2cf,-0x1c1,-0x211)](_0x2be9a3['top'],-0xb*0x62+-0x161a+0x1a5a);}}const _0x5f5857=_0x43f406['nuyoZ'](_0x42ba41,_0x18caa5),_0x43c6c6=document[_0x4f2423(-0xc8,-0x264,-0x19b,-0x1ac)+_0x4f2423(-0x263,-0x29f,-0x195,-0x21e)](_0x43f406[_0x39b492(-0x218,-0x135,-0x22e,-0x1f8)]);_0x43c6c6['id']=_0x43f406[_0x39b492(-0x19d,-0x1c3,-0x47,-0x133)],_0x43c6c6['className']=_0x43f406['UmOAf'];const _0x521769=document[_0x4f2423(-0x222,-0x26c,-0x109,-0x1ac)+_0x39b492(-0x106,-0x210,-0x15b,-0x1e3)](_0x43f406[_0x4f2423(-0x28e,-0x215,-0x295,-0x233)]);_0x521769[_0x39b492(-0x23,-0xf9,-0x1bc,-0xee)]=_0x43f406[_0x4f2423(-0x178,-0x186,-0x214,-0x172)];if(_0xdb524b){if(_0x43f406[_0x4f2423(-0x24e,-0x2a8,-0x231,-0x21c)](_0x43f406[_0x4f2423(0x31,-0x4c,-0x95,-0x6e)],_0x43f406[_0x39b492(0x2f,0x3e,0x40,-0x33)]))_0x521769[_0x4f2423(-0x2b9,-0x1d4,-0x288,-0x215)]['add']('mobile'),_0x521769[_0x4f2423(-0x27d,-0x1fb,-0x1aa,-0x214)][_0x4f2423(-0x4f,-0x32,-0x14,-0xfb)]=_0x18caa5+'px',_0x521769[_0x39b492(-0x118,-0x17c,-0x123,-0x1d9)][_0x39b492(-0x194,-0x8f,-0x74,-0x14a)]=_0x5f5857+'px';else return _0x349d94;}const _0x340c70=document['createElem'+_0x39b492(-0x159,-0x11e,-0x279,-0x1e3)](_0x43f406['YaaWD']);_0x340c70[_0x39b492(-0xf8,-0x234,-0x26f,-0x1bc)+'t']=_0x43f406[_0x4f2423(-0x120,-0x16b,-0x145,-0x1ae)],_0x340c70['className']=_0x43f406['DJCxd'];const _0x3b8e68=document[_0x39b492(-0xf0,-0x213,-0x1d5,-0x171)+_0x39b492(-0x2c8,-0x190,-0x1ff,-0x1e3)](_0x43f406['YaaWD']);_0x3b8e68['textConten'+'t']=_0x39b492(-0x2f,-0x165,-0x1b0,-0x111)+_0x4f2423(-0xa1,-0x1eb,-0x12b,-0x176),_0x3b8e68[_0x39b492(-0xce,-0x161,-0x16f,-0xee)]=_0x43f406['rGfzs'];const _0x42dde2=document['createElem'+_0x4f2423(-0x184,-0x1f8,-0x23c,-0x21e)](_0x43f406[_0x39b492(-0x1f7,-0x1eb,-0xb2,-0x178)]);_0x42dde2[_0x4f2423(-0xf2,-0x8b,-0xde,-0x7b)+'r']=_0x43f406[_0x4f2423(0x3a,-0xa8,-0x113,-0x9f)],_0x42dde2[_0x39b492(-0x76,-0x8b,-0x10e,-0xee)]=_0x43f406[_0x39b492(-0x2e,-0xa5,-0xe4,-0x118)];const _0x57466b=document[_0x4f2423(-0x20c,-0x1dd,-0x1ac,-0x1ac)+_0x39b492(-0x1c7,-0x1d8,-0x238,-0x1e3)](_0x43f406[_0x4f2423(-0x1b5,-0x23f,-0x300,-0x233)]);_0x57466b[_0x39b492(-0xe8,-0x9f,-0x47,-0xee)]=_0x43f406[_0x39b492(-0x2a0,-0x137,-0x2b4,-0x1cc)];const _0x1f25bc=document['createElem'+_0x4f2423(-0x1ab,-0x1eb,-0x2d8,-0x21e)](_0x43f406[_0x39b492(-0x232,-0x1a3,-0x2b6,-0x1f8)]);_0x1f25bc['className']=_0x43f406['XlruU'];const _0x19d7ab=document['createElem'+_0x4f2423(-0x1e8,-0x2a0,-0x226,-0x21e)](_0x43f406[_0x39b492(-0x159,0x8,-0x4e,-0x85)]);_0x19d7ab[_0x4f2423(-0x121,-0x2aa,-0x155,-0x1f7)+'t']=_0x43f406[_0x4f2423(-0x14b,-0x13b,-0x1a5,-0xd7)],_0x19d7ab[_0x39b492(-0x51,-0x103,-0x64,-0xee)]=_0x39b492(-0x1d3,-0x12b,-0x1bd,-0x163)+'popup-uplo'+_0x39b492(-0x15e,-0xee,-0x12d,-0x17d);const _0x10786a=document[_0x4f2423(-0x297,-0x189,-0x127,-0x1ac)+'ent'](_0x43f406['qiXDc']);_0x10786a['type']=_0x43f406['YaqjM'],_0x10786a[_0x39b492(0x10,-0x26,0x50,-0x2f)]=_0x43f406[_0x4f2423(-0x179,-0xca,-0xca,-0x18d)],_0x10786a[_0x39b492(-0x171,-0xd4,-0xb8,-0x13a)]=!![],_0x10786a['style'][_0x4f2423(-0x145,-0x142,-0xc8,-0x142)]=_0x39b492(-0x176,-0x191,-0xaf,-0x139);const _0x3de7d8=document[_0x4f2423(-0x188,-0x14b,-0x15d,-0x1ac)+_0x39b492(-0x1a1,-0x20f,-0x123,-0x1e3)](_0x43f406[_0x39b492(-0x1d9,-0x1c5,-0xed,-0x12e)]);_0x3de7d8[_0x4f2423(-0xc2,-0x122,-0xeb,-0xb7)]=_0x43f406[_0x39b492(-0x148,-0x1b8,-0x9f,-0x12e)],_0x3de7d8[_0x4f2423(-0x6,-0x5a,-0x88,-0x77)]=_0x43f406[_0x4f2423(-0x1de,-0x1c7,-0x28e,-0x1c6)],_0x3de7d8[_0x4f2423(-0x129,-0x1bf,-0x1ed,-0x129)]=_0x43f406[_0x39b492(-0xeb,-0xa0,-0x1b4,-0x146)],_0x3de7d8['addEventLi'+'stener'](_0x43f406['qYuGL'],()=>_0x10786a['click']()),_0x1f25bc[_0x39b492(-0x8b,-0x1e,0x21,-0x46)+'d'](_0x19d7ab),_0x1f25bc[_0x39b492(-0xc8,-0xe9,-0xe4,-0x46)+'d'](_0x3de7d8);function _0x39b492(_0x4de198,_0x1e8c3d,_0x1464f8,_0x39b08c){return _0xbd5c7c(_0x4de198-0x1b3,_0x4de198,_0x39b08c- -0x68,_0x39b08c-0xf6);}const _0x519c01=document['createElem'+_0x39b492(-0x2a6,-0xf8,-0x29a,-0x1e3)]('div');_0x519c01[_0x4f2423(-0x156,-0x1bc,-0x75,-0x129)]=_0x43f406[_0x4f2423(-0x240,-0x19f,-0xc4,-0x19f)];const _0xb4913e=document['createElem'+_0x4f2423(-0x2b4,-0x29d,-0x284,-0x21e)](_0x39b492(0x3d,-0x4e,-0x12a,-0x87));_0xb4913e['textConten'+'t']=_0x43f406[_0x39b492(-0x1da,-0x194,-0x1ea,-0x1ea)],_0xb4913e[_0x4f2423(-0x63,-0x94,-0x11c,-0x129)]=_0x43f406[_0x39b492(-0x77,-0xbd,-0xf8,-0xb7)],_0x519c01[_0x39b492(-0xe2,0x7d,-0x6,-0x46)+'d'](_0xb4913e);function _0x19de57(){function _0x3ef3ea(_0x376aca,_0x54120e,_0x3c0e3b,_0x1cd6fe){return _0x39b492(_0x54120e,_0x54120e-0x31,_0x3c0e3b-0x13,_0x3c0e3b-0x29d);}const _0x1c75a3={'UmTKL':function(_0x139cd5,_0x338b70){return _0x2b0b8c['brkeO'](_0x139cd5,_0x338b70);},'vBCBa':_0x2b0b8c[_0x3ef3ea(0xfa,0x113,0xe0,0x1a8)],'LsZEo':_0x3ef3ea(0x141,0xcd,0x167,0x1d1),'ZUgnw':'div','fxWPa':_0x77906b(0x59f,0x583,0x4de,0x633),'uhkvs':_0x2b0b8c[_0x77906b(0x574,0x537,0x5a6,0x639)],'sRzLS':_0x2b0b8c[_0x77906b(0x5c6,0x547,0x625,0x691)],'orBks':_0x2b0b8c[_0x77906b(0x5d9,0x689,0x5c2,0x6ba)],'quxLj':_0x77906b(0x508,0x5cc,0x4b0,0x558),'ojOPU':function(_0x10ff3f,_0x2e39c3){function _0x384630(_0x9e7a98,_0x3d5a0d,_0x2c3892,_0x9c013a){return _0x3ef3ea(_0x9e7a98-0x54,_0x3d5a0d,_0x9c013a-0x48,_0x9c013a-0x123);}return _0x2b0b8c[_0x384630(0x80,0x105,0x83,0x13e)](_0x10ff3f,_0x2e39c3);},'GmDIA':_0x2b0b8c[_0x77906b(0x51a,0x4ec,0x5e2,0x4af)]};_0x519c01['innerHTML']='';if(_0x2b3306[_0x77906b(0x50a,0x4a6,0x554,0x5ef)]===0x296*0x4+0x13a*0x13+0x49*-0x76){const _0x4ade0a=document[_0x77906b(0x4a7,0x45c,0x42f,0x40d)+_0x77906b(0x435,0x4e9,0x3e7,0x409)]('div');_0x4ade0a[_0x77906b(0x45c,0x3c4,0x4ba,0x4ee)+'t']=_0x2b0b8c[_0x3ef3ea(0x187,0x18a,0x25a,0x32a)],_0x4ade0a[_0x3ef3ea(0x1b0,0x12c,0x1af,0x19f)]=_0x3ef3ea(0x17d,0x6e,0x13a,0x174)+'popup-empt'+_0x3ef3ea(0x1ae,0x155,0x240,0x1da),_0x519c01[_0x77906b(0x5d2,0x630,0x626,0x695)+'d'](_0x4ade0a);return;}_0x2b3306[_0x77906b(0x4f3,0x55a,0x496,0x41d)]((_0xba0bb3,_0x348c22)=>{const _0x2c0b0a={'tnaBi':function(_0x591444,_0x21914f){return _0x1c75a3['UmTKL'](_0x591444,_0x21914f);},'QwCMa':_0x1c75a3[_0x3d44ee(0x24,0x10d,0x9,0xe7)],'uFKfU':function(_0x5bf969){return _0x5bf969();}},_0x7e756c=document['createElem'+'ent'](_0x1c75a3[_0x5bf8ae(0x39a,0x34c,0x39b,0x2e3)]);_0x7e756c[_0x3d44ee(0x14f,0x129,0x161,0xdb)]=_0x3d44ee(-0x4a,0xf8,-0x5,0x66)+'popup-img-'+_0x5bf8ae(0x3ec,0x540,0x46e,0x427);const _0x1314c5=document[_0x5bf8ae(0x38c,0x2c9,0x345,0x2b8)+_0x3d44ee(-0x4d,-0xc5,0x3d,-0x1a)](_0x1c75a3[_0x3d44ee(0x199,0x105,-0x2f,0xae)]);_0x1314c5[_0x3d44ee(0xa,0x1e,0xc1,0xdb)]=_0x5bf8ae(0x3c4,0x36c,0x353,0x324)+_0x3d44ee(0x10a,0x19f,0xba,0xc3)+'wrapper';const _0x58d6ae=document[_0x5bf8ae(0x2f4,0x283,0x345,0x3de)+_0x3d44ee(0x16,0x19,-0x90,-0x1a)](_0x3d44ee(0x231,0xb0,0x180,0x166));function _0x5bf8ae(_0x12febb,_0xde3af3,_0x30cd0b,_0x83201b){return _0x77906b(_0x30cd0b- -0x162,_0x12febb,_0x30cd0b-0xc4,_0x83201b-0x1f);}_0x58d6ae['src']=_0xba0bb3[_0x5bf8ae(0x345,0x375,0x2f1,0x23e)];const _0x41900c=document[_0x5bf8ae(0x3be,0x2aa,0x345,0x2c8)+_0x3d44ee(-0xc2,0xd0,0x1f,-0x1a)](_0x1c75a3[_0x3d44ee(0x131,-0x46,-0x15,0x7e)]);_0x41900c[_0x5bf8ae(0x432,0x4c4,0x43a,0x39c)]=_0x1c75a3[_0x5bf8ae(0x445,0x440,0x36b,0x3f7)],_0x41900c[_0x3d44ee(0x163,0xe6,0x212,0x18d)]='×',_0x41900c[_0x3d44ee(0x14,0x197,0x14f,0xdb)]=_0x1c75a3['uhkvs'],_0x41900c[_0x5bf8ae(0x3a2,0x49b,0x3d8,0x4bf)+_0x5bf8ae(0x3cb,0x3f9,0x460,0x472)](_0x1c75a3[_0x5bf8ae(0x2cf,0x311,0x359,0x2dd)],_0x30f086=>{function _0x32ef8c(_0x153b8a,_0x4f0cdc,_0x59417f,_0x222b7f){return _0x3d44ee(_0x153b8a-0x40,_0x4f0cdc-0x122,_0x59417f,_0x153b8a- -0x1e7);}function _0x193729(_0x111120,_0x1d37b7,_0x5ca545,_0x17848d){return _0x5bf8ae(_0x111120,_0x1d37b7-0x83,_0x5ca545- -0x2a4,_0x17848d-0x1d);}if(_0x2c0b0a[_0x193729(0x76,-0xb,0x8d,0x31)](_0x32ef8c(-0x154,-0xa0,-0x69,-0x16d),_0x2c0b0a[_0x32ef8c(-0x8d,-0x2f,-0x135,-0xda)])){const _0x4b64a0=_0x294419[_0x193729(0xda,0x209,0x198,0x257)](_0x1f0f34,arguments);return _0x5a1b0d=null,_0x4b64a0;}else _0x30f086[_0x32ef8c(-0x109,-0x1dc,-0x186,-0x9d)+_0x32ef8c(-0xfe,-0x187,-0xd9,-0xea)](),_0x2b3306[_0x193729(0x1af,0xe3,0x19c,0xf7)](_0x348c22,-0x14c8+0x1843+-0x37a),_0x2c0b0a['uFKfU'](_0x19de57);}),_0x1314c5[_0x5bf8ae(0x48a,0x3c4,0x470,0x416)+'d'](_0x58d6ae),_0x1314c5[_0x3d44ee(0xce,0x247,0x239,0x183)+'d'](_0x41900c);const _0x377602=document[_0x5bf8ae(0x338,0x3fe,0x345,0x3b9)+_0x3d44ee(0xc,-0xdb,-0x50,-0x1a)](_0x1c75a3['orBks']);_0x377602[_0x5bf8ae(0x481,0x413,0x43a,0x3bd)]=_0x1c75a3['quxLj'],_0x377602[_0x5bf8ae(0x52f,0x3f5,0x476,0x412)+'r']='图'+_0x1c75a3[_0x3d44ee(0x1c3,0xf7,0x1e4,0xfe)](_0x348c22,-0x4da*0x3+0x3d*-0x75+0x2a70),_0x377602['value']=_0xba0bb3['name']||'',_0x377602['className']=_0x1c75a3[_0x5bf8ae(0x35f,0x3a9,0x3bf,0x34d)],_0x377602['addEventLi'+'stener']('input',_0x482d48=>{function _0x45f6e0(_0x4dd2a4,_0x30035b,_0x4bd9d1,_0x332dfb){return _0x5bf8ae(_0x4dd2a4,_0x30035b-0x180,_0x30035b- -0x3e0,_0x332dfb-0xd7);}function _0x2cdd10(_0x19ac8b,_0x330fb7,_0x958665,_0x3a1454){return _0x5bf8ae(_0x3a1454,_0x330fb7-0x45,_0x330fb7- -0xc8,_0x3a1454-0x20);}_0x1c75a3[_0x45f6e0(0x4f,0x26,0x96,0x8e)]('cMUjN',_0x1c75a3[_0x45f6e0(-0xd3,-0x11a,-0xea,-0x157)])?_0x1335e1=_0x2cdd10(0x368,0x2d0,0x38d,0x357)+_0x2cdd10(0x291,0x28d,0x1bc,0x1d3)+'4,'+_0x2345f4:_0x2b3306[_0x348c22][_0x45f6e0(-0x180,-0xa3,-0x170,-0x17b)]=_0x482d48[_0x2cdd10(0x2f5,0x38d,0x2e8,0x402)]['value'];}),_0x7e756c[_0x3d44ee(0x1ff,0x202,0xd7,0x183)+'d'](_0x1314c5),_0x7e756c[_0x5bf8ae(0x537,0x478,0x470,0x549)+'d'](_0x377602);function _0x3d44ee(_0xab8cac,_0x49267e,_0x19bc4d,_0x5ef468){return _0x3ef3ea(_0xab8cac-0x107,_0x19bc4d,_0x5ef468- -0xd4,_0x5ef468-0x54);}_0x519c01['appendChil'+'d'](_0x7e756c);});const _0x1db6af=document['createElem'+_0x77906b(0x435,0x48b,0x34a,0x403)](_0x2b0b8c[_0x3ef3ea(0x131,0x131,0x1c2,0x1a6)]);_0x1db6af[_0x77906b(0x45c,0x4d8,0x3bd,0x40b)+'t']=_0x77906b(0x528,0x5c1,0x52d,0x513)+_0x2b3306[_0x3ef3ea(0x129,0x138,0x18f,0xa6)]+_0x77906b(0x4ad,0x45f,0x441,0x4e0);function _0x77906b(_0x51ad65,_0x1cf272,_0x43122d,_0x3b1c36){return _0x4f2423(_0x1cf272,_0x1cf272-0x134,_0x43122d-0xc8,_0x51ad65-0x653);}_0x1db6af['className']=_0x2b0b8c[_0x77906b(0x525,0x524,0x5c9,0x453)],_0x519c01['appendChil'+'d'](_0x1db6af);}_0x10786a['addEventLi'+_0x4f2423(-0xf6,-0x70,-0x121,-0x91)](_0x43f406[_0x39b492(-0x4f,0x1b,0x1a,-0x37)],async _0x512c20=>{const _0x170a67=_0x512c20['target'][_0x1586c6(0x189,0x1e1,0x2a5,0x179)];if(!_0x170a67||_0x2b0b8c['eajIw'](_0x170a67[_0x5b8e8b(0x496,0x3e3,0x42a,0x3f7)],0x27*-0xc1+0x195d+-0x40a*-0x1))return;function _0x1586c6(_0x51b533,_0x37986d,_0x2fc21a,_0x3275af){return _0x4f2423(_0x51b533,_0x37986d-0x2c,_0x2fc21a-0x10,_0x37986d-0x2ea);}for(const _0x28949d of _0x170a67){if(!_0x28949d[_0x5b8e8b(0x535,0x4fb,0x3fe,0x489)][_0x5b8e8b(0x3ef,0x3fc,0x4e0,0x429)](_0x2b0b8c[_0x1586c6(0xb,0xb2,0x180,0xa4)]))continue;try{const _0xcfb91c=await _0x2b0b8c[_0x1586c6(0x225,0x17f,0x1f2,0x16e)](_0xacee3e,_0x28949d),_0x2935ff={};_0x2935ff[_0x5b8e8b(0x364,0x37a,0x269,0x340)]=_0xcfb91c,_0x2935ff['name']='',_0x2b3306[_0x1586c6(0x360,0x27a,0x1ff,0x1bb)](_0x2935ff);}catch(_0x308452){console[_0x5b8e8b(0x332,0x38e,0x454,0x376)]('[showUserD'+_0x5b8e8b(0x300,0x490,0x308,0x3c4)+_0x5b8e8b(0x526,0x3f0,0x39e,0x477)+_0x1586c6(0x2ef,0x23a,0x2ee,0x2ee)+_0x1586c6(0x228,0x20f,0x2e7,0x168),_0x308452);}}function _0x5b8e8b(_0x4f8023,_0x68bfa3,_0x5cc250,_0x21cb47){return _0x4f2423(_0x68bfa3,_0x68bfa3-0x180,_0x5cc250-0x1d,_0x21cb47-0x540);}_0x19de57(),_0x10786a[_0x1586c6(0x1fd,0x15b,0x130,0x14c)]='';});function _0xacee3e(_0x1b2709){return new Promise((_0x2f21d7,_0x23a755)=>{function _0x1a3344(_0x4121bc,_0x5463c7,_0x1f57ad,_0x29c99f){return _0x4509(_0x1f57ad- -0x217,_0x29c99f);}function _0x55a884(_0x2bbda0,_0x34d1de,_0x367b59,_0x3e20a6){return _0x4509(_0x34d1de- -0x316,_0x2bbda0);}const _0x12f0b3=new FileReader();_0x12f0b3[_0x55a884(-0xfa,-0x158,-0x12a,-0xfa)]=()=>_0x2f21d7(_0x12f0b3[_0x1a3344(0x17,0x83,0x54,-0x97)]),_0x12f0b3[_0x1a3344(-0x6,0xb7,0x10,0x89)]=_0x23a755,_0x12f0b3['readAsData'+_0x1a3344(0x55,-0x5,0x49,0xc1)](_0x1b2709);});}_0x57466b['appendChil'+'d'](_0x1f25bc),_0x57466b[_0x39b492(-0x48,0x89,-0x4d,-0x46)+'d'](_0x10786a),_0x57466b[_0x39b492(-0xc6,0x7b,0x63,-0x46)+'d'](_0x519c01);const _0x4a0d38=document[_0x39b492(-0x259,-0x197,-0xc6,-0x171)+_0x39b492(-0x12b,-0x172,-0x108,-0x1e3)](_0x43f406[_0x4f2423(-0x2dd,-0x29a,-0x228,-0x233)]);_0x4a0d38[_0x39b492(-0x55,-0x155,-0x148,-0xee)]=_0x43f406[_0x39b492(-0x171,-0x1e6,-0x222,-0x165)];const _0x5e282f=document['createElem'+_0x39b492(-0x2ad,-0x1dc,-0x14a,-0x1e3)](_0x43f406[_0x4f2423(-0x17f,-0x13f,-0x1d7,-0x169)]);_0x5e282f[_0x39b492(-0x27d,-0x284,-0x231,-0x1bc)+'t']='取消',_0x5e282f[_0x4f2423(-0x75,-0x187,-0x49,-0x129)]=_0x43f406['mtKXi'];const _0x414ce3=document['createElem'+'ent'](_0x43f406['apxUK']);_0x414ce3['textConten'+'t']=_0x43f406[_0x4f2423(-0xf0,-0x124,-0x1d7,-0x14d)];function _0x4f2423(_0x53ac0b,_0x25ce57,_0x470d58,_0x1b1273){return _0xbd5c7c(_0x53ac0b-0x25,_0x53ac0b,_0x1b1273- -0xa3,_0x1b1273-0x9a);}_0x414ce3[_0x4f2423(-0xb6,-0x1f7,-0x19c,-0x129)]=_0x43f406['LuXZp'];const _0x136b7b=_0x56ad5e=>{const _0x4d0515={'VDbrw':function(_0xccaacb,_0x50639b){function _0x465166(_0x3444b9,_0x1ca4c1,_0x9bfa69,_0x58988c){return _0x4509(_0x9bfa69-0x3d6,_0x1ca4c1);}return _0x2b0b8c[_0x465166(0x525,0x4c5,0x52e,0x5f7)](_0xccaacb,_0x50639b);}};_0x43c6c6[_0x3b9e01(-0x107,-0xc3,-0xe5,-0x160)]['add'](_0x2b0b8c[_0x3b9e01(-0xc7,-0xa8,-0xa5,-0x8e)]);function _0x3b9e01(_0x1e5112,_0x11c883,_0x118739,_0x496fa1){return _0x39b492(_0x496fa1,_0x11c883-0x155,_0x118739-0xda,_0x118739-0xf5);}function _0x323f41(_0x297cf2,_0x24b9a0,_0x12fdf6,_0x143bec){return _0x39b492(_0x143bec,_0x24b9a0-0x1d3,_0x12fdf6-0x182,_0x297cf2-0x1f6);}setTimeout(()=>{function _0x42f47b(_0x3e9f73,_0x1c646d,_0x1eefd0,_0x5c5095){return _0x323f41(_0x3e9f73-0x2ac,_0x1c646d-0x19f,_0x1eefd0-0x177,_0x5c5095);}function _0x42eac8(_0x559d8d,_0x5bec23,_0x3573c8,_0x446e41){return _0x3b9e01(_0x559d8d-0x173,_0x5bec23-0xc5,_0x446e41-0x15f,_0x5bec23);}_0x43c6c6[_0x42f47b(0x37a,0x43d,0x460,0x3d7)](),_0x4d0515[_0x42eac8(0x93,0x168,0x1e0,0x168)](_0x332d61,_0x56ad5e);},-0x1601+0x3*-0x113+-0xce8*-0x2);};_0x5e282f[_0x39b492(0x5,-0x6c,0x9,-0xde)+_0x39b492(0x12,0x80,0x11,-0x56)](_0x43f406[_0x4f2423(-0x182,-0x190,-0x2c5,-0x218)],()=>_0x136b7b(null)),_0x414ce3[_0x4f2423(-0x46,-0x19b,-0x3a,-0x119)+_0x39b492(-0xeb,-0xdb,-0x86,-0x56)](_0x39b492(-0x256,-0x24d,-0x1df,-0x180),()=>_0x136b7b({'text':_0x42dde2[_0x39b492(-0x160,-0x212,-0x17e,-0x154)]['trim']()||null,'images':[..._0x2b3306]}));const _0x454ccf=_0x6c8ad3=>{function _0x4c17cb(_0x393c51,_0x38f719,_0x218d7e,_0x337a84){return _0x39b492(_0x38f719,_0x38f719-0xc3,_0x218d7e-0xaa,_0x393c51- -0x1c);}function _0x49a219(_0xd5d604,_0x31e21f,_0x206710,_0x5d5ea8){return _0x39b492(_0xd5d604,_0x31e21f-0xc2,_0x206710-0x1e,_0x5d5ea8-0x574);}if(_0x2b0b8c['zjzsI'](_0x6c8ad3[_0x49a219(0x449,0x35d,0x362,0x3a7)],_0x2b0b8c['zqLSx']))_0x2b0b8c[_0x49a219(0x3cf,0x3db,0x3f7,0x47e)](_0x136b7b,null),document['removeEven'+_0x4c17cb(-0x149,-0xd6,-0xf5,-0x12a)](_0x2b0b8c[_0x4c17cb(-0x1be,-0x27a,-0xdb,-0x285)],_0x454ccf);else _0x2b0b8c[_0x49a219(0x4df,0x55e,0x4a5,0x4d7)](_0x6c8ad3['key'],'Enter')&&_0x6c8ad3[_0x4c17cb(-0x11d,-0x1bc,-0x11b,-0x107)]&&(_0x4c17cb(-0x19b,-0x253,-0x27b,-0x211)===_0x2b0b8c[_0x49a219(0x45e,0x573,0x4d4,0x4db)]?_0x2248f9[_0x4c17cb(-0x51,-0xa1,0x37,-0x8e)](..._0x56ea47['content']):(_0x2b0b8c[_0x4c17cb(-0x112,-0x1f5,-0xc3,-0xe7)](_0x136b7b,{'text':_0x42dde2[_0x4c17cb(-0x170,-0x1d2,-0xbc,-0xf2)][_0x4c17cb(-0x99,0x8,-0x170,-0x3d)]()||null,'images':[..._0x2b3306]}),document[_0x4c17cb(-0x1e0,-0x25d,-0x136,-0x1c9)+_0x49a219(0x524,0x3d8,0x3e4,0x447)](_0x2b0b8c[_0x49a219(0x376,0x418,0x2f0,0x3d2)],_0x454ccf)));};document['addEventLi'+_0x39b492(-0x132,-0x12d,-0x96,-0x56)](_0x43f406[_0x4f2423(-0x172,-0x17a,-0x68,-0x115)],_0x454ccf),_0x4a0d38[_0x4f2423(-0x12,-0x14b,-0xa7,-0x81)+'d'](_0x5e282f),_0x4a0d38[_0x4f2423(0x68,-0xa5,0xf,-0x81)+'d'](_0x414ce3),_0x521769[_0x39b492(-0x95,-0x112,-0x87,-0x46)+'d'](_0x340c70),_0x521769['appendChil'+'d'](_0x3b8e68),_0x521769[_0x4f2423(-0xe7,-0x67,0xc,-0x81)+'d'](_0x42dde2),_0x521769[_0x39b492(-0x116,0x7f,-0x49,-0x46)+'d'](_0x57466b),_0x521769['appendChil'+'d'](_0x4a0d38),_0x43c6c6[_0x4f2423(-0x130,0x1b,-0xe6,-0x81)+'d'](_0x521769),document[_0x39b492(-0xb9,-0x217,-0x173,-0x12b)][_0x39b492(-0xec,0x3e,-0x6e,-0x46)+'d'](_0x43c6c6),_0x43f406['icZTi'](setTimeout,()=>_0x42dde2[_0x4f2423(-0x12e,-0x232,-0x2a7,-0x1eb)](),-0x1a7*0xd+0x3*0x496+0x81d);});}function replacePlaceholder(_0x1ada08,_0x391433,_0x39bec9,_0x198ae3){const _0x2a8c7c={'nJbqy':function(_0x319163,_0x4acd52){return _0x319163(_0x4acd52);},'GbJNy':'获取角色设计提示词超'+'时','hkaxI':function(_0x1132c1,_0x1474ca){return _0x1132c1(_0x1474ca);},'agaXG':function(_0x2cba3c,_0x22067b){return _0x2cba3c===_0x22067b;},'jbgaV':function(_0x1d4ca1,_0x786fdf){return _0x1d4ca1===_0x786fdf;},'KfeJx':'dURXS','oiaec':'KhSTO','SlgML':function(_0x13edab,_0x2a5e05){return _0x13edab!==_0x2a5e05;},'zDwnP':_0x3dc439(0x249,0x25a,0x209,0x319),'KnxBO':'nLQjN','nNccO':function(_0x37dc82,_0x529e97){return _0x37dc82===_0x529e97;},'wNJPz':_0x3dc439(0x2cf,0x206,0x2cd,0x2dc),'QrLFZ':_0x28f4d7(0x518,0x522,0x5d4,0x4e3),'OIaVh':function(_0x1577c2,_0x54725d,_0x110249,_0x12475d,_0x5f4df9){return _0x1577c2(_0x54725d,_0x110249,_0x12475d,_0x5f4df9);}};if(_0x2a8c7c[_0x3dc439(0x1ff,0x281,0x2c4,0x296)](typeof _0x1ada08,_0x3dc439(0x14d,0x1b1,0x217,0x23d)))return _0x39bec9&&_0x1ada08[_0x28f4d7(0x3fb,0x4ce,0x38e,0x4d6)](_0x391433)&&(_0x198ae3&&(_0x2a8c7c[_0x28f4d7(0x44c,0x4c4,0x37c,0x4e6)](_0x2a8c7c['KfeJx'],_0x2a8c7c['oiaec'])?(_0x5151ac['removeList'+_0x28f4d7(0x4a4,0x41b,0x586,0x402)](_0x4bc48a['LLM_CHAR_D'+'ESIGN_GET_'+'PROMPT_RES'+_0x3dc439(0x1ab,0x235,0x199,0x190)],_0x499177),_0x2a8c7c['nJbqy'](_0x282918,new _0x339edd(_0x2a8c7c['GbJNy']))):_0x198ae3['add'](_0x391433))),_0x1ada08['replaceAll'](_0x391433,_0x39bec9);if(Array[_0x28f4d7(0x48d,0x555,0x551,0x4c8)](_0x1ada08)){if(_0x2a8c7c[_0x3dc439(0x193,0x14c,0x6d,0x66)](_0x2a8c7c[_0x3dc439(0x302,0x24c,0x273,0x16d)],_0x2a8c7c[_0x3dc439(0x26d,0x24b,0x257,0x336)]))return _0x1ada08[_0x3dc439(0x1b8,0x271,0x25f,0x263)](_0x28665a=>replacePlaceholder(_0x28665a,_0x391433,_0x39bec9,_0x198ae3));else{const _0x339299={};_0x339299[_0x28f4d7(0x56a,0x4fa,0x5a0,0x5e3)]=_0x177108[_0x3dc439(0x2d7,0x273,0x22a,0x214)],_0x339299['testMode']=![],_0x2a8c7c['hkaxI'](_0x2c3ee2,_0x339299);}}function _0x3dc439(_0x1af5e0,_0x387453,_0xae4807,_0x1b2208){return _0x4509(_0x387453-0x8,_0x1b2208);}function _0x28f4d7(_0x5eb2d3,_0x372677,_0x45d492,_0x1b2b0c){return _0x4509(_0x5eb2d3-0x2ff,_0x1b2b0c);}if(_0x1ada08&&_0x2a8c7c[_0x3dc439(0x1f5,0x12d,0x15a,0x1ef)](typeof _0x1ada08,_0x2a8c7c[_0x28f4d7(0x4ff,0x4d4,0x482,0x46f)])){if('WsYCo'!==_0x2a8c7c[_0x3dc439(0x2be,0x230,0x218,0x1ae)]){const _0xb525c4={};for(const _0xb67583 in _0x1ada08){_0xb525c4[_0xb67583]=_0x2a8c7c['OIaVh'](replacePlaceholder,_0x1ada08[_0xb67583],_0x391433,_0x39bec9,_0x198ae3);}return _0xb525c4;}else _0x2fcabf&&_0x5141a5[_0x3dc439(0x2bb,0x262,0x1d2,0x2ee)](_0x2afa64);}return _0x1ada08;}function attachImagesToMessage(_0x9cdeb,_0x406f20,_0x3abc50,_0x434fbe='参考图片'){const _0x3a1531={};_0x3a1531['MdDEs']=function(_0x462fa4,_0x10b926){return _0x462fa4+_0x10b926;},_0x3a1531['HJsaH']=function(_0xae06e8,_0x552f99){return _0xae06e8===_0x552f99;},_0x3a1531['HBvQJ']=function(_0x36ccee,_0x448548){return _0x36ccee+_0x448548;},_0x3a1531[_0x378fee(-0x15e,-0xfb,-0x151,-0x1a6)]=_0x115d83(-0xad,-0x66,-0x2d,-0x56),_0x3a1531[_0x115d83(-0x5d,0x3e,0x5e,0x38)]=_0x378fee(-0x25,-0x68,-0xde,-0x7f),_0x3a1531[_0x378fee(-0x177,-0x13f,-0xc6,-0x15b)]=_0x115d83(-0x125,-0x143,-0xf5,-0x100),_0x3a1531['YQeiW']=function(_0x3f6504,_0x335400){return _0x3f6504<_0x335400;},_0x3a1531[_0x115d83(-0x3f,0x93,-0x55,0x16)]=function(_0xaa50f2,_0x19b12d){return _0xaa50f2>=_0x19b12d;},_0x3a1531[_0x378fee(-0xe4,-0x180,-0x1e6,-0x1aa)]=function(_0x41c441,_0x4c3f11){return _0x41c441===_0x4c3f11;};function _0x115d83(_0x484d06,_0x127e26,_0x44bd69,_0x79e7c){return _0x4509(_0x44bd69- -0x22a,_0x484d06);}_0x3a1531[_0x115d83(0x57,-0xea,-0x15,-0x42)]=_0x115d83(-0xfa,0x43,-0x78,-0x106),_0x3a1531[_0x378fee(-0x111,0x65,-0xf9,-0x4f)]=function(_0x4d7b4d,_0x470dc3){return _0x4d7b4d>_0x470dc3;};const _0x4a5857=_0x3a1531;if(!_0x3abc50||_0x3abc50[_0x115d83(-0xd8,0x24,-0x76,-0x111)]===-0x1*0x2069+0x1*0x25bd+-0x3e*0x16||_0x4a5857[_0x378fee(-0x19f,-0x118,-0x161,-0x139)](_0x406f20,0x1412+0x2d1*0xa+-0x303c)||_0x4a5857[_0x378fee(-0x3a,-0xe1,-0x15a,-0xe2)](_0x406f20,_0x9cdeb['length']))return _0x9cdeb;const _0xe6efdf=[..._0x9cdeb],_0x34c485=_0xe6efdf[_0x406f20];function _0x378fee(_0x1d43cc,_0x2535b9,_0x41882e,_0x3d55e6){return _0x4509(_0x3d55e6- -0x2b7,_0x2535b9);}const _0x468443=[];if(_0x4a5857['MtPFx'](typeof _0x34c485[_0x378fee(-0x1e6,-0xef,-0xca,-0x142)],'string')){const _0x1adbab={};_0x1adbab[_0x115d83(0x41,0x68,0x1c,-0x2c)]=_0x4a5857[_0x378fee(-0x65,-0x6d,-0x96,-0xa2)],_0x1adbab[_0x378fee(-0x10d,-0x102,-0x6f,-0x105)]=_0x34c485[_0x378fee(-0x161,-0x21a,-0xbb,-0x142)],_0x468443[_0x378fee(-0xc3,-0xa2,0x69,-0x2a)](_0x1adbab);}else Array['isArray'](_0x34c485[_0x378fee(-0x107,-0xb7,-0x13c,-0x142)])&&_0x468443[_0x378fee(0x6b,-0xad,0xad,-0x2a)](..._0x34c485[_0x115d83(-0xb2,-0x188,-0xb5,0x0)]);if(_0x4a5857[_0x115d83(0xe1,-0x64,0x3e,0x12)](_0x3abc50['length'],-0x1ccc+0x38e*-0x1+0x52*0x65)){const _0x42eace={};_0x42eace[_0x378fee(-0x87,-0xca,0x44,-0x71)]=_0x4a5857['ykWBY'],_0x42eace['text']='\x0a[以下是用户上传的'+_0x3abc50[_0x378fee(-0x163,-0xf9,-0x98,-0x103)]+'张'+_0x434fbe+']',_0x468443[_0x115d83(-0x41,0x12a,0x63,0x9)](_0x42eace);}_0x3abc50['forEach']((_0x3f81ee,_0x4787a5)=>{const _0x3c7eca=_0x4a5857[_0x437a87(0x377,0x322,0x302,0x265)](typeof _0x3f81ee,_0x437a87(0x32b,0x3b3,0x3c6,0x3b5))?_0x3f81ee:_0x3f81ee['base64'],_0x505a30=typeof _0x3f81ee===_0x14d101(0x2b4,0x228,0x2b3,0x2b5)&&_0x3f81ee[_0x14d101(0x1ff,0x1cc,0x15a,0x20b)]?_0x3f81ee[_0x437a87(0x300,0x353,0x3dd,0x28f)]:''+_0x434fbe+_0x4a5857[_0x14d101(0x1ec,0x11e,0x25f,0x26e)](_0x4787a5,0x1*-0x1f3+0x429*0x9+-0x237d),_0x46bb53={};_0x46bb53[_0x14d101(0x2fc,0x2d7,0x21d,0x3dc)]=_0x437a87(0x373,0x3bc,0x465,0x416),_0x46bb53['text']='['+_0x505a30+']',_0x468443[_0x14d101(0x343,0x3d0,0x276,0x39a)](_0x46bb53);function _0x14d101(_0x24d7e0,_0x2a198b,_0x1c1128,_0x2a1988){return _0x115d83(_0x2a1988,_0x2a198b-0x38,_0x24d7e0-0x2e0,_0x2a1988-0x113);}let _0x4aef0d=_0x3c7eca;if(!_0x3c7eca['startsWith'](_0x4a5857['Cwioy'])){if(_0x4a5857[_0x14d101(0x33e,0x27a,0x2b3,0x34d)]!==_0x4a5857['BSvFQ']){const _0x1e2c26=_0x28379f[_0x14d101(0x199,0x1db,0x1b4,0x205)+_0x14d101(0x348,0x2b3,0x32e,0x35a)+'t']();_0x33c13b=_0x4a5857[_0x437a87(0x346,0x3f7,0x45e,0x336)](_0x1e2c26['bottom'],-0x1c21*0x1+-0x1*-0xf77+0xcb4);}else _0x4aef0d=_0x14d101(0x25a,0x32a,0x25e,0x320)+_0x437a87(0x360,0x36b,0x31d,0x3d7)+'4,'+_0x3c7eca;}const _0x32bd02={};_0x32bd02[_0x14d101(0x258,0x1e2,0x1d8,0x2ca)]=_0x4aef0d,_0x32bd02[_0x14d101(0x334,0x2a9,0x2ee,0x33e)]=_0x4a5857['VKQZv'];function _0x437a87(_0x4e5510,_0x2d1549,_0x58a5e3,_0x12f167){return _0x378fee(_0x4e5510-0x162,_0x12f167,_0x58a5e3-0x3c,_0x2d1549-0x4c1);}const _0x508b9b={};_0x508b9b[_0x14d101(0x2fc,0x322,0x398,0x347)]=_0x14d101(0x2a4,0x1d4,0x372,0x233),_0x508b9b[_0x437a87(0x3e3,0x3f8,0x4bb,0x44d)]=_0x32bd02,_0x468443[_0x14d101(0x343,0x3cb,0x391,0x2b5)](_0x508b9b);});const _0xf8eb99={..._0x34c485};return _0xf8eb99[_0x378fee(-0x8a,-0x195,-0x14f,-0x142)]=_0x468443,_0xe6efdf[_0x406f20]=_0xf8eb99,_0xe6efdf;}function findMessageIndexWithPlaceholder(_0x22b3d1,_0x34d3b1){const _0x54fc50={};_0x54fc50['QpfIm']='未能获取上下文内容',_0x54fc50[_0x304fc3(0x8d,0x256,0x175,0x132)]=function(_0x511ab6,_0x2b7305){return _0x511ab6<_0x2b7305;},_0x54fc50[_0x50e0e1(0xac,-0x22,0x85,-0xfd)]=function(_0x318199,_0x1ca9f4){return _0x318199!==_0x1ca9f4;},_0x54fc50[_0x50e0e1(-0x45,0x31,0x108,0x5a)]=_0x304fc3(0x1de,0x1a2,0x1d7,0x127),_0x54fc50[_0x50e0e1(-0x8f,-0x4,0x11,0x64)]=function(_0xbece88,_0x1c26df){return _0xbece88===_0x1c26df;},_0x54fc50['UPENT']='WRcqm';function _0x50e0e1(_0x4fc23e,_0x31aa07,_0x7aa801,_0x4391d9){return _0x4509(_0x31aa07- -0x236,_0x7aa801);}_0x54fc50[_0x50e0e1(-0x77,-0x3e,0x56,-0xf5)]=function(_0x46673d,_0x253193){return _0x46673d===_0x253193;};function _0x304fc3(_0x6fd473,_0x46d0e5,_0x5c9610,_0x51a426){return _0x4509(_0x5c9610-0x8f,_0x6fd473);}_0x54fc50[_0x50e0e1(-0x40,-0x106,-0x34,-0xe6)]=_0x304fc3(0x164,0x29a,0x241,0x1d7),_0x54fc50[_0x50e0e1(-0x1d3,-0x123,-0x14a,-0x171)]=_0x304fc3(0xd0,0x245,0x173,0x108);const _0x305439=_0x54fc50;for(let _0x3d1614=-0x9ba+-0x111e+0x1ad8;_0x305439[_0x50e0e1(-0xb3,-0x150,-0x1dd,-0x8b)](_0x3d1614,_0x22b3d1[_0x304fc3(0x32f,0x27a,0x243,0x2b6)]);_0x3d1614++){if(_0x305439['YLDPN'](_0x305439[_0x304fc3(0x2ea,0x297,0x2f6,0x342)],_0x305439[_0x50e0e1(0x102,0x31,0x62,0x8)])){_0x683ff8['warning'](_0x305439['QpfIm']);return;}else{const _0x168f89=_0x22b3d1[_0x3d1614];if(_0x305439[_0x50e0e1(0x72,-0x4,-0x2a,0xe7)](typeof _0x168f89[_0x50e0e1(-0x167,-0xc1,-0x15,-0x10c)],'string')&&_0x168f89['content'][_0x304fc3(0x1a8,0x260,0x18b,0x103)](_0x34d3b1))return _0x3d1614;else{if(Array[_0x304fc3(0x18f,0x1f8,0x21d,0x2c8)](_0x168f89['content'])){if(_0x305439[_0x50e0e1(-0x58,0x23,0xd4,0x9e)]===_0x50e0e1(0x2d,0x2e,0x49,-0x83))for(const _0x11055c of _0x168f89[_0x50e0e1(-0x15,-0xc1,-0x4f,0x2)]){if(_0x305439['qexWK'](_0x11055c['type'],_0x305439['uOIYF'])&&_0x11055c[_0x304fc3(0x1d1,0x160,0x241,0x31c)][_0x304fc3(0xfe,0x153,0x18b,0x131)](_0x34d3b1))return _0x305439[_0x304fc3(0x20d,0x1c3,0x2a3,0x35a)](_0x305439[_0x304fc3(0x15a,0xce,0x1a2,0xfc)],'iFKpY')?_0x3d1614:_0x5cdcdd[_0x50e0e1(-0x4e,0x33,0xa7,-0x24)](_0x1ae508=>_0x4c432b(_0x1ae508,_0x1d30d7,_0x4cc638,_0x5d197d));}else _0x2fd2e0[_0x50e0e1(0x5d,0x57,0x93,0x76)](_0x294639);}}}}return-(-0x14d*-0x8+0x335+-0xd9c);}function generateRequestId(){const _0x34bc05={};_0x34bc05[_0xf1d0e(-0x95,-0x2,-0x153,-0x4f)]=function(_0x4f4252,_0xe2d888){return _0x4f4252+_0xe2d888;};const _0x56b97d=_0x34bc05;function _0xf1d0e(_0x39a97b,_0x625a99,_0x3d69b1,_0xb0175b){return _0x4509(_0x39a97b- -0x2cf,_0x625a99);}if(crypto&&crypto[_0x1c60b0(0x76,-0x69,-0x37,-0x123)])return crypto['randomUUID']();function _0x1c60b0(_0x3a9a40,_0x1f9564,_0x15e170,_0xa80102){return _0x4509(_0x15e170- -0x231,_0x3a9a40);}return _0x56b97d[_0x1c60b0(0x3,-0x5b,0x9,-0xac)](Date[_0xf1d0e(-0x19b,-0x24b,-0x161,-0x18f)]()[_0xf1d0e(-0x154,-0xa7,-0x81,-0x198)](-0x206e*0x1+0xd20+0x1372),Math['random']()['toString'](0x1981*0x1+0x9e4+-0x2341)[_0x1c60b0(-0xe1,-0xc4,-0x143,-0x16b)](0x2611+-0xd*-0x162+-0x3809));}export function LLM_CHAR_DESIGN_GET_PROMPT(){function _0x5e57a5(_0x4f6ffb,_0x3981b7,_0x944808,_0x6ff98c){return _0x4509(_0x4f6ffb- -0x3af,_0x6ff98c);}function _0x5b68cb(_0xa09f3,_0x1d4e23,_0x393329,_0x5c8214){return _0x4509(_0xa09f3- -0x173,_0x393329);}const _0x58708b={'yDWrt':function(_0x501ea5,_0x2778a2){return _0x501ea5!==_0x2778a2;},'DbHxn':function(_0x530fd3,_0x2c054c){return _0x530fd3(_0x2c054c);},'lonmt':function(_0x5e0970,_0x1eb396){return _0x5e0970!==_0x1eb396;},'bTryd':_0x5e57a5(-0x2db,-0x203,-0x3ab,-0x3c6),'puMAP':_0x5e57a5(-0x1ed,-0x19c,-0x255,-0x26a)+'时','brjNa':function(_0x5bbb31){return _0x5bbb31();}};return new Promise((_0x583f5b,_0x4609db)=>{function _0x58f09a(_0x2f13b4,_0xcd9794,_0x2ca59b,_0x1c3aa4){return _0x5b68cb(_0x2ca59b-0x20d,_0xcd9794-0xab,_0xcd9794,_0x1c3aa4-0xe2);}const _0x47cab1={'PThzC':'未在\x20LLM\x20输出中'+_0x2f46f8(-0x56,-0x59,-0xbf,-0xe5),'xGRRD':function(_0x53dbac,_0x30c1fc){function _0x1fbeec(_0x1e5a64,_0x1541f9,_0x1aebca,_0x52ff1d){return _0x2f46f8(_0x1e5a64-0xba,_0x1e5a64,_0x1aebca-0x18b,_0x1541f9-0x2de);}return _0x58708b[_0x1fbeec(0x227,0x1c7,0x128,0x1ce)](_0x53dbac,_0x30c1fc);},'HHGZp':_0x58708b['bTryd'],'pasMC':function(_0x1da246,_0x380b64){return _0x1da246(_0x380b64);},'WILep':_0x58708b[_0x58f09a(0x1e2,0x1a7,0x1b3,0x1fe)]},_0x48b204=_0x58708b[_0x58f09a(0x1e0,0x20f,0x28c,0x21e)](generateRequestId);console[_0x2f46f8(0x6e,-0x41,0x123,0x4d)](_0x2f46f8(-0xae,-0xa6,0x13,0x2e)+_0x58f09a(0x334,0x2ac,0x249,0x2c6)+_0x58f09a(0x326,0x23d,0x310,0x234)+_0x2f46f8(-0x9a,-0x5f,0x92,-0x12)+_0x58f09a(0x25c,0x2d7,0x2ba,0x36c)+_0x48b204+')');const _0x548b2d=_0x315d21=>{if(_0x58708b[_0x5b15bd(-0x8a,0x58,-0x3e,-0x10d)](_0x315d21['id'],_0x48b204))return;function _0x44c22a(_0x209769,_0xf75190,_0x1ba274,_0x3512b3){return _0x58f09a(_0x209769-0x1ab,_0x209769,_0x3512b3-0x2cb,_0x3512b3-0x4b);}function _0x5b15bd(_0x1e97c9,_0x4f67d2,_0x4e5386,_0x3224f7){return _0x2f46f8(_0x1e97c9-0x15,_0x3224f7,_0x4e5386-0x1b2,_0x4e5386- -0xbe);}eventSource[_0x44c22a(0x54c,0x404,0x5a7,0x4ce)+_0x5b15bd(-0x101,-0x171,-0xf0,-0x1aa)](eventNames[_0x5b15bd(-0x2,-0x9c,-0x7e,0x2d)+_0x44c22a(0x563,0x47f,0x426,0x4ef)+_0x44c22a(0x5e0,0x48f,0x4d2,0x51d)+_0x44c22a(0x66c,0x4c9,0x4d9,0x592)],_0x548b2d),_0x58708b['DbHxn'](_0x583f5b,_0x315d21[_0x44c22a(0x50a,0x474,0x484,0x482)]);};eventSource['on'](eventNames[_0x2f46f8(-0x7e,0x8e,-0x7f,0x40)+_0x2f46f8(0x4f,0x5b,0x0,-0x4d)+_0x58f09a(0x1f7,0x1ce,0x252,0x2d0)+'PONSE'],_0x548b2d);const _0x1c67ce={};_0x1c67ce['id']=_0x48b204,eventSource['emit'](eventNames['LLM_CHAR_D'+_0x2f46f8(-0x33,-0x16,-0x48,-0x4d)+'PROMPT_REQ'+_0x2f46f8(0x154,0x9f,0x59,0x84)],_0x1c67ce);function _0x2f46f8(_0x3a7387,_0x5014fa,_0xc9da04,_0x224922){return _0x5e57a5(_0x224922-0x1d8,_0x5014fa-0x9d,_0xc9da04-0x1e9,_0x5014fa);}setTimeout(()=>{function _0x49a115(_0x3ed059,_0x253791,_0x4f7089,_0x4ddafe){return _0x2f46f8(_0x3ed059-0x1d3,_0x4f7089,_0x4f7089-0x148,_0x3ed059-0x95);}const _0x1530bd={};_0x1530bd[_0x49a115(-0x16,0xa4,-0x41,0x88)]=_0x47cab1['PThzC'];function _0x81509e(_0x4147e0,_0x3cab88,_0x4d984b,_0x2c9d47){return _0x58f09a(_0x4147e0-0x59,_0x4d984b,_0x3cab88- -0x2af,_0x2c9d47-0x15c);}_0x1530bd[_0x49a115(0xff,0xca,0x131,0x169)]=_0x49a115(0xc3,0x12d,0x0,0xaf)+'Gen]\x20No\x20ch'+'aracter/ou'+_0x81509e(-0x15,0x3,-0xca,-0x17)+_0x49a115(0x12c,0x105,0x1b8,0x105)+'utput';const _0x564c5b=_0x1530bd;if(_0x47cab1[_0x81509e(-0x25,0x70,-0x37,0x4d)](_0x47cab1[_0x49a115(0xee,0x48,0x153,0x157)],'NYPTE'))eventSource[_0x49a115(0x27,0xfb,-0xbc,0x81)+_0x49a115(0x63,0x56,-0x7f,-0x25)](eventNames[_0x49a115(0xd5,0x155,0x197,0x89)+_0x49a115(0x48,-0x9d,0xe5,0x21)+_0x81509e(-0x11c,-0x5d,-0x53,0x84)+'PONSE'],_0x548b2d),_0x47cab1[_0x49a115(-0x11,-0x26,0x64,0x24)](_0x4609db,new Error(_0x47cab1[_0x49a115(0xbf,0x137,0x11d,0x14a)]));else{_0x55e539[_0x49a115(-0x20,-0x36,-0x20,-0x59)](_0x564c5b['lwUBm']),_0x8540da[_0x49a115(0xe2,0x138,0xe4,0x127)](_0x564c5b[_0x49a115(0xff,0x1bd,0xbd,0x10d)]),_0x122c93[_0x49a115(0xe2,0x11b,0x1c8,0x165)](_0x81509e(0xcd,-0x10,-0x6a,-0xa4)+_0x49a115(0x8c,0x2e,-0x57,0x78)+'LM\x20output\x20'+'for\x20debugg'+_0x81509e(-0x81,-0x101,-0x17d,-0xf7),_0x3db004);return;}},-0x2*-0x21+-0x1*-0x344d+-0xd7f);});}export function LLM_CHAR_DESIGN(_0x58254a,_0xbc4ba0={}){function _0x43ecc6(_0x3762c4,_0x578ab0,_0x115e3f,_0x5dc90e){return _0x4509(_0x3762c4- -0x43,_0x578ab0);}function _0x368a0e(_0x167cbf,_0xdafc30,_0x433f8a,_0x27bdf6){return _0x4509(_0x433f8a-0x216,_0x167cbf);}const _0x2fe49d={'tklSv':function(_0x389b1b,_0x128c0e){return _0x389b1b(_0x128c0e);},'gYrdR':function(_0x3f04f7,_0x1c6bc2){return _0x3f04f7===_0x1c6bc2;},'IBxYJ':_0x43ecc6(0x207,0x2e5,0x190,0x2de),'hMHyy':function(_0x13a020,_0x28d3fb){return _0x13a020(_0x28d3fb);},'nyQJc':function(_0x2213a2,_0x3a9c63){return _0x2213a2===_0x3a9c63;},'EdldI':_0x43ecc6(0x1e8,0x1f5,0x271,0x10f),'CRMop':function(_0x2d96b0){return _0x2d96b0();},'LefPC':function(_0x3dba69,_0x4a0d3a){return _0x3dba69(_0x4a0d3a);},'xCnnV':function(_0x58bbbd,_0xe7de50){return _0x58bbbd(_0xe7de50);},'UjrQY':function(_0x32036e,_0x8d5463){return _0x32036e!==_0x8d5463;},'rBkXd':_0x43ecc6(0x1dc,0x278,0x291,0x106),'MFbUT':'BWjwv','jVHLi':function(_0xdb04de,_0x2c6ed4){return _0xdb04de(_0x2c6ed4);},'gzVBl':function(_0x927c12,_0x48b8a9){return _0x927c12(_0x48b8a9);},'USKVq':_0x43ecc6(0x234,0x202,0x222,0x318)+_0x368a0e(0x38c,0x42a,0x3a6,0x3fc),'uwUwg':_0x368a0e(0x2fe,0x2d3,0x357,0x409),'bizGf':function(_0x2a7bf3){return _0x2a7bf3();},'ScCJD':function(_0xb19e0b,_0x5311a1){return _0xb19e0b===_0x5311a1;},'yhhJf':'string','WepoS':_0x368a0e(0x460,0x4bc,0x414,0x4b8),'ddDDV':function(_0x2aa194,_0x505541){return _0x2aa194+_0x505541;},'Qsxub':'text','euWuf':_0x368a0e(0x3f9,0x490,0x413,0x3ae),'qNWEW':_0x43ecc6(0xf2,0xfa,0x9b,0x10b),'JxdWd':function(_0x1ab050,_0x1e222e,_0x580d18){return _0x1ab050(_0x1e222e,_0x580d18);}};return new Promise((_0x3fb3c1,_0x280436)=>{function _0x3cb0e6(_0x54047b,_0x3bc5bd,_0x1ee3ad,_0x3123d8){return _0x368a0e(_0x1ee3ad,_0x3bc5bd-0x83,_0x3123d8-0x62,_0x3123d8-0x13d);}const _0x19f357={'RszzJ':_0x2fe49d['uwUwg'],'tHfsm':function(_0x44c9fd){function _0x48522c(_0x2ef902,_0xfb140b,_0x1580b6,_0x83b727){return _0x4509(_0xfb140b-0x3d6,_0x83b727);}return _0x2fe49d[_0x48522c(0x58b,0x5a0,0x501,0x66b)](_0x44c9fd);},'FDsjX':function(_0x1a24f8,_0x58e6e5){function _0x28a986(_0x4e6265,_0x3e8045,_0x59ba9d,_0xc3cc9b){return _0x4509(_0x59ba9d- -0x266,_0x3e8045);}return _0x2fe49d[_0x28a986(-0x1cd,-0x199,-0x16b,-0xa6)](_0x1a24f8,_0x58e6e5);},'DFFpM':_0x2fe49d['yhhJf'],'FwwfX':_0x2fe49d['WepoS'],'dHehO':function(_0x44706e,_0x5b4f65){function _0x331c9a(_0x2c1838,_0xf0067b,_0xc01017,_0x336893){return _0x4509(_0x2c1838-0x2e6,_0x336893);}return _0x2fe49d[_0x331c9a(0x44c,0x513,0x381,0x3cb)](_0x44706e,_0x5b4f65);},'FlivM':_0x2fe49d['Qsxub'],'QMXEk':_0x2fe49d[_0x3cb0e6(0x46d,0x476,0x3bd,0x3e7)],'wJqDW':_0x2fe49d[_0x3cb0e6(0x503,0x4c2,0x413,0x484)]};function _0x320b3e(_0x1b245e,_0x4cf977,_0x49c9d0,_0x5c25e1){return _0x43ecc6(_0x1b245e-0x207,_0x5c25e1,_0x49c9d0-0xbb,_0x5c25e1-0x1c0);}const _0x46bd43=generateRequestId(),_0x5016fb=_0xbc4ba0[_0x3cb0e6(0x2b3,0x26e,0x2c5,0x33c)]||0x577*-0x5+0x99e*-0x2b+0x2a33d;let _0x1f709b=null;console[_0x3cb0e6(0x44d,0x532,0x426,0x49c)](_0x3cb0e6(0x529,0x3d8,0x3fb,0x47d)+'Gen]\x20Execu'+_0x320b3e(0x287,0x277,0x35c,0x272)+_0x3cb0e6(0x2c8,0x2b2,0x3b4,0x383)+_0x320b3e(0x418,0x4d9,0x39e,0x4b6)+_0x3cb0e6(0x39f,0x456,0x472,0x477)+_0x46bd43+')');const _0x2d044f=()=>{function _0x506dff(_0x2415fa,_0x4e60e5,_0x41b88a,_0x2000cf){return _0x320b3e(_0x2415fa-0x59,_0x4e60e5-0xbb,_0x41b88a-0x7a,_0x41b88a);}function _0x57b9a7(_0x616b33,_0x496171,_0x1b324b,_0x3ff6f3){return _0x3cb0e6(_0x616b33-0x162,_0x496171-0x7,_0x3ff6f3,_0x496171-0x5f);}const _0xbceba3={'mjWHA':function(_0x12bdc7,_0x2e97a6){function _0x4e8626(_0x4a8f85,_0x42914d,_0x23931d,_0x57b33d){return _0x4509(_0x4a8f85-0x2df,_0x42914d);}return _0x2fe49d[_0x4e8626(0x4e3,0x482,0x4e8,0x4b4)](_0x12bdc7,_0x2e97a6);}};_0x2fe49d['gYrdR'](_0x2fe49d[_0x57b9a7(0x578,0x541,0x4fb,0x5f9)],_0x2fe49d[_0x57b9a7(0x56a,0x541,0x50e,0x4a7)])?(eventSource[_0x57b9a7(0x37e,0x440,0x49d,0x3c6)+'ener'](eventNames['LLM_CHAR_D'+_0x57b9a7(0x55b,0x4c1,0x54a,0x4e4)+_0x57b9a7(0x45d,0x508,0x54b,0x53a)],_0x1a7974),_0x1f709b&&(_0x2fe49d[_0x506dff(0x307,0x3c9,0x27a,0x221)](clearTimeout,_0x1f709b),_0x1f709b=null)):(_0x409a18[_0x57b9a7(0x335,0x3bf,0x3ac,0x313)]['add'](_0x19f357['RszzJ']),_0x3ea300(()=>{function _0x3d30e9(_0x220816,_0x384236,_0x1f8301,_0x5f12d6){return _0x506dff(_0x384236- -0x4b,_0x384236-0x3f,_0x5f12d6,_0x5f12d6-0x5b);}function _0x514223(_0x9fba28,_0x388c2c,_0x22cc2e,_0x4fd92c){return _0x57b9a7(_0x9fba28-0x152,_0x388c2c- -0x1e5,_0x22cc2e-0xca,_0x22cc2e);}_0x2c3beb[_0x514223(0x24b,0x28c,0x261,0x243)](),_0xbceba3[_0x3d30e9(0x4bb,0x435,0x4f7,0x3a6)](_0x558ca3,_0x12fe52);},0x1*0x11c5+0x8af+-0xcef*0x2));},_0x1a7974=_0xb82679=>{function _0x4abe3d(_0x5ab078,_0x4269ab,_0xb3af02,_0x41e9dd){return _0x320b3e(_0xb3af02- -0x3b0,_0x4269ab-0x49,_0xb3af02-0x9b,_0x41e9dd);}function _0x521cce(_0x3de7b2,_0x2fd76b,_0x3de807,_0x2c1dbd){return _0x320b3e(_0x3de807- -0x2b9,_0x2fd76b-0x1c3,_0x3de807-0x114,_0x2fd76b);}if(_0x2fe49d['nyQJc'](_0x2fe49d[_0x521cce(0x52,-0x51,-0x2c,0x6d)],_0x2fe49d[_0x4abe3d(-0x65,-0x208,-0x123,-0x146)])){if(_0xb82679['id']!==_0x46bd43)return;_0x2fe49d[_0x521cce(0x1ce,0x10b,0x17a,0x18e)](_0x2d044f);if(_0xb82679[_0x521cce(-0x103,-0x88,-0x25,0x9f)]){if(_0xb82679[_0x4abe3d(0xce,-0xde,-0x3,-0x34)]){const _0x25d602={};_0x25d602['result']=_0xb82679[_0x521cce(0x1e9,0x213,0x176,0xad)],_0x25d602[_0x4abe3d(0x61,0x45,-0x3,-0x43)]=!![],_0x2fe49d[_0x4abe3d(0x78,0xde,0xa4,0xb)](_0x3fb3c1,_0x25d602);}else{const _0x5228cf={};_0x5228cf[_0x4abe3d(0x9a,-0x29,0x7f,0x11c)]=_0xb82679[_0x521cce(0x213,0x18e,0x176,0xea)],_0x5228cf[_0x521cce(0x1a4,0x7a,0xf4,0x1d2)]=![],_0x2fe49d[_0x4abe3d(-0x84,-0x77,-0x9c,-0xee)](_0x3fb3c1,_0x5228cf);}}else _0x2fe49d[_0x4abe3d(-0x64,-0xb7,-0x9a,0x29)](_0x2fe49d['rBkXd'],_0x2fe49d[_0x4abe3d(-0x174,-0x158,-0xdd,-0x1a2)])?_0x2fe49d[_0x521cce(-0x38,0x62,0x20,-0xbf)](_0x280436,new Error(_0xb82679[_0x4abe3d(0x133,0xe2,0x7f,0xb)]||_0x521cce(0x6,0x75,0x91,-0x27))):(_0x189b01[_0x4abe3d(0x4,-0x98,-0x15,-0x16)+_0x521cce(0x2d,0x100,0xed,0x30)](),_0x4c9d23[_0x521cce(0x1f1,0x15d,0x157,0x98)](_0x319968,-0x1455+0x2a1*0x2+0xf14),_0x19f357[_0x521cce(0x138,0x1bf,0xdc,0x81)](_0x453294));}else{const _0x20b782=_0x19f357[_0x521cce(0x1a,-0x21,0xc8,0xc)](typeof _0x28250a,_0x19f357[_0x521cce(0x48,0x17,-0x27,0x8f)])?_0x1c59c8:_0x33268e[_0x4abe3d(-0x5c,-0x4f,-0xef,-0x85)],_0x42e631=_0x19f357['FDsjX'](typeof _0x14213e,_0x19f357[_0x4abe3d(-0xc7,0x1b,0xf,-0x2d)])&&_0x4bf2dd[_0x521cce(0x118,-0x31,0x54,0x38)]?_0x2698aa[_0x4abe3d(-0x29,0x48,-0xa3,-0x14d)]:''+_0x5d175a+_0x19f357['dHehO'](_0x3b28c2,0x2492+0x9a3*-0x1+-0x1aee),_0x475e27={};_0x475e27[_0x521cce(0xa5,0x219,0x151,0x149)]=_0x19f357[_0x521cce(0x162,0x1b9,0xd4,0x1d)],_0x475e27[_0x521cce(0x52,0x13b,0xbd,0xf5)]='['+_0x42e631+']',_0x2991e9[_0x521cce(0x1df,0x1ad,0x198,0xce)](_0x475e27);let _0xd6fb94=_0x20b782;!_0x20b782[_0x4abe3d(-0x2b,0x25,-0x6,0x7c)](_0x19f357[_0x521cce(0x132,0xa2,0x147,0x90)])&&(_0xd6fb94=_0x521cce(0xd0,-0x31,0xaf,0x51)+_0x4abe3d(-0x15d,-0x5a,-0x8b,-0x108)+'4,'+_0x20b782);const _0x1e4c4c={};_0x1e4c4c[_0x521cce(0x124,0x7d,0xad,0x76)]=_0xd6fb94,_0x1e4c4c[_0x521cce(0x234,0xa0,0x189,0x22c)]=_0x19f357[_0x521cce(0x119,0xd6,0x144,0x130)];const _0x294877={};_0x294877['type']=_0x521cce(0x1e,0x1bc,0xf9,0x16b),_0x294877['image_url']=_0x1e4c4c,_0x47f66d[_0x521cce(0x281,0x239,0x198,0x202)](_0x294877);}};eventSource['on'](eventNames[_0x320b3e(0x3db,0x468,0x44a,0x463)+_0x320b3e(0x3ae,0x430,0x397,0x428)+'ONSE'],_0x1a7974);const _0x3b6dfe={};_0x3b6dfe[_0x320b3e(0x2e1,0x2d3,0x2d7,0x336)]=_0x58254a,_0x3b6dfe['id']=_0x46bd43,eventSource[_0x3cb0e6(0x4bf,0x42c,0x57d,0x4bf)](eventNames['LLM_CHAR_D'+_0x320b3e(0x3f7,0x43e,0x323,0x4b3)+_0x3cb0e6(0x4fd,0x408,0x458,0x499)],_0x3b6dfe),_0x1f709b=_0x2fe49d[_0x320b3e(0x38c,0x2c2,0x2e9,0x44e)](setTimeout,()=>{function _0x256651(_0x31f63a,_0xd01370,_0x2df6c8,_0x542b60){return _0x3cb0e6(_0x31f63a-0xdb,_0xd01370-0x19e,_0x542b60,_0x31f63a- -0x5a8);}_0x2d044f(),_0x2fe49d['gzVBl'](_0x280436,new Error(_0x2fe49d[_0x256651(-0x1e5,-0x29e,-0x29c,-0x125)]));},_0x5016fb);});}export async function handleCharacterDesignRequest(_0x2ee100){const _0x51803e={'rcwyx':function(_0x53a73b,_0x536f3){return _0x53a73b(_0x536f3);},'RMhNK':_0x395447(-0x9c,0x55,0x83,-0x6)+'时','FOsFf':function(_0x1c3431){return _0x1c3431();},'KYypo':function(_0x346138,_0x553db8,_0x54f0e3){return _0x346138(_0x553db8,_0x54f0e3);},'nKQeR':_0x395447(-0x16c,-0x147,-0x37,-0xec),'EBLtm':function(_0x37bb5c,_0x1812ec){return _0x37bb5c!==_0x1812ec;},'EXIgm':_0x3f6323(-0x2fe,-0x2da,-0x299,-0x29d),'NOAqa':function(_0x3daed8,_0xbae819){return _0x3daed8-_0xbae819;},'TbVJw':function(_0x44b905,_0x49e93b){return _0x44b905>=_0x49e93b;},'KllnT':function(_0x115d5f,_0xa33926){return _0x115d5f===_0xa33926;},'dppFm':_0x3f6323(-0x19a,-0x8c,-0x68,-0xde),'AJpCr':_0x3f6323(-0x14c,-0x137,-0x19d,-0xdf)+_0x395447(-0x2d,-0xc0,-0xf7,-0xb8)+_0x3f6323(-0x15a,-0xc6,-0xc9,-0x110)+_0x395447(-0x80,-0x5a,-0xd,-0xd1),'DiAAi':_0x3f6323(-0xb8,-0x79,-0xa6,-0x15a)+_0x395447(-0x95,-0xe0,-0x11a,-0x8f)+'式\x20-\x20LLM\x20请求'+_0x395447(-0x8f,0x80,-0xaa,-0x15),'zohbg':function(_0x58eff3,_0x38029e,_0x3c1ee2,_0x27ccaf,_0x39433d){return _0x58eff3(_0x38029e,_0x3c1ee2,_0x27ccaf,_0x39433d);},'zMvgE':_0x3f6323(-0x1b2,-0x1e4,-0x18d,-0x1a5),'rPkyM':_0x395447(0xc2,0x9f,-0xae,0x3d)+_0x3f6323(-0x19d,-0x2d1,-0x25d,-0x1ed),'WbFTU':_0x3f6323(-0x34e,-0x2d2,-0x1fc,-0x29e),'koXhx':function(_0x46bd2f,_0x14ab3c,_0x41f50b,_0x5dfb62,_0x25d2e2){return _0x46bd2f(_0x14ab3c,_0x41f50b,_0x5dfb62,_0x25d2e2);},'NgvsY':_0x3f6323(-0x14a,-0x1c3,-0x1a4,-0x15a)+_0x3f6323(-0x28c,-0x17b,-0xd8,-0x1aa)+':','eqCvH':function(_0x2b89d2,_0x2418e3){return _0x2b89d2(_0x2418e3);},'CtBPf':_0x395447(0x30,0xc,0xa9,0x3d)+_0x395447(0xb0,0xf5,-0x7a,0x45)+_0x3f6323(-0x238,-0x1df,-0x251,-0x25b)+_0x3f6323(-0x319,-0x2e4,-0x336,-0x298)+_0x395447(-0x27,0xdf,0x60,-0x8)+'.','qlhcp':_0x395447(0xce,0x71,0xf3,0x3d)+_0x3f6323(-0x15a,-0x260,-0x171,-0x1b2)+_0x3f6323(-0x5c,-0xb8,-0x105,-0x12a)+_0x395447(-0x29,-0x101,-0xd6,-0xf2)+'t','QTBxp':_0x3f6323(-0x171,-0x1e3,-0x306,-0x231),'rbxzM':_0x395447(-0x9d,-0xd,-0x80,0x3d)+_0x3f6323(-0x251,-0x137,-0xc6,-0x1b2)+_0x395447(-0xfc,0x4f,-0x2a,-0x45),'ZEsrx':_0x3f6323(-0x1c8,-0x20c,-0x23b,-0x15a)+'Gen]\x20User\x20'+_0x3f6323(-0x274,-0x301,-0x28c,-0x288)+_0x3f6323(-0x2e8,-0x24e,-0x299,-0x299)+'t:','Wyhdk':_0x3f6323(-0x107,-0x1e0,-0x16e,-0x15a)+_0x395447(0x65,-0x75,-0x5b,-0x2d)+_0x3f6323(-0x1bf,-0x21e,-0x202,-0x166)+'.','dczGg':function(_0x3b771f,_0x119a70){return _0x3b771f+_0x119a70;},'hegND':function(_0x4b4f36,_0x4985e5){return _0x4b4f36===_0x4985e5;},'nxjrd':function(_0x3c0369,_0x20de1f){return _0x3c0369!==_0x20de1f;},'stuKI':_0x3f6323(-0x1a7,-0x26,-0xe8,-0xec),'fXyqt':'未能获取上下文内容','COEOO':'[character'+'Gen]\x20Conte'+_0x395447(-0xdc,-0x1bb,-0x99,-0xdd)+'s:','ZbnKw':_0x395447(-0x3d,-0x1a1,-0xa,-0xc1),'gbRmK':function(_0x2bc2dd,_0x49db95){return _0x2bc2dd(_0x49db95);},'Mrjog':_0x395447(0x11f,0xe9,0xed,0x3d)+_0x3f6323(-0x288,-0x207,-0x1f9,-0x220)+'ered\x20world'+'\x20book\x20cont'+'ent:','XTqsa':function(_0x2bd83e,_0x15f7a8){return _0x2bd83e>_0x15f7a8;},'QjBpj':'[character'+'Gen]\x20Chara'+_0x395447(0x114,-0x59,0x79,0x90)+_0x395447(-0x81,0x92,0xb8,0x3f),'BxElY':'char_desig'+'n','bMoLC':function(_0x49f811,_0x229d18){return _0x49f811(_0x229d18);},'sNMXQ':function(_0x29fdfa){return _0x29fdfa();},'kfzEt':function(_0x4ab46c){return _0x4ab46c();},'Rqjin':_0x395447(-0xf,0x88,-0x37,0x3d)+_0x395447(-0xb7,-0x111,0x1f,-0x68)+_0x395447(0x12a,0x48,0x2b,0xaa)+_0x395447(0x57,0xf1,0x45,0x66)+'gered):','Jhvpi':'[character'+'Gen]\x20合并相邻消'+_0x3f6323(-0x16b,-0x2d6,-0x23f,-0x223),'JlJEQ':function(_0x4dc05a,_0x1f85ad){return _0x4dc05a||_0x1f85ad;},'hhlAM':function(_0xcccd74,_0x4c8390){return _0xcccd74(_0x4c8390);},'YLfue':_0x3f6323(-0x19d,-0x20b,-0x1a8,-0x15a)+_0x395447(-0x4b,-0x102,-0x56,-0x5c)+_0x3f6323(-0x26f,-0x1e8,-0x20b,-0x257),'xFWLB':_0x395447(-0x45,0x38,-0x73,0x3b),'YxxVr':function(_0xcf62c2,_0x4fc3df){return _0xcf62c2!==_0x4fc3df;},'WPNag':function(_0x5305df,_0x7899e3){return _0x5305df(_0x7899e3);},'vPoPy':function(_0x3faf93){return _0x3faf93();},'SeUZm':function(_0x533ce2,_0x1eae63){return _0x533ce2!==_0x1eae63;},'FHkun':'hHDDP','lSMRp':'角色服装参考图片','nezZS':'张角色/服装图片附加'+_0x395447(0x92,0xba,0x50,0x11),'FtHRY':function(_0x1a5a00,_0x567178){return _0x1a5a00!==_0x567178;},'hzDgu':_0x3f6323(-0x175,-0x10e,-0x169,-0x1e9),'WbiKv':_0x3f6323(-0x1b4,-0x212,-0x15a,-0x15a)+_0x3f6323(-0x194,-0x2d8,-0x20c,-0x21f)+_0x395447(-0x132,0x40,-0xbc,-0x9d),'iCdMy':function(_0x567043,_0x194e12){return _0x567043>_0x194e12;},'ewepj':function(_0x251501,_0x4d4137,_0x29f01f){return _0x251501(_0x4d4137,_0x29f01f);},'lnYiW':_0x3f6323(-0x194,-0x156,-0x23f,-0x15a)+'Gen]\x20LLM\x20r'+'esponse:','UffnE':function(_0x54ec41,_0x39678a){return _0x54ec41!==_0x39678a;},'EJaiP':_0x3f6323(-0x1f4,-0x212,-0x34b,-0x286),'OVJuw':_0x3f6323(-0x369,-0x1ed,-0x2b1,-0x282),'PqbFY':_0x395447(0x25,-0xf8,-0x14,-0xa5),'PhHnH':function(_0x196e47,_0x2ebf5d){return _0x196e47(_0x2ebf5d);},'ncugu':function(_0x26ed19,_0x474bc4){return _0x26ed19(_0x474bc4);},'CEoDd':_0x3f6323(-0x1fc,-0x1ed,-0x1e7,-0x121),'MyYhK':_0x395447(0x8c,-0x90,0x5,0x3d)+'Gen]\x20No\x20ch'+_0x395447(0x3b,0x60,-0x15,-0x1d)+_0x395447(0x12d,0xfb,0x80,0x50)+_0x3f6323(-0xe8,-0x7,-0x124,-0xf1)+_0x3f6323(-0x18a,-0x25c,-0x24e,-0x205),'qAoKW':'[character'+_0x395447(-0x44,-0x35,0x82,0x6)+_0x395447(-0x10,0x68,0xdf,0x24)+_0x395447(-0x36,0x71,0x9c,0x42)+_0x395447(-0xd8,-0xaf,-0x131,-0xb4),'IMJEI':_0x395447(0x121,0xc0,0x113,0x3d)+'Gen]\x20Extra'+_0x395447(0x8b,0x49,0x36,0x55)};function _0x395447(_0x2be5b2,_0x4669aa,_0x49efcc,_0x20eb5f){return _0x4509(_0x20eb5f- -0x1c8,_0x49efcc);}console[_0x3f6323(-0xc1,-0x97,-0xcf,-0x13b)](_0x51803e[_0x3f6323(-0x1b0,-0x26b,-0x230,-0x1f2)]);function _0x3f6323(_0x511f99,_0x167f81,_0x2e6d2e,_0x3a3fe5){return _0x4509(_0x3a3fe5- -0x35f,_0x2e6d2e);}try{const _0x33459b=await _0x51803e[_0x3f6323(-0x176,-0x248,-0x1e3,-0x227)](showUserDemandPopup);if(_0x51803e[_0x3f6323(-0x365,-0x1d6,-0x23a,-0x27d)](_0x33459b,null)){console[_0x3f6323(-0x163,-0x225,-0x78,-0x13b)](_0x51803e[_0x395447(-0x17,0x35,0x24,0x29)]),toastr[_0x3f6323(-0x2aa,-0x314,-0x234,-0x239)](_0x51803e[_0x395447(-0xe1,-0x106,-0x1d4,-0xfc)]);return;}let _0x5c0866=_0x33459b[_0x395447(-0x48,-0xfe,0x11,-0x16)]||extension_settings[extensionName]?.[_0x395447(0x85,0x97,0xd0,0x89)+_0x3f6323(-0x220,-0x13f,-0x204,-0x1fc)]||'';const _0x4bc2e8=_0x33459b[_0x395447(0xc2,0x5d,0x168,0x94)]||[];console['log'](_0x51803e[_0x3f6323(-0x1e1,-0x226,-0x2a0,-0x1e2)],_0x5c0866),console[_0x3f6323(-0x20e,-0x1ff,-0x17c,-0x13b)](_0x51803e[_0x3f6323(-0x1bb,-0x322,-0x30c,-0x253)],_0x4bc2e8[_0x3f6323(-0x1b7,-0x168,-0x15f,-0x1ab)]),toastr[_0x3f6323(-0x258,-0x1d9,-0x23e,-0x239)](_0x51803e[_0x3f6323(-0x1e5,-0x101,-0x1f5,-0x129)]);const _0xc84cfe=getContext(),_0x18b409=_0x51803e[_0x395447(-0xa4,-0x41,-0x25,-0x4f)](extension_settings[extensionName]?.[_0x3f6323(-0x149,-0x10c,-0x56,-0x135)+_0x3f6323(-0x10f,-0x95,-0xbe,-0x150)]??0x4d6+-0xb5*-0x2b+0x1*-0x233b,0x1*0x2027+0x2*0x835+-0x3090),_0x581583=await _0x51803e[_0x395447(-0x137,-0xa,-0x1bf,-0xd4)](getElContext,_0x2ee100,_0x18b409);if(!_0x581583||_0x51803e['hegND'](_0x581583['length'],-0x1fe1+-0xe02+0x2de3)){if(_0x51803e['nxjrd'](_0x51803e[_0x395447(0x114,0x11e,0x12,0x9a)],_0x51803e['stuKI'])){const _0x57b925={'kSgzC':function(_0x237e5f,_0x53b74a){return _0x237e5f!==_0x53b74a;},'mfgJK':function(_0x126fb4,_0x498fd7){function _0x423195(_0x11168e,_0x2f5b95,_0x126675,_0x3abcf9){return _0x3f6323(_0x11168e-0xfe,_0x2f5b95-0x9d,_0x11168e,_0x2f5b95-0x63f);}return _0x51803e[_0x423195(0x40f,0x3c0,0x390,0x2f3)](_0x126fb4,_0x498fd7);},'Zfckc':_0x51803e[_0x395447(0xd3,0x58,0x6f,0x83)]},_0x12d8aa=_0x51803e[_0x395447(-0xc6,-0xd7,-0xa0,-0x90)](_0x262b98);_0x39af2f['log'](_0x3f6323(-0x14d,-0x86,-0xe2,-0x15a)+'Gen]\x20Reque'+_0x395447(0x168,0x134,0xfa,0xae)+_0x3f6323(-0x208,-0x1a8,-0x12b,-0x19a)+'ompt\x20(ID:\x20'+_0x12d8aa+')');const _0x1f01cb=_0x13115f=>{if(_0x57b925[_0x38c7ce(-0x1e8,-0x1c3,-0x16f,-0x117)](_0x13115f['id'],_0x12d8aa))return;_0x274890[_0x2dddfa(-0x126,-0x28b,-0x1d5,-0x153)+'ener'](_0x5e4c0e[_0x2dddfa(-0x135,-0x1e2,-0x127,-0x1fb)+_0x2dddfa(-0x1c7,-0x25c,-0x1b4,-0x280)+_0x2dddfa(-0xd2,-0xbb,-0x186,-0x123)+'PONSE'],_0x1f01cb);function _0x2dddfa(_0x2440ed,_0x288e2b,_0x8acc7e,_0x30ee1e){return _0x395447(_0x2440ed-0x4f,_0x288e2b-0xad,_0x2440ed,_0x8acc7e- -0x176);}function _0x38c7ce(_0x8ac36e,_0x3eadf7,_0x2c42fd,_0x59609a){return _0x395447(_0x8ac36e-0x4f,_0x3eadf7-0x16f,_0x8ac36e,_0x3eadf7- -0x1f0);}_0x57b925[_0x2dddfa(-0x2de,-0x209,-0x276,-0x209)](_0x2d0365,_0x13115f[_0x2dddfa(-0x2f3,-0x1a6,-0x221,-0x17f)]);};_0xe797ec['on'](_0x13039f[_0x395447(0x2c,-0x53,0xb8,0x4f)+_0x3f6323(-0xfe,-0x1a3,-0x21b,-0x1d5)+_0x3f6323(-0x192,-0x12f,-0x1ba,-0x1a7)+_0x3f6323(-0x134,-0x143,-0xa8,-0x132)],_0x1f01cb);const _0x590941={};_0x590941['id']=_0x12d8aa,_0x4f07f9['emit'](_0x1de43b[_0x395447(-0x72,0xe1,0x10b,0x4f)+'ESIGN_GET_'+_0x395447(-0xc3,0x2,0x9c,-0x11)+_0x395447(0x58,-0x2a,0xcb,0x93)],_0x590941),_0x51803e[_0x395447(-0x75,-0x17f,-0x1bd,-0xd4)](_0x2436c0,()=>{function _0x53d786(_0x4cc821,_0x4cc5c2,_0x5df80c,_0x1ce5a0){return _0x395447(_0x4cc821-0xe7,_0x4cc5c2-0x18b,_0x4cc821,_0x1ce5a0-0x8e);}function _0x20acff(_0x5798f0,_0x13f5d1,_0x45fed4,_0x5004dd){return _0x395447(_0x5798f0-0x1e1,_0x13f5d1-0x15c,_0x5798f0,_0x45fed4-0x8e);}_0x1b4b2a[_0x20acff(-0x35,0x26,0x2f,-0x74)+_0x20acff(0x5b,0x2f,0x6b,0xab)](_0x557cf8[_0x20acff(0xa,0x9b,0xdd,0x5f)+'ESIGN_GET_'+'PROMPT_RES'+_0x53d786(0x10c,0x5f,0x12c,0xf3)],_0x1f01cb),_0x57b925[_0x20acff(-0x1e,-0xd0,-0x72,0x1e)](_0x3c8aac,new _0x26da04(_0x57b925[_0x53d786(0x4b,0x4d,-0x1,-0x31)]));},-0x2091*0x1+-0x3977+0x8118);}else{toastr[_0x3f6323(-0x1b3,-0x163,-0x28e,-0x23d)](_0x51803e[_0x395447(-0x92,0xd,-0xa1,-0x8d)]);return;}}console[_0x3f6323(-0x175,-0x207,-0xce,-0x13b)](_0x51803e[_0x395447(-0x6a,-0xca,-0x65,-0x48)],_0x581583);const _0x18888d=_0x581583[_0x51803e[_0x3f6323(-0x149,-0x253,-0x100,-0x18f)](_0x581583[_0x3f6323(-0x1c5,-0x21d,-0x1af,-0x1ab)],-0x1*-0x15dd+-0x7*0x1d4+-0x910)];let _0xeeab73='';if(_0x581583){if(_0x51803e[_0x395447(-0x10c,0x2d,-0x78,-0x54)](_0x51803e['ZbnKw'],_0x395447(-0x8d,-0xfc,-0xd0,-0xbe))){const _0x1afdfd=_0x5c0866?[..._0x581583,_0x5c0866]:_0x581583;_0xeeab73=await _0x51803e[_0x395447(0x13c,0xe1,0xea,0x53)](processWorldBooksWithTrigger,_0x1afdfd),console[_0x3f6323(-0x88,-0x1b9,-0x1ca,-0x13b)](_0x51803e['Mrjog'],_0xeeab73);}else _0xef1b3[_0x3f6323(-0x94,-0x189,-0x86,-0xd2)](_0x178eb1);}const _0x43131b=_0x581583&&_0x51803e[_0x3f6323(-0x1b2,-0x9d,-0x108,-0x16c)](_0x581583[_0x395447(-0x9c,0xb6,0xac,-0x14)],-0x18d1*0x1+-0x1*0x13b9+-0x7*-0x65d)?_0x581583[_0x3f6323(-0x1d3,-0x143,-0x10a,-0x184)](0x7a0+0x1683*0x1+-0x1e23,-(-0x31e+0x1633+-0x4a*0x42)):[],_0x4473f4=[];_0x5c0866&&_0x4473f4[_0x395447(0x17d,0xa8,-0x1f,0xc5)](_0x5c0866);_0x18888d&&_0x4473f4[_0x395447(0x2b,0x70,-0x7,0xc5)](_0x18888d);const _0x1ccd6d=_0x4473f4[_0x395447(0x59,0xa8,0x179,0xc2)]('\x0a'),_0x4f6133=[];_0x5c0866&&_0x4f6133['push'](_0x5c0866);_0x581583&&_0x581583[_0x395447(0x3d,-0x86,-0x6a,-0x14)]>-0xde7*-0x1+-0x2176+0x138f&&_0x4f6133[_0x3f6323(-0x5c,-0x13b,-0x10d,-0xd2)](_0x581583['join']('\x0a'));_0xeeab73&&_0x4f6133[_0x3f6323(-0x2f,0x12,-0x189,-0xd2)](_0xeeab73);const _0x56cbd6=_0x4f6133[_0x395447(-0x16,0x1d,0x10d,0xc2)]('\x0a');console[_0x395447(0x30,-0x86,0x22,0x5c)](_0x51803e[_0x395447(-0x16,-0x93,-0x33,0x3e)],_0x56cbd6);let _0x1a79ce=_0x51803e['KYypo'](buildPromptForRequestType,_0x51803e[_0x3f6323(-0x155,-0x25c,-0x18b,-0x1ee)],_0x1ccd6d);const _0x4b0a8f=_0x51803e[_0x3f6323(-0x1bb,-0xfc,-0x187,-0x163)](generateCharacterListText,_0x56cbd6),_0x555046=_0x51803e[_0x395447(-0x26,-0x72,-0x19e,-0xe1)](generateOutfitEnableListText),_0x115255=_0x51803e['kfzEt'](generateCommonCharacterListText);console['log'](_0x51803e[_0x3f6323(-0xd8,-0x1d5,-0x145,-0x1a6)],_0x4b0a8f);const _0x371127=_0xc84cfe[_0x3f6323(-0x1aa,-0xb1,-0x142,-0x19c)+'ta']?.[_0x3f6323(-0x1db,-0x1bd,-0x1d1,-0x267)]||{};_0x1a79ce=mergeAdjacentMessages(_0x1a79ce),console['log'](_0x51803e['Jhvpi'],_0x1a79ce);const _0x3edfba={'context':_0x43131b[_0x395447(0x4a,0x195,0x114,0xc2)]('\x0a'),'body':_0x18888d,'worldBookContent':_0xeeab73,'variables':_0x371127,'userDemand':_0x51803e[_0x3f6323(-0x23c,-0x1c6,-0x130,-0x1b3)](_0x5c0866,''),'characterListText':_0x4b0a8f,'outfitEnableListText':_0x555046,'commonCharacterListText':_0x115255},{messages:_0x4bd923,replacedVariables:_0x332eda}=replaceAllPlaceholders(_0x1a79ce,_0x3edfba);_0x1a79ce=_0x4bd923;function _0x4b8ae0(_0x314a49){function _0x3a770b(_0x585d26,_0x21f987,_0x2e9e03,_0x2903a1){return _0x3f6323(_0x585d26-0x32,_0x21f987-0x1d6,_0x585d26,_0x2e9e03-0x59f);}function _0x3ce9a2(_0x5193b1,_0x56025c,_0x22ab53,_0x49502d){return _0x395447(_0x5193b1-0xe1,_0x56025c-0xcb,_0x22ab53,_0x49502d-0x177);}if(_0x51803e[_0x3ce9a2(0x71,0x147,0x182,0x9f)](_0x3a770b(0x413,0x44f,0x39b,0x3d0),_0x51803e[_0x3ce9a2(0x18f,0x132,0xd7,0x111)])){for(let _0x17b3a4=_0x51803e['NOAqa'](_0x314a49[_0x3a770b(0x3a1,0x3b2,0x3f4,0x41e)],-0xccc+-0x2403+-0x238*-0x16);_0x51803e[_0x3a770b(0x343,0x43d,0x3a4,0x3d6)](_0x17b3a4,0x2ff+-0xd13+0xa14);_0x17b3a4--){if(_0x51803e[_0x3ce9a2(0x77,0x167,0xa4,0x91)](_0x314a49[_0x17b3a4][_0x3ce9a2(0xa9,0x7c,0xd9,0x15d)],_0x51803e[_0x3a770b(0x4d9,0x330,0x40d,0x4bc)]))return _0x17b3a4;}return-(-0x2407+0xa01+-0x1*-0x1a07);}else _0x51803e['rcwyx'](_0x2cd7e1,null),_0x518944[_0x3a770b(0x3e7,0x2b2,0x33e,0x35c)+_0x3ce9a2(0x126,0x14e,0xd2,0x144)](_0x51803e[_0x3ce9a2(0x210,0x143,0x2d1,0x223)],_0x432d07);}const _0x46f8bb=_0x51803e['hhlAM'](_0x4b8ae0,_0x1a79ce);console[_0x3f6323(-0xbd,-0x21e,-0x1a9,-0x13b)](_0x51803e['YLfue'],_0x46f8bb);if(_0x51803e[_0x395447(0x10b,0xca,-0x9f,0x2b)](_0x4bc2e8['length'],-0x710+-0x1a02+-0x1f2*-0x11)&&_0x46f8bb>=-0x57*0x13+-0x1f5f+0x25d4){if('FCvSd'===_0x51803e[_0x3f6323(-0x2e2,-0x180,-0x298,-0x235)])_0x1a79ce=attachImagesToMessage(_0x1a79ce,_0x46f8bb,_0x4bc2e8,_0x51803e[_0x3f6323(-0x16a,-0x99,-0x143,-0xd8)]),console['log'](_0x51803e[_0x3f6323(-0x57,-0xec,-0x1f1,-0x10f)],_0x4bc2e8[_0x395447(0xb8,0x96,0x7b,-0x14)],_0x51803e[_0x3f6323(-0x236,-0x1a2,-0x147,-0x225)],_0x46f8bb);else{_0x137469[_0x395447(-0xbd,-0xfe,-0xf7,-0xa2)](_0x51803e[_0x3f6323(-0x1c7,-0x188,-0x198,-0x243)]),_0x22e021[_0x3f6323(-0x152,-0x93,-0x132,-0x13b)](_0x51803e[_0x3f6323(-0x1bd,-0x10c,-0x124,-0x130)]);return;}}try{if(_0x51803e['YxxVr']('wmrnr','wmrnr'))_0x1f6ce6=_0x51803e['zohbg'](_0x5e4c82,_0x17a6d9,_0x3bb630,_0x240534,_0x51803e['zMvgE']),_0x431dd4[_0x395447(0x5b,0xe0,-0x66,0x5c)](_0x51803e['rPkyM'],_0x1c3f5c[_0x3f6323(-0x13f,-0x1cb,-0x13c,-0x1ab)],_0x51803e[_0x3f6323(-0x1e6,-0x2e3,-0x2e7,-0x225)],_0x185f33);else{const _0x5a163d=await _0x51803e[_0x395447(-0x1b,0xae,0x5,-0x29)](getEnabledCharacterImages,_0x56cbd6),_0x1c287a=await _0x51803e[_0x3f6323(-0xc3,-0x9b,-0xc7,-0x156)](getEnabledOutfitImages),_0x42171a=await _0x51803e[_0x395447(-0x105,-0x108,-0xca,-0x90)](getCommonCharacterImages),_0x3ccbf5=[..._0x5a163d,..._0x1c287a,..._0x42171a];_0x51803e['XTqsa'](_0x3ccbf5[_0x3f6323(-0x21f,-0x197,-0x266,-0x1ab)],-0x2d*0x56+0x286*-0x6+0x1*0x1e42)&&_0x51803e['TbVJw'](_0x46f8bb,0x26b8+-0xdde+0x18da*-0x1)&&(_0x51803e[_0x395447(0x61,-0x23,-0x23,-0x2c)](_0x51803e[_0x3f6323(-0x2af,-0x307,-0x27e,-0x281)],_0x51803e[_0x3f6323(-0x238,-0x2cf,-0x34c,-0x281)])?(_0xa0eb50[_0x395447(-0x145,-0x3f,-0x48,-0x5f)+_0x395447(0x74,-0xa1,-0x16,-0x23)](_0x47f80a[_0x3f6323(-0x1c3,-0x202,-0x127,-0x148)+_0x395447(-0x9e,-0x92,0x45,0x22)+_0x395447(0xed,0x48,0xce,0x69)],_0x235152),_0x589c2b&&(_0x280d2b(_0x541d41),_0x200c2b=null)):(_0x1a79ce=attachImagesToMessage(_0x1a79ce,_0x46f8bb,_0x3ccbf5,_0x51803e['lSMRp']),console[_0x395447(0xc3,0x63,-0x2f,0x5c)](_0x51803e[_0x3f6323(-0xc0,-0xe0,-0x33,-0x10f)],_0x3ccbf5['length'],_0x51803e[_0x395447(-0x89,-0xc5,0x52,0xb)],_0x46f8bb)));}}catch(_0x16da55){if(_0x51803e[_0x3f6323(-0x233,-0x341,-0x28a,-0x272)](_0x51803e[_0x395447(-0x1,-0xa0,0x6,-0xc5)],_0x3f6323(-0x1f7,-0x29d,-0x2dd,-0x28a)))console[_0x3f6323(-0x2d0,-0x24d,-0x2a1,-0x22c)]('[character'+'Gen]\x20收集角色/'+_0x395447(-0x7d,-0x194,-0x18a,-0xd5),_0x16da55);else{const _0x35da1a={};for(const _0x5809b7 in _0x464367){_0x35da1a[_0x5809b7]=_0x51803e[_0x3f6323(-0x124,-0x23b,-0x13b,-0x17a)](_0x5d905b,_0x39badb[_0x5809b7],_0x1459cc,_0x289a13,_0x44a293);}return _0x35da1a;}}console[_0x395447(0x57,0x38,0xa9,0x5c)](_0x51803e[_0x395447(0x92,0x82,-0x111,-0x44)],_0x1a79ce);let _0xd28c21='';_0x51803e[_0x395447(0xf4,0x12a,0x7c,0x6f)](_0x332eda[_0x3f6323(-0x6,-0x10b,-0x169,-0xe7)],0x1407*0x1+-0xb*-0x55+0x1b1*-0xe)&&(_0xd28c21=_0x395447(-0x1c5,-0xc1,-0x194,-0xf9)+_0x3f6323(-0x248,-0x2a4,-0x1b3,-0x23e)+[..._0x332eda][_0x395447(0xf4,-0x16,-0x2,0xc2)]('、')+'\x0a');_0x51803e[_0x395447(-0x63,-0xb3,0x76,-0x28)](updateCombinedPrompt,_0x1a79ce,_0xd28c21);const _0x551850=extension_settings[extensionName]?.[_0x395447(0x15,0x122,0x43,0xb5)+_0x3f6323(-0x248,-0x251,-0x107,-0x1b7)]??![];if(_0x551850){toastr[_0x395447(-0x16b,-0x175,-0x17f,-0xa2)](_0x51803e['AJpCr']),console[_0x3f6323(-0xe3,-0x131,-0xb6,-0x13b)](_0x51803e[_0x3f6323(-0xad,-0x84,-0x15b,-0x130)]);return;}const _0x3efeff={};_0x3efeff['timeoutMs']=0x493e0;const _0x5d68b6=await _0x51803e[_0x3f6323(-0x247,-0x261,-0x243,-0x26b)](LLM_CHAR_DESIGN,_0x1a79ce,_0x3efeff);console[_0x395447(0x111,0x5f,0xb3,0x5c)](_0x51803e[_0x395447(-0x2c,-0xd9,-0x66,-0xaa)],_0x5d68b6);if(_0x5d68b6[_0x3f6323(-0x10d,-0x202,-0x20e,-0x176)]){console['log'](_0x395447(0xbb,0x65,-0x68,0x3d)+'Gen]\x20测试模式\x20'+_0x395447(0x8a,0x140,0xa8,0xb3));return;}const _0x2e6f85=_0x5d68b6[_0x3f6323(-0x2b,-0x17,-0xfb,-0xf4)];if(!_0x2e6f85){if(_0x51803e[_0x3f6323(-0x22d,-0x348,-0x306,-0x26e)](_0x51803e['EJaiP'],_0x51803e[_0x395447(0xb3,0x182,0xa0,0xa9)])){toastr['error'](_0x51803e[_0x3f6323(-0x16c,-0x14e,-0x18f,-0x145)]);return;}else _0x2bb435[_0x3f6323(-0x16b,-0x30c,-0x2bf,-0x22c)](_0x51803e[_0x3f6323(-0x223,-0x214,-0x1ac,-0x270)],_0x3c95ed),_0x27f467['error']('角色设计请求失败:\x20'+_0xf909f4[_0x395447(0x8c,0x3a,0x70,0x46)]);}const _0x4de3d7=_0x51803e[_0x3f6323(-0x197,-0x1e2,-0x192,-0x245)](removeThinkingTags,_0x2e6f85),_0x42da8e=_0x51803e[_0x395447(0x8d,-0xec,-0x108,-0x43)](extractCharacterAndOutfitTags,_0x4de3d7);if(_0x51803e['KllnT'](_0x42da8e['characters'][_0x395447(-0x90,0x3,0x8e,-0x14)],0x7e1*-0x3+-0x62d+0x774*0x4)&&_0x51803e['KllnT'](_0x42da8e[_0x3f6323(-0x206,-0x1ac,-0x28f,-0x23b)][_0x395447(-0xa4,-0x6,-0x14,-0x14)],-0x55f+0x1b80+0x1*-0x1621)){if(_0x51803e['EBLtm'](_0x51803e['CEoDd'],_0x51803e[_0x3f6323(-0x17c,-0x127,-0x209,-0x14f)])){const _0x37ea91={};_0x37ea91[_0x395447(0x3b,-0x7,0x153,0xa3)]=_0x4c8a7c[_0x395447(-0x37,0x189,0xcb,0xa3)],_0x37ea91['testMode']=!![],_0x51803e[_0x395447(0x92,-0x1c,-0xc3,-0x35)](_0x500367,_0x37ea91);}else{toastr[_0x395447(-0x190,-0x57,-0x175,-0xa6)]('未在\x20LLM\x20输出中'+_0x395447(-0xc3,-0x100,-0x5f,-0xd6)),console[_0x3f6323(-0x1a8,-0x76,-0xb4,-0x13b)](_0x51803e['MyYhK']),console['log'](_0x51803e[_0x395447(-0xa6,0xe,-0x13a,-0x7c)],_0x2e6f85);return;}}console[_0x3f6323(-0xc2,-0xbc,-0x1f7,-0x13b)](_0x51803e[_0x395447(0x71,-0x3f,-0xee,-0x12)],_0x42da8e);const _0x5f3d95={};for(const _0x5d96dc of _0x332eda){const _0x1332f7=_0x5d96dc[_0x395447(-0x120,-0x154,-0x22,-0x72)](/^\{\{getvar::([^}]+)\}\}$/);if(_0x1332f7){const _0x2ddd1c=_0x1332f7[0xeef+0x2399+-0x3287];_0x5f3d95[_0x2ddd1c]=_0x371127[_0x2ddd1c]||'';}}const _0x1aaa6f={'generationContext':_0x581583[_0x3f6323(-0x43,-0x115,-0x14d,-0xd5)]('\x0a'),'generationWorldBook':_0xeeab73,'generationVariables':_0x5f3d95};await _0x51803e['ewepj'](handleExtractedData,_0x42da8e,_0x1aaa6f),toastr[_0x395447(-0x1dd,-0x192,-0x13d,-0xf8)](_0x3f6323(-0x123,-0x178,-0x1db,-0x11f)+'成！');}catch(_0x1176e0){console['error'](_0x51803e['NgvsY'],_0x1176e0),toastr[_0x3f6323(-0x1de,-0x28d,-0x317,-0x22c)]('角色设计请求失败:\x20'+_0x1176e0[_0x3f6323(-0x215,-0x10d,-0x19f,-0x151)]);}}