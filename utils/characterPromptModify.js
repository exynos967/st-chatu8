(function(_0x2f7e69,_0x4c3da0){function _0x125082(_0x392d96,_0x10e814,_0x32cf1a,_0x313663){return _0x4dc7(_0x392d96-0x12d,_0x32cf1a);}const _0x544ed2=_0x2f7e69();function _0x393320(_0x2c5d68,_0x26e9d7,_0x197dc9,_0x37b67f){return _0x4dc7(_0x37b67f-0x39e,_0x26e9d7);}while(!![]){try{const _0x5f8088=-parseInt(_0x393320(0x5c2,0x5b7,0x674,0x671))/(-0x361+-0x1*-0xaca+0x278*-0x3)*(-parseInt(_0x125082(0x355,0x2b6,0x3ef,0x2e5))/(0x1445+0x1b7+0x61*-0x3a))+parseInt(_0x393320(0x66b,0x5f4,0x702,0x6a7))/(0x1d76+0x4*-0x7db+0x1f9*0x1)*(parseInt(_0x393320(0x582,0x670,0x57e,0x602))/(0x1a86+0x2449*-0x1+0x9c7*0x1))+parseInt(_0x125082(0x2fd,0x283,0x2e7,0x295))/(-0xbcb+-0x7*-0x4f5+-0x7*0x345)+-parseInt(_0x393320(0x63f,0x5c0,0x62b,0x5a6))/(-0x351+0x22f4+0x1*-0x1f9d)+parseInt(_0x125082(0x369,0x425,0x3bb,0x3da))/(0xada+-0x92*0x1f+0xc3*0x9)+-parseInt(_0x125082(0x42b,0x3a2,0x4e7,0x497))/(0xdfb+-0x38*-0xd+0x3*-0x599)*(parseInt(_0x125082(0x451,0x4f1,0x4b1,0x4b9))/(-0x53*0x6f+0xa00+0x1a06))+-parseInt(_0x393320(0x58d,0x61a,0x5b4,0x5e2))/(0xdf*0x1e+0x487+0x75*-0x43);if(_0x5f8088===_0x4c3da0)break;else _0x544ed2['push'](_0x544ed2['shift']());}catch(_0x5dbed6){_0x544ed2['push'](_0x544ed2['shift']());}}}(_0x559b,-0x10dba*-0x5+0x414b2+-0x5b81b));const _0x7b9336=(function(){const _0x289563={};_0x289563['ydCCl']=function(_0x5a881f,_0x1a405e){return _0x5a881f!==_0x1a405e;};function _0x5f5d41(_0x2029e7,_0x2b959f,_0x28d37d,_0x1dad56){return _0x4dc7(_0x2b959f- -0x32a,_0x28d37d);}_0x289563['tYuzg']=_0x5f5d41(-0x26,-0x88,-0x112,-0x139);const _0x29ca72=_0x289563;let _0x15a04a=!![];return function(_0x4aec1e,_0x50cdab){const _0x1aa035=_0x15a04a?function(){function _0x3758d2(_0x151525,_0x8b1757,_0x510f86,_0x5241d0){return _0x4dc7(_0x8b1757- -0x38f,_0x5241d0);}function _0x5c27cb(_0x5069ba,_0x338f16,_0x2a12a8,_0x1ad031){return _0x4dc7(_0x2a12a8- -0x54,_0x338f16);}if(_0x50cdab){if(_0x29ca72[_0x3758d2(-0x1fc,-0x1af,-0x193,-0x127)](_0x29ca72[_0x5c27cb(0x2af,0x38b,0x2ef,0x22e)],_0x29ca72[_0x5c27cb(0x36b,0x34b,0x2ef,0x335)]))_0x210765=_0x3758d2(-0x71,-0xfd,-0x1ac,-0x170)+_0x5c27cb(0x290,0x1a4,0x1ea,0x285)+[..._0x47c8d1][_0x3758d2(-0x1dd,-0x11e,-0x162,-0x1c2)]('、')+'\x0a';else{const _0x5e5a45=_0x50cdab['apply'](_0x4aec1e,arguments);return _0x50cdab=null,_0x5e5a45;}}}:function(){};return _0x15a04a=![],_0x1aa035;};}()),_0x31035a=_0x7b9336(this,function(){const _0x17333a={};_0x17333a[_0x8c1796(0x3a2,0x366,0x421,0x367)]='(((.+)+)+)'+'+$';const _0x5f4a3a=_0x17333a;function _0xeacdd5(_0x4bc16e,_0x13f332,_0x48126a,_0x367eb7){return _0x4dc7(_0x367eb7- -0x37c,_0x4bc16e);}function _0x8c1796(_0x4f6d59,_0x44d643,_0x497228,_0x247b4c){return _0x4dc7(_0x4f6d59-0x1c9,_0x247b4c);}return _0x31035a[_0xeacdd5(-0x183,-0x1ad,-0x1b5,-0x161)]()[_0xeacdd5(-0x62,-0x75,-0xb9,-0x36)]('(((.+)+)+)'+'+$')[_0x8c1796(0x3e4,0x326,0x445,0x3ad)]()[_0xeacdd5(-0xe0,-0xba,-0xf5,-0xd9)+'r'](_0x31035a)[_0x8c1796(0x50f,0x522,0x4de,0x4fc)](_0x5f4a3a['hrpSQ']);});function _0x559b(){const _0x569a8a=['EwvPv2W','zNvSBejVzhLouW','DMfSDwu','v0jHy2S','qNLjza','DxjLCW','y29UDgvUDa','AgzqteO','t2fZyKG','twDXBhe','te9ZwNC','vfzeAxa','zhnVEhy','EffRruu','u2fbzuS','zNLDiezPBMfSia','zgvrzuG','A0z2q1a','ywDtugW','BM93','rhnwBvG','AxnbCNjHEq','Bg9N','wNPbwuK','Dvngr1a','Aw1Hz2vFDxjS','zwHOqLC','DfL1EMC','u0zx','6kEs6iMY5O+q56s66k+n5l+U5Ps55A6m5OIq77Yb','C2vHCMnO','CYbMB3vUzcbPBG','Chzdteu','B2jQzwn0','sNbcvha','AvvwEu0','sLDZv0u','BwLKyLC','EvnJr1C','5O+q56s66k+n5l+U5Ps56k+35RgclI4U','DxjS','ywDqwNq','y2HHCL8','6k+35ywi6ycj5OUP5lIa5lIQ6kEs6iMY6Ake6k6+','AgT2zgW','rK5Atva','mJi1nJCYnuLsDxzoCG','rLDxBuu','EMnmwK8','sfjnreK','tfjsq0i','r0TSC04','tgzYs3i','yMfZzty0','Aw5MBW','AhjWu1e','wNvXswy','5lIl5y2k6lQRtLngvZOG','Ew5StwK','Durpz0W','rvLYvNi','5lIl5y2k6lQRu0zx','Ewrdq2W','zNLDiow3SUABToAwSoINKUIjSUMIHa','DxbWzxjcB2r5uW','6i635y+w6kEs6iMY5l+U5Ps55O+q56s66k+n6lAf','y29UDgv4DdO','zxjLzcK6','t05trq','uhjVBxb0tw9KAq','yxv0BW','tefIChK','zgv0ywLS','Ew9TCwG','5lIk5y2k6lQRu0zx6iom6z2I','uKrkzwC','q29UDgv4Da','y3n0wMe','qNLsuuO','5lIk5y2k6lQRu0zx','5Qoa5Rwl5yIW6kEs6iMY5Qch562+','sLjNCeG','5lIT5PAh5zcn56EWoIa','BgvUz3rO','Bxb0icHjrdOG','AuDfCum','CLbyAe0','z2zSv0e','zgf0ytO','igLUzgv4','DMfYAwfIBgvZ','Aw5WDxq','zNLDie5VignOyq','5lIk5y2k6lQRtLngvW','B250zw50','5lIk5y2k6lQRtLngv+IdJoMDOG','B3iGzgvIDwDNAq','rLDcywnR','CMfUzg9T','zwLbzxu','q0TYzfe','sMXivgm','mtm3mte5mNfHA2n5tG','zxf1AxjLBwvUDa','sLHctvq','t3b4r04','5lIT5PAh5zcn56EW','z1z5veu','5lIk5y2k6lQRtLngvZOG','zNLDievYCM9YoG','i3n0lwnOyxr1oa','DgLUzYbJAgfYia','lxrHyI1JAgfYyq','whvxyM8','ig91Dhb1Da','EgL4Dhq','Aw5NignOyxiGBq','E3VLVzpLIy3OP5lOIBj9Fq','B2rPzNKGteXnia','sNDcvLC','qLH5A1u','Dg9tDhjPBMC','qND2yvy','6kEs6iMY5O+q56s66k+n5l+U5Ps55AsX6lsLoG','5lIl5y2k6lQRu0zxoIa','5A2x5Q61ici','5lQu5A6y5Asw6lkm','z2v0rwXLBwvUDa','BgvmAxn0vgv4Da','koEPUIK','uvHlAw0','v3LLEeW','zgnsr1e','rhfeA0W','mM9jqwH5sa','DgLTzw91De1Z','y3rLCG','reDtzNq','zxHLyW','DfnhCgK','v0L6CM4','zuvPveC','ENzTre8','vu9hs0y','teXNy0y','DwvZDc4UlG','rhL6A3q','BwvZC2fNzq','ywn0zxjmAxn0va','q3npswy','CMvZzxrjza','ug9fqwO','ELfcDNi','DxjLC0jHy2S','mtKZmJe5nNHbruDpwq','icdMLRa6ia','6kkR5l2/55sO77YA','v0Hrt0G','tfDsz2e','uhP3D0u','BMfTzq','Aw1Hz2vZihrVia','ndm3ode0me5gseLtuW','D2LusLe','C3rHCNrZv2L0Aa','CIb0zxH0oG','B3v0zML0rw5HyG','B3vHCfO','yKXYq3q','svbAD2K','6kEs6iMY5l+U5Ps5ieXmtsdOR7C','Axn0vgv4Da','C2L6zq','wfbiz3K','cLVKU6xKUiVMMk/NLkJMIlFKUiRKVkdNMOq','Aw5KzxHpzG','Bw9KAwz5ihjLCq','zgf0yq','ufjptvbux1jfuq','zMLSDgvY','vMfYAwfIBgvZ','zKzvvuS','zNLDifn0yxj0Aq','qKLcuxy','5lIl5y2k6lQRtLngv+IdJoMDOJO','BMfTzuno','yMLSC1C','5lQu5A6y5Asw6lkm6iom6z2I','zLfLt28','D29YBgqGyM9VAW','z0fYyMq','rMncD0y','zxiGChjVBxb0ia','ig1LC3nHz2uGAq','ndrRr05iA0u','tevHDu8','BwfW','5lIl5y2k6lQRtLngv+IdJoMDOG','DKr1Chq','Ehb2yva','ChjVBxb0oG','iIdNMOtKU6xKUiVMLBdMJA46cGO','CuHHv0K','C3vJy2vZCW','ww9xqu0','Bw9KAwz5ihbYBW','q2fnr0O','AM9PBG','zMfJAwfSrMvHDa','ELfSzui','ufzHq3K','BK9Wywe','DhjPz2DLCG','rvfRvwS','uNHgAM4','zNLDien1CNjLBG','ChjVBxb0','A0zyq3m','zKHRB3u','rLD0DKO','rvL4z3m','thz0s0K','DhLWzq','twHUuwm','ChvZAa','zNfqBuK','EfzUrNe','q094DKW','CMvTB3zLtgLZDa','DxnLCKrLBwfUza','qKjqrfO','u2DUvLa','yMHiBhq','CMfJDgvYihrHzW','5RkH5PYj5Qoa5Rwl5yIW6zYa6kAb5PU05PAW55Qe','pc/KURRNIAK+','BMC6','zNLDifjHDYbmta','uwn5CMW','vfrzwhC','6k+k5PAT77YA5Qoa5Rwl5yIW5lUL5lIl5y+y6yEp','CNbhBxC','CMvWBgfJzufSBa','5lIk5y2k6lQRu0zx6iom6z2IoIa','teXnioIVT+AXGUwKSEI0Pq','ioMHUEABToAuUsZMMk/LKkBLUPtNLkG/','5BEY5y+w5RAi5PU05PAW','ufjptvbux1jfuW','C0Tosxa','icdML6C6ia','wvP5B20','s0HcAwy','tfftB2m','lI4U','u0zxqMfJAW','BvfduKS','uu1fy2O','y29UC3rYDwn0BW','yvD6wfa','uw5eC2y','teXnioI/LowBNUE7K+AENos4UUEPUG','DgvYihrYAwDNzq','C1nIBMi','zM9YrwfJAa','CMvZzxrZ','5PYQ5zYOieXmtsdOVPpLH7RKUk0','EMPPEvm','CMvXDwvZDcaOsq','ue9ou0u','Cuvjv0G','BwvZC2fNzsbHDa','DxvpAw0','Dgv4Da','t0rjrLLFuKvtua','DuzjBee','DhjPBq','whbqve4','qw9mA24','CMvWBgfJzq','DeXKDKG','swfXEg8','s2XLBu4','y2HHCMfJDgvYCW','w2nOyxjHy3rLCG','ENDisuO','z3HgCw8','z1rMzuC','ze1Ks0C','D2fYBMLUzW','zgf0ytPPBwfNzq','rejOtxO','wfjAyxm','y2HHCMfJDgvYua','u0TruLO','zw1PDa','DwT2q3K','sw1vy2W','zKLcwKu','DMfYAwfIBgvZoG','Ee1Zu00','DgvKigrHDge6','BMfTzuvo','C3rYAw5N','Certuvu','AgjeB0C','ndmYodu3tNPuDwrq','EKPsBNK','rNHwzxa','BfjlEvu','wenirvq','B1nHtei','sxziD0C','z3vPCfq','5yEg5Ash5PU05PAW6kEs6iMYici','s29YBee','C3bSAxq','DvvHvu4','AM1jDfy','zNLDioATO+wCQowKHoEqHUINKUIjSG','zNLDifnHDMvKia','tu9iAwi','tg95Awm','5lIl5y2k6lQRu0zx6iom6z2IoIa','CMvZDwX0','vKrWAK0','AfbSrK0','B2D5u3i','quHttgC','t0rjrLLFr0vuxW','s1jQs2K','ExHNCw0','weTtEwe','5y+c6icd5zU+54Mh','rfDxrwS','AfzVu08','AMTmA0y','BxzNzeO','zLzKEu0','BMrLEdO','5PwW5O2UoG','pos6UUEjQt4k','y29UDgv4Da','zNvSBejVzhLtrG','zxjYB3i','rdOG','6iUX5PAh5zcn56EWoIa','ENHTq2e','C3vIC3rYAw5N','mteZmtC2zfvovenx','Cfb0D1a','yvvXExG','tMrvtgy','5lIl5y2k6lQRu0zx6iom6z2I','vxfowwG','5lIl5y2k6lQRtLngvW','CMfUzg9Tvvvjra','q2npBuu','zNLDifjLCxvLCW','sLrrCMC','mtuWnJn3B3vNwui','sKTLDvm','zNLDifvZzxiGCG','zNLDiev4DhjHyW','zNLDiev4zwn1Da','vuvtva','ChfrCfK','D3HKsgy','zNLDioACQUIVHUwiQ+EAHos6UUEjQq','tsbVDxrWDxqGzG','zxH0icH0CMLNzW','Bg9dwem','CeXAtxy','Au9XAuu','D0PvDfK','A0LsCvK','zNvtz1i','r29Yr3O','Avrwvvu','5lIk5y2k6lQRtLngv+IdJoMDOJO','Bu94zgO','wgDws2K','z2vUzxjHDgLVBG','CgjZuxC','5lQu5A6y5Asw6lkmoIa','zw5LCG','teXnx0niqvjFtq','mtK4t0D4s2vf','tffuzMi','rvnu','DxbWzxjcB2r5tG'];_0x559b=function(){return _0x569a8a;};return _0x559b();}_0x31035a();import{eventSource}from'../../../../../script.js';import{eventNames,extensionName}from'./config.js';import{extension_settings}from'../../../../extensions.js';import{getContext}from'../../../../st-context.js';function _0x29670b(_0x30570c,_0x48d1a3,_0x5ce00c,_0x3623af){return _0x4dc7(_0x30570c-0x300,_0x5ce00c);}import{saveSettingsDebounced}from'../../../../../script.js';import{generateCharacterListText,generateOutfitEnableListText,generateCommonCharacterListText}from'./settings/worldbook.js';import{updateCombinedPrompt}from'./settings/llm.js';import{buildPromptForRequestType}from'./settings/llmService.js';import{refreshCharacterSettings}from'./settings/character/index.js';import{stylishConfirm}from'./ui_common.js';import{mergeAdjacentMessages,replaceAllPlaceholders,replacePlaceholder as _0x26d04f}from'./promptProcessor.js';function replacePlaceholder(_0x3c25ce,_0x25abce,_0x18d79f,_0x1edb1b){const _0x3108c4={'TJVHh':function(_0x43b280,_0x445d8d){return _0x43b280===_0x445d8d;},'BNZqH':_0x89c5fc(0x5f3,0x681,0x619,0x5be),'zjiyS':function(_0x5cd548,_0x5bc079){return _0x5cd548(_0x5bc079);},'XMvfC':function(_0x3c8b98,_0x4de826){return _0x3c8b98!==_0x4de826;},'rPXhM':_0x89c5fc(0x531,0x52a,0x4b7,0x5a6),'KHBif':function(_0xeb20e8,_0x259e7e){return _0xeb20e8===_0x259e7e;},'bilsW':_0xf6865e(0xf0,0x166,0xd7,0x55),'FxVep':function(_0x52c4f6,_0x48047f){return _0x52c4f6!==_0x48047f;},'dcRGQ':_0xf6865e(-0x84,-0x100,-0x17,-0x97),'KlemN':function(_0x2dfb89,_0x2d700b,_0x67eb06,_0x17cd1f,_0x2a21ba){return _0x2dfb89(_0x2d700b,_0x67eb06,_0x17cd1f,_0x2a21ba);}};if(_0x3108c4['TJVHh'](typeof _0x3c25ce,_0x89c5fc(0x611,0x6c2,0x5b3,0x5b0))){if(_0x18d79f&&_0x3c25ce['includes'](_0x25abce)){if(_0x3108c4['XMvfC'](_0x3108c4['rPXhM'],_0x3108c4[_0xf6865e(-0x61,0x38,-0xa1,-0x3e)]))for(const _0x350f27 of _0x3d7989[_0xf6865e(0xd5,0xbe,0x174,0x9a)]){if(_0x3108c4['TJVHh'](_0x350f27[_0x89c5fc(0x5c1,0x5fe,0x655,0x5b6)],_0x3108c4['BNZqH'])&&_0x350f27[_0x89c5fc(0x5f3,0x621,0x546,0x570)]['includes'](_0x481920))return _0x55aa3e;}else _0x1edb1b&&_0x1edb1b['add'](_0x25abce);}return _0x3c25ce[_0x89c5fc(0x5d5,0x625,0x518,0x5d6)](_0x25abce,_0x18d79f);}if(Array[_0xf6865e(0xe4,0xad,0x18e,0x96)](_0x3c25ce))return _0x3c25ce[_0xf6865e(0xd,-0x40,0x67,0x28)](_0x41d509=>replacePlaceholder(_0x41d509,_0x25abce,_0x18d79f,_0x1edb1b));if(_0x3c25ce&&_0x3108c4[_0xf6865e(0x44,0x9f,0x87,0xbf)](typeof _0x3c25ce,_0x3108c4[_0xf6865e(0x3,0x21,0x9d,0x62)])){const _0x254f56={};for(const _0x6ee7c1 in _0x3c25ce){_0x3108c4[_0xf6865e(0x7c,0xcc,-0x28,0xd2)]('icVWN',_0x3108c4[_0xf6865e(-0x33,0x39,0x8f,-0x7c)])?_0x254f56[_0x6ee7c1]=_0x3108c4[_0x89c5fc(0x5fc,0x58f,0x576,0x64d)](replacePlaceholder,_0x3c25ce[_0x6ee7c1],_0x25abce,_0x18d79f,_0x1edb1b):_0x3108c4[_0x89c5fc(0x5ed,0x5b7,0x591,0x669)](_0x37c269,_0x1642e8);}return _0x254f56;}function _0xf6865e(_0x1e7f0d,_0x1a6248,_0x2e375f,_0x216882){return _0x4dc7(_0x1e7f0d- -0x259,_0x216882);}function _0x89c5fc(_0x538e1c,_0x5e1c3b,_0x21a872,_0x55ccf4){return _0x4dc7(_0x538e1c-0x341,_0x21a872);}return _0x3c25ce;}function attachImagesToMessage(_0x52a734,_0x5e65f0,_0x1eb65f,_0x5541ad=_0x29670b(0x5ee,0x5b6,0x595,0x653)){const _0x415c16={'hkvdl':function(_0xf10ba9,_0x3fdad5){return _0xf10ba9(_0x3fdad5);},'hPlFM':_0x56ffc9(-0xe3,-0x105,-0x19d,-0xa4),'mQCRK':_0x204a4a(0x469,0x4ea,0x4ce,0x4e2),'RDJeg':_0x56ffc9(0xb2,0x47,0xd8,0x85),'wiTJQ':function(_0x5f25b1,_0x375a17){return _0x5f25b1+_0x375a17;},'fVdyM':_0x56ffc9(0x2b,-0x50,-0x4a,-0x102),'odpeO':function(_0x220d37,_0x151938){return _0x220d37!==_0x151938;},'pvCLE':'OoNfJ','aWzXP':_0x56ffc9(0x91,0x3f,-0x16,-0x73),'mvgdJ':function(_0x52e308,_0x20906f){return _0x52e308<_0x20906f;},'TTYXw':function(_0x203419,_0x44600b){return _0x203419>=_0x44600b;},'EYrVr':function(_0x483694,_0x259394){return _0x483694===_0x259394;},'JKeuS':function(_0x589688,_0x16be64){return _0x589688===_0x16be64;},'KorlA':'RRqiD','xixtt':function(_0x14d835,_0x2800fd){return _0x14d835>_0x2800fd;},'BBPDZ':function(_0x4104cb,_0x211650){return _0x4104cb!==_0x211650;},'DBhMz':_0x56ffc9(-0x6d,-0x92,-0xd1,-0x12)};if(!_0x1eb65f||_0x1eb65f[_0x204a4a(0x38e,0x3ac,0x323,0x325)]===-0x3ba*0x7+-0x4f+0x1a65||_0x415c16[_0x56ffc9(-0x25,-0x10,0x84,-0x7c)](_0x5e65f0,0x11e3*0x1+-0x12ad+0xca)||_0x415c16[_0x56ffc9(-0x8d,-0x71,-0x4b,-0xdd)](_0x5e65f0,_0x52a734[_0x204a4a(0x38e,0x440,0x367,0x38b)]))return _0x52a734;const _0x4ae32d=[..._0x52a734];function _0x204a4a(_0x7875e1,_0x5a6c47,_0x4f9d9c,_0x1596ec){return _0x29670b(_0x7875e1- -0x167,_0x5a6c47-0xb3,_0x1596ec,_0x1596ec-0x18d);}const _0x3f39e6=_0x4ae32d[_0x5e65f0],_0x39b49a=[];if(_0x415c16[_0x204a4a(0x377,0x3ef,0x3ea,0x38d)](typeof _0x3f39e6[_0x56ffc9(0x45,0x2c,0x93,0x7)],_0x415c16[_0x56ffc9(0x2d,-0x61,0x55,0x24)])){const _0x5988e8={};_0x5988e8[_0x204a4a(0x419,0x4a0,0x446,0x3ce)]=_0x56ffc9(-0xcd,-0x50,-0x57,0x26),_0x5988e8[_0x56ffc9(-0x35,-0x50,-0x111,-0x96)]=_0x3f39e6[_0x204a4a(0x4c7,0x551,0x40e,0x416)],_0x39b49a['push'](_0x5988e8);}else Array[_0x204a4a(0x4d6,0x499,0x4ac,0x539)](_0x3f39e6[_0x204a4a(0x4c7,0x478,0x4e0,0x4f8)])&&(_0x415c16[_0x204a4a(0x4a3,0x4b3,0x558,0x50d)]('SnwZU',_0x415c16[_0x204a4a(0x475,0x3eb,0x415,0x3fe)])?_0x2d1a33[_0x56ffc9(-0x39,-0x80,-0x33,-0x6a)](..._0x48cf49[_0x204a4a(0x4c7,0x53e,0x44d,0x55c)]):_0x39b49a[_0x204a4a(0x41b,0x431,0x490,0x4a4)](..._0x3f39e6[_0x56ffc9(0xd,0x2c,0x77,-0x2)]));if(_0x415c16[_0x56ffc9(-0x159,-0xed,-0x195,-0xad)](_0x1eb65f[_0x204a4a(0x38e,0x365,0x317,0x364)],-0x2*0x38a+-0x2f9*-0x8+0x85a*-0x2)){if(_0x415c16[_0x56ffc9(-0x2c,-0x7a,-0x6c,-0xa3)](_0x415c16[_0x56ffc9(-0x21,-0x3e,-0xb9,-0xca)],_0x204a4a(0x3e8,0x365,0x3f6,0x37c))){const _0x2687ff={};_0x2687ff['type']=_0x415c16[_0x204a4a(0x48c,0x4e2,0x51c,0x47e)],_0x2687ff[_0x204a4a(0x44b,0x455,0x3af,0x4c3)]=_0x204a4a(0x3e9,0x3cd,0x35f,0x33d)+_0x1eb65f['length']+'张'+_0x5541ad+']',_0x39b49a[_0x56ffc9(-0xd9,-0x80,0xe,-0x125)](_0x2687ff);}else _0x244ad7['value']=_0x17f3f9[_0x54a6f5],_0x415c16[_0x56ffc9(-0x1bb,-0x134,-0x11b,-0x7a)](_0x4dc195,_0x39ca92)[_0x204a4a(0x40f,0x3da,0x441,0x385)](_0x415c16[_0x56ffc9(0x8c,-0x1b,-0x3b,-0x3c)]);}_0x1eb65f['forEach']((_0x26e548,_0x2c4d3e)=>{const _0x75d261={'loCXC':function(_0x4cce2a,_0x2dde00){return _0x415c16['hkvdl'](_0x4cce2a,_0x2dde00);},'wMely':'input'},_0x596336=typeof _0x26e548===_0x415c16[_0x367f19(-0x51,-0x13,-0x3e,-0xca)]?_0x26e548:_0x26e548[_0x367f19(-0x1b7,-0xfb,-0x108,-0xf5)],_0x24be4f=typeof _0x26e548===_0x415c16[_0x126b07(0x2a4,0x39d,0x2ec,0x292)]&&_0x26e548[_0x367f19(-0xa3,0x20,-0x9d,-0x11d)]?_0x26e548['name']:''+_0x5541ad+_0x415c16[_0x126b07(0x383,0x3b9,0x344,0x340)](_0x2c4d3e,-0x1b8b+0x877+0x5*0x3d1),_0x196fe1={};_0x196fe1[_0x126b07(0x31b,0x36f,0x37f,0x2ff)]=_0x415c16[_0x367f19(0xb3,0xb7,0x14,-0xa4)],_0x196fe1[_0x367f19(-0xd0,0x7a,-0x2d,-0x2f)]='['+_0x24be4f+']',_0x39b49a[_0x367f19(0x43,-0x4d,-0x5d,0x21)](_0x196fe1);let _0x531ead=_0x596336;if(!_0x596336[_0x367f19(-0x95,0x6,-0x99,0x11)](_0x126b07(0x3a6,0x23e,0x2f9,0x37b))){if(_0x415c16['odpeO'](_0x415c16[_0x367f19(0xd3,0x7c,0x69,-0xf)],_0x415c16[_0x126b07(0x482,0x3f5,0x447,0x43d)])){const _0x232716=_0x11608d[_0x126b07(0x36a,0x36d,0x320,0x365)+_0x367f19(-0x57,0xbe,0x4d,0x3e)](_0x126b07(0x283,0x246,0x2cb,0x25e)+_0x5a5254);_0x232716&&(_0x232716[_0x126b07(0x445,0x3c7,0x429,0x49a)]=_0x2cfcf1[_0x3ab67f],_0x75d261[_0x126b07(0x3b3,0x4a0,0x413,0x491)](_0x2d6a28,_0x232716)[_0x367f19(0x3e,-0xbe,-0x69,0xa)](_0x75d261['wMely']));}else _0x531ead=_0x367f19(0x97,0x7d,-0x1c,-0xa)+'/png;base6'+'4,'+_0x596336;}const _0x9d62c1={};_0x9d62c1[_0x126b07(0x224,0x210,0x2c9,0x210)]=_0x531ead,_0x9d62c1[_0x367f19(-0x50,-0x153,-0xf5,-0x105)]=_0x367f19(-0x1a9,-0xa8,-0xf7,-0x45);function _0x126b07(_0x395077,_0x4cdfd9,_0x592c06,_0x2bcb1d){return _0x56ffc9(_0x395077-0x1a0,_0x592c06-0x401,_0x2bcb1d,_0x2bcb1d-0x16a);}const _0x185cd0={};function _0x367f19(_0x49390f,_0xeaa08f,_0x4ded5e,_0x2d85fe){return _0x204a4a(_0x4ded5e- -0x478,_0xeaa08f-0xda,_0x4ded5e-0x13a,_0xeaa08f);}_0x185cd0[_0x367f19(-0x122,-0xbe,-0x5f,-0x3c)]=_0x415c16[_0x126b07(0x3e9,0x3c6,0x3a3,0x43f)],_0x185cd0[_0x126b07(0x478,0x46a,0x440,0x3df)]=_0x9d62c1,_0x39b49a[_0x367f19(0x2b,-0x105,-0x5d,-0x19)](_0x185cd0);});const _0x190718={..._0x3f39e6};function _0x56ffc9(_0x7c8505,_0x2439c6,_0xa6d763,_0x414b26){return _0x29670b(_0x2439c6- -0x602,_0x2439c6-0x4f,_0xa6d763,_0x414b26-0x1d2);}return _0x190718[_0x56ffc9(0xa1,0x2c,-0x40,0x2f)]=_0x39b49a,_0x4ae32d[_0x5e65f0]=_0x190718,_0x4ae32d;}function findMessageIndexWithPlaceholder(_0x46846f,_0x4a0765){const _0x94260={'bhHlt':function(_0x4f1364,_0x518a76){return _0x4f1364(_0x518a76);},'PoEAj':_0xc6c355(0x24,0x6d,0x31,0x92)+'时','QnDsf':function(_0x37d432){return _0x37d432();},'zQBvr':function(_0x5e91f1,_0x352129,_0x4fcad2){return _0x5e91f1(_0x352129,_0x4fcad2);},'LEauO':function(_0x1211d9,_0x14c598){return _0x1211d9<_0x14c598;},'zJRny':_0xc6c355(0x115,0x15a,0x16d,0x163),'DsVmX':_0x20364f(0x12c,0xe6,0x87,0x7a),'hVoSO':function(_0x131b81,_0x488729){return _0x131b81===_0x488729;},'hPoOY':'text'};function _0xc6c355(_0x200fd8,_0x389f09,_0x4e9129,_0x1bea45){return _0x29670b(_0x389f09- -0x476,_0x389f09-0x1dd,_0x4e9129,_0x1bea45-0x41);}for(let _0x312aba=-0x1918+0x1f86+-0x1*0x66e;_0x94260[_0xc6c355(0x65,0xef,0x13a,0xaf)](_0x312aba,_0x46846f[_0xc6c355(0x135,0x7f,0x5f,0xc)]);_0x312aba++){const _0x43b3ee=_0x46846f[_0x312aba];if(typeof _0x43b3ee[_0xc6c355(0xf8,0x1b8,0x129,0x1ee)]===_0x94260[_0x20364f(0x8f,0x1c8,0x11b,0x17a)]&&_0x43b3ee[_0x20364f(0x11f,0x20b,0x175,0x1ec)]['includes'](_0x4a0765)){if(_0xc6c355(0xcc,0xca,0x54,0x33)!==_0x94260[_0x20364f(0x213,0x209,0x183,0x185)]){const _0x131637={'eEiTG':function(_0xb4a8a7,_0x1ec881){function _0x5de237(_0x39fe3a,_0x5962ac,_0x38f236,_0x27e8b9){return _0x20364f(_0x39fe3a-0x133,_0x39fe3a,_0x27e8b9-0x3c2,_0x27e8b9-0x1b6);}return _0x94260[_0x5de237(0x50a,0x54e,0x4b5,0x493)](_0xb4a8a7,_0x1ec881);},'dsoxv':_0x94260[_0x20364f(-0x2c,0x42,0x80,0x3d)],'uFIlA':function(_0x74c51d){function _0x8ff5cf(_0x2f02bc,_0x28db24,_0x1f3174,_0x40b500){return _0x20364f(_0x2f02bc-0xf3,_0x2f02bc,_0x28db24- -0x1a3,_0x40b500-0x5);}return _0x94260[_0x8ff5cf(-0x31,-0xb7,-0x108,-0x11a)](_0x74c51d);},'yeiWl':function(_0x16a19b,_0x2d0583,_0x3bcd15){function _0x480411(_0x5124c4,_0xb98b00,_0x2a4076,_0x15d5da){return _0xc6c355(_0x5124c4-0x89,_0x2a4076-0x2e,_0x5124c4,_0x15d5da-0x1cd);}return _0x94260[_0x480411(0x64,0x124,0xf2,0x114)](_0x16a19b,_0x2d0583,_0x3bcd15);}};return new _0x2e4c97((_0x3aa6ec,_0x4f9aa4)=>{function _0x55f6cf(_0x5c1747,_0x55c988,_0x228dbf,_0x1e284f){return _0x20364f(_0x5c1747-0x8f,_0x5c1747,_0x228dbf-0x1f4,_0x1e284f-0x92);}const _0x534f59=_0x131637[_0x59494a(0x2db,0x30d,0x331,0x2ac)](_0x8715ff);_0xea4ece[_0x59494a(0x38d,0x2c6,0x3c1,0x336)](_0x55f6cf(0x38f,0x396,0x2f8,0x294)+_0x55f6cf(0x222,0x295,0x222,0x292)+_0x55f6cf(0x2d4,0x33c,0x342,0x3f6)+'ting\x20char\x20'+_0x55f6cf(0x34b,0x22d,0x2aa,0x321)+_0x55f6cf(0x2e7,0x1d5,0x231,0x2a2)+_0x534f59+')');const _0x2f3d80=_0x400832=>{function _0x4640be(_0x423081,_0x22b9f4,_0x5e9ef3,_0x586f5a){return _0x59494a(_0x423081-0x1f3,_0x423081,_0x5e9ef3-0x0,_0x5e9ef3-0x76);}if(_0x400832['id']!==_0x534f59)return;function _0x6d514f(_0x3022ff,_0x242c0a,_0x119329,_0x27db86){return _0x55f6cf(_0x242c0a,_0x242c0a-0x8f,_0x27db86-0x76,_0x27db86-0x13);}_0x5526cb[_0x6d514f(0x368,0x3f9,0x2f2,0x337)+_0x4640be(0x3aa,0x315,0x390,0x3a9)](_0x14543c[_0x4640be(0x35c,0x41f,0x391,0x3ba)+_0x4640be(0x2e3,0x2ae,0x358,0x309)+'PROMPT_RES'+_0x4640be(0x384,0x341,0x31c,0x317)],_0x2f3d80),_0x3aa6ec(_0x400832[_0x6d514f(0x2f1,0x2a9,0x2a9,0x32b)]);};_0x466703['on'](_0x34ae4c[_0x55f6cf(0x3bd,0x3da,0x35e,0x2ac)+'ODIFY_GET_'+_0x59494a(0x2f0,0x2f0,0x274,0x291)+_0x55f6cf(0x226,0x2ca,0x2e9,0x27b)],_0x2f3d80);const _0x3982f3={};function _0x59494a(_0x1cf5ca,_0x3e5caf,_0x11e4a7,_0x19313d){return _0x20364f(_0x1cf5ca-0x1cf,_0x3e5caf,_0x19313d-0x1b1,_0x19313d-0x17b);}_0x3982f3['id']=_0x534f59,_0x21acbf[_0x55f6cf(0x308,0x276,0x303,0x287)](_0x49fc98[_0x55f6cf(0x36c,0x2ba,0x35e,0x3f5)+'ODIFY_GET_'+_0x59494a(0x252,0x29a,0x2f3,0x24c)+_0x55f6cf(0x3d9,0x291,0x349,0x3da)],_0x3982f3),_0x131637[_0x55f6cf(0x35c,0x335,0x363,0x2d0)](_0x6d5a9a,()=>{_0x494791[_0x460463(0x63,-0x2f,0xeb,0xd0)+_0x460463(0xff,0x7b,0x7f,0x11c)](_0x1a31da[_0x460463(0x100,0x1a3,0x1a1,0x75)+'ODIFY_GET_'+'PROMPT_RES'+_0x460463(0x8b,0xfc,0x8f,0xc2)],_0x2f3d80);function _0x4fdd77(_0x42bd6f,_0x5acf52,_0x1e88e7,_0x528a98){return _0x55f6cf(_0x1e88e7,_0x5acf52-0x104,_0x5acf52- -0xc7,_0x528a98-0x1a9);}function _0x460463(_0x2764f5,_0x409eda,_0x1ac39e,_0x188d14){return _0x59494a(_0x2764f5-0x12c,_0x188d14,_0x1ac39e-0x17c,_0x2764f5- -0x21b);}_0x131637[_0x460463(0xc,-0xa3,0x65,-0x82)](_0x4f9aa4,new _0x36b6bc(_0x131637[_0x4fdd77(0x2df,0x2a8,0x336,0x2f8)]));},-0x1b53+0x1*-0xbaf+0x6*0xd03);});}else return _0x312aba;}else{if(Array[_0x20364f(0x126,0x194,0x184,0xee)](_0x43b3ee[_0xc6c355(0x25d,0x1b8,0x1d7,0x15b)]))for(const _0x35e4b0 of _0x43b3ee[_0xc6c355(0x230,0x1b8,0x1aa,0x167)]){if(_0x94260[_0x20364f(0xe4,0x10d,0x137,0x90)](_0x35e4b0['type'],_0x94260['hPoOY'])&&_0x35e4b0[_0xc6c355(0xdb,0x13c,0x1ef,0x86)]['includes'](_0x4a0765))return _0x312aba;}}}function _0x20364f(_0x477ce7,_0x4495dd,_0x10c18d,_0x1e98be){return _0x29670b(_0x10c18d- -0x4b9,_0x4495dd-0x1a3,_0x4495dd,_0x1e98be-0xde);}return-(-0x15e+0x1fa7+0xa18*-0x3);}function generateRequestId(){function _0x331973(_0x2fd59d,_0x1b56ab,_0x4a078e,_0x22a92d){return _0x29670b(_0x1b56ab- -0x166,_0x1b56ab-0x14e,_0x2fd59d,_0x22a92d-0x10a);}const _0x29f95d={};_0x29f95d['FcBwF']=_0x331973(0x462,0x457,0x3bd,0x475)+_0x102dff(0x1eb,0x21e,0x1f7,0x1cf)+'fy]\x20Error:';function _0x102dff(_0x486c3d,_0x1ed0c8,_0x5e4b49,_0x4f84e2){return _0x29670b(_0x1ed0c8- -0x2c9,_0x1ed0c8-0x1c8,_0x5e4b49,_0x4f84e2-0x39);}_0x29f95d[_0x102dff(0x233,0x2ca,0x347,0x221)]=_0x102dff(0x257,0x31a,0x287,0x2fe);const _0x3f15d5=_0x29f95d;if(crypto&&crypto[_0x102dff(0x309,0x33c,0x2e9,0x30d)]){if(_0x3f15d5[_0x331973(0x3d7,0x42d,0x46c,0x3cb)]!==_0x102dff(0x259,0x213,0x246,0x19c))return crypto[_0x331973(0x4f5,0x49f,0x54f,0x400)]();else _0x376ac1[_0x331973(0x4e4,0x493,0x511,0x4f3)](_0x3f15d5[_0x331973(0x435,0x3fb,0x352,0x486)],_0x4522f4),_0x4353b3['error'](_0x102dff(0x239,0x254,0x1a3,0x2ab)+'\x20'+_0x1368af[_0x331973(0x33a,0x3cf,0x3d0,0x3b8)]);}return Date[_0x331973(0x442,0x4d5,0x47b,0x569)]()['toString'](0x10ec+0x22e5+-0x33ad)+Math[_0x102dff(0x21d,0x23b,0x29e,0x22c)]()[_0x331973(0x308,0x3b5,0x394,0x452)](0x11*-0x123+-0xeb1*-0x1+0x4c6)[_0x331973(0x422,0x497,0x4c7,0x3df)](0x1e44+0x2a6+-0x144*0x1a);}export function LLM_CHAR_MODIFY_GET_PROMPT(){const _0x249cab={'sSbnb':function(_0x3d6de6,_0x38b476){return _0x3d6de6!==_0x38b476;},'DWWEk':function(_0xb36c6a,_0x4242f4){return _0xb36c6a(_0x4242f4);},'fHkou':function(_0x256e9c,_0x249364){return _0x256e9c===_0x249364;},'xQkEE':_0x2bd114(0x449,0x4a8,0x430,0x4ec),'CKrdQ':_0x3fea9d(0x12b,0x31,0x117,0xd3)+'时','HRMDI':function(_0x54d0fb){return _0x54d0fb();},'NdULf':function(_0x143f28,_0x229515,_0x572b5e){return _0x143f28(_0x229515,_0x572b5e);}};function _0x2bd114(_0x1b2bf6,_0x57cf54,_0x39b4ad,_0x22be78){return _0x29670b(_0x57cf54- -0x121,_0x57cf54-0x2f,_0x22be78,_0x22be78-0x1d7);}function _0x3fea9d(_0x19b652,_0x3cafb6,_0x290bee,_0x1f4891){return _0x29670b(_0x1f4891- -0x410,_0x3cafb6-0xf6,_0x3cafb6,_0x1f4891-0xc7);}return new Promise((_0x29a44b,_0x3f092e)=>{const _0x5b1572=_0x249cab[_0x2a7b83(0x2ec,0x389,0x3a9,0x39c)](generateRequestId);console[_0x224c4e(0x3eb,0x46c,0x4f1,0x47d)](_0x2a7b83(0x4b8,0x48a,0x3f7,0x486)+'PromptModi'+'fy]\x20Reques'+_0x224c4e(0x3d7,0x33f,0x358,0x293)+_0x2a7b83(0x494,0x49f,0x38e,0x438)+_0x224c4e(0x350,0x324,0x270,0x2c2)+_0x5b1572+')');function _0x2a7b83(_0x1548da,_0x40fd7e,_0x13d6eb,_0x417717){return _0x3fea9d(_0x1548da-0x168,_0x40fd7e,_0x13d6eb-0x77,_0x417717-0x2d9);}const _0x13d9cb=_0x425139=>{function _0x64f99(_0x2daf4c,_0xd30315,_0xdbd85,_0x468ef8){return _0x224c4e(_0x2daf4c-0xaf,_0xdbd85- -0xc8,_0xdbd85-0x188,_0x468ef8);}if(_0x249cab[_0x3019d5(0x4c0,0x38e,0x44c,0x401)](_0x425139['id'],_0x5b1572))return;function _0x3019d5(_0xc38512,_0x17ca7e,_0x454fd1,_0x186246){return _0x2a7b83(_0xc38512-0x65,_0xc38512,_0x454fd1-0x8a,_0x454fd1- -0x25);}eventSource[_0x3019d5(0x3ac,0x47c,0x42a,0x46f)+_0x64f99(0x318,0x30b,0x388,0x2e9)](eventNames[_0x3019d5(0x503,0x532,0x4c7,0x4ca)+_0x64f99(0x376,0x2e2,0x350,0x324)+'PROMPT_RES'+'PONSE'],_0x13d9cb),_0x29a44b(_0x425139['prompt']);};function _0x224c4e(_0x2a880f,_0x44bf6f,_0x229374,_0x4b8136){return _0x2bd114(_0x2a880f-0x100,_0x44bf6f- -0xb1,_0x229374-0x141,_0x4b8136);}eventSource['on'](eventNames[_0x224c4e(0x409,0x451,0x3d1,0x3ae)+'ODIFY_GET_'+_0x2a7b83(0x3fb,0x4d4,0x3ce,0x462)+'PONSE'],_0x13d9cb);const _0x4e7ab9={};_0x4e7ab9['id']=_0x5b1572,eventSource[_0x224c4e(0x381,0x3f6,0x46e,0x3c9)](eventNames['LLM_CHAR_M'+'ODIFY_GET_'+_0x2a7b83(0x42e,0x3aa,0x3c6,0x41d)+_0x2a7b83(0x4bb,0x488,0x595,0x4d7)],_0x4e7ab9),_0x249cab[_0x224c4e(0x36c,0x42f,0x431,0x3c6)](setTimeout,()=>{function _0x11c30e(_0x40e48b,_0xb6f4a6,_0x1d3261,_0x4270ae){return _0x224c4e(_0x40e48b-0xb4,_0x40e48b-0x152,_0x1d3261-0x175,_0xb6f4a6);}const _0x19b31f={'yScGW':function(_0x2b6a70,_0x2b56b2){function _0x37e26c(_0x168aa7,_0x3b360c,_0x16e986,_0x17f38d){return _0x4dc7(_0x17f38d- -0x296,_0x3b360c);}return _0x249cab[_0x37e26c(-0x34,0xab,0x1,0x59)](_0x2b6a70,_0x2b56b2);}};function _0x294fcf(_0x3d1245,_0x389b67,_0x497acd,_0x25c9bd){return _0x224c4e(_0x3d1245-0x111,_0x25c9bd- -0xa2,_0x497acd-0x128,_0x389b67);}_0x249cab[_0x294fcf(0x2c7,0x29c,0x38f,0x308)](_0x249cab[_0x294fcf(0x3fb,0x38b,0x417,0x3c1)],_0x249cab[_0x11c30e(0x5b5,0x657,0x62b,0x5e8)])?(eventSource['removeList'+'ener'](eventNames[_0x11c30e(0x5a3,0x5ff,0x52a,0x635)+_0x11c30e(0x56a,0x4b3,0x4d2,0x505)+_0x294fcf(0x2cd,0x3b8,0x3cb,0x325)+_0x11c30e(0x52e,0x513,0x4ff,0x528)],_0x13d9cb),_0x249cab[_0x11c30e(0x56f,0x537,0x4eb,0x62d)](_0x3f092e,new Error(_0x249cab[_0x11c30e(0x486,0x49e,0x4b1,0x46d)]))):(_0x19b31f[_0x11c30e(0x448,0x3b7,0x49e,0x498)](_0x1ba4a5,_0x124db1),_0x4190a2=null);},-0x42c3+0xd23+0x5cb0);});}export function LLM_CHAR_MODIFY(_0x2ea8ac,_0x559e61={}){function _0x35a208(_0x40e13c,_0x3598df,_0x5c1261,_0x2f07a4){return _0x29670b(_0x2f07a4- -0x6aa,_0x3598df-0xe5,_0x3598df,_0x2f07a4-0x180);}function _0x35c071(_0xe4867f,_0x506ea5,_0x601ce,_0x1f8d30){return _0x29670b(_0x1f8d30- -0x116,_0x506ea5-0x1a5,_0x601ce,_0x1f8d30-0xc0);}const _0x41f9be={'RyfHw':function(_0x2cc12d,_0x112688){return _0x2cc12d(_0x112688);},'AiAiw':_0x35c071(0x573,0x408,0x53c,0x4b9),'Lrkku':_0x35c071(0x513,0x47e,0x4b7,0x45c)+_0x35a208(-0x1e,-0xf6,-0xb4,-0x7d),'jkLkF':'upperBodyS'+'FW','FWWmE':_0x35a208(-0x116,-0x14c,-0x154,-0x1c8)+_0x35a208(-0x1f7,-0x151,-0x1d5,-0x1a7),'pbsQw':_0x35c071(0x49d,0x4c7,0x564,0x511)+_0x35a208(-0x9d,-0xd3,-0x17d,-0x10a),'IvHwG':_0x35a208(-0x2b,-0x100,-0x126,-0x81)+_0x35c071(0x3ab,0x38f,0x376,0x3ed),'JRgpH':function(_0x5929c6,_0x325534){return _0x5929c6(_0x325534);},'ehhBW':_0x35a208(-0x13a,-0x95,-0x14a,-0x114),'uUaUN':_0x35c071(0x386,0x3ed,0x33b,0x3e7),'gflWA':function(_0x397d29,_0x1e00c2){return _0x397d29!==_0x1e00c2;},'SKQRZ':_0x35a208(-0x1ec,-0x263,-0x161,-0x1bb),'COxvL':function(_0x3b8314){return _0x3b8314();},'OpxGN':_0x35a208(-0x212,-0x195,-0xfd,-0x15e)+'求超时','VDShI':function(_0x534ea9){return _0x534ea9();}};return new Promise((_0x1f0c1b,_0x366cec)=>{const _0x44e5ba={'plxcB':_0x41f9be['AiAiw'],'jmItV':_0x41f9be['Lrkku'],'gArbd':_0x41f9be[_0xd28c1a(0x15b,0x279,0x2b0,0x206)],'agSPl':_0x41f9be[_0xd28c1a(0x67,0x176,0x129,0xe6)],'hfPLJ':'fullBodySF'+'W','wxdHf':_0x41f9be[_0x47bd2a(0x78,-0x38,-0x7,0x55)],'gcnVR':_0x41f9be[_0xd28c1a(0x1d9,0x1a5,0x21c,0x1ee)],'AoLkn':function(_0x50ef72,_0x15e72d){function _0xf251c0(_0xafa9c2,_0x3620ab,_0x4e7922,_0x357422){return _0x47bd2a(_0xafa9c2-0x15f,_0x3620ab-0x1b5,_0x3620ab,_0x357422- -0xca);}return _0x41f9be[_0xf251c0(-0x1a3,-0x1da,-0xf4,-0x1a2)](_0x50ef72,_0x15e72d);},'iOqiE':_0x41f9be[_0x47bd2a(0x62,-0x20,-0x29,0x77)],'Wemkd':_0x41f9be[_0xd28c1a(0x186,0x20c,0x259,0x1f3)],'Mgqlq':function(_0x284289,_0x5dc736){function _0x3cf3e4(_0x36820e,_0x2870b9,_0x462d13,_0x22ca6c){return _0xd28c1a(_0x36820e,_0x2870b9-0x80,_0x462d13-0x120,_0x22ca6c- -0x211);}return _0x41f9be[_0x3cf3e4(-0x105,-0x99,-0x13d,-0x103)](_0x284289,_0x5dc736);},'KRjKi':_0x41f9be[_0xd28c1a(0x150,0x1a8,0x1cd,0x1dc)],'XuWbo':function(_0x46594d,_0x2e0ea4){function _0x40832c(_0x2ef09b,_0x43f488,_0xd9ab31,_0x4943c6){return _0xd28c1a(_0x43f488,_0x43f488-0x1ec,_0xd9ab31-0x13c,_0x4943c6- -0x26);}return _0x41f9be[_0x40832c(0x25,0x42,0xe0,0xe8)](_0x46594d,_0x2e0ea4);},'lRKyU':function(_0x1b9545){function _0x30bd58(_0x285893,_0x29285b,_0x36c6d7,_0x29b321){return _0x47bd2a(_0x285893-0x7,_0x29285b-0x106,_0x36c6d7,_0x285893-0x37);}return _0x41f9be[_0x30bd58(-0xf,0x3d,0x7c,0x5c)](_0x1b9545);},'uDOgL':_0x41f9be[_0xd28c1a(0x162,0x16d,0xc2,0x120)]},_0x1f2fca=_0x41f9be['VDShI'](generateRequestId),_0x3c62bd=_0x559e61[_0xd28c1a(0xa1,0x1e4,0xb3,0x13e)]||0x1174f+-0x2dd*-0x1+-0x2fcc;let _0x144cad=null;console[_0xd28c1a(0x225,0x2f5,0x1b4,0x253)]('[character'+_0xd28c1a(0x144,0x9a,0xe4,0xfc)+_0x47bd2a(0x2a,0x23,-0x54,0x42)+_0xd28c1a(0x130,0x183,0x12b,0x12b)+_0xd28c1a(0x1ab,0x1b8,0xd2,0x12d)+_0x47bd2a(-0x18,0x3b,0x48,-0x1e)+_0xd28c1a(0x23b,0x18b,0x219,0x20f)+_0x1f2fca+')');function _0xd28c1a(_0x132eca,_0x3003d7,_0x537509,_0x3d84c6){return _0x35c071(_0x132eca-0xe8,_0x3003d7-0x18c,_0x132eca,_0x3d84c6- -0x2d5);}const _0x7fe339=()=>{eventSource['removeList'+'ener'](eventNames[_0x38abe5(0x2c1,0x1b2,0x281,0x255)+_0x4086de(-0xc7,-0x61,-0xdf,-0x3f)+'ONSE'],_0x109330);function _0x38abe5(_0x382dea,_0x5b647f,_0x1e4d3c,_0x457d09){return _0x47bd2a(_0x382dea-0x1e4,_0x5b647f-0x5a,_0x382dea,_0x457d09-0x1fd);}function _0x4086de(_0x4340d6,_0x574570,_0x1d2fa0,_0x26e01f){return _0xd28c1a(_0x26e01f,_0x574570-0x11f,_0x1d2fa0-0x139,_0x4340d6- -0x28f);}_0x144cad&&(_0x41f9be['RyfHw'](clearTimeout,_0x144cad),_0x144cad=null);},_0x109330=_0x4aaac0=>{function _0x27ef40(_0x3ca74a,_0x1fe96f,_0x1c0615,_0x46616d){return _0x47bd2a(_0x3ca74a-0x1be,_0x1fe96f-0xf2,_0x1fe96f,_0x1c0615-0x1cc);}const _0x15cfee={'pqQpY':function(_0xd357c4,_0x337efa){return _0x44e5ba['AoLkn'](_0xd357c4,_0x337efa);},'DqDkL':_0x44e5ba[_0x4e33c8(0x452,0x443,0x481,0x436)],'ZzAYI':_0x44e5ba['Wemkd']};function _0x4e33c8(_0x92da3a,_0x162a3c,_0x1f33b0,_0x3c1229){return _0xd28c1a(_0x1f33b0,_0x162a3c-0xdf,_0x1f33b0-0x1ec,_0x92da3a-0x227);}if(_0x44e5ba[_0x27ef40(0x249,0x275,0x232,0x2e7)](_0x44e5ba[_0x27ef40(0x1ca,0x1f8,0x1ec,0x1fc)],_0x44e5ba['KRjKi']))_0x15cfee[_0x4e33c8(0x44b,0x4f3,0x4d9,0x3a1)](_0x19b7b1,new _0x432c27(_0x5d5918[_0x4e33c8(0x421,0x3e8,0x372,0x41a)]||_0x15cfee[_0x4e33c8(0x363,0x301,0x391,0x37e)]));else{if(_0x44e5ba[_0x4e33c8(0x34f,0x38f,0x397,0x2d3)](_0x4aaac0['id'],_0x1f2fca))return;_0x7fe339();if(_0x4aaac0[_0x27ef40(0x20a,0x1a8,0x16e,0x1f6)])_0x44e5ba['AoLkn'](_0x1f0c1b,_0x4aaac0[_0x27ef40(0x22d,0x1f8,0x1e6,0x157)]);else{if(_0x44e5ba[_0x4e33c8(0x34f,0x2c4,0x335,0x318)](_0x4e33c8(0x413,0x459,0x4c4,0x3c5),_0x27ef40(0x160,0x187,0x12e,0x17e)))_0x44e5ba[_0x27ef40(0x162,0x279,0x1b8,0x116)](_0x366cec,new Error(_0x4aaac0[_0x4e33c8(0x421,0x3bf,0x43e,0x419)]||'LLM\x20请求失败'));else{const _0x522533=['nameCN',_0x44e5ba['plxcB'],_0x44e5ba[_0x27ef40(0x12b,0x233,0x1e0,0x1cc)],'facialFeat'+_0x27ef40(0xb8,0x16f,0x13c,0x1fa),_0x44e5ba[_0x4e33c8(0x39c,0x426,0x36f,0x406)],_0x44e5ba[_0x27ef40(0x21a,0x1a2,0x23b,0x218)],_0x44e5ba[_0x4e33c8(0x46b,0x4f9,0x52a,0x4cd)],_0x27ef40(0x17f,0x2ba,0x1f9,0x1dd)+'WBack',_0x4e33c8(0x463,0x4ea,0x50c,0x4f1)+_0x27ef40(0x285,0x20f,0x245,0x287),_0x44e5ba[_0x4e33c8(0x44c,0x3c7,0x3aa,0x48c)],_0x27ef40(0x1b9,0x2b7,0x22a,0x1bd)+'FW',_0x44e5ba['gcnVR']];_0x522533[_0x27ef40(0x21d,0x13b,0x1aa,0x148)](_0x14fecb=>{function _0x50764b(_0x5a9f6d,_0x44eb96,_0x2da048,_0x5d4385){return _0x4e33c8(_0x5a9f6d- -0x1ef,_0x44eb96-0x1d9,_0x5d4385,_0x5d4385-0x154);}function _0x18b407(_0x4c48df,_0x3901d5,_0x4ef631,_0x191484){return _0x4e33c8(_0x4ef631- -0x43a,_0x3901d5-0x79,_0x191484,_0x191484-0x1c8);}if(_0xd18bf1[_0x14fecb]){const _0x35a158=_0x352511[_0x50764b(0x16e,0x1c9,0x1b0,0x225)+_0x18b407(0xdc,0x3b,0x2e,0x59)]('char_'+_0x14fecb);_0x35a158&&(_0x35a158[_0x50764b(0x277,0x2fd,0x209,0x1ea)]=_0x400ae4[_0x14fecb],_0x5b6ca0(_0x35a158)[_0x18b407(-0x141,-0x13b,-0x88,-0xe3)](_0x15cfee[_0x18b407(0x34,0x5b,0x41,0x53)]));}});}}}};eventSource['on'](eventNames[_0xd28c1a(0x1aa,0x2f0,0x1b7,0x238)+'ODIFY_RESP'+_0x47bd2a(-0xc6,-0x29,-0x103,-0xe5)],_0x109330);const _0x4f2185={};_0x4f2185['prompt']=_0x2ea8ac,_0x4f2185['id']=_0x1f2fca;function _0x47bd2a(_0x43d6fe,_0x9697b1,_0xb5b431,_0x4fb767){return _0x35a208(_0x43d6fe-0x12f,_0xb5b431,_0xb5b431-0x14c,_0x4fb767-0xdf);}eventSource['emit'](eventNames[_0x47bd2a(0xf5,0xcb,0x79,0x58)+'ODIFY_REQU'+_0xd28c1a(0x2e3,0x213,0x23f,0x23b)],_0x4f2185),_0x144cad=setTimeout(()=>{_0x44e5ba[_0x504d53(0xd2,0xf,0x46,0x44)](_0x7fe339);function _0x49f62a(_0x334493,_0x2905e0,_0x3eacb7,_0x279ee5){return _0xd28c1a(_0x3eacb7,_0x2905e0-0xbb,_0x3eacb7-0xc5,_0x334493- -0x2b4);}function _0x504d53(_0x16513c,_0x263be7,_0x3bdf92,_0x4b19b3){return _0xd28c1a(_0x16513c,_0x263be7-0x1,_0x3bdf92-0x16a,_0x263be7- -0x1dc);}_0x366cec(new Error(_0x44e5ba[_0x49f62a(-0x1c2,-0x209,-0x264,-0x205)]));},_0x3c62bd);});}function preprocessTagContent(_0x12a465){function _0x54dfd6(_0xc45fcf,_0x269625,_0x4f0893,_0x2478ad){return _0x29670b(_0x2478ad- -0x6df,_0x269625-0x2f,_0xc45fcf,_0x2478ad-0x1c0);}const _0x29105e={};_0x29105e[_0x54dfd6(-0x70,-0x19a,-0x9e,-0xe0)]=_0x171f9f(0x2b8,0x263,0x36f,0x27d),_0x29105e[_0x54dfd6(-0x212,-0x188,-0x1cc,-0x205)]=_0x54dfd6(-0x9a,-0x4d,-0xd9,-0xc3);const _0x152d16=_0x29105e;let _0x5be986=_0x12a465[_0x171f9f(0x316,0x3ce,0x39a,0x336)](/:/g,':')[_0x171f9f(0x316,0x369,0x26e,0x2ad)](/\(/g,'（')[_0x171f9f(0x316,0x2ac,0x273,0x281)](/\)/g,'）')['replace'](/,/g,',');_0x5be986=_0x5be986['replace'](/下半身NSWebcam:/g,_0x152d16[_0x54dfd6(-0x1a2,-0x51,-0x181,-0xe0)]),_0x5be986=_0x5be986[_0x54dfd6(-0x1e9,-0x1c8,-0x93,-0x127)](/下半身NSFW_背面:/g,_0x152d16[_0x171f9f(0x35d,0x2e6,0x357,0x2c7)]),_0x5be986=_0x5be986[_0x171f9f(0x316,0x2ef,0x39b,0x279)](/上半身NSFW_背面:/g,_0x152d16['ZuqIf']);function _0x171f9f(_0x44c688,_0x5246a2,_0x4edda2,_0x929b72){return _0x29670b(_0x44c688- -0x2a2,_0x5246a2-0x9c,_0x5246a2,_0x929b72-0xf);}return _0x5be986;}function parseCharacterData(_0x32a2c1){const _0x82d991={'BIBQv':function(_0xb74917,_0x2ed7fc){return _0xb74917!==_0x2ed7fc;},'kFXCs':function(_0x41d6a5){return _0x41d6a5();},'LQSoc':function(_0x5457c0,_0x40d80a){return _0x5457c0(_0x40d80a);},'RxFjn':_0x604635(0x181,0x23c,0x17f,0x193),'gxFqo':_0x604635(0x297,0x2b0,0x31f,0x2a0),'DLIWV':_0x604635(0x2e3,0x253,0x2e0,0x29f)+'ures','SGkJA':_0x2d5e04(0xf4,0x1a3,0x19b,0xfb)+_0x2d5e04(0x1e8,0xb3,0x164,0xe6),'gTfeG':_0x2d5e04(0x13b,0x85,0x10b,0x1a7)+'FW','fQeOo':_0x2d5e04(0x115,0x1cc,0x10b,0x82)+_0x2d5e04(0x1d0,0x115,0x12c,0x9a),'JpBTp':_0x604635(0x245,0x2d9,0x345,0x35d)+'W','zQleB':_0x604635(0x23b,0x2d9,0x29e,0x381)+_0x604635(0x252,0x30c,0x254,0x383),'EQkUk':_0x2d5e04(0x231,0x1c7,0x250,0x1bd)+_0x2d5e04(0x1b7,0x285,0x1c9,0x202),'UqNYh':_0x604635(0x3a0,0x30a,0x248,0x333)+'FW','Npysp':'fullBodyNS'+'FWBack','JwBVW':function(_0x574ef3,_0x569c0d){return _0x574ef3===_0x569c0d;},'BwvaV':function(_0x302833,_0x3173af){return _0x302833&&_0x3173af;},'deQeH':_0x604635(0xf2,0x1b3,0x131,0xf9),'hXSre':_0x604635(0x217,0x29e,0x22f,0x254)+'PromptModi'+'fy]\x20解析到的人物'+_0x2d5e04(0x28d,0x2b0,0x21e,0x22e)},_0x97ee9b=_0x32a2c1[_0x2d5e04(0x272,0x27d,0x206,0x2b5)]('\x0a')['map'](_0x5a9d95=>_0x5a9d95['trim']())[_0x2d5e04(0x1cd,0xd9,0x17e,0x11e)](_0x107a04=>_0x107a04),_0x2cc124={};_0x2cc124[_0x2d5e04(0xcf,0x136,0x184,0x22e)]='',_0x2cc124[_0x2d5e04(0x238,0x1c1,0x1f8,0x235)]='';function _0x2d5e04(_0x4c6f72,_0x3a9b0e,_0x4e4197,_0x3109b5){return _0x29670b(_0x4e4197- -0x3d7,_0x3a9b0e-0x9c,_0x3109b5,_0x3109b5-0x7e);}_0x2cc124[_0x2d5e04(0x213,0xfe,0x19b,0x113)+_0x604635(0x355,0x30e,0x291,0x26b)]='',_0x2cc124[_0x604635(0x2e4,0x253,0x27c,0x2f3)+_0x604635(0x238,0x21c,0x2ce,0x2d0)]='',_0x2cc124[_0x604635(0x181,0x1c3,0x145,0x17a)+'FW']='',_0x2cc124[_0x2d5e04(0x16b,0xfd,0x10b,0xe2)+_0x2d5e04(0x192,0xf4,0x12c,0xba)]='',_0x2cc124['fullBodySF'+'W']='',_0x2cc124[_0x2d5e04(0x2a8,0x207,0x221,0x1ab)+_0x2d5e04(0x19c,0x2ad,0x254,0x2fb)]='',_0x2cc124[_0x2d5e04(0x1ae,0x1ff,0x250,0x2f2)+_0x604635(0x34c,0x325,0x3d2,0x291)]='',_0x2cc124[_0x2d5e04(0x1ae,0x2e8,0x250,0x253)+_0x2d5e04(0x12f,0x227,0x1c9,0x16f)]='',_0x2cc124[_0x2d5e04(0x1b6,0x219,0x252,0x2b0)+'FW']='',_0x2cc124[_0x2d5e04(0x2c5,0x1d7,0x252,0x2e7)+_0x2d5e04(0x18a,0xaf,0x12c,0x1ef)]='';const _0x4a3085=_0x2cc124,_0x43f4fe={};_0x43f4fe['中文名称']=_0x82d991[_0x2d5e04(0x174,0x117,0x1a1,0x207)],_0x43f4fe['英文名称']=_0x82d991[_0x2d5e04(0x1fb,0x21a,0x1e8,0x1f2)],_0x43f4fe[_0x604635(0x2be,0x201,0x19f,0x16d)]=_0x82d991['DLIWV'],_0x43f4fe[_0x2d5e04(0x20d,0x1ba,0x186,0x121)]=_0x82d991['SGkJA'],_0x43f4fe[_0x604635(0x1fd,0x1d2,0x121,0x10f)]=_0x82d991[_0x604635(0x28c,0x2a1,0x303,0x34a)],_0x43f4fe[_0x604635(0x130,0x1cd,0x287,0x262)]=_0x82d991[_0x604635(0x294,0x23f,0x2d2,0x288)],_0x43f4fe[_0x2d5e04(0x78,0x19d,0x108,0xde)]=_0x82d991[_0x604635(0x392,0x32b,0x360,0x2f5)],_0x43f4fe[_0x2d5e04(0x2e6,0x2a0,0x22b,0x1e5)]=_0x82d991[_0x604635(0x30d,0x254,0x302,0x2bd)],_0x43f4fe['上半身NSFW']='upperBodyN'+_0x2d5e04(0x1e0,0x236,0x26d,0x226);function _0x604635(_0x1a2197,_0x8bfdd,_0x290531,_0x25a94a){return _0x29670b(_0x8bfdd- -0x31f,_0x8bfdd-0x18e,_0x1a2197,_0x25a94a-0x89);}_0x43f4fe[_0x604635(0x127,0x1e2,0x295,0x186)]=_0x82d991[_0x2d5e04(0x16c,0x23a,0x1a0,0x1a6)],_0x43f4fe[_0x2d5e04(0x2d3,0x277,0x22d,0x293)]=_0x82d991[_0x2d5e04(0x2c2,0x232,0x22c,0x16b)],_0x43f4fe['下半身NSFW背面']=_0x82d991['Npysp'];const _0x93ad32=_0x43f4fe;for(const _0x25bbb4 of _0x97ee9b){const _0x35be19=_0x25bbb4[_0x604635(0x2a6,0x232,0x216,0x231)](':');if(_0x82d991[_0x2d5e04(0xff,0x1b3,0x142,0x136)](_0x35be19,-(0x292*0xf+0x14d*0xf+-0x3a10)))continue;const _0x631704=_0x25bbb4['substring'](0x33*-0xb9+-0x19*-0x15d+0x2c6,_0x35be19)['trim'](),_0x46618f=_0x25bbb4[_0x604635(0x267,0x2de,0x2ba,0x268)](_0x35be19+(-0x252b+-0x3*0x12d+0x28b3))[_0x2d5e04(0x25e,0x1fc,0x1de,0x282)]();if(_0x93ad32[_0x631704])_0x4a3085[_0x93ad32[_0x631704]]=_0x46618f;else{if(_0x82d991[_0x604635(0x242,0x1fd,0x25e,0x14d)](_0x631704,_0x46618f)){if(_0x82d991[_0x604635(0x220,0x23a,0x22a,0x270)](_0x82d991['deQeH'],_0x82d991[_0x604635(0x370,0x319,0x379,0x2b6)])){if(_0x82d991[_0x604635(0x2ce,0x23a,0x28c,0x19a)](_0xea1c2['id'],_0x310fa7))return;_0x82d991[_0x604635(0x28b,0x25c,0x1d6,0x233)](_0x50798f),_0x189846['success']?_0x16232c(_0x42e33a[_0x2d5e04(0x230,0x18a,0x20e,0x28d)]):_0x82d991[_0x2d5e04(0x18d,0x25f,0x1c7,0x143)](_0x362ccc,new _0x30dfee(_0x12e832[_0x604635(0x338,0x2c6,0x338,0x2f0)]||_0x2d5e04(0x269,0x17e,0x1bf,0x16c)));}else console[_0x2d5e04(0x21e,0x272,0x267,0x263)](_0x604635(0x27e,0x29e,0x1f0,0x280)+_0x2d5e04(0x9f,0xa1,0x110,0x5f)+_0x2d5e04(0x2b0,0x23f,0x23a,0x255)+_0x2d5e04(0xc7,0xf0,0x148,0x1d6)+_0x631704+'\x22');}}}if(!_0x4a3085[_0x604635(0x198,0x23c,0x294,0x267)])return null;return console[_0x604635(0x3aa,0x31f,0x32b,0x29d)](_0x82d991['hXSre'],_0x4a3085),_0x4a3085;}function extractCharacterTags(_0x199121){function _0x504f5a(_0x29fb69,_0x46cafa,_0x306d47,_0x82bdef){return _0x29670b(_0x29fb69- -0x6e1,_0x46cafa-0x4f,_0x46cafa,_0x82bdef-0xcd);}const _0x4a98fc={'LQTfb':function(_0x392666,_0x4ddc58){return _0x392666(_0x4ddc58);},'JXBMT':function(_0x177896,_0x3a00d1){return _0x177896===_0x3a00d1;},'gVyTE':_0x312be1(0x11c,0x132,0x94,0xdf),'PzwwE':function(_0x351b27,_0x2afd0b){return _0x351b27===_0x2afd0b;},'fMido':_0x312be1(0x124,0x18e,0x103,0xb7)},_0x1bebad={};_0x1bebad[_0x312be1(0xc3,0x180,0x159,0xb9)]=[];const _0xf1420c=_0x1bebad;_0x199121=_0x199121[_0x504f5a(-0x129,-0x85,-0x96,-0x1bb)](/<thinking>[\s\S]*?<\/thinking>/gi,'')[_0x312be1(0xbc,0x14e,0xd0,0x90)]();const _0x396d87=/<人物>([\s\S]*?)<\/人物>/g;let _0x53dad7;while((_0x53dad7=_0x396d87[_0x504f5a(-0x1b5,-0x14d,-0x26f,-0x267)](_0x199121))!==null){if(_0x4a98fc[_0x312be1(0x11,0x7c,-0x5f,0xc3)](_0x4a98fc[_0x312be1(0x14,-0x4c,0xbf,-0xf)],_0x4a98fc[_0x504f5a(-0x1d4,-0x142,-0x169,-0x189)])){const _0x1522b8=_0x4a98fc[_0x312be1(0x12c,0x147,0x175,0x89)](preprocessTagContent,_0x53dad7[-0xe1e*-0x1+-0x1489+0x66c]),_0x5b935b=_0x4a98fc['LQTfb'](parseCharacterData,_0x1522b8);_0x5b935b&&(_0x4a98fc[_0x504f5a(-0x1a0,-0x1aa,-0x179,-0x102)](_0x4a98fc['fMido'],_0x504f5a(-0x114,-0x1cf,-0xd4,-0x1a8))?_0x4a98fc['LQTfb'](_0x21b439,_0x551ab2['result']):_0xf1420c[_0x312be1(0xc3,0x119,0x119,0xcf)][_0x312be1(0x89,0x10a,0x107,0x2b)](_0x5b935b));}else _0x305e7e[_0x100635]&&(_0x49b581[_0x1cd5fa]=_0x459f73[_0x136aa1]);}function _0x312be1(_0x2a971f,_0x1ffe96,_0x400a25,_0x4aff1a){return _0x29670b(_0x2a971f- -0x4f9,_0x1ffe96-0xf4,_0x400a25,_0x4aff1a-0x60);}return _0xf1420c;}function getCurrentCharacterPreset(){const _0x4e1c79=extension_settings[extensionName];function _0x46ae10(_0x35b052,_0x3685e2,_0x319136,_0x2f50ae){return _0x29670b(_0x35b052- -0x668,_0x3685e2-0x116,_0x2f50ae,_0x2f50ae-0x185);}const _0x328dab=_0x4e1c79[_0x11ba26(0x6c1,0x5a2,0x692,0x62e)+_0x46ae10(-0x130,-0x1b0,-0x14f,-0x16e)];if(!_0x328dab||!_0x4e1c79['characterP'+_0x46ae10(-0xbe,-0x111,-0xbb,-0x134)][_0x328dab])return null;function _0x11ba26(_0x308fde,_0x121a18,_0xf75466,_0x3a041c){return _0x29670b(_0x3a041c-0x68,_0x121a18-0x1bc,_0x308fde,_0x3a041c-0x16c);}const _0x5bfa49={};return _0x5bfa49['id']=_0x328dab,_0x5bfa49[_0x46ae10(-0x115,-0x93,-0xe1,-0xda)]=_0x4e1c79[_0x46ae10(-0xa2,0x20,-0x7d,-0x16)+'resets'][_0x328dab],_0x5bfa49;}function buildCharacterText(_0x301556){const _0x5a1b10={};_0x5a1b10['LLgcF']=_0x347958(0x187,0x1ea,0x249,0x242);const _0x37d087=_0x5a1b10,_0x431879=_0x301556[_0x31293c(0x5f,0x93,-0x4,0xaf)];function _0x31293c(_0x1272af,_0xad2565,_0x2722dd,_0x19988e){return _0x29670b(_0x2722dd- -0x557,_0xad2565-0x19f,_0x1272af,_0x19988e-0x1e7);}function _0x347958(_0x3c18a8,_0xd280e8,_0x318f16,_0x1fa06b){return _0x29670b(_0x318f16- -0x3ad,_0xd280e8-0x157,_0xd280e8,_0x1fa06b-0x31);}let _0x416e64=_0x37d087[_0x347958(0x238,0x170,0x185,0x196)];return _0x416e64+=_0x31293c(-0x33,0x3,-0x63,-0x8)+(_0x431879[_0x347958(0x11e,0x159,0x1ae,0x211)]||'')+'\x0a',_0x416e64+=_0x347958(0x305,0x2b0,0x24e,0x260)+(_0x431879[_0x31293c(0x82,-0x1b,0x78,0x120)]||'')+'\x0a',_0x416e64+=_0x347958(0x2a3,0x262,0x274,0x1e4)+(_0x431879['facialFeat'+'ures']||'')+'\x0a',_0x416e64+='五官外貌背面:\x20'+(_0x431879[_0x31293c(-0x4e,0x44,0x1b,0x6c)+_0x31293c(-0x1d,0x18,-0x1c,-0x6b)]||'')+'\x0a',_0x416e64+='上半身SFW:\x20'+(_0x431879[_0x31293c(-0x2e,0x4,-0x75,-0xa3)+'FW']||'')+'\x0a',_0x416e64+=_0x347958(0x17d,0x287,0x1e8,0x156)+(_0x431879[_0x31293c(-0x6,0x25,-0x75,0x1d)+'FWBack']||'')+'\x0a',_0x416e64+=_0x347958(0x186,0x1c4,0x171,0x124)+(_0x431879[_0x31293c(0x88,-0x1a,0xa1,0x15a)+'W']||'')+'\x0a',_0x416e64+=_0x31293c(0x85,0x13b,0x8d,0x45)+(_0x431879[_0x347958(0x1ee,0x189,0x24b,0x207)+_0x31293c(0x83,0xef,0xd4,0xc5)]||'')+'\x0a',_0x416e64+=_0x31293c(0x2d,0x7,-0x49,-0x3b)+(_0x431879[_0x347958(0x1f4,0x320,0x27a,0x2a7)+_0x347958(0x244,0x325,0x297,0x276)]||'')+'\x0a',_0x416e64+=_0x347958(0x219,0x32e,0x26f,0x263)+'\x20'+(_0x431879['upperBodyN'+_0x31293c(0x2e,0x92,0x49,0x1c)]||'')+'\x0a',_0x416e64+=_0x31293c(-0x85,-0xde,-0x7c,-0xa4)+(_0x431879[_0x31293c(0x88,0xe1,0xd2,0x18d)+'FW']||'')+'\x0a',_0x416e64+=_0x31293c(0x80,-0x7c,0x3,0x76)+'\x20'+(_0x431879[_0x31293c(0x11e,0xef,0xd2,0x92)+_0x31293c(-0x1d,-0xf2,-0x54,-0x84)]||'')+'\x0a',_0x416e64+=_0x31293c(-0x11,-0x4,0x36,-0x27),_0x416e64;}export async function handleCharacterPromptModify(_0x19ced4,_0x114896=[]){const _0x6d27c3={'kgHPV':'(空)','fFUUK':_0x22a15e(0x16e,0x199,0x160,0x102),'JlHTc':function(_0x608eb2,_0xc708d1){return _0x608eb2(_0xc708d1);},'LRRCB':_0x128d3c(0xc8,0x158,0x180,0xae)+_0x128d3c(0x70,0x82,0x118,0x6c)+_0x22a15e(0x127,0xd6,0xa0,0x1ab)+'ng\x20charact'+_0x128d3c(0x101,0xfd,0x43,0x1ac)+_0x22a15e(0x121,0xf2,0x167,0x158)+_0x128d3c(0x138,0xce,0x157,0x183),'kFvCP':'[character'+_0x22a15e(0xb6,0x122,0xfd,0xc2)+_0x22a15e(0x1af,0x12b,0x1b6,0x142)+_0x22a15e(0x98,0xbe,0x2d,0x88),'XpPTN':function(_0x53587d,_0xeccfd6){return _0x53587d===_0xeccfd6;},'WUtPi':_0x128d3c(-0x1b,0x84,0x60,0x10e),'IPZwi':function(_0x5ab06a){return _0x5ab06a();},'zxmCa':_0x22a15e(0x9c,0xeb,0x74,0x46),'gWOfZ':'[character'+_0x22a15e(0xb6,0x142,0x170,0xdf)+_0x128d3c(0x72,0x114,0xf7,0xbb)+'t\x20preset:','OjUmi':_0x22a15e(0x18c,0xd9,0x1fc,0x1cf)+'PromptModi'+_0x128d3c(0x1fb,0x17c,0x19a,0x21f)+_0x128d3c(-0x1e,0x7f,0x125,-0x18),'TVDip':_0x22a15e(0x18c,0x178,0x235,0x15d)+_0x22a15e(0xb6,0x8f,0x129,0x9f)+_0x22a15e(0x1b0,0x26a,0x1c0,0x1da)+_0x22a15e(0x19b,0x14d,0x187,0x20c),'HiSYb':function(_0x5a6968,_0x3b5763){return _0x5a6968||_0x3b5763;},'GorGz':function(_0x15fa5b,_0x136409){return _0x15fa5b!==_0x136409;},'fuSgR':_0x128d3c(0x1df,0x175,0x13a,0x1f6),'WIzrn':_0x22a15e(0x1bc,0x266,0x1d5,0x15a),'vJZom':_0x22a15e(0x18c,0x1a8,0xde,0x1f1)+_0x128d3c(0xfe,0x82,0x36,0x116)+'fy]\x20Charac'+_0x22a15e(0x176,0xd8,0x15b,0xbd)+_0x22a15e(0x116,0x19a,0x1b7,0x19a),'yCZsr':function(_0x4cc94f,_0x3ac264,_0x3b54a2){return _0x4cc94f(_0x3ac264,_0x3b54a2);},'oSaLB':'char_modif'+'y','EYxgs':function(_0x3e8de5,_0x53d57b){return _0x3e8de5(_0x53d57b);},'DGSft':function(_0x4523e3,_0x3d9a3c){return _0x4523e3(_0x3d9a3c);},'RVjuC':_0x22a15e(0x18c,0xee,0x164,0x21d)+_0x22a15e(0xb6,0x168,0x19,0x4f)+'fy]\x20合并相邻消息'+'后:','xVnFq':'{{用户需求}}','ImUcl':function(_0x5de400,_0x1677a1,_0x26b4d2){return _0x5de400(_0x1677a1,_0x26b4d2);},'vUnur':function(_0x590365,_0x42841c,_0x142c19,_0x11981d,_0x1e4836){return _0x590365(_0x42841c,_0x142c19,_0x11981d,_0x1e4836);},'SaAeK':_0x22a15e(0xe6,0xc0,0xac,0x125),'TIKic':'[character'+_0x22a15e(0xb6,0x88,0x67,0x114)+_0x22a15e(0x206,0x266,0x29f,0x29a)+_0x128d3c(0x155,0x105,0x4e,0x170),'JWsWE':function(_0x40d5cd,_0x365d8b){return _0x40d5cd>_0x365d8b;},'agPZt':_0x22a15e(0x190,0x14b,0x1a5,0x161),'syYtX':function(_0xc4418a,_0x2b5ff9){return _0xc4418a>_0x2b5ff9;},'WyexL':function(_0x166302,_0x3c99ff){return _0x166302>=_0x3c99ff;},'uuOim':function(_0x29be5a,_0x366508,_0x168a1e,_0x5a2e24,_0x4c7d79){return _0x29be5a(_0x366508,_0x168a1e,_0x5a2e24,_0x4c7d79);},'xpvaP':'参考图片','ehDIz':_0x22a15e(0x112,0xc6,0x186,0x19d)+_0x22a15e(0x17f,0x15a,0x15b,0x1d2)+_0x22a15e(0xca,0x15b,0xe6,0x19),'cQRvE':_0x22a15e(0x18c,0x23f,0x1be,0x19a)+'PromptModi'+'fy]\x20LLM\x20ou'+'tput:','WZHGn':_0x22a15e(0x15f,0x1e0,0x1b2,0x112),'midbW':_0x128d3c(0xdb,0x141,0xe0,0x163),'FNZMP':_0x22a15e(0x17a,0x161,0x1ae,0x16d)+'检测到角色标签','krRUs':_0x128d3c(0x1d6,0x158,0xe1,0xb3)+_0x128d3c(-0x35,0x82,0x13f,0xd3)+_0x128d3c(0x1d5,0x12a,0x133,0x11b)+'M\x20output\x20f'+_0x22a15e(0xd1,0xbf,0xb9,0x17d)+'ng:','WHQOH':'[character'+'PromptModi'+_0x22a15e(0x1db,0x259,0x146,0x159)+_0x22a15e(0x19d,0x245,0x241,0xf9),'sKNIp':_0x22a15e(0x214,0x1a9,0x262,0x2b1),'MhnQc':function(_0x4544de,_0x1a8f9b){return _0x4544de===_0x1a8f9b;},'LOsZw':_0x22a15e(0x1b1,0x179,0x101,0x116),'OasbH':_0x22a15e(0x18c,0xf9,0x13e,0x1b8)+_0x22a15e(0xb6,0x6a,0x15a,0xa5)+_0x22a15e(0xde,0x9b,0xee,0x133)};function _0x128d3c(_0x45d082,_0x47f052,_0xb1228a,_0x1859e1){return _0x29670b(_0x47f052- -0x465,_0x47f052-0x95,_0x1859e1,_0x1859e1-0x1d6);}console[_0x22a15e(0x20d,0x1b8,0x1c2,0x22c)](_0x6d27c3[_0x22a15e(0xa3,0x158,0x14,0x122)]),toastr[_0x22a15e(0xa7,0x10e,0x81,0xed)](_0x6d27c3[_0x22a15e(0x208,0x1f8,0x1fc,0x15e)]);function _0x22a15e(_0x48d8cd,_0x16e748,_0x2e0e70,_0x4d1359){return _0x29670b(_0x48d8cd- -0x431,_0x16e748-0x153,_0x4d1359,_0x4d1359-0x105);}try{if(_0x6d27c3[_0x22a15e(0x185,0x203,0x1cc,0xec)](_0x6d27c3['WUtPi'],_0x22a15e(0x106,0x108,0x19d,0x164)))return _0x211a1a['randomUUID']();else{const _0x117093=getContext(),_0x26fd9e=extension_settings[extensionName],_0x31cc24=_0x6d27c3['IPZwi'](getCurrentCharacterPreset);if(!_0x31cc24){toastr['error'](_0x6d27c3[_0x128d3c(0x118,0x197,0x147,0x21f)]);return;}console[_0x128d3c(0x118,0x1d9,0x1e3,0x1b0)](_0x6d27c3['gWOfZ'],_0x31cc24['id']);const _0x578866=_0x31cc24['data'][_0x22a15e(0x1ee,0x23f,0x1b8,0x203)+_0x22a15e(0xbd,0x120,0x5d,0x2f)]||'',_0x275795=_0x31cc24[_0x22a15e(0x122,0x6b,0x149,0x10b)][_0x128d3c(0xf7,0x1ba,0x16f,0x239)+'WorldBook']||'',_0x57f86b=_0x31cc24[_0x22a15e(0x122,0x14b,0x61,0x1be)][_0x22a15e(0x1ee,0x274,0x173,0x231)+_0x128d3c(0xd1,0xf1,0x129,0x193)]||{};console['log'](_0x6d27c3['OjUmi'],_0x578866),console['log'](_0x22a15e(0x18c,0x1e6,0x159,0x1e8)+_0x128d3c(0xb3,0x82,0x118,-0x28)+_0x128d3c(0xdf,0x17c,0x1d9,0x19a)+_0x22a15e(0x12e,0xaa,0x1df,0x172)+':',_0x275795),console['log'](_0x6d27c3[_0x22a15e(0x202,0x227,0x265,0x2bb)],_0x57f86b);const _0x3c6fc8=_0x6d27c3['HiSYb'](_0x19ced4,''),_0x47214e=[];if(_0x19ced4){if(_0x6d27c3[_0x128d3c(0x182,0x1b5,0x265,0x23b)](_0x6d27c3[_0x128d3c(0x148,0x1b4,0x1b3,0x1f8)],_0x6d27c3[_0x128d3c(0x5f,0xc9,0x16c,0xe7)]))_0x47214e[_0x128d3c(0xf5,0x11d,0x9c,0xac)](_0x19ced4);else{if(_0x56b11f[_0x2bc8c8]&&_0x40826e[_0x1b7cdc]!==_0x57e8cd[_0x4c9dd3]){const _0xad0a22=_0x61d961[_0x22cb4b]||_0x6d27c3['kgHPV'],_0x45463a=_0x5b5dc4[_0x55a2b7];_0x121e06+='•\x20'+_0x129291[_0x1ad9f7]+':\x0a',_0x1afbd2+='\x20\x20旧:\x20'+_0xad0a22[_0x22a15e(0x1cc,0x10f,0x188,0x1fc)](-0xbf0+0x14f3+0x1*-0x903,0x4*0x62e+-0x153c+-0x34a)+(_0xad0a22['length']>0x149*0x12+0x79c+0x73*-0x44?_0x22a15e(0x16e,0xfc,0x166,0xc3):'')+'\x0a',_0x40918b+=_0x22a15e(0x10c,0x100,0x11e,0x18b)+_0x45463a[_0x128d3c(0x108,0x198,0x200,0x148)](0x1df2+-0xe04+-0xfee,-0x1*0x463+0xbe7+-0x1*0x752)+(_0x45463a['length']>-0x148a+-0x1355+0x1*0x2811?_0x6d27c3[_0x128d3c(0x125,0xf2,0xca,0xed)]:'')+'\x0a\x0a',_0x4863b8++;}}}_0x578866&&_0x47214e[_0x22a15e(0x151,0xd9,0xea,0x1bb)](_0x578866);_0x275795&&_0x47214e[_0x128d3c(0x73,0x11d,0xc5,0x135)](_0x275795);const _0x2a7ea5=_0x47214e[_0x128d3c(0x17a,0x10c,0x151,0x7e)]('\x0a');console[_0x128d3c(0x1d4,0x1d9,0x173,0x1ba)](_0x6d27c3['vJZom'],_0x2a7ea5);let _0x2f07aa=_0x6d27c3['yCZsr'](buildPromptForRequestType,_0x6d27c3[_0x22a15e(0x1a7,0x112,0xec,0x173)],_0x3c6fc8);const _0x4d1682=_0x6d27c3[_0x128d3c(0x126,0x119,0x1aa,0xcf)](generateCharacterListText,_0x2a7ea5),_0x2fea09=_0x6d27c3['IPZwi'](generateOutfitEnableListText),_0x670462=_0x6d27c3[_0x22a15e(0x11a,0x9c,0xda,0xea)](generateCommonCharacterListText);console[_0x22a15e(0x20d,0x184,0x252,0x1a1)]('[character'+_0x22a15e(0xb6,0x25,0x136,0x90)+'fy]\x20Charac'+'ter\x20list\x20t'+_0x128d3c(0x1cb,0x1ae,0x185,0x229)+_0x22a15e(0xb4,0x129,0x117,0x163),_0x4d1682);const _0x1feb06=_0x117093['chatMetada'+'ta']?.[_0x22a15e(0xcb,0xa8,0xee,0x14a)]||{},_0x25be1f=_0x6d27c3[_0x22a15e(0xfa,0x172,0x161,0x194)](buildCharacterText,_0x31cc24);_0x2f07aa=_0x6d27c3[_0x22a15e(0x14d,0x179,0x19f,0xbd)](mergeAdjacentMessages,_0x2f07aa),console[_0x22a15e(0x20d,0x197,0x258,0x20a)](_0x6d27c3['RVjuC'],_0x2f07aa);const _0x18c3d1=findMessageIndexWithPlaceholder(_0x2f07aa,_0x6d27c3[_0x22a15e(0x153,0xad,0x1f7,0x19c)]);console[_0x128d3c(0x144,0x1d9,0x236,0x167)]('[character'+'PromptModi'+_0x128d3c(0x1bb,0x1a6,0x111,0x237)+_0x22a15e(0xd8,0xe3,0x7f,0x28)+_0x22a15e(0x132,0x1b3,0x9d,0x124)+_0x128d3c(0x159,0x18f,0xe5,0x21b),_0x18c3d1);const _0x3495d3={..._0x57f86b,..._0x1feb06},_0x3d0317={};_0x3d0317[_0x128d3c(0x175,0x192,0x1f3,0xf3)]=_0x578866,_0x3d0317['worldBookC'+_0x128d3c(0x52,0x9b,0xd2,0x38)]=_0x275795,_0x3d0317[_0x22a15e(0xcb,0x67,0x119,0xa0)]=_0x3495d3,_0x3d0317[_0x22a15e(0x156,0xe9,0x114,0x212)]=_0x19ced4||'',_0x3d0317['characterL'+_0x22a15e(0x11c,0x6d,0xfd,0x147)]=_0x4d1682,_0x3d0317[_0x128d3c(0x66,0xe3,0x12e,0x138)+_0x22a15e(0xf1,0x141,0x161,0x103)]=_0x2fea09,_0x3d0317['commonChar'+_0x128d3c(0x148,0xd1,0x3c,0x28)+'ext']=_0x670462;const _0x159b41=_0x3d0317,{messages:_0xe104f5,replacedVariables:_0x5d2d5c}=_0x6d27c3[_0x22a15e(0x199,0x1a9,0x22e,0x136)](replaceAllPlaceholders,_0x2f07aa,_0x159b41);_0x2f07aa=_0xe104f5,_0x2f07aa=_0x6d27c3['vUnur'](_0x26d04f,_0x2f07aa,_0x6d27c3[_0x128d3c(0x180,0x1d1,0x284,0x24b)],_0x25be1f,_0x5d2d5c),console['log'](_0x6d27c3['TIKic'],_0x2f07aa);let _0x234b7e='';if(_0x6d27c3[_0x128d3c(0x139,0x1e7,0x150,0x283)](_0x5d2d5c[_0x22a15e(0x11d,0x84,0x12a,0x121)],-0x1b4b+0x2703+-0xbb8)){if(_0x6d27c3[_0x128d3c(-0x28,0x66,-0x37,-0x34)]!==_0x22a15e(0x1a0,0x188,0x259,0x115))_0x234b7e=_0x128d3c(0x17c,0x12d,0x109,0xe7)+_0x22a15e(0x10d,0x101,0x124,0x64)+[..._0x5d2d5c][_0x22a15e(0x140,0x121,0x14e,0x122)]('、')+'\x0a';else{_0x398f61['error']('找不到指定的角色预设');return;}}_0x114896&&_0x6d27c3['syYtX'](_0x114896[_0x128d3c(0xda,0x90,0x98,0x9d)],-0x206d+0x1*-0x1449+0xad*0x4e)&&_0x6d27c3[_0x22a15e(0xf4,0xd2,0x15e,0x17c)](_0x18c3d1,0x73*-0x2f+0x283*-0xb+0x30be)&&(_0x2f07aa=_0x6d27c3[_0x128d3c(0x20a,0x14c,0x105,0x142)](attachImagesToMessage,_0x2f07aa,_0x18c3d1,_0x114896,_0x6d27c3[_0x22a15e(0x138,0x1e5,0xde,0x1d2)]),console[_0x22a15e(0x20d,0x1e5,0x277,0x1c2)](_0x22a15e(0x18c,0x20c,0x151,0x17a)+'PromptModi'+'fy]\x20Attach'+'ed',_0x114896[_0x22a15e(0xc4,0xe3,0x7b,0xdc)],_0x6d27c3['ehDIz'],_0x18c3d1));updateCombinedPrompt(_0x2f07aa,_0x234b7e);const _0x1a4825={};_0x1a4825[_0x128d3c(0x91,0xc4,0x9c,0x14c)]=0x493e0;const _0x1d122c=await _0x6d27c3[_0x128d3c(0x10e,0x165,0x1ef,0x1cc)](LLM_CHAR_MODIFY,_0x2f07aa,_0x1a4825);console[_0x128d3c(0x241,0x1d9,0x20c,0x148)](_0x6d27c3['cQRvE'],_0x1d122c);if(!_0x1d122c){if(_0x6d27c3['GorGz'](_0x6d27c3['WZHGn'],_0x128d3c(0x1e2,0x160,0x196,0x11d))){toastr[_0x128d3c(0x235,0x194,0x216,0x167)](_0x6d27c3[_0x128d3c(0x178,0x1e8,0x1c9,0x281)]);return;}else{const _0x2ce250={'FWtvJ':function(_0x39e767,_0x200b9a){return _0x39e767!==_0x200b9a;},'iGEqC':function(_0x1c04ee,_0x108be1){function _0x4d10ce(_0xf431d4,_0x200f65,_0x451867,_0x246a32){return _0x128d3c(_0xf431d4-0x79,_0xf431d4-0x4de,_0x451867-0x1b4,_0x246a32);}return _0x6d27c3[_0x4d10ce(0x580,0x57e,0x4d1,0x52e)](_0x1c04ee,_0x108be1);}},_0x169add=_0x569c9d();_0x66a529[_0x128d3c(0x19a,0x1d9,0x1d4,0x293)](_0x22a15e(0x18c,0x1b5,0xd3,0x115)+_0x22a15e(0xb6,0x28,0xae,0x169)+_0x128d3c(0x169,0x1a2,0x23c,0x223)+_0x128d3c(0x153,0xac,0x14c,0x16a)+_0x128d3c(0x11b,0x10a,0x88,0x15e)+_0x22a15e(0xc5,0x11a,0x39,0x63)+_0x169add+')');const _0x54cc29=_0x5e60e9=>{if(_0x2ce250[_0x57b149(-0x10,-0xa9,0x10,0x5b)](_0x5e60e9['id'],_0x169add))return;function _0x57b149(_0x3a5621,_0x4ba0fd,_0x2c5a54,_0x320dd9){return _0x22a15e(_0x2c5a54- -0x13c,_0x4ba0fd-0x132,_0x2c5a54-0x26,_0x4ba0fd);}_0x8d74ed[_0x3ecd13(0x1b3,0x199,0x244,0x1f1)+_0x57b149(0x3d,0x124,0xb5,0x6d)](_0x329e19[_0x3ecd13(0x250,0x215,0x1c5,0x271)+_0x57b149(0xa4,0x12b,0x7d,0x35)+_0x3ecd13(0x1c6,0x20c,0x271,0x17a)+_0x57b149(0xac,0xdd,0x41,0x2c)],_0x54cc29);function _0x3ecd13(_0x298c9d,_0x5d3002,_0x455214,_0x1d37fc){return _0x22a15e(_0x298c9d-0x5e,_0x5d3002-0x70,_0x455214-0xa,_0x1d37fc);}_0x2ce250[_0x3ecd13(0x124,0x16e,0x1ca,0x16c)](_0x127826,_0x5e60e9[_0x3ecd13(0x1a7,0x26a,0x1a4,0x23c)]);};_0x38cb0a['on'](_0x33a8da[_0x22a15e(0x1f2,0x2ac,0x143,0x163)+'ODIFY_GET_'+'PROMPT_RES'+'PONSE'],_0x54cc29);const _0x1fcfe9={};_0x1fcfe9['id']=_0x169add,_0xcd6c19[_0x22a15e(0x197,0x10b,0x14c,0x1c5)](_0x38c696[_0x22a15e(0x1f2,0x1ae,0x26a,0x1cf)+_0x128d3c(0x140,0x185,0x11d,0x248)+'PROMPT_REQ'+'UEST'],_0x1fcfe9),_0x15d3a2(()=>{function _0x2e10d3(_0x2558bc,_0x23a3c7,_0x1e7582,_0x1231c8){return _0x128d3c(_0x2558bc-0x1e7,_0x2558bc-0x1bb,_0x1e7582-0x107,_0x1e7582);}_0x213d34['removeList'+_0x292d8e(0x3b7,0x322,0x2e1,0x3d0)](_0x1334ae['LLM_CHAR_M'+_0x292d8e(0x369,0x2ea,0x2ba,0x24f)+_0x292d8e(0x253,0x299,0x34c,0x29a)+'PONSE'],_0x54cc29);function _0x292d8e(_0x1721c5,_0x39288a,_0x1beb2b,_0x5a90d5){return _0x128d3c(_0x1721c5-0x16e,_0x39288a-0x165,_0x1beb2b-0x5d,_0x1beb2b);}_0x6d27c3[_0x292d8e(0x29b,0x207,0x19e,0x20f)](_0x31346d,new _0x4f1dcf('获取角色修改提示词超'+'时'));},0xa22+-0x1eb6+0x16*0x2b6);}}const _0x5dfb63=_0x6d27c3['DGSft'](extractCharacterTags,_0x1d122c);if(_0x6d27c3[_0x128d3c(0x1ae,0x151,0x1b5,0x140)](_0x5dfb63['characters'][_0x22a15e(0xc4,0x91,0x31,0xf3)],-0x25f3+-0x53*0x4f+0x3f90)){toastr[_0x22a15e(0x191,0x1a8,0x18f,0x209)](_0x6d27c3[_0x128d3c(0xb4,0x6a,0xe5,0x20)]),console['log'](_0x128d3c(0x15f,0x158,0x9e,0x1ec)+_0x128d3c(-0x2f,0x82,0x3,0x117)+'fy]\x20No\x20cha'+_0x128d3c(0x134,0x126,0x1b4,0xe0)+_0x128d3c(0x1cc,0x1e2,0x1b2,0x295)+_0x22a15e(0xe3,0x148,0x6d,0x150)),console[_0x22a15e(0x20d,0x275,0x231,0x29c)](_0x6d27c3['krRUs'],_0x1d122c);return;}console[_0x128d3c(0x132,0x1d9,0x250,0x173)](_0x6d27c3[_0x22a15e(0x10e,0x16e,0x152,0x1a7)],_0x5dfb63);const _0x273841=_0x5dfb63[_0x128d3c(0x13d,0x157,0x1e6,0x179)][0x237c+0xe79*0x1+-0x31f5];await updateCharacterPresetFromLLM(_0x31cc24['id'],_0x273841),toastr[_0x22a15e(0x13c,0xd1,0x17c,0xe8)](_0x6d27c3[_0x128d3c(0x1f0,0x135,0x1f5,0x1e9)]);}}catch(_0x316243){if(_0x6d27c3[_0x22a15e(0x150,0xaf,0x16b,0x170)](_0x22a15e(0x1b1,0x1ec,0x177,0x19d),_0x6d27c3[_0x22a15e(0x201,0x193,0x1a2,0x1ff)]))console[_0x128d3c(0x136,0x194,0x133,0x1c0)](_0x6d27c3[_0x128d3c(0x1f7,0x1cb,0x268,0x25a)],_0x316243),toastr[_0x128d3c(0x24d,0x194,0xe0,0xfe)](_0x22a15e(0xec,0x8d,0x157,0x144)+'\x20'+_0x316243[_0x22a15e(0x104,0x175,0x185,0x5b)]);else{_0x2e94e2[_0x22a15e(0xa7,0x13d,-0x2,0xf8)](_0x128d3c(0x96,0x133,0xa8,0x138));return;}}}function _0x4dc7(_0x5ce96d,_0x2d1a33){_0x5ce96d=_0x5ce96d-(-0x1e5c+-0x44a*-0x4+0xefc);const _0x48cf49=_0x559b();let _0x43be71=_0x48cf49[_0x5ce96d];if(_0x4dc7['KAWgRO']===undefined){var _0x14e60c=function(_0x26b703){const _0x29ae92='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x27e1e2='',_0x55636d='',_0x523c87=_0x27e1e2+_0x14e60c;for(let _0x411b34=0xc54*0x2+-0x4*-0x368+-0x2648,_0x488922,_0x48031b,_0x433daa=-0x7e1*-0x2+-0x35*0x19+0x9*-0x12d;_0x48031b=_0x26b703['charAt'](_0x433daa++);~_0x48031b&&(_0x488922=_0x411b34%(0xa2a+-0x7*0x166+0x4*-0x17)?_0x488922*(0x3b2+-0x1231+0xebf)+_0x48031b:_0x48031b,_0x411b34++%(-0x233d+-0x12ed*0x1+0x362e))?_0x27e1e2+=_0x523c87['charCodeAt'](_0x433daa+(-0x268a+0x1*0x3f+0x2655))-(-0x1955*0x1+-0x8e*0x37+-0x1*-0x37e1)!==0x2*-0x1088+0x1855*0x1+0x1*0x8bb?String['fromCharCode'](-0xaee*0x3+0x7c2*0x4+0x2c1&_0x488922>>(-(0x1488+0x235*-0xe+0xa60)*_0x411b34&-0x5*-0x45b+-0x4f4+-0x17*0xbb)):_0x411b34:-0x1191+-0x1888+0x2a19){_0x48031b=_0x29ae92['indexOf'](_0x48031b);}for(let _0x1408e0=0x7*-0x2c+0x1c1b+-0x61*0x47,_0x39d060=_0x27e1e2['length'];_0x1408e0<_0x39d060;_0x1408e0++){_0x55636d+='%'+('00'+_0x27e1e2['charCodeAt'](_0x1408e0)['toString'](0x23e2+0x1b84+-0x3f56))['slice'](-(0xcd*0x27+-0xba7+-0x1392));}return decodeURIComponent(_0x55636d);};_0x4dc7['oWaVtR']=_0x14e60c,_0x4dc7['mlDYwV']={},_0x4dc7['KAWgRO']=!![];}const _0x6350cd=_0x48cf49[-0xe*0x15a+0x1c9a+-0x9ae],_0x36cdf3=_0x5ce96d+_0x6350cd,_0x2f64dc=_0x4dc7['mlDYwV'][_0x36cdf3];if(!_0x2f64dc){const _0x3b868d=function(_0x59304c){this['wyAhkx']=_0x59304c,this['NRhskI']=[-0xfbb*-0x2+0x26af*0x1+-0x4*0x1189,-0x6e6+0x3b*0x99+-0x1c5d,0x4ac+-0x1533+0x1087],this['wqvALQ']=function(){return'newState';},this['iMSxfS']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['alnKvy']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x3b868d['prototype']['wsygQE']=function(){const _0x150f01=new RegExp(this['iMSxfS']+this['alnKvy']),_0xc0e83a=_0x150f01['test'](this['wqvALQ']['toString']())?--this['NRhskI'][0x17e8+0x1faf*-0x1+-0x1f2*-0x4]:--this['NRhskI'][-0x6a4+-0x2676+0x2d1a];return this['YTfTsf'](_0xc0e83a);},_0x3b868d['prototype']['YTfTsf']=function(_0x209f93){if(!Boolean(~_0x209f93))return _0x209f93;return this['UDYdfT'](this['wyAhkx']);},_0x3b868d['prototype']['UDYdfT']=function(_0xdc78ec){for(let _0x3080c1=-0x104c+-0xc7b+0x8b*0x35,_0x554242=this['NRhskI']['length'];_0x3080c1<_0x554242;_0x3080c1++){this['NRhskI']['push'](Math['round'](Math['random']())),_0x554242=this['NRhskI']['length'];}return _0xdc78ec(this['NRhskI'][0x3*0x47+0x1*0xcdf+-0x4*0x36d]);},new _0x3b868d(_0x4dc7)['wsygQE'](),_0x43be71=_0x4dc7['oWaVtR'](_0x43be71),_0x4dc7['mlDYwV'][_0x36cdf3]=_0x43be71;}else _0x43be71=_0x2f64dc;return _0x43be71;}async function updateCharacterPresetFromLLM(_0x5a6bc8,_0x44b44b){const _0x5ab3a0={'ouapZ':_0x3ac341(0x59e,0x621,0x569,0x61b)+_0x3ac341(0x53c,0x4dc,0x589,0x562),'qHaWI':function(_0x16d7f8,_0x120548){return _0x16d7f8!==_0x120548;},'LfrKr':function(_0x955a51,_0x585e88){return _0x955a51(_0x585e88);},'iBZSz':'找不到指定的角色预设','nOpaa':_0x3ac341(0x531,0x545,0x568,0x57c),'Dyzkt':'英文名称','aUqyx':_0x1d5679(0x68,0x82,-0x17,-0x38),'uSFGP':_0x1d5679(0x53,0x11,-0x43,0xb8),'qEIWH':'下半身SFW','vDupt':_0x3ac341(0x529,0x615,0x551,0x56f),'EcajJ':'上半身NSFW背面','CcOmE':_0x3ac341(0x5d1,0x5bc,0x6ca,0x674),'YoWAM':_0x3ac341(0x550,0x626,0x5a3,0x5d7),'YZyom':function(_0x4fb7e2,_0x260e2c){return _0x4fb7e2===_0x260e2c;},'wfAKi':_0x3ac341(0x6d9,0x5cb,0x5df,0x687),'Iaqxo':_0x1d5679(0x76,0x48,0x28,0xb2),'kIRqY':function(_0x4ea89e,_0x416fd8){return _0x4ea89e>_0x416fd8;},'SgnVP':_0x3ac341(0x555,0x64d,0x654,0x60f),'pQavM':function(_0x576d1e,_0x13e5ac){return _0x576d1e===_0x13e5ac;},'yomqh':'qORnS','hbDoG':_0x1d5679(0x14f,0x99,0xc4,0x4),'Iomts':_0x3ac341(0x609,0x689,0x599,0x5fc)+'内容','bKLpK':function(_0x54e11c,_0x339674){return _0x54e11c(_0x339674);},'zvmDO':function(_0x5a4a92,_0x1bb5fa){return _0x5a4a92(_0x1bb5fa);},'QXKim':_0x3ac341(0x521,0x4e0,0x51c,0x580)+_0x3ac341(0x520,0x52c,0x612,0x582)+_0x1d5679(-0x27,0x4f,0x18,0x104),'fIBZE':_0x3ac341(0x6aa,0x68d,0x57a,0x5f3),'LvtKI':function(_0x103859,_0x183b40){return _0x103859(_0x183b40);}},_0x3824a6=extension_settings[extensionName],_0x2474e0=_0x3824a6[_0x3ac341(0x5f3,0x5c3,0x66e,0x636)+_0x1d5679(0x160,0xcf,0x109,0x22)][_0x5a6bc8];if(!_0x2474e0){toastr[_0x3ac341(0x700,0x717,0x6e3,0x669)](_0x5ab3a0['iBZSz']);return;}let _0xd6693c=_0x3ac341(0x6db,0x649,0x6b7,0x64b)+_0x5a6bc8+_0x1d5679(0x41,0x90,-0x16,0x95);const _0x4ad9ff={};_0x4ad9ff[_0x1d5679(0xd5,0x80,0x5d,0xe4)]=_0x5ab3a0[_0x1d5679(0x3e,0x9a,0x155,0x13a)],_0x4ad9ff[_0x3ac341(0x6f9,0x6d2,0x683,0x63f)]=_0x5ab3a0[_0x1d5679(0x118,0x59,0x5b,-0x4a)],_0x4ad9ff[_0x1d5679(0x19,0x97,0x6a,0x136)+'ures']=_0x3ac341(0x5b7,0x4d4,0x646,0x590),_0x4ad9ff[_0x3ac341(0x632,0x6a3,0x5e8,0x5e2)+'uresBack']=_0x5ab3a0[_0x1d5679(0x1d0,0x125,0x64,0x1af)],_0x4ad9ff[_0x1d5679(0x21,0x7,-0xb4,-0x71)+'FW']=_0x1d5679(0x77,0x16,-0x72,0x6),_0x4ad9ff['upperBodyS'+'FWBack']=_0x5ab3a0[_0x3ac341(0x62f,0x6fc,0x750,0x6b0)],_0x4ad9ff[_0x1d5679(0x169,0x11d,0x16a,0x12c)+'W']=_0x5ab3a0[_0x3ac341(0x600,0x6c1,0x622,0x61f)],_0x4ad9ff[_0x3ac341(0x5af,0x608,0x65a,0x668)+_0x1d5679(0x9f,0x150,0x1b5,0x1a7)]=_0x1d5679(0x148,0x127,0x1ce,0x167);function _0x1d5679(_0x2fb676,_0x337e5e,_0x4d594f,_0x45340c){return _0x29670b(_0x337e5e- -0x4db,_0x337e5e-0x150,_0x45340c,_0x45340c-0x13c);}_0x4ad9ff[_0x1d5679(0x194,0x14c,0x95,0x207)+'SFW']=_0x5ab3a0[_0x1d5679(-0x2f,0x8d,0xdb,0x26)],_0x4ad9ff['upperBodyN'+_0x3ac341(0x58e,0x58a,0x659,0x610)]=_0x5ab3a0['EcajJ'],_0x4ad9ff[_0x1d5679(0xde,0x14e,0xba,0x172)+'FW']=_0x5ab3a0[_0x1d5679(0xe3,0x12b,0xdf,0x103)],_0x4ad9ff[_0x1d5679(0x210,0x14e,0xce,0x160)+_0x1d5679(0xd9,0x28,0x52,0xe2)]=_0x5ab3a0[_0x3ac341(0x60e,0x5e2,0x5c2,0x5de)];const _0x79a6=_0x4ad9ff;let _0x2d1bd4=0x39+0xa43*0x1+-0xa7c;for(const _0x4f3c21 in _0x79a6){if(_0x44b44b[_0x4f3c21]&&_0x5ab3a0['qHaWI'](_0x44b44b[_0x4f3c21],_0x2474e0[_0x4f3c21])){if(_0x5ab3a0[_0x1d5679(0x171,0xc1,0x29,0x106)]('swzxN',_0x5ab3a0['wfAKi'])){_0x548711[_0x3ac341(0x632,0x688,0x685,0x632)](_0x5ab3a0[_0x1d5679(0xa3,0x6e,0xff,0x114)]),_0x5e9606[_0x1d5679(0x16a,0x163,0xd6,0x1f5)](_0x3ac341(0x637,0x6c9,0x69d,0x62d)+_0x1d5679(-0xb2,0xc,0x55,0xe)+_0x1d5679(-0x6e,0x23,-0x7b,0x82)+_0x1d5679(0x78,0xb0,0x158,0x173)+_0x1d5679(0xaf,0x16c,0xcd,0x12e)+_0x3ac341(0x599,0x5bd,0x503,0x584)),_0x358544[_0x1d5679(0xf2,0x163,0xe7,0x153)](_0x1d5679(0x4a,0xe2,0x62,0x3f)+_0x3ac341(0x5da,0x4e7,0x5a7,0x557)+'fy]\x20Raw\x20LL'+_0x1d5679(0x1aa,0x137,0x1b7,0x1b2)+_0x1d5679(0x49,0x27,-0x87,0x38)+_0x1d5679(0x154,0xb3,0xbe,0x12c),_0xceb159);return;}else{const _0x331e5c=_0x2474e0[_0x4f3c21]||_0x5ab3a0[_0x1d5679(0x11b,0xdf,0x3d,0x139)],_0x387088=_0x44b44b[_0x4f3c21];_0xd6693c+='•\x20'+_0x79a6[_0x4f3c21]+':\x0a',_0xd6693c+=_0x1d5679(0xa9,0xc0,0xca,0x50)+_0x331e5c[_0x3ac341(0x72d,0x640,0x639,0x66d)](-0x1aee+0x178c+-0x1b1*-0x2,-0x1f95+-0xdf0*-0x2+0x3e7)+(_0x5ab3a0[_0x3ac341(0x6ca,0x63c,0x731,0x688)](_0x331e5c[_0x1d5679(-0x7c,0x1a,0x91,-0x6b)],-0x22a7+0x527+0x1db2)?_0x5ab3a0[_0x3ac341(0x621,0x661,0x6af,0x5f9)]:'')+'\x0a',_0xd6693c+='\x20\x20新:\x20'+_0x387088['substring'](0x41b*-0x7+-0x1*-0x713+0x15aa,-0x1be0+-0x1*0x533+0xa7*0x33)+(_0x5ab3a0[_0x1d5679(0x150,0x13d,0x1d8,0xc9)](_0x387088[_0x1d5679(0x83,0x1a,-0x1e,-0x49)],-0x1*-0xc7d+0x659*0x3+-0x1f56)?_0x5ab3a0[_0x1d5679(0xc3,0xae,0xe1,0x11a)]:'')+'\x0a\x0a',_0x2d1bd4++;}}}if(_0x5ab3a0['pQavM'](_0x2d1bd4,0x1*-0x233f+-0x1*0x267e+0x49bd*0x1)){if(_0x5ab3a0[_0x3ac341(0x50d,0x572,0x515,0x55b)]===_0x5ab3a0[_0x3ac341(0x62b,0x659,0x607,0x642)]){if(_0x5ab3a0[_0x1d5679(0x64,0x91,-0x16,0xd8)](_0x58aff1['id'],_0x4aae5d))return;_0x542783['removeList'+_0x1d5679(0x152,0x147,0x134,0x112)](_0x42d408['LLM_CHAR_M'+_0x1d5679(0x1cb,0x10f,0xb0,0xed)+'PROMPT_RES'+_0x3ac341(0x607,0x5e2,0x5e6,0x61e)],_0x2f7980),_0x5ab3a0[_0x3ac341(0x4b2,0x555,0x5a1,0x546)](_0x2dc1c5,_0x50275d['prompt']);}else{toastr[_0x1d5679(-0x79,-0x3,0x1f,0x26)](_0x5ab3a0['Iomts']);return;}}_0xd6693c+='共\x20'+_0x2d1bd4+_0x3ac341(0x5f7,0x6b8,0x6c6,0x607);const _0x1dc465=await _0x5ab3a0['bKLpK'](stylishConfirm,_0xd6693c);if(!_0x1dc465){toastr['info'](_0x3ac341(0x649,0x5e4,0x593,0x608));return;}for(const _0x34a24c in _0x79a6){_0x44b44b[_0x34a24c]&&(_0x2474e0[_0x34a24c]=_0x44b44b[_0x34a24c]);}saveSettingsDebounced();const _0x5be868=_0x5ab3a0[_0x3ac341(0x53b,0x63a,0x4fc,0x5a0)]($,_0x5ab3a0[_0x3ac341(0x5ac,0x4da,0x4db,0x594)]);_0x5be868[_0x3ac341(0x621,0x5bb,0x4c8,0x565)]&&(_0x5ab3a0[_0x3ac341(0x660,0x541,0x578,0x5dc)](_0x5ab3a0[_0x3ac341(0x69e,0x5e6,0x6b9,0x63b)],_0x5ab3a0[_0x3ac341(0x693,0x673,0x646,0x63b)])?_0x3769d5[_0x1d5679(0x1aa,0x163,0x11f,0x1f0)](_0x1d5679(0x19e,0xe2,0x92,0x184)+_0x3ac341(0x521,0x5e2,0x57f,0x557)+_0x3ac341(0x6d6,0x6e0,0x646,0x681)+_0x3ac341(0x566,0x628,0x551,0x58f)+_0x4b49df+'\x22'):_0x5ab3a0[_0x1d5679(0xc2,0xa4,0x29,0xd)](refreshCharacterSettings,_0x5be868));_0x5ab3a0[_0x3ac341(0x58f,0x5eb,0x5f5,0x5ef)](updateFormFields,_0x44b44b);function _0x3ac341(_0x595a46,_0x4cedc4,_0x4c04bc,_0x2a1c7f){return _0x29670b(_0x2a1c7f-0x70,_0x4cedc4-0x1f4,_0x4c04bc,_0x2a1c7f-0x12e);}console[_0x3ac341(0x6a8,0x6da,0x69e,0x6ae)](_0x1d5679(0x55,0xe2,0x26,0x16e)+_0x1d5679(-0xac,0xc,0xa,-0x4c)+_0x1d5679(-0x4b,0x6,0x36,-0x26)+'设\x20\x22'+_0x5a6bc8+'\x22');}function updateFormFields(_0x3d5442){const _0x9489b0={'UOGKF':function(_0x589a15,_0x2a5fb2){return _0x589a15!==_0x2a5fb2;},'tLdvH':_0x3bd995(0x531,0x584,0x551,0x4ca),'wEVTX':_0x3bd995(0x63e,0x6a7,0x5f3,0x5ed),'AHSLg':function(_0x1a574c,_0x3ce040){return _0x1a574c(_0x3ce040);},'zwHIJ':'input','eiAeu':_0x3bd995(0x4e6,0x561,0x579,0x571)+'ures','JTQrg':'facialFeat'+_0x29b579(0x282,0x2b6,0x21a,0x31e),'ogySr':'fullBodySF'+'W','XgVKi':_0x3bd995(0x559,0x552,0x5ff,0x575)+_0x29b579(0x2e6,0x3a6,0x420,0x41f),'iUVyM':_0x3bd995(0x674,0x595,0x62e,0x628)+_0x29b579(0x409,0x3bf,0x359,0x36b),'VDpjM':_0x29b579(0x328,0x3a4,0x374,0x416)+'FW'};function _0x3bd995(_0x4893e2,_0x30d06d,_0x413189,_0x170296){return _0x29670b(_0x413189-0x7,_0x30d06d-0x14e,_0x170296,_0x170296-0xf9);}const _0x5be48b=[_0x29b579(0x379,0x2d6,0x251,0x21c),'nameEN',_0x9489b0[_0x3bd995(0x4b4,0x483,0x50c,0x514)],_0x9489b0[_0x3bd995(0x59d,0x658,0x60f,0x6d0)],'upperBodyS'+'FW',_0x3bd995(0x43d,0x588,0x4e9,0x5aa)+_0x3bd995(0x51b,0x51b,0x50a,0x4c6),_0x9489b0[_0x3bd995(0x624,0x5b4,0x5ef,0x536)],_0x9489b0[_0x29b579(0x456,0x399,0x316,0x3a4)],_0x9489b0[_0x29b579(0x3a4,0x3c6,0x43a,0x459)],_0x3bd995(0x6ac,0x5f0,0x62e,0x571)+_0x29b579(0x277,0x31b,0x2af,0x37a),_0x9489b0[_0x3bd995(0x585,0x5aa,0x5ed,0x538)],_0x29b579(0x44f,0x3a4,0x35d,0x34e)+_0x29b579(0x33f,0x27e,0x258,0x203)];function _0x29b579(_0x4e5dfc,_0x51a168,_0x1f41f4,_0x4474a8){return _0x29670b(_0x51a168- -0x285,_0x51a168-0x133,_0x4474a8,_0x4474a8-0x19a);}_0x5be48b['forEach'](_0x4508ea=>{function _0x307b21(_0x5595ac,_0x4b6c1c,_0x26594d,_0xfd8eee){return _0x29b579(_0x5595ac-0x10,_0x5595ac- -0x201,_0x26594d-0x82,_0xfd8eee);}function _0x7bdd0a(_0x94c750,_0x7c2a61,_0x40e91d,_0x133e35){return _0x3bd995(_0x94c750-0x38,_0x7c2a61-0x110,_0x133e35- -0x29d,_0x94c750);}if(_0x9489b0[_0x7bdd0a(0x2df,0x35a,0x1e0,0x29b)](_0x7bdd0a(0x1ef,0x1df,0x20a,0x284),_0x9489b0[_0x307b21(0x133,0x1ab,0x82,0x7a)])){if(_0x3d5442[_0x4508ea]){const _0x75641c=document['getElement'+_0x7bdd0a(0x43a,0x37d,0x44d,0x396)]('char_'+_0x4508ea);if(_0x75641c){if(_0x9489b0['wEVTX']===_0x7bdd0a(0x3e6,0x39d,0x2c7,0x385))return _0x331f2f;else _0x75641c[_0x307b21(0x1a4,0x219,0x1d7,0x226)]=_0x3d5442[_0x4508ea],_0x9489b0[_0x307b21(0x163,0x14e,0x11f,0x134)]($,_0x75641c)[_0x7bdd0a(0x398,0x2ae,0x32d,0x2e0)](_0x9489b0[_0x7bdd0a(0x3b6,0x2d2,0x26d,0x328)]);}}}else _0x268ed3[_0x47b19f]=_0x45e26e[_0x2abe0c];});}