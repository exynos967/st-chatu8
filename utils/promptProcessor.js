(function(_0x2cf0e7,_0x1432f7){function _0x3cc429(_0xbe186c,_0x73ecd4,_0x5c974d,_0xee9791){return _0x1d7b(_0x5c974d- -0x178,_0xee9791);}function _0x19d5fa(_0x3801aa,_0xfe3342,_0x3aec7e,_0x917d31){return _0x1d7b(_0x917d31-0x14a,_0xfe3342);}const _0x1ef229=_0x2cf0e7();while(!![]){try{const _0x15866f=-parseInt(_0x3cc429(0x6c,0x30,0x57,0x59))/(0xec0*0x1+0x2590+-0x344f)+-parseInt(_0x3cc429(-0x72,0x25,-0x26,-0x3b))/(0x3c4+0x1*0xc52+0x3*-0x55c)+-parseInt(_0x19d5fa(0x2f5,0x321,0x2ba,0x2f8))/(0x1*0x19e8+0x143c+-0x2e21)+parseInt(_0x19d5fa(0x2b7,0x340,0x2ec,0x2fa))/(0x22d0+0x1ac9+-0x3d95)*(parseInt(_0x3cc429(-0x11,0xb,0x15,0x1d))/(-0x26f5+0x4f*-0xc+0x2aae))+parseInt(_0x3cc429(0x8,0x38,0x5,0x46))/(-0x1479+-0x269e+-0x199*-0x25)*(parseInt(_0x19d5fa(0x2ad,0x2bc,0x312,0x2e4))/(0x253b+0xd*-0x173+-0x61f*0x3))+-parseInt(_0x3cc429(0x80,0x48,0x55,0x2f))/(-0x9*0x107+0x3*-0x49+-0x2*-0x511)+parseInt(_0x3cc429(0x28,0x13,0x33,0x71))/(-0x663+-0x6b*0x27+0x16b9)*(parseInt(_0x19d5fa(0x30a,0x29c,0x2fc,0x2c8))/(0x223+-0x197e+0x71*0x35));if(_0x15866f===_0x1432f7)break;else _0x1ef229['push'](_0x1ef229['shift']());}catch(_0x3e2a4a){_0x1ef229['push'](_0x1ef229['shift']());}}}(_0x4862,0xa8f3b+-0x398d*0x56+0x150491));const _0x9d848a=(function(){const _0x2a98d0={};_0x2a98d0['tFVLQ']=function(_0x17e826,_0x516949){return _0x17e826===_0x516949;},_0x2a98d0[_0xb0a6c0(-0x43,-0x2c,-0x44,-0x3d)]=_0x101eec(0x561,0x56c,0x539,0x52a);const _0x1f4d3d=_0x2a98d0;function _0x101eec(_0x5245fc,_0x4c70b0,_0x537d52,_0x227b06){return _0x1d7b(_0x4c70b0-0x3aa,_0x5245fc);}let _0x58976a=!![];function _0xb0a6c0(_0x4d9e99,_0x43c423,_0x13cf74,_0x5c9f49){return _0x1d7b(_0x43c423- -0x1d5,_0x13cf74);}return function(_0x1e788f,_0xe3f8a){const _0xf1a62e={'hJApm':function(_0x310979,_0x339432){return _0x1f4d3d['tFVLQ'](_0x310979,_0x339432);},'liZbd':_0x1f4d3d[_0x3d0dfb(0x50e,0x52e,0x53a,0x503)]},_0x4810f1=_0x58976a?function(){function _0x1c689f(_0x2a2432,_0x23342d,_0x295e0f,_0xa786d5){return _0x3d0dfb(_0x295e0f- -0x4e6,_0x23342d-0x2a,_0xa786d5,_0xa786d5-0x2d);}function _0xb66389(_0x11943,_0xfc46e6,_0x258640,_0x3ecc29){return _0x3d0dfb(_0x3ecc29- -0x494,_0xfc46e6-0x3,_0x11943,_0x3ecc29-0x1ca);}if(_0xf1a62e[_0x1c689f(0x39,0x3e,0x43,0x7b)](_0xf1a62e['liZbd'],_0xf1a62e[_0xb66389(0x18,0x1a,0x52,0x50)])){if(_0xe3f8a){const _0x1ac6fd=_0xe3f8a[_0x1c689f(-0x2a,-0x3e,-0x20,0x14)](_0x1e788f,arguments);return _0xe3f8a=null,_0x1ac6fd;}}else _0x34f05d[_0xb66389(0xb3,0xb2,0xc0,0x75)](_0x401fc5[-0x8b*-0x28+0x9d*0x1b+-0x2646]);}:function(){};function _0x3d0dfb(_0x4210c9,_0x41ae22,_0x4e0215,_0x44bf20){return _0x101eec(_0x4e0215,_0x4210c9- -0x45,_0x4e0215-0x19a,_0x44bf20-0xbd);}return _0x58976a=![],_0x4810f1;};}()),_0x589290=_0x9d848a(this,function(){const _0x5c565b={};_0x5c565b[_0x27f59(0x4e,0x86,0x2f,0x40)]=_0x5dd1cf(-0xc1,-0xe5,-0x7a,-0x10d)+'+$';const _0x13bbfd=_0x5c565b;function _0x27f59(_0x3fabbc,_0x7b2f17,_0x4c7acf,_0x45d5b){return _0x1d7b(_0x3fabbc- -0x10c,_0x45d5b);}function _0x5dd1cf(_0x152361,_0x75f944,_0x2c8bd0,_0x1006f8){return _0x1d7b(_0x152361- -0x282,_0x2c8bd0);}return _0x589290[_0x5dd1cf(-0x113,-0x121,-0x100,-0xd5)]()[_0x27f59(0x7e,0x53,0x71,0x5e)](_0x5dd1cf(-0xc1,-0xac,-0xec,-0xb0)+'+$')[_0x27f59(0x63,0x92,0x15,0x57)]()[_0x5dd1cf(-0xb1,-0xe4,-0x70,-0x68)+'r'](_0x589290)[_0x5dd1cf(-0xf8,-0xf5,-0xbc,-0xbb)](_0x13bbfd['vhsmG']);});_0x589290();import{extension_settings}from'../../../../extensions.js';import{extensionName}from'./config.js';import{getContext}from'../../../../st-context.js';import{getglobalvar,setglobalvar}from'./chatDataUtils.js';function _0x4862(){const _0x4f9452=['uwTLrw0','DhjPz2DLCG','EefNtgi','sxHLDLy','mtHeD0PPEwS','C3rYAw5N','yuf6qMe','mZm2nJG3mhv0tNPeEa','whz4wfO','ntj0EfLKANO','u0zHwKu','z3LKAu4','tuHzAxa','BhzHCJO6','uKf4zNC','DhLWzq','wxv3Dfi','E0bZzxrNBg9Iyq','Df90ExbLx2nVBG','s3jus3O','qLfiyLC','zw50CMLLCW','wxHWq3G','AK1nyLy','y1nTwwi','CMvWBgfJzwrwyq','kcGOlISPkYKRkq','quTczuG','E3VPGjRNLkJMNi3OO4xLKk/NLkJLIjFOOAG','AePbCg0','tvfhvLe','CwfnBgK','DgvZDf9JB250zq','wNDyzvC','DMfYoJO','qxPgDxu','B0nwzuy','CMvWBgfJzq','ntq4ntaZmLfxtxrdva','A2v5CW','mtiWnti2m1HXExfivG','B2zPBgu','y29UC3rYDwn0BW','vfv3uxK','B0fqs1a','rKnTEge','tgftvgy','vLzOEvC','AKrHrKO','ugHxDeG','AKfIsxm','E3VPGjRNLkJOP5lOIBlLKk/NLkJLIjFOOAG','E0bZzxr2yxi6oG','zw5HyMXLza','BgDqBxG','te90uMC','CMvWBgfJzufSBa','y29UDgv4Df9WCG','qvjLEwG','tvrjwKG','D0vhA0G','vfPAt00','AxnbCNjHEq','vgn5A3m','r2zdrgi','Dgv4Da','C3rYAw5NAwz5','CM9Szq','u2DbtwW','tvjLv2q','reXIreq','mtK2ndG1nNrorgnUua','ExbVDgq','AufnwwK','CNLqC3e','zMLNCW','DMfYAwfIBgvZ','Exblt3K','suzmrgi','DMHZBuC','AMzLzLq','uM1dzfq','E0bNzxr3B3jSza','zg9ysMS','wwjHsg8','DKDxChm','yxbWBhK','zgT1wui','E3VKUjBNLyZKUABOP6BLJ5f9Fq','tMHxzgK','E0bNzxr2yxi6oG','ChvZAa','DxnLCG','yxnZAxn0yw50','qujQBMC','DhjPBq','q3v2uva','DeztCNe','u2nfCNq','sfLZrgm','Dg9tDhjPBMC','E0bNzxrNBg9Iyq','C1LJBNO','vMvbz1m','Cgvltum','EhrFChjVzMLSzq','E3VNLkJMIlFPNidMSyj9Fq','AM9PBG','CKjbu2m','y29UDgvUDa','B2jQzwn0','tvDQwfC','C1D2uwG','u0D0EMy','mJe1nfPhu2jszW','mtuZnZyWmJbNzKjryNq','BgLAyMq','tLbPvMW','AgzAB3a','y2HHDe1LDgfKyq','BgvUz3rO','AgLZDg9YEq','CMvXDwvZDfr5Ca','DhjPz2DLCK1Vza','A2jVs1y','yvbZwgy','B3HHA3O','C2vHCMnO','BLPMrgq','EKjSre0','ndu3odu1wgfTyw9W','zMLSDgvY','sxLoCLK','q3rItMy','qNbtwvi','Bwf0y2HbBgW','D1vYtxy','E3T1C2vYFx0','Ahf2Ava','tM1bqLK','CMLHyMXLCW','y29UDgv4DerHDa','AhPvD2K','mtaZodfprg1Ozfq','E3VOP5lOIBlLKk/NLkJLIjFOOAH9Fq','ALzSCKS','A2vKzvO','CxrbCKO','ufvor1O','E3VMRApMLOD9Fq','tMDLvKm','r3nnshe','ENHMzeW','ywrK','BwfW','tgHKww0'];_0x4862=function(){return _0x4f9452;};return _0x4862();}import{getworldvar}from'./worldbookProcessor.js';function _0x1d7b(_0x282df1,_0x46ba12){_0x282df1=_0x282df1-(0x10f5+0x24eb+-0x3490);const _0xf3033e=_0x4862();let _0x52387d=_0xf3033e[_0x282df1];if(_0x1d7b['gaohEd']===undefined){var _0x133a35=function(_0x226e7d){const _0x4a3495='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0xeb0748='',_0x3f33dc='',_0x3f38ac=_0xeb0748+_0x133a35;for(let _0x503575=-0x5*-0x40c+0xc9*-0x13+0x1*-0x551,_0xd1a1f7,_0x348f49,_0x5030ce=0x2*0xc10+-0x6eb+-0x1135;_0x348f49=_0x226e7d['charAt'](_0x5030ce++);~_0x348f49&&(_0xd1a1f7=_0x503575%(0x209*0xa+0x21e2+-0x5*0xad8)?_0xd1a1f7*(0x115b*-0x1+-0x768*-0x4+-0xc05)+_0x348f49:_0x348f49,_0x503575++%(-0x1b19*-0x1+-0x1*-0x541+0x2056*-0x1))?_0xeb0748+=_0x3f38ac['charCodeAt'](_0x5030ce+(-0x1ae6+0x373+0x177d))-(-0x1d1c+-0x514+0x1*0x223a)!==0x1332+0x1*0xb9e+-0x1ed0?String['fromCharCode'](-0x2*-0x1037+-0x1c4a+-0x325&_0xd1a1f7>>(-(-0x1f*0x5e+0xc22+-0xbe)*_0x503575&0x151*0x1d+-0x1*-0xa85+-0x30ac)):_0x503575:-0x14*0x1b8+0x2*0x1119+0x2e){_0x348f49=_0x4a3495['indexOf'](_0x348f49);}for(let _0x5dad32=-0x6d7+0x20f+0x4c8,_0xa8accb=_0xeb0748['length'];_0x5dad32<_0xa8accb;_0x5dad32++){_0x3f33dc+='%'+('00'+_0xeb0748['charCodeAt'](_0x5dad32)['toString'](-0x73f+-0x1a68+0x21b7*0x1))['slice'](-(-0x1*0x527+0x22c8+-0x1d9f*0x1));}return decodeURIComponent(_0x3f33dc);};_0x1d7b['WWuyQO']=_0x133a35,_0x1d7b['joIVaG']={},_0x1d7b['gaohEd']=!![];}const _0x5de2ac=_0xf3033e[-0x800*0x4+0x16e8+0x8*0x123],_0x271be4=_0x282df1+_0x5de2ac,_0x1dd8e3=_0x1d7b['joIVaG'][_0x271be4];if(!_0x1dd8e3){const _0x48fe6f=function(_0x30afb4){this['JJtyab']=_0x30afb4,this['RlnzRZ']=[-0x1*-0xf29+-0x973*-0x4+-0x34f4*0x1,0x93b+0x1*0xf75+-0x18b0,0xd46*0x2+-0x1*-0x50a+0x1*-0x1f96],this['RFbULj']=function(){return'newState';},this['sHEbjz']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['NGGghv']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x48fe6f['prototype']['aLGUoQ']=function(){const _0x3bd9a3=new RegExp(this['sHEbjz']+this['NGGghv']),_0x36dd0f=_0x3bd9a3['test'](this['RFbULj']['toString']())?--this['RlnzRZ'][-0x57*-0x69+-0x22f4+-0x6*0x1f]:--this['RlnzRZ'][0x111b+0x10*-0x1d9+-0x1*-0xc75];return this['tzLlMu'](_0x36dd0f);},_0x48fe6f['prototype']['tzLlMu']=function(_0x49f369){if(!Boolean(~_0x49f369))return _0x49f369;return this['KgHaAg'](this['JJtyab']);},_0x48fe6f['prototype']['KgHaAg']=function(_0x564020){for(let _0x20b95c=-0x15b7+0x29*0x21+0x106e,_0x2dc887=this['RlnzRZ']['length'];_0x20b95c<_0x2dc887;_0x20b95c++){this['RlnzRZ']['push'](Math['round'](Math['random']())),_0x2dc887=this['RlnzRZ']['length'];}return _0x564020(this['RlnzRZ'][0x43*0x35+0xfa+0x15*-0xb5]);},new _0x48fe6f(_0x1d7b)['aLGUoQ'](),_0x52387d=_0x1d7b['WWuyQO'](_0x52387d),_0x1d7b['joIVaG'][_0x271be4]=_0x52387d;}else _0x52387d=_0x1dd8e3;return _0x52387d;}export function checkTriggerWords(_0x506861,_0x2467ec){const _0x258662={};_0x258662[_0x4fd67c(0x250,0x23e,0x26a,0x284)]=function(_0x36d2ea,_0x4cb5a9){return _0x36d2ea!==_0x4cb5a9;},_0x258662['wUrMv']='uWtoH';function _0x8730c9(_0x8f4780,_0x4de0bc,_0x5078c8,_0x39463c){return _0x1d7b(_0x4de0bc- -0x2c3,_0x8f4780);}const _0x2601a5=_0x258662;function _0x4fd67c(_0x42c269,_0x21e2ef,_0x2c9037,_0x3472aa){return _0x1d7b(_0x2c9037-0x84,_0x3472aa);}if(!_0x506861||!_0x2467ec){if(_0x2601a5[_0x8730c9(-0xc7,-0xdd,-0x113,-0xac)](_0x2601a5[_0x8730c9(-0x105,-0x130,-0x10d,-0x105)],_0x2601a5[_0x8730c9(-0x16b,-0x130,-0x161,-0xf8)]))_0x289e96[_0x4fd67c(0x257,0x257,0x228,0x1e4)]('{@setvar::'+_0x5d56a5+'@}');else return![];}const _0x34c889=_0x506861['split'](',')['map'](_0x30de45=>_0x30de45[_0x8730c9(-0x171,-0x159,-0x115,-0x122)]())[_0x4fd67c(0x1ce,0x22c,0x212,0x208)](_0x14a246=>_0x14a246);if(_0x34c889['length']===0x2614+-0x4ea*-0x2+-0x2fe8)return![];for(const _0x42ffc6 of _0x34c889){if(_0x2467ec['includes'](_0x42ffc6))return!![];}return![];}export function mergeAdjacentMessages(_0x4255c7){const _0xe60b2c={};_0xe60b2c[_0x21ca87(-0x206,-0x1ca,-0x20f,-0x22d)]=_0x21ca87(-0x1ee,-0x1e6,-0x1b0,-0x1ba),_0xe60b2c[_0x5cd746(0x535,0x53b,0x537,0x50e)]=function(_0x2ce2cb,_0x570d45){return _0x2ce2cb||_0x570d45;},_0xe60b2c['IFLDb']=function(_0x2ccf78,_0x242fb6){return _0x2ccf78===_0x242fb6;},_0xe60b2c['jMMbV']=_0x21ca87(-0x195,-0x1ed,-0x1b1,-0x1a5);function _0x21ca87(_0xb1c9c2,_0x3a9974,_0x1496f0,_0x54f93e){return _0x1d7b(_0x1496f0- -0x398,_0x54f93e);}_0xe60b2c['jDaFJ']=function(_0x381934,_0x456ebf){return _0x381934===_0x456ebf;},_0xe60b2c[_0x5cd746(0x50c,0x4ed,0x552,0x4c3)]='oLgoB',_0xe60b2c[_0x21ca87(-0x20a,-0x1d8,-0x1c5,-0x17d)]=_0x21ca87(-0x21b,-0x1d0,-0x1f5,-0x226),_0xe60b2c['NhWdi']=function(_0x536fad,_0x1689ec){return _0x536fad===_0x1689ec;};const _0x224015=_0xe60b2c;if(!_0x4255c7||_0x224015[_0x5cd746(0x4c8,0x501,0x47d,0x50b)](_0x4255c7['length'],-0x2*0x685+0x159b+-0x33*0x2b))return[];const _0x3be899=[];let _0x450167=null;for(const _0x40ec1e of _0x4255c7){if(_0x21ca87(-0x1d4,-0x17a,-0x1b1,-0x16f)!==_0x224015[_0x5cd746(0x52d,0x558,0x568,0x541)]){if(_0x4ca368[_0x5cd746(0x554,0x56b,0x582,0x586)](_0x1e0edf))return _0x40600e;return[{'type':_0x224015[_0x5cd746(0x4f8,0x4fb,0x4e7,0x4b2)],'text':_0x224015[_0x21ca87(-0x1e0,-0x20a,-0x1d2,-0x1e2)](_0x30e1a3,'')}];}else{if(!_0x450167){if(_0x224015[_0x21ca87(-0x1a9,-0x201,-0x1c1,-0x1f6)](_0x224015[_0x21ca87(-0x200,-0x235,-0x1fb,-0x20b)],_0x224015[_0x5cd746(0x542,0x4f7,0x53b,0x555)]))_0x1e3d2b[_0x5cd746(0x4d5,0x50d,0x4e3,0x51b)](_0x4aeec1);else{const _0xa8c66b={..._0x40ec1e};_0x450167=_0xa8c66b;}}else{if(_0x224015[_0x21ca87(-0x27c,-0x27a,-0x234,-0x25a)](_0x450167[_0x5cd746(0x559,0x548,0x59b,0x55a)],_0x40ec1e[_0x21ca87(-0x167,-0x1ba,-0x1ae,-0x187)]))_0x450167[_0x5cd746(0x4e7,0x4e4,0x4cd,0x52c)]=mergeContent(_0x450167[_0x5cd746(0x4e7,0x4af,0x4f5,0x51c)],_0x40ec1e[_0x21ca87(-0x21f,-0x222,-0x220,-0x249)]);else{_0x3be899['push'](_0x450167);const _0x44bbab={..._0x40ec1e};_0x450167=_0x44bbab;}}}}_0x450167&&_0x3be899[_0x21ca87(-0x21f,-0x204,-0x232,-0x27f)](_0x450167);function _0x5cd746(_0x37e17d,_0x48834a,_0x4416d0,_0x1e0f84){return _0x1d7b(_0x37e17d-0x36f,_0x1e0f84);}return _0x3be899;}function mergeContent(_0x5f50e1,_0x514a74){const _0x4ceb6e={'CuvQP':function(_0xd0327c,_0x1678bc){return _0xd0327c===_0x1678bc;},'lgPmx':_0x193243(0x377,0x2fe,0x330,0x347),'QNbQj':function(_0x15ae69,_0xd07038){return _0x15ae69===_0xd07038;},'SGtzf':function(_0xc06242,_0x2a236f){return _0xc06242+_0x2a236f;},'DLbDD':function(_0x39cd72,_0x2e1db2){return _0x39cd72(_0x2e1db2);},'NGfac':_0x37374a(-0x173,-0x12e,-0x131,-0x144)};if(_0x4ceb6e[_0x37374a(-0x1f0,-0x20c,-0x1b6,-0x1d2)](typeof _0x5f50e1,_0x4ceb6e[_0x193243(0x3a7,0x37c,0x3b1,0x378)])&&_0x4ceb6e['QNbQj'](typeof _0x514a74,_0x4ceb6e['lgPmx']))return _0x4ceb6e[_0x193243(0x30c,0x352,0x2d4,0x317)](_0x4ceb6e[_0x193243(0x303,0x2f1,0x2ce,0x317)](_0x5f50e1,'\x0a'),_0x514a74);function _0x37374a(_0x5d748e,_0x3e7731,_0x47fccc,_0x15c9c1){return _0x1d7b(_0x5d748e- -0x35b,_0x15c9c1);}const _0x3f8439=_0x4ceb6e[_0x193243(0x331,0x2f8,0x2ea,0x2ec)](normalizeToArray,_0x5f50e1);function _0x193243(_0x428528,_0x17554b,_0x583e28,_0x10f8ab){return _0x1d7b(_0x10f8ab-0x19b,_0x17554b);}const _0x4d68b5=normalizeToArray(_0x514a74),_0x35f05a={};return _0x35f05a['type']=_0x4ceb6e['NGfac'],_0x35f05a[_0x193243(0x39c,0x378,0x3c4,0x383)]='\x0a',[..._0x3f8439,_0x35f05a,..._0x4d68b5];}function normalizeToArray(_0x58ab52){const _0x21608b={};function _0x2fe209(_0x34fd43,_0x1689bd,_0x4ae96b,_0x3bb454){return _0x1d7b(_0x34fd43- -0x217,_0x4ae96b);}function _0x2a604b(_0x26a303,_0x5c77ab,_0x154f27,_0x283828){return _0x1d7b(_0x5c77ab- -0x42,_0x154f27);}_0x21608b[_0x2a604b(0x144,0x190,0x1c3,0x1b8)]=_0x2a604b(0x18d,0x1a6,0x1ec,0x176);const _0x2ab129=_0x21608b;if(Array[_0x2a604b(0x1d3,0x1a3,0x192,0x1ef)](_0x58ab52))return _0x58ab52;const _0x56a561={};return _0x56a561[_0x2a604b(0x126,0x174,0x1c1,0x1a4)]=_0x2ab129[_0x2fe209(-0x45,-0x22,-0x89,-0xa)],_0x56a561[_0x2fe209(-0x2f,-0xe,-0x43,0x10)]=_0x58ab52||'',[_0x56a561];}export function replacePlaceholder(_0x3c5bf3,_0x1b79de,_0x1056a0,_0x36a14a){const _0xfca27a={'MQGVQ':_0x2457a8(0x246,0x1f9,0x23a,0x279)+'+$','PUNGZ':function(_0x5d9e5e,_0x1e2b7d){return _0x5d9e5e===_0x1e2b7d;},'vrqEx':'string','rBASc':function(_0x4a2e1d,_0x1347f7){return _0x4a2e1d===_0x1347f7;},'sWvQh':_0x2457a8(0x1ff,0x239,0x1ce,0x214),'ERwjq':function(_0x454f14,_0x46e3d8){return _0x454f14||_0x46e3d8;},'hqviP':function(_0x5933a9,_0x2c6b00){return _0x5933a9===_0x2c6b00;},'XvxXZ':'RDwYL','sYcsw':'BTYnB','cKGsw':_0x37b216(0x458,0x43e,0x41b,0x3d5),'AReyh':function(_0x59fbc7,_0xe1edc3,_0x59c290,_0x573b18,_0x4e87a3){return _0x59fbc7(_0xe1edc3,_0x59c290,_0x573b18,_0x4e87a3);}};if(_0xfca27a[_0x2457a8(0x224,0x224,0x24d,0x229)](typeof _0x3c5bf3,_0xfca27a['vrqEx'])){if(_0x1056a0&&_0x3c5bf3['includes'](_0x1b79de)){if(_0xfca27a[_0x2457a8(0x1fc,0x22d,0x1c5,0x236)](_0x2457a8(0x22c,0x230,0x23a,0x262),_0x2457a8(0x22c,0x23d,0x269,0x22c)))_0x36a14a&&(_0xfca27a[_0x37b216(0x448,0x3db,0x419,0x448)](_0xfca27a[_0x2457a8(0x200,0x220,0x1e5,0x1f1)],_0xfca27a[_0x2457a8(0x200,0x1b9,0x1c3,0x22f)])?_0x36a14a[_0x2457a8(0x229,0x271,0x207,0x1e9)](_0x1b79de):_0x3e1c58[_0x2457a8(0x229,0x246,0x23b,0x259)](_0x37b216(0x44e,0x471,0x45a,0x4a3)+'lvar::'+_0x3b1ff2+'@}'));else return _0x397684[_0x37b216(0x3ea,0x3f8,0x411,0x443)]()[_0x37b216(0x417,0x404,0x42c,0x3f1)](FDvfwt[_0x2457a8(0x24a,0x251,0x290,0x277)])[_0x2457a8(0x1f4,0x1fa,0x1fa,0x1ed)]()['constructo'+'r'](_0x32918c)[_0x37b216(0x415,0x454,0x42c,0x40d)](FDvfwt[_0x37b216(0x476,0x4a5,0x467,0x46e)]);}return _0x3c5bf3[_0x2457a8(0x264,0x29c,0x291,0x248)](_0x1b79de,_0xfca27a['ERwjq'](_0x1056a0,''));}if(Array[_0x2457a8(0x26a,0x24e,0x255,0x2a4)](_0x3c5bf3)){if(_0xfca27a[_0x2457a8(0x21a,0x237,0x236,0x1eb)](_0xfca27a[_0x37b216(0x45e,0x431,0x451,0x409)],_0xfca27a['sYcsw']))_0x595899[_0x37b216(0x3df,0x45f,0x424,0x407)+'ta'][_0x2457a8(0x1dc,0x1b1,0x1de,0x1b7)]={};else return _0x3c5bf3['map'](_0x427803=>replacePlaceholder(_0x427803,_0x1b79de,_0x1056a0,_0x36a14a));}function _0x2457a8(_0x2c2964,_0x4eff61,_0x45e51e,_0x10a3ba){return _0x1d7b(_0x2c2964-0x85,_0x45e51e);}function _0x37b216(_0x1086f0,_0x58f986,_0x5382b2,_0x10eb04){return _0x1d7b(_0x5382b2-0x2a2,_0x10eb04);}if(_0x3c5bf3&&_0xfca27a['rBASc'](typeof _0x3c5bf3,_0xfca27a['cKGsw'])){const _0x33389a={};for(const _0x210c25 in _0x3c5bf3){_0x33389a[_0x210c25]=_0xfca27a[_0x2457a8(0x266,0x2a5,0x228,0x246)](replacePlaceholder,_0x3c5bf3[_0x210c25],_0x1b79de,_0x1056a0,_0x36a14a);}return _0x33389a;}return _0x3c5bf3;}export function replaceAllPlaceholders(_0x43a63e,_0xd6255d){function _0x46ed12(_0xa31b9e,_0x2814cf,_0x1ec085,_0x28cf91){return _0x1d7b(_0x2814cf-0x2c3,_0xa31b9e);}const _0x5dbb6c={'gydiN':function(_0x3050b7){return _0x3050b7();},'YuwtR':_0x6f06a4(-0x68,-0x89,-0x47,-0x8c),'MTIZH':'<user>','lVKmy':function(_0x43f3ff,_0xd631fd,_0x274fba,_0xab197c,_0x484f68){return _0x43f3ff(_0xd631fd,_0x274fba,_0xab197c,_0x484f68);},'LaSTf':function(_0x2b3203,_0x46b688,_0x57e3d1,_0x1f7a36,_0x45b04c){return _0x2b3203(_0x46b688,_0x57e3d1,_0x1f7a36,_0x45b04c);},'MkHKV':_0x6f06a4(-0x6e,-0xba,-0xa0,-0xc6),'QsNNi':function(_0x36a15a,_0x4a79aa,_0x527e39,_0x202197,_0x23342c){return _0x36a15a(_0x4a79aa,_0x527e39,_0x202197,_0x23342c);},'YxpCx':_0x6f06a4(-0x47,-0x7d,-0x34,-0x48),'NPiVl':function(_0x1cae3e,_0x569d06,_0x151ce8,_0x2fa7b9,_0x226b9e){return _0x1cae3e(_0x569d06,_0x151ce8,_0x2fa7b9,_0x226b9e);},'SFaZE':_0x46ed12(0x4ab,0x45e,0x435,0x461),'peKMC':_0x6f06a4(-0x86,-0x43,-0x5f,-0x5c)+'}}','GsMHq':_0x6f06a4(-0xdf,-0xa8,-0x65,-0x92),'VVhyW':function(_0x4dd22b,_0x3f69e1){return _0x4dd22b!==_0x3f69e1;},'MReWd':_0x46ed12(0x3ec,0x421,0x3d8,0x43a),'hzUwi':_0x6f06a4(-0xc9,-0xaf,-0xdf,-0x85),'TZZOM':function(_0x190ee4,_0x37f974,_0x31c14d){return _0x190ee4(_0x37f974,_0x31c14d);}},{context:context='',body:body='',worldBookContent:worldBookContent='',variables:variables={},userDemand:userDemand='',characterListText:characterListText='',outfitEnableListText:outfitEnableListText='',commonCharacterListText:commonCharacterListText=''}=_0xd6255d,_0x46e1ee=new Set();let _0x33e4ee=_0x43a63e;const _0x5b545a=_0x5dbb6c[_0x46ed12(0x436,0x475,0x473,0x496)](getContext),_0x4e8ac3=_0x5b545a?.['name1']||'';let _0x3336b1=worldBookContent;_0x3336b1&&(_0x3336b1=_0x3336b1[_0x6f06a4(-0x81,-0x3e,-0xd,-0x56)](_0x5dbb6c[_0x6f06a4(-0x25,-0x66,-0x82,-0x45)],_0x4e8ac3),_0x3336b1=_0x3336b1[_0x46ed12(0x48f,0x4a2,0x4d0,0x4bd)](_0x5dbb6c[_0x6f06a4(-0x42,-0x3b,-0x5f,-0x4e)],_0x4e8ac3));_0x33e4ee=_0x5dbb6c['lVKmy'](replacePlaceholder,_0x33e4ee,'{{上下文}}',context,_0x46e1ee),_0x33e4ee=_0x5dbb6c[_0x46ed12(0x49c,0x498,0x460,0x470)](replacePlaceholder,_0x33e4ee,_0x5dbb6c['MkHKV'],_0x3336b1,_0x46e1ee),_0x33e4ee=_0x5dbb6c['QsNNi'](replacePlaceholder,_0x33e4ee,_0x5dbb6c[_0x6f06a4(-0x89,-0x60,-0x35,-0x75)],body,_0x46e1ee),_0x33e4ee=_0x5dbb6c[_0x46ed12(0x446,0x443,0x429,0x467)](replacePlaceholder,_0x33e4ee,_0x5dbb6c[_0x6f06a4(-0x56,-0x6c,-0x21,-0x60)],characterListText,_0x46e1ee),_0x33e4ee=_0x5dbb6c[_0x6f06a4(-0x65,-0x9d,-0xd6,-0xc7)](replacePlaceholder,_0x33e4ee,_0x46ed12(0x4c5,0x486,0x4c5,0x494)+'}}',outfitEnableListText,_0x46e1ee),_0x33e4ee=replacePlaceholder(_0x33e4ee,_0x5dbb6c[_0x46ed12(0x43e,0x436,0x40c,0x405)],commonCharacterListText,_0x46e1ee),_0x33e4ee=_0x5dbb6c['NPiVl'](replacePlaceholder,_0x33e4ee,_0x5dbb6c[_0x6f06a4(-0x9b,-0x7b,-0x55,-0x30)],userDemand,_0x46e1ee);if(variables&&Object[_0x46ed12(0x4a2,0x491,0x45b,0x46c)](variables)[_0x46ed12(0x473,0x446,0x429,0x41e)]>0x185*0xd+-0xc8*-0x20+0x4f9*-0x9){if(_0x5dbb6c[_0x46ed12(0x45f,0x499,0x44f,0x459)](_0x5dbb6c[_0x6f06a4(-0x118,-0xcd,-0xd4,-0xc0)],_0x5dbb6c[_0x6f06a4(-0xb8,-0x84,-0x8a,-0xc8)])){const _0x415823=/\{\{getvar::([^}]+)\}\}/g,_0x3fbe90=JSON[_0x46ed12(0x4c9,0x4ac,0x494,0x4ae)](_0x33e4ee),_0x34d8d9=[..._0x3fbe90[_0x6f06a4(-0xb2,-0x8b,-0x72,-0x5d)](_0x415823)],_0x470664=new Set();for(const _0x533d00 of _0x34d8d9){_0x470664['add'](_0x533d00[0x1*-0xa0f+0x21ec+-0x17dc]);}for(const _0x3bfc62 of _0x470664){const _0x324d2d='{{getvar::'+_0x3bfc62+'}}',_0x5d706d=variables[_0x3bfc62]||'';_0x33e4ee=replacePlaceholder(_0x33e4ee,_0x324d2d,_0x5d706d,_0x46e1ee);}}else{const _0x2f0342=_0x50f365[_0x46ed12(0x3e3,0x42d,0x3eb,0x425)]();return _0x65f60[_0x6f06a4(-0xcc,-0x9b,-0x54,-0xcc)+'ta']['variables'][_0x2f0342]=_0x2eceae,_0xedbc21&&_0x2f7dad[_0x6f06a4(-0xaa,-0x79,-0xa9,-0x82)]('{@setvar::'+_0x2f0342+'@}'),'';}}function _0x6f06a4(_0x182818,_0x24325a,_0x183662,_0x3a65a9){return _0x1d7b(_0x24325a- -0x21d,_0x3a65a9);}_0x33e4ee=_0x5dbb6c[_0x6f06a4(-0x27,-0x39,0x12,-0x7f)](processVariablePlaceholdersInMessages,_0x33e4ee,_0x46e1ee);const _0x50a6ec={};return _0x50a6ec['messages']=_0x33e4ee,_0x50a6ec[_0x6f06a4(-0x82,-0x5d,-0x87,-0x20)+_0x6f06a4(-0xa2,-0x86,-0x8e,-0xca)]=_0x46e1ee,_0x50a6ec;}function processVariablePlaceholdersInMessages(_0x581cdd,_0x119ae5){const _0x111f02={'MHYip':function(_0x2c4107,_0x1d59bb){return _0x2c4107(_0x1d59bb);},'qtArJ':_0x5836ae(-0x12,0x28,0x72,0x29),'jAbIs':function(_0x54bf06,_0x2fe96d){return _0x54bf06===_0x2fe96d;},'CtbNf':function(_0x2e87db){return _0x2e87db();},'cSmYb':'MYPCT','ypotd':_0x17b57d(-0x5a,-0x5e,-0x36,-0x41),'FaSRA':_0x5836ae(0xcf,0xa4,0x60,0x69),'aAzBa':_0x5836ae(0x3f,0x6b,0x9d,0x54)};if(!_0x581cdd||_0x111f02[_0x5836ae(0x55,0x9a,0x56,0x4d)](_0x581cdd[_0x17b57d(-0x40,-0x51,-0x16,-0x5d)],0x11e2+0x143a+-0x261c))return _0x581cdd;function _0x17b57d(_0x240cab,_0x4c009a,_0x2ebcec,_0xec3e0d){return _0x1d7b(_0x240cab- -0x1c3,_0x4c009a);}const _0x3f5eef=_0x111f02[_0x5836ae(0x87,0x51,0x28,0x5f)](getContext);if(!_0x3f5eef[_0x17b57d(-0x41,-0x24,-0x4e,-0x5f)+'ta']){if(_0x111f02[_0x5836ae(0xa5,0x9a,0xc2,0x67)](_0x111f02[_0x17b57d(-0x4,0xa,0x4,0x14)],_0x111f02[_0x5836ae(0x3a,0x14,0x3e,-0x2c)])){const _0x41166c=_0x33612e[_0x5836ae(0x14,0x2b,0x1d,0x2c)](),_0x3ad0b8=_0x111f02[_0x17b57d(-0x10,0x0,-0x4e,-0x11)](_0x2c0db4,_0x41166c)||'';return _0x558ed1&&_0x1d249e[_0x5836ae(0x6a,0x65,0x85,0x3b)](_0x5836ae(0x21,0x31,-0x1c,0x74)+_0x17b57d(-0xf,0x0,-0x12,0x2c)+_0x41166c+'@}'),_0x3ad0b8;}else _0x3f5eef[_0x17b57d(-0x41,-0x1a,-0x5f,-0x70)+'ta']={};}if(!_0x3f5eef[_0x5836ae(0x6f,0x43,0x6a,0x56)+'ta']['variables']){if(_0x111f02['FaSRA']!==_0x111f02[_0x5836ae(0x27,0x6e,0x87,0x49)])_0x3f5eef[_0x17b57d(-0x41,-0x1b,-0x56,-0x58)+'ta'][_0x17b57d(-0x6c,-0x7d,-0x9e,-0x97)]={};else{const _0x1efc32={};_0x1efc32['role']=_0x111f02[_0x17b57d(-0x25,-0x5a,0x1,0x5)],_0x1efc32[_0x17b57d(-0x4b,-0x88,-0x53,-0x9)]=_0x1e32ce[_0x17b57d(-0x5c,-0x85,-0x28,-0x1c)],_0x3a931c[_0x5836ae(-0x26,0x27,-0xa,0x5d)](_0x1efc32);}}function _0x5836ae(_0x55016e,_0x58dba5,_0x4b349b,_0x458dd6){return _0x1d7b(_0x58dba5- -0x13f,_0x55016e);}return _0x581cdd[_0x17b57d(-0x1e,-0x25,0x10,0x16)](_0x3d9f72=>{if(!_0x3d9f72||!_0x3d9f72['content'])return _0x3d9f72;return{..._0x3d9f72,'content':processContentVariables(_0x3d9f72['content'],_0x3f5eef,_0x119ae5)};});}function processContentVariables(_0x1595a9,_0x4b41ac,_0x227e93){const _0x7d711a={'oCVeF':function(_0xaaee8c,_0x3422ca,_0x7b755c,_0xd77f74){return _0xaaee8c(_0x3422ca,_0x7b755c,_0xd77f74);},'PhWtH':'SpTWp','NgeVC':'TWisP','sYcnz':function(_0x3f1304,_0x2ee0b3){return _0x3f1304===_0x2ee0b3;},'RmCdT':_0x67aec8(0x205,0x235,0x20a,0x203),'UVngn':function(_0x4f3f42,_0x27ea05){return _0x4f3f42===_0x27ea05;},'LOtRg':_0x2c8c5f(0x148,0xf6,0x142,0x11b),'FCmxa':function(_0x2a39e3,_0x5047a2){return _0x2a39e3!==_0x5047a2;},'amSAe':_0x2c8c5f(0x140,0x175,0x15e,0x11e),'nZfDd':function(_0x303cfc,_0xbe8315,_0xe04800,_0x5bc7f0){return _0x303cfc(_0xbe8315,_0xe04800,_0x5bc7f0);}};function _0x2c8c5f(_0x3c7eac,_0x5d2821,_0x29c5b7,_0x4f7354){return _0x1d7b(_0x29c5b7- -0x6a,_0x4f7354);}function _0x67aec8(_0x8b325d,_0x58f3a9,_0x5c2e3f,_0x1ce6dd){return _0x1d7b(_0x1ce6dd-0x1b,_0x8b325d);}if(_0x7d711a['UVngn'](typeof _0x1595a9,_0x7d711a[_0x2c8c5f(0x13d,0x192,0x174,0x166)]))return _0x7d711a[_0x2c8c5f(0xfa,0x14f,0x121,0xe5)](processStringVariables,_0x1595a9,_0x4b41ac,_0x227e93);if(Array[_0x67aec8(0x235,0x1c1,0x1e1,0x200)](_0x1595a9))return _0x1595a9['map'](_0x57e09a=>{const _0x317224={'RAxfw':function(_0x9140f2,_0xeb19c2,_0x17b3bf,_0x3d9a80){function _0x14d6c2(_0x56725e,_0x60e67c,_0x5918c5,_0x2bac3d){return _0x1d7b(_0x60e67c-0x138,_0x56725e);}return _0x7d711a[_0x14d6c2(0x34d,0x303,0x319,0x33b)](_0x9140f2,_0xeb19c2,_0x17b3bf,_0x3d9a80);}};function _0x2e0ff0(_0x2baf59,_0x374660,_0x9aecfe,_0x53f4ea){return _0x67aec8(_0x374660,_0x374660-0x163,_0x9aecfe-0x121,_0x2baf59- -0x3bb);}function _0x41c4cc(_0x216cdf,_0x30dae6,_0x4750b2,_0x31b62d){return _0x2c8c5f(_0x216cdf-0x11a,_0x30dae6-0x4a,_0x31b62d-0x212,_0x4750b2);}if(_0x7d711a[_0x2e0ff0(-0x1c8,-0x1eb,-0x1a2,-0x1e4)]!==_0x7d711a[_0x2e0ff0(-0x1ff,-0x212,-0x216,-0x20c)]){if(_0x57e09a&&_0x7d711a[_0x41c4cc(0x34a,0x334,0x367,0x319)](_0x57e09a['type'],_0x7d711a[_0x2e0ff0(-0x244,-0x243,-0x200,-0x21e)])&&_0x7d711a['UVngn'](typeof _0x57e09a['text'],_0x7d711a[_0x41c4cc(0x3cd,0x342,0x3a9,0x386)])){if(_0x7d711a[_0x41c4cc(0x369,0x397,0x3b3,0x37c)](_0x2e0ff0(-0x1d8,-0x18d,-0x220,-0x1af),_0x7d711a['amSAe'])){if(!_0x5338ff||!_0x581416[_0x41c4cc(0x340,0x2fa,0x2fe,0x320)])return _0x596a3b;return{..._0x25345a,'content':_0x317224[_0x2e0ff0(-0x1eb,-0x1d8,-0x1b8,-0x1b9)](_0xb57fee,_0x161a49[_0x41c4cc(0x34b,0x348,0x363,0x320)],_0x57cb15,_0x3d6ade)};}else return{..._0x57e09a,'text':_0x7d711a[_0x41c4cc(0x3a7,0x3c1,0x34b,0x373)](processStringVariables,_0x57e09a['text'],_0x4b41ac,_0x227e93)};}return _0x57e09a;}else return![];});return _0x1595a9;}function processStringVariables(_0x2ef454,_0x946daf,_0x2a3571){const _0x411e99={'AzFuu':function(_0x141f2c,_0x24e6d3){return _0x141f2c===_0x24e6d3;},'BpSYR':'yvSEB','vFakv':function(_0x5dcda8,_0x28abf6,_0x1c8bcf){return _0x5dcda8(_0x28abf6,_0x1c8bcf);},'AOsfR':function(_0x59b0b,_0x5b7088){return _0x59b0b!==_0x5b7088;},'SgAMl':'bOsdp','NmABY':_0x2453d3(-0x207,-0x205,-0x223,-0x237),'iAMYi':_0x2453d3(-0x216,-0x22f,-0x26f,-0x22d),'aPsXf':function(_0x4cbeeb,_0x46c943){return _0x4cbeeb(_0x46c943);}};if(!_0x2ef454)return _0x2ef454;let _0x100d49=_0x2ef454;_0x100d49=_0x100d49[_0x26fe79(0xd2,0x8b,0x8c,0x89)](/\{@setvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x4dbd80,_0x4de855,_0x2cc93a)=>{const _0x4a66a4=_0x4de855[_0x38dde1(0x3e3,0x431,0x467,0x44a)]();_0x946daf[_0x38dde1(0x40f,0x449,0x428,0x423)+'ta'][_0x38dde1(0x41e,0x41e,0x44f,0x44b)][_0x4a66a4]=_0x2cc93a;function _0x405444(_0x221f9d,_0x5de20a,_0x210913,_0x1574aa){return _0x2453d3(_0x221f9d-0x1d9,_0x210913-0xe3,_0x210913-0x142,_0x5de20a);}_0x2a3571&&_0x2a3571[_0x38dde1(0x4a9,0x46b,0x426,0x4af)](_0x38dde1(0x4a2,0x4a2,0x47a,0x466)+_0x4a66a4+'@}');function _0x38dde1(_0xe75428,_0x120c45,_0x3f0a8c,_0x8734ee){return _0x2453d3(_0xe75428-0x147,_0x120c45-0x658,_0x3f0a8c-0x1e9,_0x8734ee);}return'';}),_0x100d49=_0x100d49['replace'](/\{@getvar::([^@]+)@\}/g,(_0x112ef0,_0x55ceb1)=>{const _0x480b48=_0x55ceb1['trim']();function _0x1c4923(_0x15545d,_0x55b33d,_0x21387d,_0x2f8f39){return _0x2453d3(_0x15545d-0x1ab,_0x55b33d- -0x44,_0x21387d-0x8f,_0x2f8f39);}const _0xad2a61=_0x946daf[_0x413326(-0x8b,-0x96,-0x5a,-0x9b)+'ta'][_0x1c4923(-0x2bf,-0x27e,-0x28f,-0x252)][_0x480b48]||'';if(_0x2a3571){if(_0x411e99[_0x413326(-0x6f,-0x4e,-0x10,-0x95)](_0x411e99[_0x1c4923(-0x1fd,-0x244,-0x28d,-0x219)],_0x411e99['BpSYR']))_0x2a3571[_0x413326(-0x26,-0x74,-0x8c,-0xbd)](_0x413326(-0x97,-0xb3,-0x74,-0x100)+_0x480b48+'@}');else{const _0x258318={..._0x3ece04};_0x27128d=_0x258318;}}function _0x413326(_0x18615c,_0x1dc461,_0x3b2b24,_0x52bc47){return _0x2453d3(_0x18615c-0x20,_0x1dc461-0x179,_0x3b2b24-0x2c,_0x3b2b24);}return _0xad2a61;}),_0x100d49=_0x100d49[_0x2453d3(-0x1b5,-0x1c5,-0x1e4,-0x1a2)](/\{@setglobalvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x3a1828,_0x1694db,_0x36b541)=>{const _0x241a78=_0x1694db[_0xee644c(0x26b,0x23d,0x235,0x29f)]();function _0xee644c(_0x733b51,_0x1fdbee,_0x2767b0,_0x193590){return _0x2453d3(_0x733b51-0x1ad,_0x733b51-0x492,_0x2767b0-0x3e,_0x2767b0);}function _0x2db143(_0x1adf31,_0x4ca1f4,_0x2d65e9,_0x3a6991){return _0x26fe79(_0x1adf31-0x1d5,_0x4ca1f4-0x54,_0x2d65e9,_0x4ca1f4-0x337);}return _0x411e99['vFakv'](setglobalvar,_0x241a78,_0x36b541),_0x2a3571&&(_0x411e99['AOsfR'](_0x411e99[_0x2db143(0x405,0x3df,0x3f0,0x3e7)],_0x411e99[_0xee644c(0x297,0x279,0x272,0x25c)])?_0x2a3571[_0x2db143(0x3e2,0x398,0x36f,0x3c2)](_0x2db143(0x375,0x3ac,0x3cc,0x3f3)+_0xee644c(0x2b5,0x2c5,0x277,0x2e3)+_0x241a78+'@}'):_0x564020&&_0x199890[_0xee644c(0x2a5,0x28f,0x267,0x263)](_0xa74684)),'';}),_0x100d49=_0x100d49[_0x2453d3(-0x177,-0x1c5,-0x1fe,-0x1a3)](/\{@getglobalvar::([^@]+)@\}/g,(_0x20d80a,_0x297a40)=>{const _0x603abc=_0x297a40[_0x14cc21(-0x133,-0x114,-0x100,-0x119)]();function _0x14cc21(_0x1557cf,_0x4661bc,_0x4a7c8c,_0x417e23){return _0x2453d3(_0x1557cf-0x1c1,_0x417e23-0x10e,_0x4a7c8c-0x1c5,_0x1557cf);}function _0x3d8feb(_0x45fb25,_0x44faf2,_0x58babf,_0x5b991b){return _0x26fe79(_0x45fb25-0x118,_0x44faf2-0xb1,_0x44faf2,_0x5b991b-0x1ce);}const _0x367edc=getglobalvar(_0x603abc)||'';if(_0x2a3571){if(_0x411e99['iAMYi']!==_0x411e99[_0x14cc21(-0x155,-0x132,-0xe4,-0x12f)]){const _0x39ed2a='{{getvar::'+_0x300c6e+'}}',_0x5cafc8=_0x23ecb2[_0x201964]||'';_0x3b96fb=_0x3e6958(_0x2077d6,_0x39ed2a,_0x5cafc8,_0x6cc4d3);}else _0x2a3571[_0x3d8feb(0x231,0x209,0x1fc,0x22f)](_0x3d8feb(0x23f,0x215,0x1d8,0x1fb)+'lvar::'+_0x603abc+'@}');}return _0x367edc;});function _0x2453d3(_0x4c3eb3,_0x211e99,_0x540344,_0x24e1a8){return _0x1d7b(_0x211e99- -0x391,_0x24e1a8);}function _0x26fe79(_0x18db21,_0x1adc7d,_0x2c8206,_0x5a7a51){return _0x1d7b(_0x5a7a51- -0x143,_0x2c8206);}return _0x100d49=_0x100d49[_0x2453d3(-0x1e9,-0x1c5,-0x1da,-0x190)](/\{@getworldvar::([^@]+)@\}/g,(_0x4e6303,_0x5b3311)=>{function _0x47d87d(_0x1fda0e,_0x17f087,_0x2db971,_0x41aa32){return _0x26fe79(_0x1fda0e-0x15c,_0x17f087-0x67,_0x41aa32,_0x1fda0e- -0x3b);}function _0x171040(_0x5b640d,_0x4814d2,_0x93a54,_0x1f75a5){return _0x26fe79(_0x5b640d-0x156,_0x4814d2-0x11b,_0x4814d2,_0x5b640d- -0x27f);}const _0x380dbe=_0x5b3311[_0x47d87d(-0x14,0x1a,0x2f,0x4)](),_0x350b1d=_0x411e99[_0x171040(-0x23a,-0x266,-0x21b,-0x1f4)](getworldvar,_0x380dbe)||'';return _0x2a3571&&_0x2a3571[_0x171040(-0x21e,-0x22c,-0x24a,-0x245)](_0x47d87d(-0x21,0x1d,0x21,-0x2)+_0x47d87d(0x4b,0x5d,0x7e,0x40)+_0x380dbe+'@}'),_0x350b1d;}),_0x100d49;}export function buildPromptWithTrigger(_0xc4ccfb){const _0x3301f1={'IyNrY':function(_0x43d8e8,_0x5866af){return _0x43d8e8+_0x5866af;},'gZgFA':function(_0x33c9a1,_0x15a7d0){return _0x33c9a1+_0x15a7d0;},'vGWps':function(_0x550714,_0xacb924,_0x5782ca,_0x3ffdc2){return _0x550714(_0xacb924,_0x5782ca,_0x3ffdc2);},'KrTKz':_0xdcf67f(-0x73,-0x74,-0x30,-0x6f),'BQHbW':function(_0x1f1a34,_0x9601d9){return _0x1f1a34===_0x9601d9;},'kboKV':function(_0x5edd09,_0xa02c64){return _0x5edd09===_0xa02c64;},'Ksfyw':_0xdcf67f(-0xa,-0x1c,-0x65,-0x26),'OqUUy':_0x3938ef(0x42f,0x3d0,0x3fc,0x408),'ScErt':function(_0x20058b,_0x1f888b){return _0x20058b===_0x1f888b;},'LhdYm':'DtIRy','ypKOy':_0x3938ef(0x433,0x42d,0x3ea,0x405),'qfgrs':function(_0x5279c3,_0x339e11){return _0x5279c3!==_0x339e11;},'VeAgS':function(_0x1f471f,_0x13e74e){return _0x1f471f!==_0x13e74e;},'jfefT':_0x3938ef(0x3c8,0x43a,0x416,0x40f),'jVlrK':_0xdcf67f(-0x35,-0x28,-0xad,-0x66),'uWOhQ':function(_0x360ca2,_0x163255){return _0x360ca2(_0x163255);},'tFSrq':function(_0x1d3bc4,_0x53515c,_0x2f095d){return _0x1d3bc4(_0x53515c,_0x2f095d);}},{requestType:_0x511c52,contextData:_0x155950}=_0xc4ccfb,_0x366fb7=extension_settings[extensionName]?.['llm_reques'+_0xdcf67f(-0x18,-0x51,-0x4e,-0x15)+_0xdcf67f(-0xbe,-0x6b,-0x6a,-0x78)]||{},_0x1bf1e1={};_0x1bf1e1[_0x3938ef(0x465,0x489,0x475,0x4a7)+_0xdcf67f(0x4e,-0x6,-0x27,0x2)]='默认';function _0xdcf67f(_0x930f8e,_0x58ebff,_0x4a030c,_0x172594){return _0x1d7b(_0x172594- -0x1ce,_0x4a030c);}const _0x5b28fc=_0x366fb7[_0x511c52]||_0x1bf1e1,_0x5a041c=_0x5b28fc[_0xdcf67f(-0x7,0xf,0x20,0x12)+_0xdcf67f(-0x3d,0x1a,-0x39,0x2)]||'默认',_0x280268=extension_settings[extensionName]?.[_0x3938ef(0x43e,0x476,0x45c,0x418)+_0xdcf67f(-0x2b,-0x64,-0x73,-0x5a)+'s']||{},_0x4bcc50=_0x280268[_0x5a041c]||_0x280268[Object['keys'](_0x280268)[-0x1f08+0x2271+0x3*-0x123]]||{},{context:context='',body:body='',worldBookContent:worldBookContent='',userDemand:userDemand=''}=_0x155950;function _0x3938ef(_0xa47877,_0x193adb,_0x17b325,_0x3b543e){return _0x1d7b(_0x17b325-0x295,_0x3b543e);}const _0x546bb2=[userDemand,context,body,worldBookContent]['filter'](Boolean)[_0xdcf67f(-0x20,-0x83,-0x2d,-0x58)]('\x0a'),_0x52b6f4=[];if(_0x4bcc50[_0xdcf67f(-0x6,-0x54,0x4,-0x12)]&&Array['isArray'](_0x4bcc50[_0xdcf67f(-0x42,-0x1c,-0x33,-0x12)]))for(const _0xf24550 of _0x4bcc50[_0x3938ef(0x413,0x40e,0x451,0x49c)]){if(_0x3301f1[_0xdcf67f(0xe,-0x1e,-0x59,-0x14)]===_0x3938ef(0x436,0x3cf,0x3f4,0x3e8)){if(!_0xf24550[_0x3938ef(0x453,0x496,0x471,0x46c)])continue;if(!_0xf24550[_0xdcf67f(-0x69,-0x15,-0x1c,-0x56)]||_0x3301f1[_0x3938ef(0x415,0x418,0x450,0x438)](_0xf24550[_0x3938ef(0x412,0x3d0,0x40d,0x3f4)]['trim'](),''))continue;if(_0x3301f1[_0xdcf67f(-0x75,-0x83,-0x8b,-0x47)](_0xf24550[_0xdcf67f(-0x1e,-0x1e,-0x5a,-0x48)+'e'],_0x3301f1['Ksfyw'])){if(!checkTriggerWords(_0xf24550['triggerWor'+'ds'],_0x546bb2))continue;}const _0x216271={};_0x216271[_0x3938ef(0x440,0x449,0x47f,0x46d)]=_0xf24550['role']||_0x3301f1['OqUUy'],_0x216271[_0xdcf67f(-0x21,-0x49,-0x95,-0x56)]=_0xf24550['content'],_0x52b6f4['push'](_0x216271);}else return![];}else{if(_0x4bcc50[_0xdcf67f(-0x2,-0x6c,-0x2d,-0x4a)]&&Array[_0xdcf67f(0x5,-0x2,-0x34,0x17)](_0x4bcc50[_0xdcf67f(-0x6c,-0x42,-0x88,-0x4a)])){if(_0x3301f1[_0x3938ef(0x421,0x3cb,0x402,0x449)](_0x3301f1[_0x3938ef(0x42a,0x3f2,0x43b,0x43e)],'DtIRy'))for(const _0xc7d547 of _0x4bcc50[_0x3938ef(0x421,0x403,0x419,0x3f1)]){if(_0x3301f1['ypKOy']!==_0x3301f1[_0xdcf67f(-0x5d,-0x95,-0x79,-0x76)]){const _0x1ba4d2=_0x511220[_0x3938ef(0x415,0x3fb,0x3ff,0x3c5)](),_0x46439e=_0x3a23ef[_0x3938ef(0x449,0x3fe,0x417,0x464)+'ta']['variables'][_0x1ba4d2]||'';return _0x3eebc8&&_0x4bb5fc[_0xdcf67f(-0x24,-0x4b,-0x53,-0x2a)](_0xdcf67f(-0x3e,-0x87,-0x84,-0x69)+_0x1ba4d2+'@}'),_0x46439e;}else{if(_0xc7d547[_0xdcf67f(-0x67,-0xa8,-0x2a,-0x67)]&&_0x3301f1['qfgrs'](_0xc7d547[_0xdcf67f(-0x1b,-0x50,-0x1b,-0x67)]['trim'](),'')){const _0x296980={};_0x296980[_0x3938ef(0x43a,0x47c,0x47f,0x487)]=_0x3301f1['OqUUy'],_0x296980[_0x3938ef(0x403,0x3c1,0x40d,0x436)]=_0xc7d547[_0x3938ef(0x3f0,0x42c,0x3fc,0x414)],_0x52b6f4[_0x3938ef(0x3f9,0x3e6,0x3fb,0x41f)](_0x296980);}if(_0xc7d547[_0xdcf67f(-0x81,-0xb0,-0x85,-0x66)]&&_0x3301f1[_0xdcf67f(-0x33,-0x28,-0x70,-0x5c)](_0xc7d547['assistant']['trim'](),'')){if(_0x3301f1['jfefT']===_0x3301f1[_0xdcf67f(-0x63,-0x71,-0x88,-0x73)]){const _0x6801b6={};_0x6801b6[_0x3938ef(0x44a,0x4af,0x47f,0x4af)]=_0x3301f1[_0x3938ef(0x415,0x45b,0x431,0x454)],_0x6801b6[_0x3938ef(0x413,0x3ef,0x40d,0x42c)]=_0xc7d547[_0xdcf67f(-0x6b,-0x53,-0x5b,-0x66)],_0x52b6f4[_0x3938ef(0x3d7,0x417,0x3fb,0x409)](_0x6801b6);}else return _0x3301f1[_0xdcf67f(-0x79,0x0,-0x68,-0x3f)](_0x3301f1['gZgFA'](_0x3d34cf,'\x0a'),_0x2e8018);}}}else{if(!_0x703681||_0x203dd5[_0xdcf67f(-0x93,-0x70,-0x6b,-0x4b)]===-0x11*-0x125+-0x5b8+-0x1*0xdbd)return _0x2a6e51;const _0x41a1a9=_0x1207b4();return!_0x41a1a9[_0xdcf67f(-0x31,-0x96,-0x62,-0x4c)+'ta']&&(_0x41a1a9[_0x3938ef(0x3eb,0x3f9,0x417,0x3cc)+'ta']={}),!_0x41a1a9[_0x3938ef(0x41e,0x413,0x417,0x3d3)+'ta'][_0x3938ef(0x3d4,0x405,0x3ec,0x3f4)]&&(_0x41a1a9[_0x3938ef(0x464,0x3e3,0x417,0x460)+'ta'][_0xdcf67f(-0x53,-0x76,-0x4c,-0x77)]={}),_0x3cd3ab['map'](_0x49814f=>{if(!_0x49814f||!_0x49814f[_0x2c25c6(0x518,0x569,0x563,0x53a)])return _0x49814f;function _0x5728db(_0x40cc86,_0x384949,_0x2b17b6,_0x590a5b){return _0xdcf67f(_0x40cc86-0x1e4,_0x384949-0x1f1,_0x590a5b,_0x40cc86- -0x1bb);}function _0x2c25c6(_0x533d19,_0x109f2d,_0x47a020,_0x41712e){return _0x3938ef(_0x533d19-0x1a,_0x109f2d-0xbd,_0x41712e-0x12d,_0x533d19);}return{..._0x49814f,'content':_0x3301f1[_0x2c25c6(0x4da,0x524,0x535,0x522)](_0x5528ab,_0x49814f[_0x5728db(-0x211,-0x257,-0x257,-0x207)],_0x41a1a9,_0x45523a)};});}}}const _0x20f463=_0x3301f1['uWOhQ'](mergeAdjacentMessages,_0x52b6f4),{messages:_0x41a337,replacedVariables:_0x27d464}=_0x3301f1[_0xdcf67f(-0x33,-0xad,-0xac,-0x62)](replaceAllPlaceholders,_0x20f463,_0x155950);return _0x41a337;}export function getProcessedPrompt(_0x17f639,_0x11c820){function _0x53fd2b(_0x339aee,_0x285001,_0x2974ce,_0x39c64e){return _0x1d7b(_0x2974ce- -0x243,_0x339aee);}function _0x2e68a3(_0x56d713,_0x325fbf,_0x5cc765,_0x2c8dc7){return _0x1d7b(_0x2c8dc7- -0x19b,_0x325fbf);}const _0x612132={'mPdQB':function(_0x11702b,_0x58a047){return _0x11702b(_0x58a047);}},_0x5511a5={};return _0x5511a5[_0x53fd2b(-0xb2,-0x77,-0xbe,-0xe0)+'e']=_0x17f639,_0x5511a5[_0x53fd2b(-0xb7,-0x70,-0xab,-0xa2)+'a']=_0x11c820,_0x612132['mPdQB'](buildPromptWithTrigger,_0x5511a5);}