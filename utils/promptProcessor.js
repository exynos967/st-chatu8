(function(_0x24092c,_0xa927df){function _0x7975f4(_0x3aa0cc,_0x5118c4,_0x1f4c33,_0x512bbf){return _0x4699(_0x5118c4-0x37a,_0x1f4c33);}function _0x5587b0(_0x194b5e,_0x2d8419,_0x22926b,_0x2efd46){return _0x4699(_0x194b5e-0x205,_0x22926b);}const _0x5f100e=_0x24092c();while(!![]){try{const _0x5cd000=-parseInt(_0x5587b0(0x2ba,0x28d,0x294,0x278))/(-0x1*-0x1ba1+0x6d*-0x2f+0x1*-0x79d)*(parseInt(_0x7975f4(0x427,0x41b,0x40e,0x3ef))/(0xa8+0x61*-0x5e+0x22f8))+-parseInt(_0x7975f4(0x48c,0x44c,0x47b,0x44f))/(0xf27+0x9af*0x2+-0x2282)+parseInt(_0x7975f4(0x437,0x426,0x407,0x403))/(0x2d2*0x8+0x319+0x65*-0x41)+-parseInt(_0x7975f4(0x3bd,0x3f0,0x3d4,0x419))/(0x1357+-0x786+-0xbcc)+parseInt(_0x7975f4(0x446,0x41a,0x40d,0x44d))/(0x17ad+-0xf51+0x42b*-0x2)*(-parseInt(_0x5587b0(0x304,0x2d3,0x2be,0x31b))/(-0x2*0x581+0x2638+-0x1b2f))+parseInt(_0x5587b0(0x280,0x2b3,0x279,0x2b3))/(-0xf5c+0x6*-0x2f+-0x83f*-0x2)+-parseInt(_0x5587b0(0x303,0x31b,0x333,0x302))/(-0x273*0x2+-0x393+0x882)*(-parseInt(_0x7975f4(0x3f1,0x427,0x44b,0x445))/(-0xa47+-0x1ef0+-0x1*-0x2941));if(_0x5cd000===_0xa927df)break;else _0x5f100e['push'](_0x5f100e['shift']());}catch(_0x285a0c){_0x5f100e['push'](_0x5f100e['shift']());}}}(_0x140a,-0x48f85*0x3+-0xf*0x87cd+0xad231*0x3));const _0x242f6f=(function(){const _0x118571={};function _0x4ec48c(_0x4856e2,_0x311fb3,_0x253457,_0x52f4cf){return _0x4699(_0x4856e2- -0x98,_0x253457);}function _0x5a007e(_0x194add,_0x57ef39,_0x4bf21e,_0x41eb8c){return _0x4699(_0x41eb8c- -0x2c2,_0x57ef39);}_0x118571[_0x4ec48c(0x5a,0x46,0x56,0x2a)]=function(_0xbd962b,_0x198e40){return _0xbd962b!==_0x198e40;},_0x118571[_0x5a007e(-0x1dc,-0x193,-0x17c,-0x1c0)]=_0x5a007e(-0x23e,-0x259,-0x285,-0x257);const _0x4b0259=_0x118571;let _0xc799ce=!![];return function(_0x4f94cb,_0x55bfeb){const _0x343894=_0xc799ce?function(){function _0x3594b6(_0x43e6f2,_0x102e20,_0x59de24,_0x37779b){return _0x4699(_0x59de24- -0xb4,_0x43e6f2);}function _0x5969c3(_0xde1554,_0x25da80,_0x4e0639,_0x2a65b7){return _0x4699(_0xde1554-0x75,_0x4e0639);}if(_0x55bfeb){if(_0x4b0259['LowqL'](_0x5969c3(0x17a,0x12e,0x14f,0x1ca),_0x4b0259['tikjn'])){const _0x1a693c=_0x55bfeb['apply'](_0x4f94cb,arguments);return _0x55bfeb=null,_0x1a693c;}else{const _0x179ab2=/\{\{getvar::([^}]+)\}\}/g,_0x340ff9=_0x1ad69f['stringify'](_0x51cfc9),_0x5acb85=[..._0x340ff9['matchAll'](_0x179ab2)],_0x38cc22=new _0x493247();for(const _0x107c9e of _0x5acb85){_0x38cc22[_0x3594b6(-0x80,-0xb,-0x4d,-0x48)](_0x107c9e[0x10be+0x1f4+-0x12b1]);}for(const _0x5cde75 of _0x38cc22){const _0x3807c8='{{getvar::'+_0x5cde75+'}}',_0x5f6ad2=_0x1c8379[_0x5cde75]||'';_0x42ca01=_0x365379(_0x30b46d,_0x3807c8,_0x5f6ad2,_0x1228b7);}}}}:function(){};return _0xc799ce=![],_0x343894;};}()),_0x157821=_0x242f6f(this,function(){const _0x11c83d={};function _0x5ea549(_0x59345d,_0x332ac8,_0x538a6d,_0x14c623){return _0x4699(_0x538a6d-0x240,_0x332ac8);}_0x11c83d['hVioF']=_0x5ea549(0x2dc,0x2fa,0x325,0x308)+'+$';const _0x43cef2=_0x11c83d;function _0x25f66a(_0x345468,_0xed3ab0,_0x46dcc9,_0x3bfa60){return _0x4699(_0x3bfa60- -0x32,_0xed3ab0);}return _0x157821['toString']()[_0x25f66a(0x78,0xb0,0xb2,0x99)](_0x43cef2[_0x25f66a(0x67,0x58,0x11,0x47)])[_0x5ea549(0x318,0x305,0x2cf,0x2ef)]()['constructo'+'r'](_0x157821)[_0x25f66a(0x4d,0x55,0xbe,0x99)](_0x43cef2[_0x5ea549(0x2d4,0x29c,0x2b9,0x2dd)]);});_0x157821();import{extension_settings}from'../../../../extensions.js';import{extensionName}from'./config.js';import{getContext}from'../../../../st-context.js';import{getglobalvar,setglobalvar}from'./chatDataUtils.js';function _0x4699(_0x4965b2,_0x14e010){_0x4965b2=_0x4965b2-(0x1877+0x1900+-0x3110);const _0x26c262=_0x140a();let _0x19639d=_0x26c262[_0x4965b2];if(_0x4699['RxiBpV']===undefined){var _0x534d36=function(_0x568b87){const _0x49c38d='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x57427b='',_0x3af2a6='',_0x12ac5b=_0x57427b+_0x534d36;for(let _0x49b4d9=-0x16a7+0x9b*0x1f+0x3e2,_0x2db646,_0x1a2c11,_0x3c8a41=0x1fd*0x8+0x283*0x5+-0x1c77;_0x1a2c11=_0x568b87['charAt'](_0x3c8a41++);~_0x1a2c11&&(_0x2db646=_0x49b4d9%(0x27d*0x4+-0x2*0xf3b+-0x8e*-0x25)?_0x2db646*(-0x21dc+-0x7d5*0x3+0x399b)+_0x1a2c11:_0x1a2c11,_0x49b4d9++%(0x24e+0x2*0x1183+-0x2550))?_0x57427b+=_0x12ac5b['charCodeAt'](_0x3c8a41+(0x175*-0xe+-0x1*0x2d7+0x1747))-(0x929+0x263c+0x9*-0x543)!==-0x1d21*-0x1+0x42*0x9+-0x1f73?String['fromCharCode'](0x1721+0x420+-0x1a42&_0x2db646>>(-(-0x1b*-0xce+0x2*-0x71+-0x379*0x6)*_0x49b4d9&0x1b1*0x12+0xe25+-0x2c91)):_0x49b4d9:-0x4c*0x52+-0x21e+0x1a76){_0x1a2c11=_0x49c38d['indexOf'](_0x1a2c11);}for(let _0x3d355f=0x1f93+0x1b18+0x1*-0x3aab,_0x5ec2e8=_0x57427b['length'];_0x3d355f<_0x5ec2e8;_0x3d355f++){_0x3af2a6+='%'+('00'+_0x57427b['charCodeAt'](_0x3d355f)['toString'](-0x138d+0x2*-0x521+0x9f5*0x3))['slice'](-(-0x4*0x3d4+0x7d0+0x1*0x782));}return decodeURIComponent(_0x3af2a6);};_0x4699['pJcUDJ']=_0x534d36,_0x4699['CtJLtG']={},_0x4699['RxiBpV']=!![];}const _0x3ceb3a=_0x26c262[-0x18bc+0x7*0x3e5+-0x287],_0x41a737=_0x4965b2+_0x3ceb3a,_0x6c847a=_0x4699['CtJLtG'][_0x41a737];if(!_0x6c847a){const _0x36c7a8=function(_0x3f9ded){this['iWbzIJ']=_0x3f9ded,this['QnUJog']=[0x8be+-0x1add+0xe8*0x14,0xa*-0x16+-0x138a+0x1466,-0x1de7+-0x29*0x9e+0x3735*0x1],this['RSgLYM']=function(){return'newState';},this['rIuLaN']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['btEhEr']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x36c7a8['prototype']['NFFoLk']=function(){const _0x20c55a=new RegExp(this['rIuLaN']+this['btEhEr']),_0x327daf=_0x20c55a['test'](this['RSgLYM']['toString']())?--this['QnUJog'][0x5*-0x509+0x4e*-0x7d+-0x2*-0x1fa2]:--this['QnUJog'][0xd3*0x7+-0x3*-0xb99+-0x2890];return this['QPvrde'](_0x327daf);},_0x36c7a8['prototype']['QPvrde']=function(_0x50211c){if(!Boolean(~_0x50211c))return _0x50211c;return this['unOSVN'](this['iWbzIJ']);},_0x36c7a8['prototype']['unOSVN']=function(_0x5c7033){for(let _0x478b4d=-0xdba+0x16d4+-0x91a,_0x146b09=this['QnUJog']['length'];_0x478b4d<_0x146b09;_0x478b4d++){this['QnUJog']['push'](Math['round'](Math['random']())),_0x146b09=this['QnUJog']['length'];}return _0x5c7033(this['QnUJog'][0xe16*0x1+0x20ce+-0x2ee4]);},new _0x36c7a8(_0x4699)['NFFoLk'](),_0x19639d=_0x4699['pJcUDJ'](_0x19639d),_0x4699['CtJLtG'][_0x41a737]=_0x19639d;}else _0x19639d=_0x6c847a;return _0x19639d;}import{getworldvar}from'./worldbookProcessor.js';export function checkTriggerWords(_0x34c295,_0x33eb11){const _0x41e46f={};_0x41e46f['ipRJr']=_0x19d296(-0xdb,-0xd4,-0x9c,-0xed),_0x41e46f[_0x19d296(-0xe0,-0xcf,-0x12b,-0xe4)]='Ymumb';const _0x442ae3=_0x41e46f;if(!_0x34c295||!_0x33eb11)return![];function _0x19d296(_0x79c882,_0x159b03,_0x4f5af3,_0x515b6a){return _0x4699(_0x515b6a- -0x170,_0x159b03);}const _0x25bfb4=_0x34c295[_0x19d296(-0x97,-0xd1,-0xc3,-0xb9)](',')['map'](_0x406385=>_0x406385[_0x19d296(-0x76,-0x102,-0xc6,-0xb7)]())[_0x21f2eb(0x122,0xdc,0x16d,0x10b)](_0x4625c4=>_0x4625c4);function _0x21f2eb(_0x3feb0d,_0x282362,_0xb1d6de,_0x6c54ba){return _0x4699(_0x3feb0d-0x2d,_0xb1d6de);}if(_0x25bfb4['length']===-0x1107+-0x1ca8+0x2daf)return _0x442ae3[_0x19d296(-0x86,-0x8a,-0xc4,-0x73)]!==_0x442ae3[_0x21f2eb(0xb9,0x100,0x69,0x68)]?![]:[];for(const _0x4e401c of _0x25bfb4){if(_0x33eb11[_0x19d296(-0xbb,-0xae,-0x4d,-0x8d)](_0x4e401c))return!![];}return![];}export function mergeAdjacentMessages(_0xbb2188){const _0x3add3e={'PXBJP':function(_0x472432,_0x4815d9){return _0x472432===_0x4815d9;},'qZslV':function(_0x4548fe,_0x17dd50){return _0x4548fe===_0x17dd50;},'DTxOH':_0x255c64(0x27a,0x2e2,0x299,0x2b7),'BGxqn':function(_0x3037af,_0x4e8e6b,_0x61e1ea){return _0x3037af(_0x4e8e6b,_0x61e1ea);},'pbqww':'HgVpb'};if(!_0xbb2188||_0xbb2188[_0x255c64(0x263,0x240,0x21f,0x1da)]===0x13c5+0xb26+0x1*-0x1eeb)return[];function _0x255c64(_0x41592f,_0xc3de4f,_0x325267,_0x520354){return _0x4699(_0x325267-0x1a0,_0x520354);}function _0x21b353(_0x5c34b7,_0xd85a9,_0x1bcdca,_0x3e8819){return _0x4699(_0xd85a9- -0x3a2,_0x1bcdca);}const _0x899e70=[];let _0x4f16dc=null;for(const _0xc793fc of _0xbb2188){if(!_0x4f16dc){const _0x1c61d9={..._0xc793fc};_0x4f16dc=_0x1c61d9;}else{if(_0x3add3e[_0x21b353(-0x25f,-0x2ab,-0x279,-0x276)](_0x4f16dc['role'],_0xc793fc[_0x21b353(-0x2d9,-0x29e,-0x2cd,-0x255)])){if(_0x3add3e[_0x21b353(-0x29c,-0x2c9,-0x28f,-0x2f9)](_0x3add3e[_0x255c64(0x270,0x272,0x2a7,0x2af)],_0x3add3e[_0x255c64(0x287,0x2bb,0x2a7,0x2a8)]))_0x4f16dc[_0x255c64(0x269,0x271,0x225,0x242)]=_0x3add3e[_0x21b353(-0x2f3,-0x31e,-0x34d,-0x321)](mergeContent,_0x4f16dc[_0x255c64(0x1eb,0x22f,0x225,0x1f6)],_0xc793fc[_0x255c64(0x20f,0x263,0x225,0x20a)]);else{const _0x124372={};return _0x124372[_0x21b353(-0x2eb,-0x2e3,-0x2ba,-0x2cd)+'e']=_0x1b9fa3,_0x124372[_0x255c64(0x296,0x2bd,0x28f,0x279)+'a']=_0x305a6f,_0x30697a(_0x124372);}}else{if(_0x3add3e[_0x21b353(-0x2f5,-0x2ab,-0x2b6,-0x25d)](_0x21b353(-0x2ba,-0x2b8,-0x28b,-0x2f5),_0x3add3e['pbqww'])){_0x899e70[_0x255c64(0x249,0x2a8,0x28c,0x28e)](_0x4f16dc);const _0x1b3edb={..._0xc793fc};_0x4f16dc=_0x1b3edb;}else return![];}}}return _0x4f16dc&&_0x899e70[_0x255c64(0x2dd,0x281,0x28c,0x28c)](_0x4f16dc),_0x899e70;}function mergeContent(_0x1ab357,_0x724bbe){const _0x12948b={'sOklO':function(_0x20471b,_0xea7671){return _0x20471b===_0xea7671;},'Cxmkx':_0x5ce043(-0x21e,-0x215,-0x22c,-0x257),'jYWYj':function(_0x114d84,_0x3e9ded){return _0x114d84+_0x3e9ded;},'KAwRL':function(_0x41e62b,_0x4575fa){return _0x41e62b(_0x4575fa);}};if(_0x12948b[_0x557f0d(0x19,0x3f,0x4f,0x8c)](typeof _0x1ab357,_0x12948b[_0x5ce043(-0x1de,-0x1c0,-0x1a0,-0x1eb)])&&_0x12948b[_0x557f0d(0x54,0x3f,0x6b,0x7a)](typeof _0x724bbe,_0x12948b[_0x557f0d(0x80,0x7b,0x3e,0x69)]))return _0x12948b[_0x557f0d(0x34,0x30,0x3f,0x0)](_0x12948b[_0x557f0d(0x7e,0x30,0x46,0x14)](_0x1ab357,'\x0a'),_0x724bbe);const _0x7f47f4=_0x12948b[_0x5ce043(-0x272,-0x282,-0x1fd,-0x235)](normalizeToArray,_0x1ab357),_0x3dcb38=_0x12948b[_0x557f0d(0x4e,0x31,-0x2,0x4f)](normalizeToArray,_0x724bbe),_0x25da5d={};function _0x5ce043(_0x2ce2dd,_0x186c09,_0x2b085c,_0x19e1fa){return _0x4699(_0x19e1fa- -0x2c6,_0x2b085c);}_0x25da5d['type']=_0x5ce043(-0x20c,-0x226,-0x22e,-0x1f3),_0x25da5d[_0x5ce043(-0x234,-0x1bb,-0x1ac,-0x1f3)]='\x0a';function _0x557f0d(_0x48af03,_0x5bd041,_0x37555e,_0x36ba1e){return _0x4699(_0x5bd041- -0x60,_0x48af03);}return[..._0x7f47f4,_0x25da5d,..._0x3dcb38];}function normalizeToArray(_0x5c9f0a){const _0x3caf9d={};_0x3caf9d[_0x18bdf5(-0x1f,0x6c,0x2a,0x2f)]=function(_0x2d9735,_0x2726dd){return _0x2d9735+_0x2726dd;};function _0x253940(_0xfa4a73,_0x52c08c,_0x116a8b,_0x433f87){return _0x4699(_0x52c08c-0x31e,_0xfa4a73);}_0x3caf9d[_0x18bdf5(0x90,0xae,0x86,0x66)]=function(_0x280428,_0x45236c){return _0x280428===_0x45236c;},_0x3caf9d['omouX']=_0x253940(0x386,0x3ce,0x3a9,0x3fb);function _0x18bdf5(_0x67285d,_0xbc55a7,_0x37b347,_0x2293c8){return _0x4699(_0x37b347- -0x3e,_0x2293c8);}_0x3caf9d[_0x18bdf5(0xda,0xfc,0xb8,0x89)]=_0x253940(0x3fd,0x407,0x416,0x3dd),_0x3caf9d[_0x18bdf5(0xcc,0xaf,0x92,0x47)]='text',_0x3caf9d[_0x18bdf5(0x9d,0xa2,0x7e,0x56)]=function(_0x3036bb,_0x4f4311){return _0x3036bb||_0x4f4311;};const _0x36eeba=_0x3caf9d;if(Array[_0x253940(0x428,0x3d8,0x39e,0x429)](_0x5c9f0a))return _0x36eeba[_0x253940(0x3fe,0x3e2,0x3d8,0x3b4)](_0x36eeba['omouX'],_0x36eeba[_0x253940(0x43f,0x414,0x434,0x455)])?_0x36eeba[_0x18bdf5(0x27,0x61,0x2a,-0x3)](_0x1eefb0,'\x0a')+_0x4b8d08:_0x5c9f0a;return[{'type':_0x36eeba[_0x253940(0x3b8,0x3ee,0x3bf,0x39e)],'text':_0x36eeba[_0x18bdf5(0xc5,0x3e,0x7e,0x72)](_0x5c9f0a,'')}];}export function replacePlaceholder(_0x5397da,_0x4338c2,_0x172d1a,_0x4a9f08){const _0x32242a={'QWkEH':function(_0x485ac2,_0x59dfa4,_0x5f2c1d,_0x25d806){return _0x485ac2(_0x59dfa4,_0x5f2c1d,_0x25d806);},'zXNKa':function(_0x7f13,_0x4b5f40){return _0x7f13===_0x4b5f40;},'uhIVZ':function(_0x110dcb,_0x5aead6){return _0x110dcb===_0x5aead6;},'oIEjY':_0x2acaa9(0x487,0x4bf,0x4e0,0x4a2),'IMPYT':'lETdM','IoZnT':'fxHsW','JBLPi':function(_0xa18829,_0x3091cb){return _0xa18829!==_0x3091cb;},'QDuTG':'EUnAq','oSEAL':'object'};if(_0x32242a['zXNKa'](typeof _0x5397da,_0x16ccab(0x1d3,0x20f,0x1af,0x194)))return _0x32242a[_0x16ccab(0x240,0x240,0x1f5,0x28a)](_0x32242a[_0x2acaa9(0x495,0x4ee,0x47f,0x4be)],_0x32242a[_0x16ccab(0x23e,0x224,0x276,0x284)])?(_0x172d1a&&_0x5397da['includes'](_0x4338c2)&&(_0x4a9f08&&(_0x32242a[_0x2acaa9(0x4aa,0x4a6,0x489,0x4c0)](_0x32242a[_0x16ccab(0x206,0x21a,0x249,0x234)],_0x32242a[_0x2acaa9(0x4cb,0x474,0x48d,0x48d)])?_0x2d1fd9[_0x16ccab(0x1cb,0x209,0x187,0x1e0)](_0x353997):_0x4a9f08[_0x2acaa9(0x402,0x454,0x43c,0x44b)](_0x4338c2))),_0x5397da['replaceAll'](_0x4338c2,_0x172d1a||'')):!![];if(Array['isArray'](_0x5397da)){if(_0x32242a[_0x2acaa9(0x4aa,0x444,0x4a0,0x464)](_0x32242a[_0x16ccab(0x1e5,0x21b,0x1f2,0x1fc)],'EUnAq')){if(!_0x4db857||!_0x30fe18[_0x2acaa9(0x491,0x49b,0x41b,0x469)])return _0x5f83c8;return{..._0x18caeb,'content':_0x32242a[_0x2acaa9(0x52c,0x4a5,0x4f6,0x4e5)](_0x2b20e1,_0x3a7819['content'],_0x5305bd,_0x148209)};}else return _0x5397da['map'](_0xc77a3=>replacePlaceholder(_0xc77a3,_0x4338c2,_0x172d1a,_0x4a9f08));}if(_0x5397da&&typeof _0x5397da===_0x32242a[_0x2acaa9(0x470,0x49a,0x485,0x4ba)]){const _0x31b158={};for(const _0x12af91 in _0x5397da){_0x31b158[_0x12af91]=replacePlaceholder(_0x5397da[_0x12af91],_0x4338c2,_0x172d1a,_0x4a9f08);}return _0x31b158;}function _0x2acaa9(_0x430315,_0x3b3170,_0x4d3513,_0x10682d){return _0x4699(_0x10682d-0x3e4,_0x3b3170);}function _0x16ccab(_0x534f2d,_0x2fc505,_0x22dd9a,_0x2dcc71){return _0x4699(_0x534f2d-0x164,_0x2fc505);}return _0x5397da;}export function replaceAllPlaceholders(_0x36cc6f,_0x34437d){const _0x55e811={'EPZKj':function(_0x5701d6){return _0x5701d6();},'sjDyN':function(_0x30c533,_0x589c76){return _0x30c533===_0x589c76;},'NQKNr':_0x5ac9e9(0xa5,0x7b,0x82,0x3e),'rekme':'zJalg','PykPv':_0x5ac9e9(-0xe,0x4,0x35,-0xd),'EnXfP':_0x5ac9e9(0x76,0xa0,0x60,0x67),'DQUua':function(_0x3b1b9c,_0x40f703,_0x5bcef3,_0x4d9717,_0x4b94f3){return _0x3b1b9c(_0x40f703,_0x5bcef3,_0x4d9717,_0x4b94f3);},'jUihB':_0x5ac9e9(0xbc,0xa4,0x9a,0xcd),'AOSQo':_0x5ac9e9(0x50,0x91,0x8a,0x47),'tXFps':function(_0x4c09ce,_0x49d539,_0x249a14,_0x25742c,_0x5b3277){return _0x4c09ce(_0x49d539,_0x249a14,_0x25742c,_0x5b3277);},'kUbcg':function(_0x590f28,_0x39da13,_0x30c858,_0x373f48,_0x4031c6){return _0x590f28(_0x39da13,_0x30c858,_0x373f48,_0x4031c6);},'OddfX':_0x5ac9e9(0x38,0x7e,0x85,0xcb)+'}}','LuSCr':function(_0x4633ce,_0x4561be,_0x1b948e,_0x4432bd,_0x512c63){return _0x4633ce(_0x4561be,_0x1b948e,_0x4432bd,_0x512c63);},'HXUGU':function(_0x11b4f3,_0x43f596){return _0x11b4f3>_0x43f596;},'wxnIY':function(_0x64fa29,_0xa2099f){return _0x64fa29!==_0xa2099f;},'GdtCq':'fvpib','ulrAH':function(_0x45c9ef,_0x331857,_0xb83c23,_0x4785e7,_0x3b8477){return _0x45c9ef(_0x331857,_0xb83c23,_0x4785e7,_0x3b8477);},'ZvUIV':function(_0x2f7d65,_0x2a67f8,_0x9f2d46){return _0x2f7d65(_0x2a67f8,_0x9f2d46);}},{context:context='',body:body='',worldBookContent:worldBookContent='',variables:variables={},userDemand:userDemand='',characterListText:characterListText='',outfitEnableListText:outfitEnableListText='',commonCharacterListText:commonCharacterListText=''}=_0x34437d,_0xdcec26=new Set();let _0x55a16c=_0x36cc6f;const _0x42f762=_0x55e811[_0x4cdf16(0x272,0x257,0x224,0x229)](getContext),_0x4106ff=_0x42f762?.[_0x4cdf16(0x2d1,0x2c4,0x288,0x2db)]||'';let _0x1d60a2=worldBookContent;_0x1d60a2&&(_0x55e811[_0x4cdf16(0x26b,0x281,0x245,0x24f)](_0x55e811[_0x4cdf16(0x250,0x240,0x243,0x222)],_0x55e811['rekme'])?_0x3649f6[_0x4752ab]=_0x1a7700(_0x401ef5[_0x3f62ce],_0x4ebd47,_0x36b172,_0x4be242):(_0x1d60a2=_0x1d60a2[_0x4cdf16(0x26f,0x290,0x2ac,0x2a2)](_0x55e811[_0x4cdf16(0x267,0x29e,0x2cf,0x26f)],_0x4106ff),_0x1d60a2=_0x1d60a2[_0x5ac9e9(0x62,0x51,0x57,0x59)](_0x55e811[_0x5ac9e9(-0x6,0x1d,0x5,-0x36)],_0x4106ff)));_0x55a16c=_0x55e811[_0x5ac9e9(0x63,0x34,0x34,0x45)](replacePlaceholder,_0x55a16c,_0x55e811[_0x4cdf16(0x22d,0x24d,0x21b,0x243)],context,_0xdcec26),_0x55a16c=replacePlaceholder(_0x55a16c,_0x55e811[_0x4cdf16(0x2ca,0x2a7,0x26e,0x28f)],_0x1d60a2,_0xdcec26),_0x55a16c=_0x55e811[_0x5ac9e9(-0x10,0x4d,0x3a,0x77)](replacePlaceholder,_0x55a16c,_0x4cdf16(0x291,0x275,0x2b9,0x2a7),body,_0xdcec26),_0x55a16c=_0x55e811[_0x5ac9e9(0x4d,0x6f,0x3a,0x7)](replacePlaceholder,_0x55a16c,_0x4cdf16(0x223,0x252,0x271,0x20e),characterListText,_0xdcec26),_0x55a16c=_0x55e811[_0x5ac9e9(0x71,0x52,0x61,0x94)](replacePlaceholder,_0x55a16c,'{{通用服装启用列表'+'}}',outfitEnableListText,_0xdcec26),_0x55a16c=_0x55e811[_0x4cdf16(0x291,0x273,0x29a,0x247)](replacePlaceholder,_0x55a16c,_0x55e811[_0x5ac9e9(0xc3,0x55,0x97,0xab)],commonCharacterListText,_0xdcec26),_0x55a16c=_0x55e811[_0x5ac9e9(0xb7,0x9b,0x9d,0xdb)](replacePlaceholder,_0x55a16c,_0x4cdf16(0x26f,0x267,0x239,0x2a2),userDemand,_0xdcec26);if(variables&&_0x55e811[_0x5ac9e9(0x47,0x2d,0x25,0x2c)](Object[_0x4cdf16(0x282,0x25d,0x21f,0x257)](variables)[_0x4cdf16(0x252,0x24f,0x253,0x242)],-0x11c8+-0x1*0x245f+0x3*0x120d)){const _0x248914=/\{\{getvar::([^}]+)\}\}/g,_0x12b92f=JSON['stringify'](_0x55a16c),_0xd7b957=[..._0x12b92f[_0x5ac9e9(0x15,0x18,0x4a,0x4b)](_0x248914)],_0x230395=new Set();for(const _0xf2fc17 of _0xd7b957){_0x230395[_0x5ac9e9(0x44,0x43,-0x2,0x2e)](_0xf2fc17[0x1309*-0x2+0x527*0x3+0xc1*0x1e]);}for(const _0x54cf73 of _0x230395){if(_0x55e811[_0x5ac9e9(0x3c,0x4c,0x13,0x26)](_0x55e811[_0x5ac9e9(0x88,0x17,0x3f,0x20)],_0x55e811[_0x4cdf16(0x260,0x278,0x22b,0x295)])){const _0x74ab57=_0x4cdf16(0x25c,0x268,0x293,0x235)+_0x109826+'}}',_0xb84fb4=_0x2e584e[_0x809cde]||'';_0x15ed93=_0x56573d(_0x4d1e7b,_0x74ab57,_0xb84fb4,_0x1a5d1a);}else{const _0x24465f=_0x4cdf16(0x247,0x268,0x28f,0x22e)+_0x54cf73+'}}',_0x5b7283=variables[_0x54cf73]||'';_0x55a16c=_0x55e811[_0x5ac9e9(0x8,-0x2b,0x9,0x3d)](replacePlaceholder,_0x55a16c,_0x24465f,_0x5b7283,_0xdcec26);}}}function _0x4cdf16(_0x4b0c29,_0x2f5fe6,_0x5e2eae,_0x328321){return _0x4699(_0x2f5fe6-0x1d0,_0x5e2eae);}_0x55a16c=_0x55e811[_0x5ac9e9(0x5,-0xd,0x3e,0x57)](processVariablePlaceholdersInMessages,_0x55a16c,_0xdcec26);function _0x5ac9e9(_0x57eac2,_0x46657e,_0x17d80c,_0x3ccbab){return _0x4699(_0x17d80c- -0x69,_0x46657e);}const _0x584326={};return _0x584326[_0x4cdf16(0x2d5,0x2c0,0x2bf,0x2ba)]=_0x55a16c,_0x584326[_0x5ac9e9(0x4e,0x4e,0x54,0x85)+_0x5ac9e9(0x1d,-0x2c,0x11,-0x36)]=_0xdcec26,_0x584326;}function processVariablePlaceholdersInMessages(_0x168d9a,_0x441477){const _0x3bc9e6={'pBsTY':function(_0x3e960c,_0x4697fa,_0x53fb09,_0x3e928d){return _0x3e960c(_0x4697fa,_0x53fb09,_0x3e928d);},'eRzqG':'RAXsC','TGDqo':_0x3d475f(-0x55,-0x59,-0x27,-0x53),'LGzEZ':function(_0x2742c4,_0x18a527,_0x1bac15,_0xdcb1de){return _0x2742c4(_0x18a527,_0x1bac15,_0xdcb1de);},'GvLVj':function(_0x2f7f97,_0x18a18b){return _0x2f7f97===_0x18a18b;},'KcRBU':function(_0x104162){return _0x104162();},'JDrPO':'dmPPS'};function _0x3d475f(_0x30f82e,_0x459f15,_0xd6810b,_0x550c84){return _0x4699(_0x550c84- -0xec,_0x459f15);}if(!_0x168d9a||_0x3bc9e6[_0x5ccdb1(0x79,0xba,0x7e,0xa3)](_0x168d9a[_0x5ccdb1(0xe1,0xc2,0xbf,0x91)],0x8b7+0x20c+-0xac3*0x1))return _0x168d9a;const _0x35f657=_0x3bc9e6[_0x5ccdb1(0x17f,0x13e,0x15b,0x123)](getContext);!_0x35f657['chatMetada'+'ta']&&(_0x35f657[_0x3d475f(0x18,0x8,-0x38,-0x27)+'ta']={});function _0x5ccdb1(_0x41b544,_0x3fa7b0,_0x5d86cd,_0x47fd3a){return _0x4699(_0x3fa7b0-0x43,_0x41b544);}if(!_0x35f657['chatMetada'+'ta'][_0x5ccdb1(0xd5,0xb8,0xac,0xee)]){if(_0x3bc9e6[_0x3d475f(-0x6c,-0x36,-0x6e,-0x75)](_0x3bc9e6[_0x5ccdb1(0x97,0xb0,0xe5,0x9b)],_0x3bc9e6[_0x5ccdb1(0xb3,0xb0,0x94,0xc5)]))_0x35f657[_0x5ccdb1(0x149,0x108,0x116,0x13a)+'ta'][_0x3d475f(-0x86,-0x9f,-0xab,-0x77)]={};else return![];}return _0x168d9a[_0x3d475f(-0x7d,-0x42,-0x41,-0x5a)](_0x2a5b6a=>{function _0x3115d8(_0x3120ee,_0x2f2ce9,_0x442fb1,_0x2b699b){return _0x5ccdb1(_0x3120ee,_0x442fb1-0x175,_0x442fb1-0xa7,_0x2b699b-0x15d);}function _0xcaeb08(_0x1f06e4,_0x16d1c9,_0x5aaffd,_0x1ac889){return _0x5ccdb1(_0x16d1c9,_0x1f06e4-0x18e,_0x5aaffd-0x1ea,_0x1ac889-0x176);}if(_0x3bc9e6[_0xcaeb08(0x25c,0x290,0x25c,0x234)]!==_0x3bc9e6[_0xcaeb08(0x27f,0x27f,0x250,0x257)]){if(!_0x2a5b6a||!_0x2a5b6a[_0xcaeb08(0x256,0x276,0x28a,0x20c)])return _0x2a5b6a;return{..._0x2a5b6a,'content':_0x3bc9e6[_0x3115d8(0x2fd,0x2fd,0x2b2,0x2c1)](processContentVariables,_0x2a5b6a[_0x3115d8(0x23c,0x23d,0x23d,0x25d)],_0x35f657,_0x441477)};}else return{..._0x37ede6,'text':_0x3bc9e6[_0x3115d8(0x211,0x228,0x23e,0x22c)](_0x113da0,_0x4ab0cd[_0x3115d8(0x240,0x2da,0x28b,0x29d)],_0x1f0abd,_0x360f21)};});}function processContentVariables(_0x14c3fb,_0xcefb91,_0x1ba68b){const _0x43dc7f={'MCwRc':_0x2a7a50(0x415,0x41b,0x445,0x414),'bWdKA':function(_0x52a1e1,_0x37d279){return _0x52a1e1!==_0x37d279;},'wUTnM':function(_0x2ed153,_0x5a4869){return _0x2ed153===_0x5a4869;},'ONigo':function(_0x12db6b,_0x3fcd7c){return _0x12db6b===_0x3fcd7c;},'nLEWs':_0x2a7a50(0x354,0x3c3,0x36c,0x38b),'icxOL':function(_0x2f1a00,_0x1a2ecb,_0x536bd1,_0x15e572){return _0x2f1a00(_0x1a2ecb,_0x536bd1,_0x15e572);},'fiTpG':function(_0xabaa4f,_0x2e1260,_0x73e632,_0x232241){return _0xabaa4f(_0x2e1260,_0x73e632,_0x232241);},'wKEYO':function(_0x4a5a3e,_0x1bdeb3){return _0x4a5a3e!==_0x1bdeb3;},'aHnCN':_0x561a50(0x396,0x3bd,0x3d8,0x393)};if(typeof _0x14c3fb===_0x43dc7f[_0x2a7a50(0x386,0x389,0x3ef,0x3d4)])return _0x43dc7f['fiTpG'](processStringVariables,_0x14c3fb,_0xcefb91,_0x1ba68b);function _0x561a50(_0xe202ba,_0x1bf93b,_0x46c6e5,_0x10a542){return _0x4699(_0x10a542-0x2ff,_0x46c6e5);}function _0x2a7a50(_0x14794d,_0x310100,_0x239a6c,_0x14054b){return _0x4699(_0x14054b-0x31c,_0x14794d);}if(Array['isArray'](_0x14c3fb)){if(_0x43dc7f['wKEYO'](_0x43dc7f['aHnCN'],_0x43dc7f[_0x561a50(0x3cd,0x3a6,0x41a,0x3f0)]))for(const _0x21943e of _0x3c79a2['history']){if(_0x21943e[_0x2a7a50(0x3e5,0x3e3,0x3c6,0x414)]&&_0x21943e[_0x2a7a50(0x3dd,0x41b,0x40e,0x414)][_0x561a50(0x38e,0x384,0x382,0x3b8)]()!==''){const _0x1ab1ee={};_0x1ab1ee[_0x2a7a50(0x43b,0x449,0x425,0x420)]=_0x43dc7f[_0x2a7a50(0x425,0x439,0x44d,0x400)],_0x1ab1ee[_0x2a7a50(0x366,0x397,0x3b4,0x3a1)]=_0x21943e[_0x561a50(0x3de,0x3ad,0x415,0x3f7)],_0x72425b[_0x2a7a50(0x3d3,0x451,0x3f6,0x408)](_0x1ab1ee);}if(_0x21943e[_0x561a50(0x3a0,0x3ac,0x383,0x3c2)]&&_0x43dc7f[_0x561a50(0x3a1,0x384,0x38d,0x3c7)](_0x21943e['assistant'][_0x561a50(0x400,0x3b6,0x369,0x3b8)](),'')){const _0x323034={};_0x323034[_0x561a50(0x3c8,0x3b4,0x3e4,0x403)]='assistant',_0x323034[_0x561a50(0x3b9,0x343,0x3c8,0x384)]=_0x21943e['assistant'],_0x42303c[_0x561a50(0x3ee,0x3ec,0x435,0x3eb)](_0x323034);}}else return _0x14c3fb[_0x561a50(0x3cb,0x3b4,0x36a,0x391)](_0x3c25bb=>{function _0x459ffb(_0x396d59,_0x1a08d7,_0x1110de,_0x17b92d){return _0x561a50(_0x396d59-0x95,_0x1a08d7-0x1df,_0x396d59,_0x17b92d- -0x385);}if(_0x3c25bb&&_0x43dc7f[_0x187ba3(0x36d,0x341,0x337,0x369)](_0x3c25bb[_0x459ffb(-0x34,-0x35,0x14,0x4)],'text')&&_0x43dc7f[_0x187ba3(0x369,0x32b,0x377,0x339)](typeof _0x3c25bb['text'],_0x43dc7f[_0x459ffb(0x4,-0x1,0x4c,0x32)]))return{..._0x3c25bb,'text':_0x43dc7f[_0x459ffb(0x15,0x94,0xa2,0x58)](processStringVariables,_0x3c25bb[_0x459ffb(0x1f,0x25,0x8e,0x4d)],_0xcefb91,_0x1ba68b)};function _0x187ba3(_0x1e105e,_0x41b00c,_0x4f4e76,_0x417153){return _0x561a50(_0x1e105e-0x149,_0x41b00c-0x1a7,_0x417153,_0x41b00c- -0xa5);}return _0x3c25bb;});}return _0x14c3fb;}function processStringVariables(_0x703330,_0x3557f2,_0x59d513){const _0x572313={'mqRfh':function(_0x28b7be,_0x1037fb){return _0x28b7be!==_0x1037fb;},'vbSJq':_0x34c96d(0x64,0x5b,0x80,0x41),'ftHhO':_0x5c1a03(-0x24b,-0x265,-0x23c,-0x260),'XrpNz':function(_0x303552,_0x4ec734){return _0x303552(_0x4ec734);},'IlrGO':function(_0x23f523,_0x55d31b){return _0x23f523(_0x55d31b);},'eBWTS':_0x34c96d(0x1,0x37,-0x18,-0x16)};if(!_0x703330)return _0x703330;let _0x325dd6=_0x703330;_0x325dd6=_0x325dd6['replace'](/\{@setvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x4ff343,_0xcf8355,_0x31fedc)=>{function _0x1225fb(_0xa7ce99,_0x488cd8,_0x4137a3,_0xcbc47b){return _0x34c96d(_0x488cd8-0x459,_0x4137a3,_0x4137a3-0x1e1,_0xcbc47b-0x14);}function _0x59191a(_0xab03f9,_0x1ae026,_0x2aa4a1,_0x199501){return _0x5c1a03(_0xab03f9-0x93,_0x1ae026,_0x2aa4a1-0x13b,_0x199501-0x625);}if(_0x572313[_0x59191a(0x3d7,0x35c,0x372,0x390)](_0x572313[_0x59191a(0x397,0x3cc,0x34c,0x391)],_0x1225fb(0x483,0x464,0x497,0x461))){const _0x32e90c=_0xcf8355['trim']();return _0x3557f2[_0x59191a(0x3d2,0x3f2,0x408,0x3bb)+'ta']['variables'][_0x32e90c]=_0x31fedc,_0x59d513&&_0x59d513[_0x1225fb(0x488,0x443,0x423,0x42b)](_0x59191a(0x3f0,0x365,0x3c8,0x3a8)+_0x32e90c+'@}'),'';}else return _0x14e010;}),_0x325dd6=_0x325dd6[_0x5c1a03(-0x238,-0x276,-0x259,-0x24f)](/\{@getvar::([^@]+)@\}/g,(_0x24656b,_0x45b98e)=>{function _0x4738a9(_0x3d915a,_0x47071d,_0x108305,_0x5274d3){return _0x34c96d(_0x5274d3- -0xa9,_0x3d915a,_0x108305-0xe3,_0x5274d3-0x81);}function _0x19e13c(_0x40db92,_0x43af68,_0x755b82,_0x38ba57){return _0x5c1a03(_0x40db92-0xa4,_0x755b82,_0x755b82-0x9e,_0x40db92- -0x6);}if(_0x572313[_0x19e13c(-0x29b,-0x277,-0x2c9,-0x2b9)](_0x19e13c(-0x266,-0x258,-0x218,-0x294),_0x572313[_0x19e13c(-0x2c2,-0x28c,-0x29f,-0x27c)]))_0x4ca060[_0x19e13c(-0x2ce,-0x2bf,-0x2ab,-0x2e6)](_0x43999f[0x2*0x833+-0x1a48+-0x9e3*-0x1]);else{const _0x1dee40=_0x45b98e[_0x4738a9(-0x9c,-0x8e,-0x48,-0x6d)](),_0x2cebaa=_0x3557f2[_0x19e13c(-0x270,-0x26d,-0x23e,-0x232)+'ta'][_0x19e13c(-0x2c0,-0x294,-0x280,-0x278)][_0x1dee40]||'';return _0x59d513&&_0x59d513[_0x19e13c(-0x2ce,-0x308,-0x2b3,-0x2e0)]('{@getvar::'+_0x1dee40+'@}'),_0x2cebaa;}});function _0x5c1a03(_0x55b454,_0x50cb8c,_0x517150,_0x42521b){return _0x4699(_0x42521b- -0x32f,_0x50cb8c);}function _0x34c96d(_0x12ae62,_0x3284e7,_0x30eee5,_0x432b38){return _0x4699(_0x12ae62- -0x7d,_0x3284e7);}return _0x325dd6=_0x325dd6['replace'](/\{@setglobalvar::([^:@]+)::([\s\S]*?)@\}/g,(_0xbc646,_0x33cb55,_0x3ef18b)=>{const _0x34c320=_0x33cb55['trim']();setglobalvar(_0x34c320,_0x3ef18b);function _0x3f534e(_0x373b59,_0x508c16,_0x83419b,_0x2a64ef){return _0x5c1a03(_0x373b59-0xc2,_0x2a64ef,_0x83419b-0x5a,_0x373b59-0x6c5);}function _0x34e2ca(_0x462d3e,_0x532d23,_0x1ce418,_0x3d5075){return _0x34c96d(_0x462d3e-0x294,_0x3d5075,_0x1ce418-0x1d1,_0x3d5075-0x103);}return _0x59d513&&_0x59d513['add'](_0x3f534e(0x462,0x433,0x462,0x444)+_0x3f534e(0x402,0x3cb,0x42e,0x450)+_0x34c320+'@}'),'';}),_0x325dd6=_0x325dd6[_0x5c1a03(-0x20d,-0x25f,-0x27d,-0x24f)](/\{@getglobalvar::([^@]+)@\}/g,(_0x3fbc76,_0x198d45)=>{const _0x1b2609=_0x198d45[_0x123a05(0xb1,0x5f,0x94,0xd7)]();function _0x123a05(_0x3456f0,_0x5e965f,_0x5844c1,_0x3c30b3){return _0x34c96d(_0x5844c1-0x58,_0x3c30b3,_0x5844c1-0xa,_0x3c30b3-0xf8);}const _0x2a00bb=_0x572313[_0x3c2b2c(0x1f3,0x208,0x1e2,0x24c)](getglobalvar,_0x1b2609)||'';function _0x3c2b2c(_0x4fb30e,_0x57cd1f,_0x406bf8,_0x19879a){return _0x34c96d(_0x57cd1f-0x1db,_0x4fb30e,_0x406bf8-0x15,_0x19879a-0x1f);}return _0x59d513&&_0x59d513['add'](_0x123a05(0x8a,0x5a,0x96,0x93)+_0x123a05(0x28,0x76,0x47,0x83)+_0x1b2609+'@}'),_0x2a00bb;}),_0x325dd6=_0x325dd6['replace'](/\{@getworldvar::([^@]+)@\}/g,(_0x4c4aa7,_0x55dbd2)=>{function _0x1d2666(_0x221129,_0x336d60,_0x3e92ec,_0x24aee){return _0x34c96d(_0x3e92ec- -0x227,_0x221129,_0x3e92ec-0x5d,_0x24aee-0x1c6);}const _0x1b7d5f={'kpegZ':function(_0x57d459,_0x4719fa){return _0x57d459(_0x4719fa);}},_0x358180=_0x55dbd2[_0x4d96f0(-0x54,-0x84,-0x7a,-0x70)]();function _0x4d96f0(_0x18ee93,_0xe28a91,_0x26d29f,_0x25feb3){return _0x5c1a03(_0x18ee93-0xf9,_0xe28a91,_0x26d29f-0x3f,_0x26d29f-0x1fc);}const _0x9c4075=_0x572313[_0x1d2666(-0x1f2,-0x170,-0x1b7,-0x1e6)](getworldvar,_0x358180)||'';if(_0x59d513){if(_0x572313['eBWTS']===_0x572313[_0x4d96f0(-0x101,-0xdd,-0xca,-0xf4)])_0x59d513['add']('{@getworld'+_0x4d96f0(-0x91,-0x7f,-0x7f,-0xaf)+_0x358180+'@}');else{const _0x4539f8=_0x41da43[_0x4d96f0(-0xb6,-0xa9,-0x7a,-0xa9)](),_0x11fe68=_0x1b7d5f[_0x1d2666(-0x26c,-0x22f,-0x233,-0x23e)](_0x14982,_0x4539f8)||'';return _0x4a2583&&_0x350059[_0x4d96f0(-0x10d,-0xf1,-0xcc,-0xd8)](_0x1d2666(-0x22b,-0x1f2,-0x1e9,-0x1f0)+_0x4d96f0(-0x77,-0xf2,-0xc7,-0xc5)+_0x4539f8+'@}'),_0x11fe68;}}return _0x9c4075;}),_0x325dd6;}export function buildPromptWithTrigger(_0x272860){function _0x44c9df(_0xbf044a,_0x2076c6,_0x457721,_0xe2382f){return _0x4699(_0x457721-0x142,_0xbf044a);}const _0x191f3e={'AvXhI':function(_0x12bd4d,_0x583e79){return _0x12bd4d(_0x583e79);},'cjWBw':function(_0x6e6e32,_0x57346b){return _0x6e6e32===_0x57346b;},'dliFR':'trigger','ZAePV':function(_0x36f7ff,_0x2f5d78,_0x6a172e){return _0x36f7ff(_0x2f5d78,_0x6a172e);},'tSNNU':_0x44c9df(0x285,0x274,0x23a,0x251),'MtgNf':function(_0x44a170,_0x33b90e){return _0x44a170===_0x33b90e;},'uqcRa':_0x59b8bc(-0x14e,-0x122,-0x11e,-0x16b),'RQnhl':_0x44c9df(0x1a8,0x1f2,0x1b6,0x1ea),'vAAop':function(_0x2f29dc,_0x2d28e0){return _0x2f29dc!==_0x2d28e0;},'VHvQM':_0x59b8bc(-0xe1,-0x124,-0x11b,-0x13e),'ckbrH':_0x59b8bc(-0x105,-0xf3,-0x13a,-0x185)},{requestType:_0x59fb62,contextData:_0x40f406}=_0x272860,_0x1646e2=extension_settings[extensionName]?.['llm_reques'+_0x44c9df(0x16f,0x1a3,0x1ba,0x1b2)+_0x59b8bc(-0x11c,-0xf1,-0x129,-0x12c)]||{},_0x3079e1={};_0x3079e1[_0x44c9df(0x1e5,0x1c9,0x208,0x202)+_0x44c9df(0x1f8,0x1bb,0x1e8,0x1e6)]='默认';const _0x4d7597=_0x1646e2[_0x59fb62]||_0x3079e1,_0x129964=_0x4d7597[_0x44c9df(0x1eb,0x1c7,0x208,0x1bc)+_0x44c9df(0x217,0x205,0x1e8,0x197)]||'默认',_0xeb758e=extension_settings[extensionName]?.['test_conte'+_0x44c9df(0x258,0x1cf,0x217,0x242)+'s']||{};function _0x59b8bc(_0xa71d02,_0x861db,_0x30822e,_0x3a0f6e){return _0x4699(_0x30822e- -0x1fd,_0x3a0f6e);}const _0x9c9675=_0xeb758e[_0x129964]||_0xeb758e[Object[_0x44c9df(0x1a7,0x1d1,0x1cf,0x20d)](_0xeb758e)[-0x14df+-0xb7c+-0x3*-0xac9]]||{},{context:context='',body:body='',worldBookContent:worldBookContent='',userDemand:userDemand=''}=_0x40f406,_0x750260=[userDemand,context,body,worldBookContent][_0x59b8bc(-0xd5,-0xfb,-0x108,-0x106)](Boolean)[_0x59b8bc(-0x150,-0xfd,-0x117,-0x131)]('\x0a'),_0x5626d7=[];if(_0x9c9675['entries']&&Array[_0x44c9df(0x1c8,0x231,0x1fc,0x236)](_0x9c9675[_0x59b8bc(-0x162,-0x15a,-0x115,-0x102)]))for(const _0x5120cf of _0x9c9675[_0x59b8bc(-0x12c,-0x10e,-0x115,-0x138)]){if(!_0x5120cf[_0x59b8bc(-0x100,-0x141,-0x136,-0x16c)])continue;if(!_0x5120cf[_0x44c9df(0x1ba,0x18d,0x1c7,0x1de)]||_0x5120cf['content'][_0x44c9df(0x1b2,0x24b,0x1fb,0x1b9)]()==='')continue;if(_0x191f3e[_0x44c9df(0x218,0x1ff,0x1cb,0x1b3)](_0x5120cf[_0x59b8bc(-0x118,-0x12d,-0x101,-0x13a)+'e'],_0x191f3e[_0x59b8bc(-0x183,-0x136,-0x13c,-0x13b)])){if(!_0x191f3e['ZAePV'](checkTriggerWords,_0x5120cf[_0x59b8bc(-0x167,-0x14b,-0x130,-0x127)+'ds'],_0x750260))continue;}const _0x5b0fb0={};_0x5b0fb0[_0x44c9df(0x231,0x275,0x246,0x234)]=_0x5120cf[_0x59b8bc(-0x143,-0xbd,-0xf9,-0x130)]||_0x191f3e[_0x44c9df(0x1ec,0x20d,0x204,0x1ce)],_0x5b0fb0[_0x44c9df(0x213,0x1c6,0x1c7,0x1e0)]=_0x5120cf[_0x44c9df(0x195,0x17a,0x1c7,0x1a5)],_0x5626d7[_0x44c9df(0x22e,0x238,0x22e,0x23f)](_0x5b0fb0);}else{if(_0x9c9675[_0x44c9df(0x201,0x1e9,0x1ed,0x21f)]&&Array[_0x44c9df(0x22c,0x23f,0x1fc,0x1f2)](_0x9c9675['history'])){if(_0x191f3e['MtgNf'](_0x191f3e[_0x59b8bc(-0xe9,-0x10d,-0x120,-0x15e)],_0x191f3e['uqcRa']))for(const _0x54664d of _0x9c9675[_0x59b8bc(-0x145,-0x140,-0x152,-0x19b)]){if(_0x191f3e[_0x59b8bc(-0x13c,-0x16d,-0x14e,-0x18f)](_0x191f3e[_0x59b8bc(-0x16f,-0x15a,-0x167,-0x1aa)],_0x191f3e[_0x59b8bc(-0x167,-0x14c,-0x167,-0x153)])){if(_0x54664d[_0x59b8bc(-0xcd,-0x142,-0x105,-0xc0)]&&_0x191f3e[_0x59b8bc(-0x15a,-0x171,-0x168,-0x180)](_0x54664d[_0x59b8bc(-0x13c,-0x138,-0x105,-0xbb)][_0x59b8bc(-0xf7,-0x12a,-0x144,-0x155)](),'')){if(_0x191f3e['cjWBw'](_0x59b8bc(-0x153,-0x154,-0x16a,-0x13a),_0x191f3e[_0x44c9df(0x1c7,0x20f,0x1de,0x1fa)])){const _0x3705eb=_0x36f119[_0x59b8bc(-0x112,-0x185,-0x159,-0x17e)](_0x3d2e6d,arguments);return _0x533da4=null,_0x3705eb;}else{const _0x1077dd={};_0x1077dd['role']=_0x191f3e[_0x44c9df(0x240,0x231,0x204,0x208)],_0x1077dd['content']=_0x54664d['user'],_0x5626d7['push'](_0x1077dd);}}if(_0x54664d['assistant']&&_0x191f3e[_0x44c9df(0x18c,0x1ec,0x1d7,0x1c7)](_0x54664d[_0x44c9df(0x1d8,0x24a,0x205,0x22b)][_0x44c9df(0x239,0x1f5,0x1fb,0x22e)](),'')){const _0x97cbe={};_0x97cbe[_0x59b8bc(-0x132,-0x149,-0xf9,-0xe2)]=_0x191f3e[_0x44c9df(0x197,0x1e6,0x1ac,0x1b1)],_0x97cbe[_0x59b8bc(-0x182,-0x18e,-0x178,-0x1bf)]=_0x54664d[_0x59b8bc(-0x16f,-0xfe,-0x13a,-0xef)],_0x5626d7[_0x44c9df(0x253,0x1ea,0x22e,0x265)](_0x97cbe);}}else _0xc6d77b[_0x59b8bc(-0x136,-0x14f,-0x111,-0x13b)](_0x75d537);}else{const _0x55c1e4=_0x2f7478[_0x44c9df(0x219,0x1b1,0x1fb,0x1f6)](),_0x394b91=_0x191f3e[_0x59b8bc(-0x103,-0x149,-0x147,-0x174)](_0x4d7122,_0x55c1e4)||'';return _0x2c18b6&&_0x48c2b4[_0x59b8bc(-0x167,-0x159,-0x196,-0x147)]('{@getworld'+_0x59b8bc(-0xff,-0x110,-0x149,-0x184)+_0x55c1e4+'@}'),_0x394b91;}}}const _0x13808c=_0x191f3e[_0x44c9df(0x1f0,0x1fa,0x1f8,0x239)](mergeAdjacentMessages,_0x5626d7),{messages:_0x460835,replacedVariables:_0x171b39}=_0x191f3e[_0x59b8bc(-0xd8,-0x107,-0x125,-0x112)](replaceAllPlaceholders,_0x13808c,_0x40f406);return _0x460835;}export function getProcessedPrompt(_0x2da01d,_0x391fd6){function _0x3da4a7(_0x2de71e,_0x14801b,_0x1c65d8,_0x31c900){return _0x4699(_0x2de71e- -0xca,_0x1c65d8);}const _0x90ea78={'OBDAQ':function(_0x2ab921,_0x263254){return _0x2ab921(_0x263254);}},_0x42ef59={};function _0x347a5d(_0x50a5d0,_0x11f930,_0x5334d5,_0x4936b9){return _0x4699(_0x50a5d0- -0x2af,_0x5334d5);}return _0x42ef59[_0x347a5d(-0x1f0,-0x1d9,-0x1a8,-0x1f2)+'e']=_0x2da01d,_0x42ef59[_0x3da4a7(0x25,0x3c,0x16,-0x1b)+'a']=_0x391fd6,_0x90ea78['OBDAQ'](buildPromptWithTrigger,_0x42ef59);}function _0x140a(){const _0x1d0b30=['BfP3zu0','CMvWBgfJzq','zKrUAwq','rvDssxi','Aw5JBhvKzxm','tun3uMm','kcGOlISPkYKRkq','AM9PBG','D1vuBK0','zw50CMLLCW','q0rfAuy','sgDwCgi','yKHnthG','ChvZAa','swXYr08','E3VPGjRNLkJOP5lOIBlLKk/NLkJLIjFOOAG','y29UDgv4DerHDa','BwvZC2fNzxm','yuHUq04','tg93CuW','E3VKUjBNLyZKUABOP6BLJ5f9Fq','BMfTzte','zMLSDgvY','sgXStMC','ufHcsLa','DxnLCG','vfnMCvq','teD6rvO','s2nsqLu','DhjPz2DLCK1Vza','AxbssNi','mJi2mJeWnxfzt0HzyW','ndK3zhLSqLLN','t2rKzLG','uvDRruG','DgLRAM4','E3VKUiRKUiVMLOD9Fq','CM9Szq','EMTxEKK','thvtq3i','rfr4t0G','ywrK','r25tDem','zujxvfm','y2TICKG','vernEKq','BhzHCJO6','sKrYue8','rw5yzLa','C3rYAw5N','tLfltNi','A3bLz1O','DwXYquG','zNriAe8','qu5mtMC','DMfYAwfIBgvZ','ody5ntaWyKTxzK5h','r3zmvMO','Df90ExbLx2nVBG','AfzPB0y','CMLHyMXLCW','odKXmZzmAK5Tqum','D3HUsvK','ALvPAei','BhLMvNK','BgvUz3rO','sKjmugK','uur1veC','E3VOP5lOIBlLKk/NLkJLIjFOOAH9Fq','EefIu2K','qKD4Cw4','y29UDgvUDa','CejZvfK','rvbAs2O','vhbrwg0','y2PxqNC','DhLWzq','zvj6CuC','u3zxz2S','A2v5CW','sfHvr1u','Dg9tDhjPBMC','ALLxwwO','s0f3uKW','BwfW','DenlyKe','r2vkww4','DKfbB3a','uLfUAgW','E3VNLkJMIlFPNidMSyj9Fq','E3TNzxr2yxi6oG','rMLHvNC','BxfszMG','DMjtsNe','vKH2uu0','rffvDwe','E3T1C2vYFx0','C09RBe8','otaYnZb4Bvjfy3G','mMTtyKfmwG','su1qwvq','DfHgChm','yxbWBhK','E3VMRApMLOD9Fq','B2zPBgu','wNzvsvy','r2r0q3e','sw9ABLq','whjWtNO','AgLZDg9YEq','ndKZmJe2mfzYALPjra','nZbmBeXHu2W','veDeCw8','txrNtMy','wuz5Buq','C2PeEu4','E0bZzxr2yxi6oG','Bwf0y2HbBgW','DMfYoJO','nZuYndiXvuHeBLn4','qxzyAeK','C3bSAxq','BKXfv3m','DhjPBq','AxnbCNjHEq','E0bNzxrNBg9Iyq','zKPiCg8','CMvWBgfJzwrwyq','CgTYDfy','CMvXDwvZDfr5Ca','CMvWBgfJzufSBa','zgXPrLi','DfnotLu','yxnZAxn0yw50','sej6v0y','y2HHDe1LDgfKyq','y29UDgv4Df9WCG','zw5HyMXLza','yLDKs0e','phvZzxi+','A1vIy2C','C2vHCMnO','E0bZzxrNBg9Iyq','DhjPz2DLCLDVCG','uhLRuhy','su9pC0u','whviqMG','t05Pz28','odK5mteYA01WqwXd','Dgv4Da','zMLNCW','EhrFChjVzMLSzq','B1nfquW','qu9tuw8','wKfLufy','CvPZBfy','B0LfALK','q3HTA3G','DwHjvLO','DxfJuMe','Awn4t0W'];_0x140a=function(){return _0x1d0b30;};return _0x140a();}