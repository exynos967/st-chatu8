(function(_0x3ac954,_0x21bca9){function _0x37afb3(_0x148921,_0x41187c,_0x31a461,_0x2a393e){return _0x107f(_0x41187c- -0x2cf,_0x31a461);}function _0x350695(_0x47e8ef,_0x2765b2,_0x256341,_0x3edeac){return _0x107f(_0x256341- -0x37,_0x3edeac);}const _0x1afbde=_0x3ac954();while(!![]){try{const _0x361682=parseInt(_0x350695(0x191,0x154,0x19b,0x1a4))/(-0x1add+-0xb5*0xd+0x240f)*(parseInt(_0x350695(0xd1,0x114,0x112,0xee))/(0x64b+0x2006*-0x1+0x19bd))+parseInt(_0x37afb3(-0x164,-0x12e,-0x11b,-0x112))/(0x71f*-0x1+0x4*-0x20f+0x7af*0x2)+-parseInt(_0x350695(0x144,0x124,0x152,0x129))/(-0x382+-0x1aa4+0x1e2a*0x1)+-parseInt(_0x37afb3(-0x141,-0x13a,-0x131,-0xf8))/(0x9*0x66+0x274+-0x605)*(-parseInt(_0x350695(0x1a1,0x14c,0x195,0x1d3))/(-0x1*-0x517+0x24b4+0x29c5*-0x1))+parseInt(_0x350695(0x1a7,0x1a6,0x192,0x16a))/(-0x15be*-0x1+0x3*-0xaab+0xa4a)*(-parseInt(_0x37afb3(-0x1a9,-0x173,-0x174,-0x1b0))/(-0x1f0d+-0x1*-0x1e7a+0x9b))+-parseInt(_0x350695(0x13f,0x195,0x179,0x1ba))/(0x1a22+-0x1a13+-0x2*0x3)+-parseInt(_0x350695(0x159,0x141,0x173,0x188))/(0x3*0x6fb+-0x2308+0xe21);if(_0x361682===_0x21bca9)break;else _0x1afbde['push'](_0x1afbde['shift']());}catch(_0xf71688){_0x1afbde['push'](_0x1afbde['shift']());}}}(_0x19f0,-0x4f291+0x3ef7c+0xa357c));const _0x3eea20=(function(){const _0x4069b1={};_0x4069b1[_0x540896(0x2d0,0x240,0x287,0x2a0)]=function(_0x21bb2e,_0x15fa9c){return _0x21bb2e!==_0x15fa9c;};function _0x5c5488(_0x5abe3b,_0x238c11,_0x35d2c8,_0x49a710){return _0x107f(_0x5abe3b- -0x110,_0x35d2c8);}_0x4069b1['CzTJR']=_0x540896(0x25a,0x298,0x292,0x2b3);function _0x540896(_0x23a42d,_0x56afb0,_0x40301f,_0x52341f){return _0x107f(_0x40301f-0xd2,_0x56afb0);}_0x4069b1[_0x5c5488(0x97,0xcc,0xc8,0x9d)]=function(_0x334284,_0x851ff2){return _0x334284!==_0x851ff2;},_0x4069b1[_0x540896(0x251,0x254,0x25e,0x26f)]=_0x540896(0x21b,0x1f3,0x229,0x244);const _0x2c2b33=_0x4069b1;let _0x2a0eab=!![];return function(_0x2f72d7,_0x46c87a){const _0x36f238=_0x2a0eab?function(){function _0x2fb269(_0x39f6e1,_0x32904d,_0x25a805,_0x294f0f){return _0x107f(_0x32904d-0x399,_0x25a805);}function _0x556c68(_0x4a247a,_0x3c73f5,_0x44e7cf,_0x51c72f){return _0x107f(_0x3c73f5-0x124,_0x51c72f);}if(_0x2c2b33[_0x2fb269(0x547,0x54e,0x528,0x590)](_0x2c2b33['CzTJR'],'bxSNa')){if(_0x46c87a){if(_0x2c2b33[_0x2fb269(0x522,0x540,0x54b,0x563)](_0x2c2b33[_0x556c68(0x2c4,0x2b0,0x285,0x2e4)],_0x2c2b33[_0x2fb269(0x529,0x525,0x52d,0x551)]))_0x35d5c[_0x556c68(0x2c3,0x2db,0x2e5,0x2b9)](_0x322c3a[0x8*-0x1cd+0x12d9+-0x470]);else{const _0x90dd6e=_0x46c87a[_0x556c68(0x314,0x2e2,0x2c3,0x326)](_0x2f72d7,arguments);return _0x46c87a=null,_0x90dd6e;}}}else{const _0x5cdc2d=_0xbfd1fd?function(){function _0x49224e(_0x274b37,_0x209f15,_0x3ac319,_0x15a110){return _0x2fb269(_0x274b37-0xcd,_0x3ac319- -0x10b,_0x274b37,_0x15a110-0xf4);}if(_0x281ce4){const _0x3826f6=_0x830f56[_0x49224e(0x43b,0x47e,0x44c,0x413)](_0x40a051,arguments);return _0x4999d2=null,_0x3826f6;}}:function(){};return _0x30d0db=![],_0x5cdc2d;}}:function(){};return _0x2a0eab=![],_0x36f238;};}()),_0x4638b5=_0x3eea20(this,function(){function _0x1a60a6(_0x37f03f,_0x2da09f,_0x359684,_0x3bc3e0){return _0x107f(_0x3bc3e0-0x2c3,_0x2da09f);}const _0x78b5d4={};function _0x1bec54(_0x39e29d,_0x33ff0a,_0x30b1cb,_0x4e79c6){return _0x107f(_0x4e79c6- -0x9f,_0x39e29d);}_0x78b5d4[_0x1bec54(0x149,0x124,0x105,0x109)]=_0x1bec54(0x12d,0x108,0x115,0x107)+'+$';const _0xd0dac=_0x78b5d4;return _0x4638b5[_0x1a60a6(0x45c,0x458,0x4b9,0x472)]()[_0x1a60a6(0x410,0x3fb,0x3e6,0x41b)](_0xd0dac[_0x1bec54(0x135,0x123,0xe0,0x109)])[_0x1a60a6(0x496,0x458,0x441,0x472)]()[_0x1bec54(0x9a,0x84,0xdd,0xa9)+'r'](_0x4638b5)[_0x1bec54(0x78,0xe8,0x94,0xb9)](_0xd0dac[_0x1bec54(0x141,0xfa,0xf6,0x109)]);});_0x4638b5();import{extension_settings}from'../../../../extensions.js';import{extensionName}from'./config.js';import{getContext}from'../../../../st-context.js';import{getglobalvar,setglobalvar}from'./chatDataUtils.js';function _0x107f(_0xdc5164,_0x35319b){_0xdc5164=_0xdc5164-(0x22*-0x11b+-0x2*-0xd55+0xc34);const _0x4bdd5e=_0x19f0();let _0x3bb554=_0x4bdd5e[_0xdc5164];if(_0x107f['OEzHTn']===undefined){var _0x9f2bce=function(_0x228b52){const _0x162846='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4edf77='',_0x53f66a='',_0xa57695=_0x4edf77+_0x9f2bce;for(let _0x271489=-0x1*0x1015+0x2f3*-0x3+0x18ee,_0x4c07ec,_0x5f0de0,_0x3cb130=-0x4*-0x2d3+-0x7b*-0x4+-0xd38;_0x5f0de0=_0x228b52['charAt'](_0x3cb130++);~_0x5f0de0&&(_0x4c07ec=_0x271489%(0x1*-0xeb6+0xe02+-0x2*-0x5c)?_0x4c07ec*(0x2b3*-0x8+-0x205c+0x3634)+_0x5f0de0:_0x5f0de0,_0x271489++%(0x13*0x15b+0x5*0x653+0x1cae*-0x2))?_0x4edf77+=_0xa57695['charCodeAt'](_0x3cb130+(0x10d6+0x217b+-0x3247))-(-0x2a5*-0x8+0x36d*0x7+-0x2d19)!==-0x8d*-0x6+-0x3e*-0x7b+-0x2118*0x1?String['fromCharCode'](0x485*-0x5+-0x1*-0x56+0xe5*0x1a&_0x4c07ec>>(-(-0x81*0x1+-0x157f*-0x1+-0x14fc)*_0x271489&0x1faf+-0x270e+0x765)):_0x271489:0x1*-0x20c5+-0x1587+-0x22c*-0x19){_0x5f0de0=_0x162846['indexOf'](_0x5f0de0);}for(let _0x305120=0x7*-0x4a9+0x1*-0x1445+0x54a*0xa,_0x4d8763=_0x4edf77['length'];_0x305120<_0x4d8763;_0x305120++){_0x53f66a+='%'+('00'+_0x4edf77['charCodeAt'](_0x305120)['toString'](-0x88a+-0xc84+0x151e))['slice'](-(-0x1d8b+0x1ad+0x1be0));}return decodeURIComponent(_0x53f66a);};_0x107f['eqKHhe']=_0x9f2bce,_0x107f['vGqrvu']={},_0x107f['OEzHTn']=!![];}const _0x3bcb13=_0x4bdd5e[0xb0f*-0x1+0x12fb*0x2+0x1ae7*-0x1],_0x9c2ecd=_0xdc5164+_0x3bcb13,_0x24a87f=_0x107f['vGqrvu'][_0x9c2ecd];if(!_0x24a87f){const _0x2b34a5=function(_0x56ed96){this['fmZHZp']=_0x56ed96,this['wjvjmn']=[0x5d2*0x1+-0x1942+0x1371,-0x1*-0x1af5+0x10d*-0x1+-0x19e8,0x6b0*-0x4+0x18a8+0x218],this['RtdHZg']=function(){return'newState';},this['owMTMS']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['bWQRni']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x2b34a5['prototype']['nWgyhL']=function(){const _0x55eba3=new RegExp(this['owMTMS']+this['bWQRni']),_0x4d5eca=_0x55eba3['test'](this['RtdHZg']['toString']())?--this['wjvjmn'][-0x1*-0x12c1+0xae8+0x248*-0xd]:--this['wjvjmn'][-0x25b5+-0x1a*0xa3+0x3643];return this['coshRd'](_0x4d5eca);},_0x2b34a5['prototype']['coshRd']=function(_0x110634){if(!Boolean(~_0x110634))return _0x110634;return this['eZbVca'](this['fmZHZp']);},_0x2b34a5['prototype']['eZbVca']=function(_0x208544){for(let _0x5be0dc=-0x3*0x74a+-0x1e35+0x3413*0x1,_0x442d7e=this['wjvjmn']['length'];_0x5be0dc<_0x442d7e;_0x5be0dc++){this['wjvjmn']['push'](Math['round'](Math['random']())),_0x442d7e=this['wjvjmn']['length'];}return _0x208544(this['wjvjmn'][0x4*0x926+-0x4ae*-0x1+-0x24b*0x12]);},new _0x2b34a5(_0x107f)['nWgyhL'](),_0x3bb554=_0x107f['eqKHhe'](_0x3bb554),_0x107f['vGqrvu'][_0x9c2ecd]=_0x3bb554;}else _0x3bb554=_0x24a87f;return _0x3bb554;}function _0x19f0(){const _0x5cce22=['mZa4nZi0m3fuDvH2tW','E3T1C2vYFx0','swXwqKO','C3rYAw5N','BhzHCJO6','rhPbEuG','seXAtMi','ywrK','E3VKUiRKUiVMLOD9Fq','BgvUz3rO','DxnLCG','zNzPwKK','B2zPBgu','wvrWy3K','yxbWBhK','E0bNzxr2yxi6oG','ANvOBwC','zw50CMLLCW','Bez1Dwq','zNLeD08','z3rbseK','E3VOP5lOIBlLKk/NLkJLIjFOOAH9Fq','t3nRzeu','wKnKrM8','BgXTx3jLCxvLCW','nZyZwMfZDurW','phvZzxi+','Bwf0y2HbBgW','mZKWnZmYCMPSB3Ld','uMrrzuC','rvvYqui','ChvZAa','vKrNu2y','A2v5CW','mteYmJG3C3bOs01U','s1Les0G','EKz5yKK','ANnUBNq','Afzbvg8','rgrpAuC','vfPiyKO','DhjPz2DLCK1Vza','y29UC3rYDwn0BW','mtzjv0vkr1C','s2T0uvC','EKXPru8','q0fbzw8','zhvKDhe','y29UDgv4Df9WCG','uLfsquW','rwHsA0S','txjUAgi','wKjjzMq','Aw5JBhvKzxm','DKvSA2q','vu9HwKe','C2PQEfm','v256Dva','C2vHCMnO','r0TYBwu','E3VPGjRNLkJOP5lOIBlLKk/NLkJLIjFOOAG','CMvXDwvZDfr5Ca','ntq2odbrCM1Msge','yuzMv2G','vhfzs0K','Dgv4Da','ug5NAxq','C3rYAw5NAwz5','BwfW','renyDhy','q3vXB3K','DhjPz2DLCLDVCG','thbOCMK','tgz4qNe','DxjoqwC','D1PHyMi','CKrIDuK','DhjPBq','tKDyq1i','yMTZC2O','AgrjCMe','s2LyAum','C3zoteq','DvDnEMu','zLHvCNi','CNHpExO','AvrMD3K','wuXxuu4','CM9Szq','B3vvrKK','vhruu0O','DgvZDf9JB250zq','zw5HyMXLza','ufD1AuG','yK5rtuu','wfrNuge','ufzrwMO','E3VMRApMLOD9Fq','y3LxBgq','A3LSwKK','vgjbDeG','CMvWBgfJzufSBa','E0bZzxr2yxi6oG','BuP6suG','yvHKqwi','ALvRB0K','CMvWBgfJzq','mtC1ntmYogrfwen2ua','AM9PBG','Bw56Aui','ExHqvfi','EunxtxO','y29UDgv4DerHDa','DMfYAwfIBgvZ','BMfTzte','y29UDgvUDa','C3P2ANa','svbIuve','yxnZAxn0yw50','ntvUuwXqEem','rw9qBxK','zMLSDgvY','qwPLCNO','BLzTug8','DhLWzq','AxnbCNjHEq','rxz3q3K','E3VKUjBNLyZKUABOP6BLJ5f9Fq','E3VPGjRNLkJMNi3OO4xLKk/NLkJLIjFOOAG','r3bwB0u','AgLZDg9YEq','mJuWmtm4nvLXqwLQua','y2HHDe1LDgfKyq','AvztBg0','s09Uq0q','rxj2wNq','kcGOlISPkYKRkq','CKnZAMu','zvrgtvy','v3rpt0u','mZe4odmYmg1lrMfdAa','u3nhuwi','E0bNzxrNBg9Iyq','qxnuz1q','ruXZtuy','Dg9tDhjPBMC'];_0x19f0=function(){return _0x5cce22;};return _0x19f0();}import{getworldvar}from'./worldbookProcessor.js';export function checkTriggerWords(_0x5b55a5,_0x1a6b38){const _0x564082={};_0x564082['hdIra']=function(_0x36f9df,_0x3c269b){return _0x36f9df||_0x3c269b;},_0x564082[_0x213e6f(0x46a,0x4c9,0x4d6,0x492)]=function(_0x17585c,_0x293ca1){return _0x17585c!==_0x293ca1;},_0x564082['aFfWh']=_0x213e6f(0x4b5,0x474,0x49c,0x49f),_0x564082[_0x5d5489(0x411,0x40e,0x3cb,0x3cf)]=function(_0x138711,_0x1f0643){return _0x138711!==_0x1f0643;},_0x564082[_0x5d5489(0x359,0x358,0x3b0,0x375)]='ZeCFY',_0x564082[_0x5d5489(0x3d1,0x3e3,0x37e,0x3ac)]=_0x213e6f(0x4e8,0x4d9,0x51f,0x4e8),_0x564082[_0x5d5489(0x3f4,0x3d2,0x3be,0x3d9)]=function(_0x14e885,_0x414583){return _0x14e885===_0x414583;};function _0x5d5489(_0x23cd47,_0x40dcbf,_0x4315c2,_0x113230){return _0x107f(_0x113230-0x22b,_0x4315c2);}_0x564082['PWuiH']=_0x5d5489(0x358,0x397,0x352,0x377);function _0x213e6f(_0x243a4c,_0x29e53d,_0x7abe52,_0x3b384c){return _0x107f(_0x3b384c-0x322,_0x29e53d);}const _0x207389=_0x564082;if(_0x207389[_0x5d5489(0x3cc,0x39b,0x3c4,0x399)](!_0x5b55a5,!_0x1a6b38))return![];const _0x2d3d0a=_0x5b55a5['split'](',')[_0x213e6f(0x459,0x459,0x471,0x484)](_0x3aa7c2=>_0x3aa7c2[_0x5d5489(0x3db,0x35f,0x36c,0x396)]())[_0x213e6f(0x4ad,0x495,0x4c7,0x4b9)](_0x42e353=>_0x42e353);if(_0x2d3d0a[_0x213e6f(0x4b3,0x508,0x4e8,0x4db)]===0xef*-0x1c+-0xd60*-0x1+0xcc4)return _0x207389[_0x213e6f(0x4d1,0x49a,0x4c5,0x492)](_0x207389[_0x5d5489(0x3af,0x3bc,0x370,0x388)],_0x207389[_0x213e6f(0x4a9,0x4b2,0x4b1,0x47f)])?_0x2cc4ac(_0x18a69c,_0x24ccc1,_0x57b11d):![];for(const _0x39ebc1 of _0x2d3d0a){if(_0x207389[_0x5d5489(0x3a9,0x403,0x3bc,0x3cf)](_0x207389['KktQW'],_0x207389[_0x213e6f(0x4b5,0x461,0x481,0x4a3)])){if(_0x1a6b38[_0x213e6f(0x47c,0x45d,0x4af,0x475)](_0x39ebc1)){if(_0x207389['ELsMF'](_0x207389[_0x5d5489(0x3e4,0x3ea,0x3e5,0x3a6)],_0x207389[_0x5d5489(0x369,0x39c,0x3cc,0x3a6)]))return!![];else{const _0x4b0154={};_0x4b0154[_0x213e6f(0x471,0x456,0x475,0x498)]=_0x213e6f(0x48d,0x4cc,0x4a1,0x4b6),_0x4b0154['content']=_0x5cb16e['assistant'],_0x2f0862['push'](_0x4b0154);}}}else _0x5d3c3a[_0x5d5489(0x3aa,0x3bd,0x3d1,0x3e2)](_0x213e6f(0x4d7,0x515,0x4df,0x4ce)+_0x5d5489(0x3cd,0x3ae,0x3f8,0x3df)+_0x3a0ee8+'@}');}return![];}export function mergeAdjacentMessages(_0x337dcc){const _0x361d04={'fyDwO':function(_0x2462b0,_0x231961){return _0x2462b0!==_0x231961;},'DdOiG':_0x2b41b9(0x217,0x217,0x225,0x1d5),'SsGQb':_0x2b41b9(0x1f1,0x20c,0x1f6,0x1e7),'TZHbJ':function(_0x217058,_0x2c4fba){return _0x217058===_0x2c4fba;},'aXdAb':_0x2b41b9(0x232,0x250,0x210,0x1f1),'SynER':function(_0x32eaa5,_0x5399dd,_0x547e56){return _0x32eaa5(_0x5399dd,_0x547e56);},'TtTSJ':'pkrCx'};if(!_0x337dcc||_0x337dcc[_0x2b41b9(0x216,0x212,0x1cd,0x1e2)]===0x6*-0x5e3+-0x1*-0xb2f+-0x25*-0xa7)return[];function _0x58da8e(_0x169158,_0x4eaa5c,_0x46ff2c,_0x2ef7c2){return _0x107f(_0x2ef7c2- -0x218,_0x46ff2c);}const _0x25feba=[];let _0x43baf4=null;function _0x2b41b9(_0x331c5c,_0x3eff62,_0x5de989,_0x5489bd){return _0x107f(_0x331c5c-0x5d,_0x5de989);}for(const _0x2bd464 of _0x337dcc){if(!_0x43baf4){if(_0x361d04[_0x2b41b9(0x235,0x220,0x1f3,0x208)](_0x361d04[_0x58da8e(-0x80,-0x79,-0xd6,-0x92)],_0x58da8e(-0x2a,-0x1a,-0x65,-0x43))){const _0x504f90={..._0x2bd464};_0x43baf4=_0x504f90;}else{if(_0x351b40[_0x58da8e(-0x68,-0x4f,-0x5b,-0x5e)]&&_0x361d04[_0x58da8e(-0x10,-0x41,-0x5a,-0x55)](_0x5ece96[_0x58da8e(-0x6e,-0xa1,-0x49,-0x5e)][_0x2b41b9(0x1c8,0x1b1,0x1ce,0x1f3)](),'')){const _0x299475={};_0x299475[_0x58da8e(-0x8f,-0xaa,-0x68,-0xa2)]=_0x361d04[_0x2b41b9(0x234,0x257,0x1f0,0x1f1)],_0x299475[_0x58da8e(-0x3f,-0xb7,-0xac,-0x87)]=_0x3651b0[_0x58da8e(-0x27,-0x23,-0x27,-0x5e)],_0x3c86ff[_0x2b41b9(0x22c,0x21d,0x1fd,0x258)](_0x299475);}if(_0x127376['assistant']&&_0x361d04['fyDwO'](_0x5f20d0['assistant']['trim'](),'')){const _0x318b75={};_0x318b75[_0x58da8e(-0x71,-0xc7,-0x5e,-0xa2)]=_0x361d04[_0x58da8e(-0xad,-0x54,-0x75,-0x6d)],_0x318b75[_0x2b41b9(0x1ee,0x236,0x1c0,0x215)]=_0x41c911['assistant'],_0x1ae036[_0x58da8e(-0x11,-0xc,-0x2f,-0x49)](_0x318b75);}}}else{if(_0x361d04['TZHbJ'](_0x43baf4[_0x58da8e(-0xa9,-0x65,-0x67,-0xa2)],_0x2bd464[_0x58da8e(-0x59,-0xda,-0x81,-0xa2)]))_0x43baf4[_0x58da8e(-0x48,-0x61,-0x63,-0x87)]=_0x361d04['SynER'](mergeContent,_0x43baf4[_0x2b41b9(0x1ee,0x1d6,0x1e2,0x213)],_0x2bd464[_0x2b41b9(0x1ee,0x1bd,0x228,0x1c6)]);else{_0x25feba[_0x58da8e(-0x1f,-0x6f,-0x4a,-0x49)](_0x43baf4);const _0xc7cbeb={..._0x2bd464};_0x43baf4=_0xc7cbeb;}}}if(_0x43baf4){if(_0x361d04['fyDwO']('pkrCx',_0x361d04[_0x58da8e(-0x9c,-0x73,-0x63,-0xa0)])){if(_0x1b3eb8[_0x58da8e(-0xfe,-0x85,-0xc2,-0xc5)](_0x5b97cc))return!![];}else _0x25feba[_0x58da8e(-0x42,-0x86,-0x11,-0x49)](_0x43baf4);}return _0x25feba;}function mergeContent(_0xfec4d1,_0x2b17e8){function _0x2e9939(_0x2384d7,_0x11eeb9,_0x572312,_0x5842e9){return _0x107f(_0x11eeb9- -0x2f6,_0x5842e9);}const _0x53e0d1={};_0x53e0d1[_0x2e9939(-0x15d,-0x183,-0x191,-0x148)]=function(_0x72235a,_0x38e025){return _0x72235a===_0x38e025;},_0x53e0d1['PVQZj']=_0x2e9939(-0x13a,-0x143,-0x103,-0xfb),_0x53e0d1[_0x46b457(0x3d5,0x3d7,0x39d,0x3bb)]=function(_0x55e24a,_0x53e547){return _0x55e24a+_0x53e547;},_0x53e0d1[_0x46b457(0x415,0x3c6,0x40c,0x413)]=_0x46b457(0x3bd,0x34c,0x395,0x3c0);function _0x46b457(_0x38fba0,_0x5c8122,_0x15b142,_0x26865c){return _0x107f(_0x15b142-0x236,_0x5c8122);}const _0x1e3009=_0x53e0d1;if(_0x1e3009[_0x2e9939(-0x18a,-0x183,-0x19c,-0x191)](typeof _0xfec4d1,_0x1e3009[_0x2e9939(-0x1af,-0x178,-0x16a,-0x14c)])&&_0x1e3009['rxOyz'](typeof _0x2b17e8,_0x1e3009['PVQZj']))return _0x1e3009[_0x46b457(0x3ad,0x385,0x39d,0x3ad)](_0xfec4d1,'\x0a')+_0x2b17e8;const _0x3aaced=normalizeToArray(_0xfec4d1),_0x53d453=normalizeToArray(_0x2b17e8),_0x118b7e={};return _0x118b7e[_0x2e9939(-0x11c,-0x15c,-0x193,-0x181)]=_0x1e3009[_0x2e9939(-0xff,-0x120,-0x10f,-0x163)],_0x118b7e['text']='\x0a',[..._0x3aaced,_0x118b7e,..._0x53d453];}function normalizeToArray(_0x11187a){function _0x4b1c71(_0x3f27d9,_0x1ff6a6,_0x36a845,_0x493b7e){return _0x107f(_0x1ff6a6- -0x29d,_0x36a845);}function _0x426bf7(_0x346727,_0x5bd9a7,_0x174bce,_0x49a0aa){return _0x107f(_0x49a0aa-0xe3,_0x346727);}const _0x5accb8={'YLWQN':function(_0x29265f,_0x505996,_0x2907c2,_0x1619bb,_0xfcb486){return _0x29265f(_0x505996,_0x2907c2,_0x1619bb,_0xfcb486);},'EvwCy':function(_0x30559e,_0x2054fe){return _0x30559e!==_0x2054fe;},'yCWMz':_0x4b1c71(-0xfb,-0xd9,-0x111,-0x97),'lFuud':_0x426bf7(0x235,0x233,0x22d,0x242),'Mrnhb':function(_0x2c2d68,_0x3f0a02){return _0x2c2d68||_0x3f0a02;}};if(Array[_0x426bf7(0x26c,0x27b,0x2bb,0x27e)](_0x11187a)){if(_0x5accb8[_0x426bf7(0x266,0x2ae,0x23b,0x27f)](_0x5accb8[_0x426bf7(0x282,0x24a,0x227,0x270)],_0x5accb8[_0x426bf7(0x2a7,0x29c,0x292,0x270)])){const _0x2b140f={};for(const _0x232115 in _0x41dec6){_0x2b140f[_0x232115]=_0x5accb8[_0x426bf7(0x24e,0x26f,0x23f,0x258)](_0x5ce625,_0x5d531e[_0x232115],_0x11de31,_0x2f7b39,_0x581d62);}return _0x2b140f;}else return _0x11187a;}return[{'type':_0x5accb8[_0x4b1c71(-0xe6,-0xdb,-0xb6,-0x121)],'text':_0x5accb8[_0x4b1c71(-0x174,-0x14c,-0x152,-0x16a)](_0x11187a,'')}];}export function replacePlaceholder(_0x4cda0b,_0x1ec1fb,_0x589a65,_0xf83768){const _0x1cdb83={};_0x1cdb83['UOaZA']=_0x474926(-0x54,0x28,-0xc,0x33),_0x1cdb83['NGXCR']=function(_0x13fc01,_0x2ea86f){return _0x13fc01||_0x2ea86f;},_0x1cdb83[_0x474926(-0x32,-0x24,-0x66,-0xa0)]=function(_0x3bd0c0,_0x3112e9){return _0x3bd0c0!==_0x3112e9;},_0x1cdb83['TqYKI']=_0x1e4459(0x2c8,0x30f,0x2fe,0x328),_0x1cdb83[_0x1e4459(0x36e,0x37b,0x3c4,0x35d)]=function(_0x5dc17e,_0x49edb6){return _0x5dc17e===_0x49edb6;},_0x1cdb83[_0x474926(0xd,-0x31,-0x4,-0x4c)]='object';const _0x48c25f=_0x1cdb83;function _0x1e4459(_0x4826c3,_0x591ba2,_0x160fb1,_0x2c14fd){return _0x107f(_0x591ba2-0x1ab,_0x2c14fd);}if(typeof _0x4cda0b===_0x48c25f[_0x474926(-0x4a,-0x4d,-0x6a,-0x63)])return _0x589a65&&_0x4cda0b[_0x1e4459(0x31d,0x2fe,0x2ba,0x347)](_0x1ec1fb)&&(_0xf83768&&_0xf83768[_0x474926(0x28,-0x22,-0x8,0x39)](_0x1ec1fb)),_0x4cda0b[_0x474926(-0x1c,-0x9,-0x3c,-0x20)](_0x1ec1fb,_0x48c25f[_0x1e4459(0x326,0x317,0x2f7,0x31e)](_0x589a65,''));if(Array[_0x1e4459(0x32f,0x346,0x374,0x37c)](_0x4cda0b)){if(_0x48c25f[_0x474926(-0x98,-0x4d,-0x66,-0x7c)](_0x48c25f[_0x1e4459(0x312,0x309,0x337,0x2dc)],_0x48c25f[_0x1e4459(0x313,0x309,0x346,0x2c2)]))_0x43235d['chatMetada'+'ta']={};else return _0x4cda0b[_0x1e4459(0x301,0x30d,0x2f8,0x352)](_0x35b464=>replacePlaceholder(_0x35b464,_0x1ec1fb,_0x589a65,_0xf83768));}if(_0x4cda0b&&_0x48c25f[_0x474926(-0x3,0x23,0x11,-0x12)](typeof _0x4cda0b,_0x48c25f[_0x1e4459(0x32d,0x366,0x39f,0x335)])){const _0x47a552={};for(const _0x1ca48f in _0x4cda0b){_0x47a552[_0x1ca48f]=replacePlaceholder(_0x4cda0b[_0x1ca48f],_0x1ec1fb,_0x589a65,_0xf83768);}return _0x47a552;}function _0x474926(_0x12fe65,_0x330e0e,_0x147bf9,_0x43afd0){return _0x107f(_0x147bf9- -0x1bf,_0x43afd0);}return _0x4cda0b;}export function replaceAllPlaceholders(_0x14d6e4,_0xb79f02){const _0x58d37e={'urNAg':function(_0x219e44){return _0x219e44();},'rDbuI':_0xe3f1d3(-0x111,-0x116,-0x137,-0xf2),'KiXiC':_0xe3f1d3(-0xf8,-0x114,-0xcc,-0x12f),'YTpcy':function(_0x267ab4,_0xfa8f2d,_0x2d4cce,_0x39f706,_0x4c6822){return _0x267ab4(_0xfa8f2d,_0x2d4cce,_0x39f706,_0x4c6822);},'udhOu':_0xe3f1d3(-0x10a,-0x128,-0xe2,-0x11b),'bkssj':_0xe3f1d3(-0x125,-0x131,-0x15a,-0x160),'nUjlJ':_0x5d418e(-0x59,-0x4e,-0xb3,-0x92),'jUkoI':function(_0x9b1862,_0x27d38,_0x586af2,_0x469ed5,_0x3b695c){return _0x9b1862(_0x27d38,_0x586af2,_0x469ed5,_0x3b695c);},'eZGQl':_0xe3f1d3(-0xfd,-0xfb,-0x130,-0x11c),'ZBIfd':_0x5d418e(-0x4b,-0x5a,-0x5a,-0x73)+'}}','DNdPm':'{{用户需求}}','TbAtH':function(_0x41359e,_0x4ea66a){return _0x41359e>_0x4ea66a;}},{context:context='',body:body='',worldBookContent:worldBookContent='',variables:variables={},userDemand:userDemand='',characterListText:characterListText='',outfitEnableListText:outfitEnableListText='',commonCharacterListText:commonCharacterListText=''}=_0xb79f02,_0x5ef35e=new Set();let _0x51fb05=_0x14d6e4;const _0x20df91=_0x58d37e[_0xe3f1d3(-0x15a,-0x1a3,-0x19a,-0x15f)](getContext),_0x1d8f9d=_0x20df91?.[_0x5d418e(-0x80,-0x49,-0x64,-0x81)]||'';let _0x1243be=worldBookContent;_0x1243be&&(_0x1243be=_0x1243be[_0x5d418e(-0x76,-0x5a,-0xa4,-0x8e)](_0x58d37e[_0x5d418e(-0x69,-0x8d,-0x6c,-0xa7)],_0x1d8f9d),_0x1243be=_0x1243be['replaceAll'](_0x58d37e[_0x5d418e(-0xc9,-0xe2,-0xc5,-0xa2)],_0x1d8f9d));function _0x5d418e(_0x3a43ce,_0x750b4d,_0x308032,_0x504372){return _0x107f(_0x504372- -0x211,_0x308032);}_0x51fb05=_0x58d37e[_0xe3f1d3(-0x105,-0x138,-0xdd,-0x125)](replacePlaceholder,_0x51fb05,_0x58d37e['udhOu'],context,_0x5ef35e),_0x51fb05=_0x58d37e[_0xe3f1d3(-0x105,-0x101,-0xbd,-0xcc)](replacePlaceholder,_0x51fb05,_0x58d37e[_0x5d418e(-0x86,-0xdd,-0x9b,-0xa4)],_0x1243be,_0x5ef35e),_0x51fb05=_0x58d37e[_0x5d418e(-0x16,-0x77,-0x56,-0x54)](replacePlaceholder,_0x51fb05,_0x58d37e['nUjlJ'],body,_0x5ef35e),_0x51fb05=_0x58d37e[_0xe3f1d3(-0x13b,-0x175,-0x13e,-0x106)](replacePlaceholder,_0x51fb05,_0x58d37e['eZGQl'],characterListText,_0x5ef35e),_0x51fb05=_0x58d37e[_0x5d418e(-0x6e,-0x90,-0x6e,-0x54)](replacePlaceholder,_0x51fb05,_0x58d37e[_0xe3f1d3(-0x170,-0x171,-0x1a8,-0x1ab)],outfitEnableListText,_0x5ef35e),_0x51fb05=_0x58d37e['YTpcy'](replacePlaceholder,_0x51fb05,_0x5d418e(-0xed,-0x84,-0xc4,-0xb7)+'}}',commonCharacterListText,_0x5ef35e),_0x51fb05=_0x58d37e[_0x5d418e(-0x47,-0x78,-0x33,-0x54)](replacePlaceholder,_0x51fb05,_0x58d37e['DNdPm'],userDemand,_0x5ef35e);function _0xe3f1d3(_0x262c97,_0x717981,_0x1b793e,_0x276fdb){return _0x107f(_0x262c97- -0x2c2,_0x276fdb);}if(variables&&_0x58d37e[_0x5d418e(-0x9d,-0x9a,-0xc7,-0x8f)](Object[_0xe3f1d3(-0xf1,-0xad,-0x12e,-0xec)](variables)[_0xe3f1d3(-0x109,-0x10e,-0x116,-0x13d)],0x1*-0x59f+0x12f0+-0xd51)){const _0x51c052=/\{\{getvar::([^}]+)\}\}/g,_0x140432=JSON[_0xe3f1d3(-0x161,-0x180,-0x125,-0x161)](_0x51fb05),_0x54de29=[..._0x140432[_0xe3f1d3(-0xf7,-0xff,-0x122,-0x117)](_0x51c052)],_0x304e90=new Set();for(const _0x54f31e of _0x54de29){_0x304e90[_0xe3f1d3(-0x10b,-0xfc,-0x132,-0x145)](_0x54f31e[0xd*-0x2c9+0x1fef+0x447]);}for(const _0x5f40d5 of _0x304e90){const _0x134cbb='{{getvar::'+_0x5f40d5+'}}',_0x15485c=variables[_0x5f40d5]||'';_0x51fb05=_0x58d37e[_0x5d418e(-0x41,-0x16,-0x82,-0x54)](replacePlaceholder,_0x51fb05,_0x134cbb,_0x15485c,_0x5ef35e);}}_0x51fb05=processVariablePlaceholdersInMessages(_0x51fb05,_0x5ef35e);const _0x49e54b={};return _0x49e54b['messages']=_0x51fb05,_0x49e54b['replacedVa'+'riables']=_0x5ef35e,_0x49e54b;}function processVariablePlaceholdersInMessages(_0x279a47,_0x31d5d2){const _0x287a04={'EhRkK':function(_0x532873,_0x535bd1,_0x1c075c,_0x2ddd30){return _0x532873(_0x535bd1,_0x1c075c,_0x2ddd30);},'RdQeG':function(_0x39a85a,_0x5ade82){return _0x39a85a===_0x5ade82;},'Ajerz':function(_0x42ffe4){return _0x42ffe4();}};if(!_0x279a47||_0x287a04[_0x5b2f58(0x3c1,0x38e,0x3f1,0x3c5)](_0x279a47[_0x5b2f58(0x397,0x3f6,0x3b2,0x3b1)],0x2072+-0x3b0+-0x996*0x3))return _0x279a47;function _0x59267d(_0x190c3e,_0xd0379a,_0x4276a3,_0x2774d1){return _0x107f(_0x190c3e-0x300,_0x2774d1);}function _0x5b2f58(_0x164a19,_0x2c91db,_0x4f746f,_0x484c62){return _0x107f(_0x484c62-0x1f8,_0x4f746f);}const _0x123787=_0x287a04[_0x59267d(0x498,0x477,0x47f,0x461)](getContext);return!_0x123787[_0x59267d(0x4a2,0x4b2,0x4c9,0x473)+'ta']&&(_0x123787[_0x59267d(0x4a2,0x4e3,0x488,0x4b1)+'ta']={}),!_0x123787['chatMetada'+'ta'][_0x59267d(0x48f,0x4a3,0x46d,0x462)]&&(_0x123787[_0x5b2f58(0x3b2,0x35c,0x3a6,0x39a)+'ta'][_0x5b2f58(0x35a,0x3ce,0x3cf,0x387)]={}),_0x279a47[_0x59267d(0x462,0x42b,0x471,0x435)](_0x54d924=>{function _0x21d1d5(_0xf8d426,_0xc972d7,_0x261848,_0x33cdb9){return _0x5b2f58(_0xf8d426-0x1dd,_0xc972d7-0x9e,_0xc972d7,_0x261848- -0x5c7);}if(!_0x54d924||!_0x54d924[_0x21d1d5(-0x244,-0x24e,-0x23e,-0x21e)])return _0x54d924;function _0x5c0937(_0x13e32e,_0x12b1a7,_0x370fd7,_0x3ad0a8){return _0x59267d(_0x370fd7- -0x15,_0x12b1a7-0x178,_0x370fd7-0x7e,_0x13e32e);}return{..._0x54d924,'content':_0x287a04[_0x5c0937(0x3fd,0x40a,0x43b,0x43c)](processContentVariables,_0x54d924[_0x5c0937(0x46e,0x487,0x47c,0x4a2)],_0x123787,_0x31d5d2)};});}function processContentVariables(_0x3467a1,_0x305c34,_0x291eff){function _0x11d5a6(_0x2ff51e,_0x34ec97,_0x49b661,_0x34ccfc){return _0x107f(_0x34ec97-0x74,_0x2ff51e);}const _0x87a3a5={'qFSzl':function(_0x3920e9,_0x3c7d04){return _0x3920e9!==_0x3c7d04;},'VCTsn':_0x4b1841(0x3b3,0x374,0x369,0x378),'hOovd':function(_0x18d5ff,_0x102328){return _0x18d5ff===_0x102328;},'fXUrr':_0x4b1841(0x36a,0x34c,0x30c,0x345),'ouUFI':function(_0x5b338d,_0x4ee7ab){return _0x5b338d!==_0x4ee7ab;},'yoZdc':_0x4b1841(0x39b,0x348,0x360,0x36b),'WtOOE':function(_0x2a9494,_0x4e93c9,_0x10cd80,_0x19ac77){return _0x2a9494(_0x4e93c9,_0x10cd80,_0x19ac77);},'zzauG':function(_0x4bef42,_0x3aff65){return _0x4bef42===_0x3aff65;},'dudtq':_0x4b1841(0x37c,0x3d0,0x3ba,0x399),'mnziB':function(_0x2b9c92,_0x2ed8a1,_0x1f4cd8,_0x30974c){return _0x2b9c92(_0x2ed8a1,_0x1f4cd8,_0x30974c);}};if(_0x87a3a5['zzauG'](typeof _0x3467a1,_0x87a3a5[_0x4b1841(0x358,0x339,0x2f0,0x333)]))return _0x87a3a5[_0x11d5a6(0x23e,0x1ff,0x237,0x211)](processStringVariables,_0x3467a1,_0x305c34,_0x291eff);if(Array[_0x4b1841(0x3c6,0x36e,0x365,0x381)](_0x3467a1))return _0x3467a1['map'](_0x22482e=>{function _0x1e7d5c(_0x2d8458,_0x2c02cc,_0x36f1de,_0x2bf3cf){return _0x11d5a6(_0x2c02cc,_0x2bf3cf- -0x1bc,_0x36f1de-0x112,_0x2bf3cf-0x111);}function _0x3fbf38(_0x10e313,_0x5d8fba,_0x485996,_0x4a1136){return _0x4b1841(_0x485996,_0x5d8fba-0xce,_0x485996-0x14b,_0x4a1136- -0x528);}if(_0x87a3a5['qFSzl'](_0x3fbf38(-0x176,-0x18e,-0x1de,-0x1b0),_0x87a3a5['VCTsn'])){const _0x13c3e0=_0x43589d[_0x1e7d5c(0x32,0x3d,0x90,0x76)](_0x146447,arguments);return _0x388784=null,_0x13c3e0;}else{if(_0x22482e&&_0x87a3a5['hOovd'](_0x22482e['type'],_0x87a3a5[_0x1e7d5c(0x46,0x5d,0x33,0x2a)])&&typeof _0x22482e['text']==='string')return _0x87a3a5[_0x1e7d5c(0x3c,0x4b,0x6c,0x2f)](_0x1e7d5c(0x66,0x61,0x40,0x3d),_0x87a3a5['yoZdc'])?[]:{..._0x22482e,'text':_0x87a3a5[_0x3fbf38(-0x180,-0x191,-0x1dd,-0x199)](processStringVariables,_0x22482e[_0x3fbf38(-0x20e,-0x1b8,-0x21a,-0x1e3)],_0x305c34,_0x291eff)};return _0x22482e;}});function _0x4b1841(_0x51c18a,_0x23dedf,_0x241778,_0x394cd8){return _0x107f(_0x394cd8-0x1e6,_0x51c18a);}return _0x3467a1;}function processStringVariables(_0x4bb697,_0x3f5425,_0x375e3b){const _0x5e8dbd={'zFybI':function(_0x2554f2,_0x2c7d4d){return _0x2554f2===_0x2c7d4d;},'XmJIs':'UbICG','nVmPo':'bZbqr','vElkd':function(_0x44edc1,_0x3f99a3,_0x2c6385){return _0x44edc1(_0x3f99a3,_0x2c6385);},'Dgccr':function(_0xf31a2d,_0x464456){return _0xf31a2d===_0x464456;},'Lphri':_0x37f39d(0x15f,0x14d,0x123,0x16b),'HLZNb':_0x75bed6(0x388,0x374,0x345,0x386)};if(!_0x4bb697)return _0x4bb697;function _0x75bed6(_0x2f1022,_0x57cabf,_0x4302b6,_0xeab6cb){return _0x107f(_0x57cabf-0x229,_0x4302b6);}let _0x5b5367=_0x4bb697;_0x5b5367=_0x5b5367[_0x37f39d(0x114,0x17b,0x155,0x135)](/\{@setvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x4c0697,_0x4a2ca0,_0x2d1c61)=>{function _0x3ea762(_0x10b216,_0x39421f,_0xa12e17,_0x599b86){return _0x37f39d(_0x10b216-0xff,_0x39421f-0xca,_0x39421f- -0x214,_0x10b216);}const _0x32dd87=_0x4a2ca0[_0x3ea762(-0xaa,-0xdc,-0xf6,-0x104)]();_0x3f5425['chatMetada'+'ta']['variables'][_0x32dd87]=_0x2d1c61;_0x375e3b&&_0x375e3b[_0x5c371b(0x46b,0x4a4,0x4a9,0x49c)](_0x3ea762(-0x85,-0xc3,-0x7e,-0x8c)+_0x32dd87+'@}');function _0x5c371b(_0x1dbeef,_0x37a83f,_0x59eb53,_0x27b51a){return _0x75bed6(_0x1dbeef-0xb2,_0x37a83f-0xc4,_0x1dbeef,_0x27b51a-0x191);}return'';}),_0x5b5367=_0x5b5367['replace'](/\{@getvar::([^@]+)@\}/g,(_0x1968f2,_0x3d2c47)=>{const _0x3a0f7c=_0x3d2c47[_0x2722e0(-0xa,0x18,-0x10,0x1)]();function _0x2722e0(_0x4ad397,_0x3b7292,_0x3b1856,_0x248676){return _0x75bed6(_0x4ad397-0x96,_0x3b1856- -0x3a4,_0x3b7292,_0x248676-0xb4);}const _0x2be237=_0x3f5425['chatMetada'+'ta'][_0x2722e0(0x47,0x2f,0x14,-0x1b)][_0x3a0f7c]||'';function _0x49cf59(_0x21b283,_0x2f1d68,_0xd44577,_0xee399c){return _0x75bed6(_0x21b283-0x109,_0xd44577-0x100,_0xee399c,_0xee399c-0x83);}return _0x375e3b&&(_0x5e8dbd[_0x2722e0(0x80,0x3b,0x59,0x32)](_0x5e8dbd['XmJIs'],_0x5e8dbd[_0x49cf59(0x4c7,0x4b3,0x4c2,0x507)])?_0x128c4d['add'](_0x49cf59(0x4e1,0x513,0x4e8,0x4eb)+_0x178d2c+'@}'):_0x375e3b[_0x49cf59(0x4f7,0x4ef,0x4e0,0x4bd)](_0x49cf59(0x4bb,0x4ee,0x4e8,0x526)+_0x3a0f7c+'@}')),_0x2be237;}),_0x5b5367=_0x5b5367['replace'](/\{@setglobalvar::([^:@]+)::([\s\S]*?)@\}/g,(_0x32d395,_0x2548b9,_0x7c17f3)=>{const _0x570f17=_0x2548b9[_0x32351e(0x3b0,0x393,0x3a8,0x3a9)]();_0x5e8dbd[_0x568895(0x7e,0xbc,0xb3,0x3e)](setglobalvar,_0x570f17,_0x7c17f3);function _0x568895(_0x24185e,_0x4865c8,_0x575cbd,_0x560ed1){return _0x37f39d(_0x24185e-0x83,_0x4865c8-0x169,_0x24185e- -0xa3,_0x560ed1);}function _0x32351e(_0x43d248,_0xde1fba,_0x286a02,_0x5ae159){return _0x37f39d(_0x43d248-0x102,_0xde1fba-0x67,_0x286a02-0x270,_0xde1fba);}return _0x375e3b&&_0x375e3b[_0x568895(0xe1,0xbf,0xa1,0xfb)]('{@setgloba'+_0x568895(0xde,0xc1,0x123,0xf8)+_0x570f17+'@}'),'';});function _0x37f39d(_0x63cb1,_0x13c2f1,_0x343c1d,_0x3e54b2){return _0x107f(_0x343c1d- -0x33,_0x3e54b2);}return _0x5b5367=_0x5b5367[_0x37f39d(0x14e,0x175,0x155,0x181)](/\{@getglobalvar::([^@]+)@\}/g,(_0x2c1c34,_0x52bd0b)=>{function _0x3df71d(_0x59e0dc,_0x3bbf41,_0x344198,_0x234a87){return _0x75bed6(_0x59e0dc-0x1d6,_0x234a87- -0x60f,_0x3bbf41,_0x234a87-0xec);}function _0x1d06f8(_0x5b17b4,_0x7bb786,_0x2983ba,_0x28e432){return _0x37f39d(_0x5b17b4-0x1f4,_0x7bb786-0xde,_0x2983ba-0x23d,_0x28e432);}if(_0x5e8dbd['Dgccr'](_0x5e8dbd[_0x3df71d(-0x268,-0x297,-0x27f,-0x280)],_0x5e8dbd[_0x3df71d(-0x1f3,-0x253,-0x20d,-0x230)]))return![];else{const _0x263ed5=_0x52bd0b[_0x1d06f8(0x348,0x395,0x375,0x355)](),_0x1e7395=getglobalvar(_0x263ed5)||'';return _0x375e3b&&_0x375e3b[_0x1d06f8(0x3c8,0x380,0x3c1,0x3e3)](_0x3df71d(-0x232,-0x1f8,-0x248,-0x23a)+_0x3df71d(-0x20e,-0x1f8,-0x1ee,-0x232)+_0x263ed5+'@}'),_0x1e7395;}}),_0x5b5367=_0x5b5367[_0x37f39d(0x125,0x14a,0x155,0x10f)](/\{@getworldvar::([^@]+)@\}/g,(_0x458542,_0xbc58e6)=>{const _0x240475=_0xbc58e6[_0x5270f9(0x148,0x118,0x14c,0x115)]();function _0x545641(_0x3197fc,_0x7be11d,_0xd08b15,_0x40ea87){return _0x37f39d(_0x3197fc-0xec,_0x7be11d-0x2f,_0x7be11d- -0x311,_0x3197fc);}const _0x387f29=getworldvar(_0x240475)||'';function _0x5270f9(_0x27ce71,_0x26edb3,_0x3d8407,_0x48f990){return _0x37f39d(_0x27ce71-0x51,_0x26edb3-0x3c,_0x48f990- -0x23,_0x27ce71);}return _0x375e3b&&_0x375e3b[_0x5270f9(0x13f,0x16e,0x127,0x161)]('{@getworld'+'var::'+_0x240475+'@}'),_0x387f29;}),_0x5b5367;}export function buildPromptWithTrigger(_0x39bc5d){const _0x3c50cc={'AsTgT':function(_0x2058fb,_0x5d6782,_0x595e65,_0x1f2fca,_0x3b8509){return _0x2058fb(_0x5d6782,_0x595e65,_0x1f2fca,_0x3b8509);},'cyWld':'{{user}}','uWMze':'<user>','ZCEEF':function(_0x4c3377,_0x264ce4,_0x35d854,_0x368120){return _0x4c3377(_0x264ce4,_0x35d854,_0x368120);},'Pngit':function(_0x9463c6,_0x4fbcdd){return _0x9463c6===_0x4fbcdd;},'iVSlm':function(_0x521b6e){return _0x521b6e();},'IPbQQ':function(_0x534b25,_0x5a9aa7){return _0x534b25===_0x5a9aa7;},'KwZsx':'jbubi','DCXtv':_0x59a76c(0x1d7,0x207,0x1c5,0x21b),'iTfwy':function(_0x4761c9,_0x4fdc15){return _0x4761c9===_0x4fdc15;},'IlVBJ':'trigger','ZCdFo':_0x59a76c(0x2af,0x272,0x231,0x27a),'EoPmy':_0x59a76c(0x235,0x257,0x279,0x26d),'bNQME':'kRVpG','ErvZt':function(_0x4c9cf1,_0x397155){return _0x4c9cf1!==_0x397155;},'EUrAB':'ierUm','wZabb':function(_0x51624f,_0x5030a2){return _0x51624f!==_0x5030a2;},'eAiYG':function(_0x3e4b08,_0x1d1f64){return _0x3e4b08(_0x1d1f64);},'KYDKH':function(_0x5598db,_0x43e32e,_0x2f6c5f){return _0x5598db(_0x43e32e,_0x2f6c5f);}},{requestType:_0x5226db,contextData:_0x31b3ab}=_0x39bc5d,_0x1ccb8e=extension_settings[extensionName]?.[_0x42565c(0x2d5,0x2dd,0x306,0x2f9)+'t_type_con'+'figs']||{},_0x52cb12={};_0x52cb12[_0x42565c(0x23f,0x263,0x2a5,0x273)+'ofile']='默认';function _0x59a76c(_0x15d590,_0x131232,_0x43aa1c,_0x461f07){return _0x107f(_0x131232-0xb8,_0x43aa1c);}function _0x42565c(_0x550251,_0x123032,_0x554cba,_0x426f48){return _0x107f(_0x123032-0x115,_0x426f48);}const _0x233c3a=_0x1ccb8e[_0x5226db]||_0x52cb12,_0x440c1d=_0x233c3a['context_pr'+_0x59a76c(0x233,0x274,0x29a,0x28d)]||'默认',_0x576234=extension_settings[extensionName]?.[_0x59a76c(0x26e,0x231,0x1ff,0x26c)+'xt_profile'+'s']||{},_0x29fecf=_0x576234[_0x440c1d]||_0x576234[Object['keys'](_0x576234)[-0x2291+-0xb7*-0x8+0x1cd9]]||{},{context:context='',body:body='',worldBookContent:worldBookContent='',userDemand:userDemand=''}=_0x31b3ab,_0x1dab7f=[userDemand,context,body,worldBookContent][_0x59a76c(0x27d,0x24f,0x239,0x240)](Boolean)[_0x42565c(0x2d2,0x29f,0x2c3,0x283)]('\x0a'),_0xcb0a2d=[];if(_0x29fecf['entries']&&Array[_0x42565c(0x2e8,0x2b0,0x2f0,0x26c)](_0x29fecf[_0x59a76c(0x295,0x279,0x246,0x2b1)])){if(_0x3c50cc[_0x59a76c(0x23c,0x24b,0x25c,0x212)](_0x3c50cc['KwZsx'],_0x3c50cc[_0x59a76c(0x1d9,0x21b,0x245,0x205)])){const _0xd5a746=_0x521e29[_0x59a76c(0x24d,0x223,0x210,0x25d)](),_0x1686e8=_0x1ff652['chatMetada'+'ta'][_0x42565c(0x28e,0x2a4,0x2ed,0x2c0)][_0xd5a746]||'';return _0x420593&&_0x12d533[_0x59a76c(0x2a5,0x26f,0x28f,0x275)](_0x59a76c(0x255,0x277,0x292,0x233)+_0xd5a746+'@}'),_0x1686e8;}else for(const _0x36601f of _0x29fecf[_0x42565c(0x29d,0x2d6,0x29a,0x298)]){if(!_0x36601f[_0x59a76c(0x265,0x232,0x226,0x206)])continue;if(!_0x36601f['content']||_0x36601f[_0x42565c(0x278,0x2a6,0x2e7,0x26c)][_0x59a76c(0x24f,0x223,0x233,0x1f9)]()==='')continue;if(_0x3c50cc[_0x42565c(0x2b2,0x289,0x29c,0x28b)](_0x36601f[_0x59a76c(0x2a2,0x291,0x28e,0x2d6)+'e'],_0x3c50cc[_0x42565c(0x2c4,0x2c7,0x2da,0x2c1)])){if(!checkTriggerWords(_0x36601f[_0x59a76c(0x250,0x21d,0x1ef,0x251)+'ds'],_0x1dab7f))continue;}const _0x515b64={};_0x515b64['role']=_0x36601f[_0x59a76c(0x25f,0x22e,0x275,0x26f)]||_0x3c50cc[_0x59a76c(0x2c3,0x27f,0x2b2,0x251)],_0x515b64[_0x42565c(0x2ea,0x2a6,0x2b5,0x277)]=_0x36601f[_0x42565c(0x27e,0x2a6,0x2cf,0x263)],_0xcb0a2d[_0x42565c(0x328,0x2e4,0x2e5,0x2b9)](_0x515b64);}}else{if(_0x29fecf[_0x59a76c(0x277,0x258,0x292,0x26d)]&&Array[_0x42565c(0x28f,0x2b0,0x2ac,0x280)](_0x29fecf[_0x42565c(0x2a3,0x2b5,0x2db,0x2ea)])){if(_0x42565c(0x2cf,0x2b4,0x2cf,0x2a6)===_0x3c50cc[_0x42565c(0x26b,0x2ab,0x272,0x298)])for(const _0xc1a90b of _0x29fecf[_0x59a76c(0x271,0x258,0x22b,0x229)]){if(_0x3c50cc[_0x59a76c(0x20b,0x234,0x1f3,0x279)]!==_0x3c50cc['bNQME'])_0x291821[_0x4a0879]=_0x3c50cc[_0x59a76c(0x296,0x265,0x2a4,0x256)](_0x4427e3,_0x577b25[_0x403ff3],_0x3d0ec6,_0x4a0863,_0x44075b);else{if(_0xc1a90b['user']&&_0xc1a90b[_0x42565c(0x2cb,0x2cf,0x2c2,0x2d9)][_0x42565c(0x25f,0x280,0x25f,0x2bb)]()!==''){if(_0x3c50cc[_0x59a76c(0x282,0x25d,0x29f,0x27e)](_0x3c50cc[_0x42565c(0x326,0x2e3,0x307,0x29a)],_0x3c50cc['EUrAB']))_0x12bcee=_0x3526a1[_0x42565c(0x270,0x298,0x2ac,0x2dc)](_0x3c50cc[_0x42565c(0x27e,0x295,0x2cf,0x283)],_0x1b59bd),_0x2086ea=_0x2fa2f9[_0x59a76c(0x23b,0x23b,0x248,0x25f)](_0x3c50cc[_0x42565c(0x2cd,0x286,0x2ba,0x266)],_0x290dc9);else{const _0x385177={};_0x385177[_0x42565c(0x2a9,0x28b,0x25a,0x25a)]=_0x3c50cc[_0x42565c(0x299,0x2dc,0x2ef,0x304)],_0x385177[_0x42565c(0x27e,0x2a6,0x2c3,0x2eb)]=_0xc1a90b[_0x42565c(0x289,0x2cf,0x2a0,0x2f9)],_0xcb0a2d[_0x42565c(0x2d0,0x2e4,0x2ea,0x327)](_0x385177);}}if(_0xc1a90b[_0x42565c(0x2b2,0x2a9,0x2c6,0x2d8)]&&_0x3c50cc[_0x42565c(0x25b,0x27e,0x2c6,0x2a8)](_0xc1a90b[_0x59a76c(0x20e,0x24c,0x26c,0x259)]['trim'](),'')){const _0x301103={};_0x301103[_0x59a76c(0x201,0x22e,0x22b,0x228)]=_0x42565c(0x2cc,0x2a9,0x2e4,0x2a1),_0x301103[_0x59a76c(0x219,0x249,0x217,0x27d)]=_0xc1a90b[_0x42565c(0x2cb,0x2a9,0x276,0x2db)],_0xcb0a2d['push'](_0x301103);}}}else{if(!_0x1210fe||_0x3c50cc[_0x42565c(0x260,0x275,0x24c,0x247)](_0x15fef4[_0x59a76c(0x261,0x271,0x25f,0x253)],-0x1*0x743+0xffe+-0x8bb))return _0x59c067;const _0x5f0c5c=_0x3c50cc[_0x59a76c(0x227,0x25b,0x26b,0x22c)](_0x5350f1);return!_0x5f0c5c['chatMetada'+'ta']&&(_0x5f0c5c['chatMetada'+'ta']={}),!_0x5f0c5c[_0x59a76c(0x25c,0x25a,0x29a,0x24f)+'ta'][_0x59a76c(0x281,0x247,0x262,0x270)]&&(_0x5f0c5c['chatMetada'+'ta']['variables']={}),_0x3dfebe[_0x42565c(0x23c,0x277,0x265,0x29a)](_0x33ea1b=>{if(!_0x33ea1b||!_0x33ea1b['content'])return _0x33ea1b;return{..._0x33ea1b,'content':_0x3c50cc['ZCEEF'](_0x7318e2,_0x33ea1b['content'],_0x5f0c5c,_0x1f75dc)};});}}}const _0x359bc7=_0x3c50cc['eAiYG'](mergeAdjacentMessages,_0xcb0a2d),{messages:_0x2d6615,replacedVariables:_0x60c6bd}=_0x3c50cc[_0x59a76c(0x250,0x28b,0x2ac,0x290)](replaceAllPlaceholders,_0x359bc7,_0x31b3ab);return _0x2d6615;}export function getProcessedPrompt(_0x3f4ccf,_0x31954b){const _0xbd4ace={};_0xbd4ace[_0xafb8bb(0x4ed,0x51b,0x50f,0x528)+'e']=_0x3f4ccf;function _0xafb8bb(_0x1d380c,_0x11b830,_0x4c151a,_0x1af3c4){return _0x107f(_0x1d380c-0x392,_0x4c151a);}function _0x30e25c(_0x4d6863,_0x298ff1,_0x11ca63,_0x32e0d6){return _0x107f(_0x11ca63-0x279,_0x4d6863);}return _0xbd4ace[_0x30e25c(0x3bf,0x40e,0x407,0x3df)+'a']=_0x31954b,buildPromptWithTrigger(_0xbd4ace);}