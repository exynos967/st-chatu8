(function(_0x51cafb,_0x3aad0c){function _0x5cf035(_0x13a661,_0x38495a,_0x4101b1,_0x254a03){return _0x5824(_0x254a03-0x19,_0x13a661);}function _0x49c010(_0x5ee942,_0x95ac07,_0x532699,_0x48921b){return _0x5824(_0x5ee942-0x1c5,_0x95ac07);}const _0x10af32=_0x51cafb();while(!![]){try{const _0x1ae5d2=-parseInt(_0x5cf035(0x13d,0x16e,0xfc,0x153))/(-0x9*-0x3f5+0x4*-0x445+-0x1288)*(parseInt(_0x5cf035(0x1d7,0x197,0x1fa,0x1ec))/(-0x1*-0x258d+0xef7+0x40a*-0xd))+parseInt(_0x5cf035(0x170,0x16e,0x14c,0x1b0))/(-0x1f3*-0xd+0x62e*0x4+-0x320c)+-parseInt(_0x49c010(0x33b,0x2d5,0x2de,0x347))/(-0x1*0x1915+0x269*0x10+0x17f*-0x9)+-parseInt(_0x49c010(0x309,0x317,0x2ae,0x2ed))/(0x125a+-0xd6*0x1f+0x3*0x287)+parseInt(_0x49c010(0x31a,0x32c,0x331,0x322))/(-0x10b8+-0xd6f+0x1e2d*0x1)+-parseInt(_0x49c010(0x377,0x3c5,0x3c6,0x3b2))/(-0x2394+0x6b+0x4*0x8cc)+-parseInt(_0x5cf035(0xe7,0x10d,0x16f,0x143))/(0x1b74+-0xc1a+-0x6a*0x25)*(-parseInt(_0x49c010(0x31f,0x373,0x319,0x35b))/(-0x1e64+-0x1490+0x32fd));if(_0x1ae5d2===_0x3aad0c)break;else _0x10af32['push'](_0x10af32['shift']());}catch(_0x5c6a13){_0x10af32['push'](_0x10af32['shift']());}}}(_0x8d78,-0x1e973*-0x6+0x887c4+-0x11*0xc3b3));const _0x50f97a=(function(){const _0x2ff764={};function _0x32af99(_0x220465,_0x11c9bc,_0x52d452,_0x530115){return _0x5824(_0x11c9bc- -0x17c,_0x52d452);}_0x2ff764[_0x32af99(0x41,0x18,0x20,-0x21)]=function(_0xd04d93,_0x9f19){return _0xd04d93===_0x9f19;},_0x2ff764[_0x32af99(-0x13,-0x78,-0x2e,-0x75)]='nLzUe';const _0xd0bfa8=_0x2ff764;function _0x238812(_0x3b81e4,_0x928152,_0x33f91f,_0x3f298b){return _0x5824(_0x3b81e4-0x24b,_0x33f91f);}let _0x103f26=!![];return function(_0x43f406,_0x29a8e0){function _0x2804f5(_0x15cd12,_0x4906ad,_0x43d5f0,_0x37f0b7){return _0x238812(_0x37f0b7- -0x4cf,_0x4906ad-0x100,_0x43d5f0,_0x37f0b7-0xe8);}function _0x4c3eeb(_0x3ee77a,_0x4e93d0,_0x17f110,_0x2f6167){return _0x32af99(_0x3ee77a-0xdc,_0x17f110-0x297,_0x3ee77a,_0x2f6167-0x2f);}if(_0xd0bfa8[_0x2804f5(-0x92,-0x114,-0xc5,-0xf0)](_0xd0bfa8[_0x2804f5(-0x1da,-0x168,-0x144,-0x180)],_0xd0bfa8[_0x2804f5(-0x1a0,-0x1bf,-0x16d,-0x180)])){const _0x254610=_0x103f26?function(){function _0x4836be(_0x2ae56b,_0x53a687,_0x319668,_0x3f7e65){return _0x2804f5(_0x2ae56b-0x160,_0x53a687-0x12,_0x53a687,_0x319668-0x365);}if(_0x29a8e0){const _0x27fa2a=_0x29a8e0[_0x4836be(0x301,0x288,0x2a4,0x30d)](_0x43f406,arguments);return _0x29a8e0=null,_0x27fa2a;}}:function(){};return _0x103f26=![],_0x254610;}else _0x486179(_0x1a2ac3['data']);};}()),_0x2b3d4b=_0x50f97a(this,function(){const _0x681aa1={};_0x681aa1[_0x2d8ff8(0x3e1,0x446,0x44c,0x416)]=_0x5cd158(0x453,0x493,0x4c5,0x477)+'+$';function _0x2d8ff8(_0xbe2168,_0x31ca49,_0x21fead,_0x5b7224){return _0x5824(_0xbe2168-0x282,_0x5b7224);}function _0x5cd158(_0x309bcb,_0x160afe,_0x303a8d,_0x3c696c){return _0x5824(_0x160afe-0x31f,_0x309bcb);}const _0x14f935=_0x681aa1;return _0x2b3d4b[_0x5cd158(0x4b1,0x46b,0x45f,0x465)]()[_0x2d8ff8(0x400,0x426,0x395,0x3ff)](_0x14f935[_0x5cd158(0x48b,0x47e,0x4e3,0x4ea)])[_0x2d8ff8(0x3ce,0x3c2,0x43c,0x3cf)]()['constructo'+'r'](_0x2b3d4b)[_0x5cd158(0x47d,0x49d,0x430,0x4b3)](_0x14f935['FoVmQ']);});_0x2b3d4b();import{extension_settings}from'../../../../../extensions.js';import{saveSettingsDebounced}from'../../../../../../script.js';import{extensionName}from'../config.js';function _0x10ba6a(_0x2a5950,_0x1961fe,_0x50fd16,_0x3e4282){return _0x5824(_0x2a5950-0x23e,_0x50fd16);}import{processUploadedImage,processUploadedImageToBlob,addLog}from'../utils.js';function _0x8d78(){const _0x46538d=['ihrVihvWzgf0zq','DfDjAwy','i25VDMvSywKTAq','q2TpDhG','5lUo57Yt5A2y5yQG6l29q29TzNK','Aw5SAw5LlwzSzq','rKLgz3u','C3bSAxq','q29dtwS','B2Lhru4','yNrU','y2fJAgvFy29TzG','Dg5oAgK','lwj0BG','zgPSDKW','AwjLigLTywDLoG','y3rvuKW','veDMvMC','Dg9Y','DMX2Cvy','mJCYnJe3nvnbruXoAq','DgHLig5LDYbMBW','5zMO6l+u5zUE5PwW5O2UoIa','CIaUC3qTy2HHDa','zw1VDMuTy2HHCG','z2vAuKu','BwfNzs1WCMv2Aq','t0H0rhy','BMX5','y3jLyxrLt2jQzq','ExvPx3jLzL9PBq','i25VDMvSywKTCG','ywTwtfO','Df9UywLFy2HHCG','ANnVBG','vuf3qwC','zgf0ytPPBwfNzq','y29TzNL1AwnHBG','AgfYlxjLzI1PBq','5zU+54Mh5Ase55cg5OIw5lIk5lYG5PE25yE66zsz','ywHdrLa','tuH4ENO','u0fxquK','l3vWBg9Hzc9PBq','tMfTzq','igzYB20Gy2fJAa','Bw1kr04','mZu4ndq0ofbKAefyyq','CxvLCNLtzwXLyW','Aw5NignHy2HLza','i2nVBwz5DwKTCG','wuruCvy','r3zTr2u','zxnZAw5Nie5VDG','Aw1Hz2uVCg5N','zxiGlNn0lwnOyq','ChjLDMLLD0LTyq','EuD1r2e','BwvZC2fNzq','veLbu3i','zMXLEa','C3jJ','B3LrvvK','Bg9N','yxbWBhK','C3r5Bgu','yMXVyJO','zNrWq2i','r3DcyM4','yMXVy2S','DhjPBq','CML0zq','C2vYDMvYrMLSzq','shnruMy','ihjLlxvWBg9Hza','yxbWzw5K','BgfJzwHVBgrLCG','5zUE5PwW5O2UoG','Bw92zs1PBwfNzq','tMvXsK8','mtrsBLzjzxy','zMLUza','y2XPy2S','Aw1Hz2vjBNb1Da','sfrssNG','v2fXt0e','A0XJwuG','CMvMlwLTywDLlq','wNPlBgu','igzYB20GB2XKia','CMvM','C3rYAw5NAwz5','ignHy2HLihrVia','5zU+54Mh5lIk5lYG5OIq5yQFlcdMNi3LIQe','BgfPx2nOyxjFCG','zw1VDMuTAw1HzW','sgXhDMC','AuHJzeO','qLnJrhu','DwjuqxC','B0zvrLK','ugjXCgO','AMfjEeW','qKPZt1i','5zU+54Mh5Ase55cg5AsX6lsLoIa','AgX4CLK','zMvIuMK','zxCTy29UDgfPBG','A2nMCMW','twfvvxe','zwXLy3qTAw1HzW','yxqUifbSzwfZzq','sevVB3u','ienVBwz5vuKGAq','5zU+54Mh5lIk5lYG5AsX6lsLlcdPLjNOR68','BgfPx3zPyMvFDa','y29TzNL1AvvYBa','ugPtqNq','lxjLzI1PBwfNzq','CMfUC2zLCL9PBq','zgLZCgXHEq','tg9HzgvKienVBq','m3WYFdf8mhW1Fa','reLdBKW','i25VDMvSywKTCW','CgXHy2vOB2XKzq','vM9uCg4','BMviCe8','DY1JB250ywLUzq','DwnkC1G','C3rVCMvezwXLDa','zwXLy3qTy2HHCG','weLvtfe','zMLSzxm','zwzFAw1Hz2u','nteXnJb2weLtAxa','6zsz6k+V6k+M5OofoG','vvjm','CL9Yzwy','zwXbssbPBwfNzq','ywDL','qNLjza','mNW0Fdf8m3WW','BwfNztO','rxjYB3iGChjVyW','i25VDMvSywKTyW','6k+M5OofoIa','BMfTzq','y2fJAgvFBM92zq','v0v6vxC','BMfPm1zPyMvuCG','ntC0nu11veT6sW','y2fJAguGzM9YBq','5lIk5lYG5AsX6lsLoIa','vLfku1i','y2HHBMDL','vgTLtMC','BM9Uzq','sxLfugK','Dhu4lwLTywDLlq','CMvZDwX0','mJq0nJG0nxn5vwv2zq','r0jethK','z2uY','z2v0rwXLBwvUDa','AKnwuuq','Bvf5suG','t1nmEha','zgviEwy','Dg9tDhjPBMC','D2fYBG','i2LTywDLsw5WDq','CMvHzefZrgf0yq','zNLvssbPBwfNzq','ywHgwvi','zgf0yq','D2rJChC','Df9UB3zLBgfP','mJi1nte3oeTtqNrODa','DezYD0G','C3rVCMvszwfKvW','DtGTAw1Hz2uTCa','rufKv1C','ota5v1jRA3LL','uwnYwgy','zs1IDg4','x25HAv9JAgfYxW','rxjYB3iGBg9Hza','rM9wBve','CMv2B2TLt2jQzq','yMXVyG','zxnNC0y','wu1hyw0','sunMBxK','DfzVAMG','BeLXr2i','BM92zwXHAs1Yzq','tKjKzwC','z2vFBMfPx2nOyq','BMfPm0nOyxjszq','ie5VDMvSquKGqW','uMTYDhy','vgTOwLq','x25VDMvSywK','ie5VDMvSquKGvG','ue9tva','A2fVDhvWAwfU','CKPtCMi','x3jLzG','kcGOlISPkYKRkq','DhHyA2C','mtCXodCYmgfuC0n4Ba','zxjYB3i','tujqwey','B1fnEg4','vgfwuMq','mxWYFdn8mhW0','i2nVBwz5DwKTAq','tNLYuu8','C2vHCMnO','ywDLoG','rKngALe','C3rHCNrZv2L0Aa','BKvhvMm'];_0x8d78=function(){return _0x46538d;};return _0x8d78();}import{dbs}from'../database.js';const NAI_VIBE_CACHE_KEY=_0x10ba6a(0x375,0x374,0x34c,0x325)+_0x10ba6a(0x354,0x351,0x3bb,0x2fe)+_0x49bc53(0x1bf,0x243,0x1e9,0x254)+_0x49bc53(0x24a,0x239,0x1fe,0x1b6),NAI_CHAR_REF_CACHE_KEY=_0x49bc53(0x224,0x1e0,0x206,0x197)+_0x49bc53(0x2f5,0x250,0x2b0,0x30f)+_0x10ba6a(0x367,0x32e,0x393,0x360),COMFYUI_REF_CACHE_KEY=_0x49bc53(0x206,0x2c7,0x25d,0x25d)+_0x49bc53(0x222,0x26c,0x270,0x232)+'age';let nai3VibeTransferImageMimeType=_0x10ba6a(0x3f7,0x398,0x401,0x452),nai3CharRefImageMimeType='image/png',comfyuiImageObjectURL=null;function updateNovelaiImagePreview(_0x23e8ea){const _0x44c6e5={};_0x44c6e5[_0x460a19(0x99,0xf1,0x131,0xc7)]='previewIma'+'ge_novelai',_0x44c6e5[_0x460a19(0x9b,0xd1,0xa7,0xbe)]=_0x4b26c5(0x34f,0x309,0x324,0x305)+_0x460a19(0xe7,0x1b7,0x1bc,0x154)+_0x4b26c5(0x2f3,0x302,0x2ad,0x293)+_0x4b26c5(0x315,0x3c1,0x359,0x33c)+_0x4b26c5(0x331,0x34c,0x2e1,0x271)+_0x4b26c5(0x28e,0x317,0x2bf,0x254)+'r',_0x44c6e5['oiGEN']=_0x460a19(0x17f,0x114,0x10a,0x11e)+_0x460a19(0x17e,0x119,0x1a9,0x188)+_0x460a19(0x116,0x107,0x132,0x147),_0x44c6e5[_0x4b26c5(0x322,0x32b,0x2f2,0x298)]=_0x460a19(0x17e,0x1ba,0xf1,0x15e),_0x44c6e5['kcfrl']=_0x4b26c5(0x388,0x399,0x367,0x389),_0x44c6e5[_0x4b26c5(0x342,0x31c,0x34b,0x2f2)]=_0x460a19(0x93,0xa5,0x10b,0xe8),_0x44c6e5[_0x4b26c5(0x30f,0x3c0,0x378,0x3e0)]=_0x460a19(0x1b3,0x12d,0x1e2,0x176),_0x44c6e5[_0x460a19(0x17b,0xd9,0x17e,0x142)]=_0x460a19(0x156,0x153,0xac,0xf7);const _0x50585b=_0x44c6e5;function _0x4b26c5(_0x3af07a,_0x39f001,_0x4a874f,_0xcc8abc){return _0x49bc53(_0x3af07a,_0x39f001-0xa8,_0x4a874f-0xd0,_0xcc8abc-0x1e6);}const _0x21cb89=document[_0x460a19(0xf8,0xf2,0x127,0xfe)+_0x4b26c5(0x29b,0x302,0x2cf,0x32a)](_0x50585b[_0x4b26c5(0x28f,0x25e,0x2af,0x2c3)]),_0x387a3a=document[_0x460a19(0x1c1,0x150,0x1b9,0x16a)+_0x4b26c5(0x2e7,0x2dc,0x334,0x2fb)](_0x50585b[_0x460a19(0xf3,0xbc,0x81,0xbe)]),_0x594e70=document[_0x460a19(0x10f,0xe8,0xcb,0xfe)+_0x4b26c5(0x2cf,0x31e,0x2cf,0x32f)](_0x50585b[_0x460a19(0x13b,0x127,0xf8,0x143)]);function _0x460a19(_0x5376ac,_0x2961aa,_0x217405,_0x32ca9e){return _0x10ba6a(_0x32ca9e- -0x287,_0x2961aa-0x1ab,_0x2961aa,_0x32ca9e-0x132);}if(_0x23e8ea&&_0x23e8ea[_0x460a19(0x1a5,0xe3,0xf9,0x138)](_0x50585b['wdcpw'])){_0x21cb89[_0x460a19(0x1a1,0x1b6,0x14b,0x177)]=_0x23e8ea,_0x21cb89['style'][_0x4b26c5(0x2c7,0x2eb,0x2ba,0x308)]=_0x50585b[_0x460a19(0xd1,0xdd,0x126,0xc6)],_0x387a3a[_0x460a19(0x18d,0x10c,0x180,0x17b)][_0x4b26c5(0x257,0x2f6,0x2ba,0x2af)]=_0x460a19(0x14d,0xf1,0x132,0xf7),_0x594e70['style'][_0x4b26c5(0x2bc,0x2ca,0x2ba,0x2de)]=_0x460a19(0xf5,0x11c,0x137,0x13f)+'x';const _0x25b42b=_0x23e8ea[_0x460a19(0xdc,0x183,0x15b,0x141)](','),_0x388a87=_0x25b42b[-0x1508+-0x149*-0x15+-0x5f5][_0x460a19(0x131,0x177,0x1a5,0x141)](':')[0x124*0x20+-0x7b*-0x4f+-0x4a74][_0x4b26c5(0x36b,0x2c7,0x329,0x2f4)](';')[-0x1*-0x7d3+-0x1*-0x161+-0x934];nai3VibeTransferImageMimeType=_0x388a87,window[_0x460a19(0x125,0x84,0xaf,0xf0)+'ansferImag'+'e']=_0x25b42b[0x2018+-0x3*-0xa59+-0x1f91*0x2];const _0x7e1aaa={};_0x7e1aaa['id']=NAI_VIBE_CACHE_KEY,_0x7e1aaa[_0x4b26c5(0x287,0x2fa,0x2f1,0x2d7)]=_0x23e8ea,dbs['storeReadW'+_0x4b26c5(0x390,0x342,0x369,0x365)](_0x7e1aaa);}else{const _0x4faf92=_0x50585b[_0x4b26c5(0x343,0x357,0x34b,0x2e6)][_0x4b26c5(0x35a,0x38f,0x329,0x358)]('|');let _0x24122d=0x1*0x1feb+0x41*0x93+-0x2*0x229f;while(!![]){switch(_0x4faf92[_0x24122d++]){case'0':window['nai3VibeTr'+'ansferImag'+'e']=null;continue;case'1':_0x387a3a[_0x460a19(0x15c,0x1c0,0x166,0x17b)][_0x4b26c5(0x2b4,0x31d,0x2ba,0x302)]=_0x50585b[_0x4b26c5(0x342,0x32a,0x378,0x328)];continue;case'2':_0x21cb89[_0x4b26c5(0x34a,0x351,0x35f,0x39c)]='';continue;case'3':_0x594e70['style'][_0x460a19(0x71,0x13d,0x75,0xd2)]=_0x50585b[_0x460a19(0x1b0,0x157,0x171,0x142)];continue;case'4':_0x21cb89[_0x460a19(0x127,0x153,0x140,0x17b)][_0x4b26c5(0x277,0x325,0x2ba,0x2c7)]=_0x50585b[_0x4b26c5(0x2f7,0x34a,0x32a,0x340)];continue;}break;}}}function _0x5824(_0x11f6c2,_0x46f34b){_0x11f6c2=_0x11f6c2-(-0x3*-0xb91+-0x797*-0x3+0x95*-0x61);const _0x471452=_0x8d78();let _0x30f7f3=_0x471452[_0x11f6c2];if(_0x5824['SsSPkw']===undefined){var _0x4f27e6=function(_0x5d6ee4){const _0x5ac327='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=';let _0x4b7615='',_0x1dbc6b='',_0x445a73=_0x4b7615+_0x4f27e6;for(let _0x3e0e6f=0x761+0x413*0x3+-0x182*0xd,_0x142300,_0x2da71e,_0x29861f=0x133f*0x2+-0x1*-0x11cb+0x9*-0x641;_0x2da71e=_0x5d6ee4['charAt'](_0x29861f++);~_0x2da71e&&(_0x142300=_0x3e0e6f%(-0x2209+0x26f9+-0x4ec)?_0x142300*(0xed*0x4+-0xb3*-0x25+-0x1d53)+_0x2da71e:_0x2da71e,_0x3e0e6f++%(0x466*-0x5+-0x234+0x1836))?_0x4b7615+=_0x445a73['charCodeAt'](_0x29861f+(-0x1593+0x36a+0x1233))-(0x17*0x151+-0x74*0x4f+0x58f)!==0x1*0xc5+0x1d*-0x109+0x40*0x75?String['fromCharCode'](-0x11d2+-0x3a*-0x17+0x81*0x1b&_0x142300>>(-(-0x5*0x1fd+0xa*-0x5d+0xd95)*_0x3e0e6f&0xaa1*0x3+-0xd61+-0x127c)):_0x3e0e6f:0xd6*-0xf+-0x245e+0x30e8){_0x2da71e=_0x5ac327['indexOf'](_0x2da71e);}for(let _0x473d9b=0x1760+0x3ea+0x1b4a*-0x1,_0x5877c4=_0x4b7615['length'];_0x473d9b<_0x5877c4;_0x473d9b++){_0x1dbc6b+='%'+('00'+_0x4b7615['charCodeAt'](_0x473d9b)['toString'](0x67a*0x2+0x12f5*-0x1+-0x1*-0x611))['slice'](-(0x19d*0x13+-0x2f*-0xb5+-0x3fe0));}return decodeURIComponent(_0x1dbc6b);};_0x5824['nWBrRw']=_0x4f27e6,_0x5824['rdBDDM']={},_0x5824['SsSPkw']=!![];}const _0xa10ea4=_0x471452[0x1f*0xe9+0x1bd*-0x16+0xa07],_0x3b5113=_0x11f6c2+_0xa10ea4,_0xfacc45=_0x5824['rdBDDM'][_0x3b5113];if(!_0xfacc45){const _0x29cca0=function(_0x577698){this['uabzFn']=_0x577698,this['eSAvCS']=[0x1c6*-0xf+-0x1604+0x309f,0x13*0x1b6+0x22b*-0x7+-0x1155,0x15c*-0x8+-0x2656+-0x189b*-0x2],this['GJXVis']=function(){return'newState';},this['oNhiCd']='\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*',this['KiIhRB']='[\x27|\x22].+[\x27|\x22];?\x20*}';};_0x29cca0['prototype']['RCMBIm']=function(){const _0x48dde3=new RegExp(this['oNhiCd']+this['KiIhRB']),_0x3adeaa=_0x48dde3['test'](this['GJXVis']['toString']())?--this['eSAvCS'][-0xb*0x15+0x2d*-0x75+0x1579]:--this['eSAvCS'][0x28*-0x7b+0x810+0x1dc*0x6];return this['RYtMOp'](_0x3adeaa);},_0x29cca0['prototype']['RYtMOp']=function(_0x204920){if(!Boolean(~_0x204920))return _0x204920;return this['KLNKri'](this['uabzFn']);},_0x29cca0['prototype']['KLNKri']=function(_0x5eb331){for(let _0x240045=-0x35b*-0x1+-0xa*0x1cb+-0x1*-0xe93,_0x41fc0d=this['eSAvCS']['length'];_0x240045<_0x41fc0d;_0x240045++){this['eSAvCS']['push'](Math['round'](Math['random']())),_0x41fc0d=this['eSAvCS']['length'];}return _0x5eb331(this['eSAvCS'][0x25*0x75+0x2*0x5a3+-0x6f*0x41]);},new _0x29cca0(_0x5824)['RCMBIm'](),_0x30f7f3=_0x5824['nWBrRw'](_0x30f7f3),_0x5824['rdBDDM'][_0x3b5113]=_0x30f7f3;}else _0x30f7f3=_0xfacc45;return _0x30f7f3;}function removeNovelaiImage(){function _0x5a2c9a(_0x29e88a,_0x287be3,_0x2c0991,_0x2b1ca7){return _0x49bc53(_0x2c0991,_0x287be3-0xdd,_0x29e88a- -0x1a5,_0x2b1ca7-0x1cd);}const _0x85aef6={'MCJco':function(_0x46f0b7,_0x4264a2){return _0x46f0b7(_0x4264a2);}};_0x85aef6['MCJco'](updateNovelaiImagePreview,null),dbs[_0x5a2c9a(0x4f,0x9b,0x91,0xb0)+'e'](NAI_VIBE_CACHE_KEY);}async function handleNovelaiImageUpload(_0x5b931e){const _0x468199={'ZzKle':function(_0x42f704,_0xa8e97){return _0x42f704(_0xa8e97);},'yGuGa':_0x5d6695(0x221,0x254,0x25a,0x1cb)+_0x47502c(0xe6,0xfc,0x10f,0xb0)+_0x47502c(0x61,0x72,0x98,0x9f)+':','febRi':function(_0x2c11c7,_0xe3242d){return _0x2c11c7+_0xe3242d;}},_0x491cf2=_0x5b931e['target'][_0x5d6695(0x216,0x1ff,0x1dc,0x231)][-0x2b*-0x6d+-0x2*0xe57+-0x9*-0x127];function _0x5d6695(_0x11e4a2,_0x477ea8,_0x319db4,_0x21c558){return _0x10ba6a(_0x11e4a2- -0x150,_0x477ea8-0xbb,_0x477ea8,_0x21c558-0xa2);}function _0x47502c(_0x598470,_0x122185,_0x6bcd97,_0x417e39){return _0x49bc53(_0x6bcd97,_0x122185-0x199,_0x122185- -0x18b,_0x417e39-0x13c);}if(!_0x491cf2)return;try{const _0x3b47d5=await processUploadedImage(_0x491cf2,!![]);_0x468199[_0x47502c(0xb8,0x11f,0x140,0xff)](updateNovelaiImagePreview,_0x3b47d5);}catch(_0x1e3f29){console[_0x47502c(0x8b,0xbb,0xdb,0x11f)](_0x468199[_0x5d6695(0x2aa,0x244,0x2a8,0x258)],_0x1e3f29),alert(_0x468199[_0x47502c(0x6d,0x51,0x0,0x59)](_0x47502c(0xb3,0x4f,-0x1f,0x50),_0x1e3f29[_0x5d6695(0x2ab,0x29d,0x2cf,0x26c)]));}}function updateNovelaiCharRefImagePreview(_0x2657c6){const _0x573d1a={};_0x573d1a[_0x3d37f6(0x461,0x454,0x486,0x43c)]=_0x417484(0x4ce,0x4e5,0x53b,0x51a),_0x573d1a[_0x417484(0x47b,0x475,0x4d4,0x45b)]=_0x417484(0x48e,0x43a,0x47c,0x4c5)+'x',_0x573d1a[_0x417484(0x447,0x488,0x455,0x44b)]='previewIma'+_0x417484(0x46f,0x43c,0x4a9,0x4d0)+_0x417484(0x433,0x45a,0x41c,0x487);function _0x417484(_0x4d2ae0,_0x4f526f,_0xd83d20,_0x3ad71a){return _0x49bc53(_0x3ad71a,_0x4f526f-0x199,_0x4d2ae0-0x237,_0x3ad71a-0xcc);}_0x573d1a['LMzfb']=_0x417484(0x43a,0x41d,0x42f,0x422)+_0x417484(0x4af,0x4f2,0x4c5,0x4fc)+'age-previe'+_0x3d37f6(0x404,0x459,0x418,0x413)+_0x417484(0x4a0,0x4fa,0x4c0,0x4fb)+_0x417484(0x45e,0x3f5,0x3ef,0x49a)+_0x3d37f6(0x456,0x51f,0x4c4,0x48c),_0x573d1a['zpDCU']='novelai-re'+'move-char-'+_0x3d37f6(0x52a,0x525,0x4cf,0x4cc)+_0x3d37f6(0x4b1,0x497,0x482,0x419),_0x573d1a[_0x417484(0x40e,0x459,0x462,0x45b)]=_0x417484(0x4ad,0x4df,0x508,0x461);function _0x3d37f6(_0x265ace,_0x35a7cf,_0x2134dd,_0x41388c){return _0x49bc53(_0x41388c,_0x35a7cf-0x184,_0x2134dd-0x226,_0x41388c-0x1d9);}_0x573d1a[_0x3d37f6(0x3ea,0x418,0x3fa,0x404)]='none',_0x573d1a[_0x417484(0x457,0x464,0x3fa,0x440)]=function(_0x3d2458,_0x15fc1b){return _0x3d2458===_0x15fc1b;},_0x573d1a[_0x3d37f6(0x464,0x473,0x43a,0x474)]=_0x417484(0x42a,0x461,0x420,0x3e7),_0x573d1a[_0x417484(0x47e,0x444,0x492,0x475)]=_0x417484(0x481,0x467,0x4b1,0x4a0),_0x573d1a['rJSrb']=_0x417484(0x4c5,0x4b5,0x4ac,0x52e);const _0x4aa2bc=_0x573d1a,_0x3eaf1c=document[_0x417484(0x44d,0x3df,0x48f,0x452)+'ById'](_0x4aa2bc[_0x417484(0x447,0x458,0x3ea,0x4a3)]),_0x358b21=document[_0x3d37f6(0x4b3,0x4ec,0x4a8,0x4b0)+_0x417484(0x49b,0x4c7,0x4cf,0x501)](_0x4aa2bc['LMzfb']),_0x39ba6b=document[_0x417484(0x44d,0x4a9,0x46d,0x4bd)+_0x3d37f6(0x42e,0x425,0x425,0x3bf)](_0x4aa2bc['zpDCU']);if(_0x2657c6&&_0x2657c6[_0x417484(0x487,0x464,0x428,0x47d)](_0x4aa2bc['Pbqpj'])){_0x3eaf1c[_0x417484(0x4c6,0x504,0x475,0x460)]=_0x2657c6,_0x3eaf1c[_0x417484(0x4ca,0x4cb,0x472,0x48d)][_0x417484(0x421,0x450,0x400,0x3b4)]=_0x4aa2bc[_0x417484(0x497,0x4ee,0x433,0x501)],_0x358b21[_0x417484(0x4ca,0x524,0x4b7,0x4c1)]['display']=_0x4aa2bc['BScDu'],_0x39ba6b[_0x3d37f6(0x44e,0x4d0,0x4b9,0x4b6)][_0x417484(0x421,0x3f2,0x426,0x3c7)]=_0x4aa2bc[_0x3d37f6(0x461,0x44c,0x46a,0x44d)];const _0x54248e=_0x2657c6[_0x417484(0x490,0x4e1,0x4bc,0x4ae)](','),_0x125ff8=_0x54248e[0x29*0x1a+-0x9ac*-0x4+0x5*-0x892][_0x3d37f6(0x467,0x4bf,0x47f,0x421)](':')[-0x843+-0x10fa+0xc9f*0x2][_0x417484(0x490,0x4a6,0x500,0x491)](';')[-0xb87*0x1+0x12c5*0x1+-0x73e];nai3CharRefImageMimeType=_0x125ff8,window[_0x417484(0x470,0x40e,0x48e,0x47a)+'fImage']=_0x54248e[0x4*-0x379+-0x18fb+0x26e0];const _0x13c2e8={};_0x13c2e8['id']=NAI_CHAR_REF_CACHE_KEY,_0x13c2e8[_0x3d37f6(0x41c,0x41b,0x447,0x46a)]=_0x2657c6,dbs[_0x417484(0x45d,0x437,0x3f4,0x46a)+_0x417484(0x4d0,0x4a0,0x49f,0x512)](_0x13c2e8);}else{if(_0x4aa2bc['ahFYR'](_0x4aa2bc[_0x417484(0x44b,0x459,0x440,0x468)],'ucJsX')){const _0x32055d=_0x4aa2bc[_0x3d37f6(0x473,0x452,0x46d,0x491)][_0x417484(0x490,0x498,0x433,0x488)]('|');let _0x412221=0x3*-0x421+-0xbb*0x13+0x1a44;while(!![]){switch(_0x32055d[_0x412221++]){case'0':_0x39ba6b[_0x417484(0x4ca,0x4b3,0x507,0x511)][_0x417484(0x421,0x47c,0x438,0x3b2)]=_0x4aa2bc['BScDu'];continue;case'1':_0x3eaf1c[_0x417484(0x4c6,0x489,0x4e3,0x513)]='';continue;case'2':_0x3eaf1c[_0x3d37f6(0x508,0x51d,0x4b9,0x4a5)][_0x3d37f6(0x3d4,0x458,0x410,0x3c7)]=_0x417484(0x446,0x41d,0x413,0x470);continue;case'3':_0x358b21[_0x3d37f6(0x4c8,0x4cf,0x4b9,0x4f1)][_0x417484(0x421,0x46f,0x439,0x453)]=_0x4aa2bc[_0x3d37f6(0x4a9,0x466,0x467,0x450)];continue;case'4':window[_0x3d37f6(0x4b3,0x3f5,0x45f,0x3f8)+'fImage']=null;continue;}break;}}else{_0x268ccd[_0x417484(0x4c6,0x513,0x46b,0x4e7)]=_0x14536a,_0x4aa812[_0x417484(0x4ca,0x4ef,0x516,0x50f)][_0x3d37f6(0x461,0x3c4,0x410,0x3ce)]=_0x4aa2bc['djlvL'],_0x1d64d5['style']['display']=_0x3d37f6(0x3c5,0x405,0x435,0x467),_0x34dc6a[_0x3d37f6(0x4e3,0x467,0x4b9,0x49c)][_0x3d37f6(0x44c,0x3f1,0x410,0x3e9)]=_0x4aa2bc['txXkg'];const _0x150c5d=_0x3a6f5f[_0x3d37f6(0x459,0x4dd,0x47f,0x46d)](','),_0x5851ee=_0x150c5d[-0x748+-0x16c4+-0x6*-0x502][_0x3d37f6(0x475,0x4d6,0x47f,0x455)](':')[-0x22d3*0x1+0x888+0x1a4c][_0x417484(0x490,0x4d9,0x45c,0x496)](';')[-0x11e7+-0x732+0x1919];_0x3ca9f5=_0x5851ee,_0x49b60f[_0x417484(0x470,0x4ac,0x4a2,0x4d9)+'fImage']=_0x150c5d[-0x204a+0x3a2+0x1d*0xfd];const _0x5183b9={};_0x5183b9['id']=_0x15486b,_0x5183b9[_0x3d37f6(0x3d8,0x45e,0x447,0x445)]=_0x514575,_0x53e5d6[_0x3d37f6(0x450,0x400,0x44c,0x4a8)+_0x417484(0x4d0,0x51f,0x4ba,0x494)](_0x5183b9);}}}function removeNovelaiCharRefImage(){function _0x2e304d(_0x385b28,_0x43b631,_0x1e7258,_0x39ee8d){return _0x10ba6a(_0x1e7258-0x181,_0x43b631-0x26,_0x43b631,_0x39ee8d-0x111);}updateNovelaiCharRefImagePreview(null),dbs[_0x2e304d(0x4c1,0x4b8,0x4e4,0x4e7)+'e'](NAI_CHAR_REF_CACHE_KEY);}async function handleNovelaiCharRefImageUpload(_0x51ff0c){const _0x2bf789={'UAwAg':_0x5a34bb(0x219,0x23e,0x206,0x1fd),'nEGVc':function(_0x3f4255,_0x4eda69){return _0x3f4255(_0x4eda69);},'BJsOR':'Error\x20proc'+'essing\x20Nov'+'elAI\x20char\x20'+'ref\x20image:','oQMxn':function(_0x2aafd8,_0x5ec34f){return _0x2aafd8+_0x5ec34f;}},_0x24dddd=_0x51ff0c['target'][_0x1b24ea(-0x215,-0x1ff,-0x1c6,-0x1b0)][-0x5*-0x20e+0x20b6+-0xe*0x312];function _0x1b24ea(_0x4fefb5,_0x54eac7,_0x47de89,_0x4fbcb7){return _0x49bc53(_0x54eac7,_0x54eac7-0x13b,_0x4fefb5- -0x40c,_0x4fbcb7-0x12);}if(!_0x24dddd)return;function _0x5a34bb(_0x149da6,_0x112e3c,_0x17dbae,_0x584656){return _0x49bc53(_0x112e3c,_0x112e3c-0x122,_0x149da6- -0x30,_0x584656-0x10f);}try{if(_0x2bf789[_0x5a34bb(0x245,0x273,0x2aa,0x2aa)]===_0x1b24ea(-0x23a,-0x25e,-0x2a7,-0x20a)){const _0x2ff120=_0x3baf3e[_0x5a34bb(0x1e2,0x186,0x211,0x1ed)],_0x142825={};_0x142825['data']=_0x2ff120,_0x142825['serverFile'+'Name']=_0x42ede7[_0x1b24ea(-0x207,-0x26d,-0x23d,-0x1e0)];const _0x57ecb9=_0x142825,_0x1aca7b={};_0x1aca7b['id']=_0x507525,_0x1aca7b[_0x5a34bb(0x1f1,0x1fa,0x205,0x19c)]=_0x57ecb9,_0x107c2c['storeReadW'+_0x1b24ea(-0x173,-0x13b,-0x160,-0x11c)](_0x1aca7b);}else{const _0x511470=await _0x2bf789[_0x5a34bb(0x221,0x22f,0x271,0x25e)](processUploadedImage,_0x24dddd);updateNovelaiCharRefImagePreview(_0x511470);}}catch(_0x583b44){console['error'](_0x2bf789[_0x5a34bb(0x1a9,0x161,0x1a0,0x192)],_0x583b44),_0x2bf789['nEGVc'](alert,_0x2bf789[_0x1b24ea(-0x1c4,-0x18e,-0x171,-0x21e)](_0x1b24ea(-0x232,-0x234,-0x1e8,-0x250),_0x583b44['message']));}}function updateComfyUIImagePreview(_0x3a7cd4){const _0x4a2ac8={};_0x4a2ac8[_0x197b60(0x519,0x4b4,0x4e6,0x56d)]='Error\x20load'+_0x10a73d(0x550,0x521,0x5b6,0x551)+_0x10a73d(0x50b,0x4fc,0x4a7,0x4d9)+_0x10a73d(0x52e,0x584,0x4c8,0x551),_0x4a2ac8[_0x197b60(0x4cd,0x4df,0x46e,0x494)]=_0x197b60(0x4ff,0x4d5,0x4d4,0x51f)+_0x10a73d(0x539,0x55c,0x536,0x4cb)+'ew-contain'+_0x197b60(0x53d,0x4fd,0x59e,0x574)+_0x10a73d(0x4de,0x4e0,0x49e,0x548)+_0x10a73d(0x4bc,0x4b9,0x4f5,0x453)+'r',_0x4a2ac8[_0x10a73d(0x4a5,0x4dc,0x4cb,0x498)]='comfyui-re'+_0x197b60(0x554,0x5b6,0x565,0x598)+_0x10a73d(0x52c,0x511,0x540,0x4c8),_0x4a2ac8[_0x197b60(0x4e9,0x47c,0x4a6,0x523)]=_0x197b60(0x548,0x4f4,0x54c,0x535),_0x4a2ac8[_0x10a73d(0x522,0x515,0x523,0x558)]=function(_0x57c712,_0x51561a){return _0x57c712!==_0x51561a;},_0x4a2ac8[_0x197b60(0x55a,0x5b9,0x56f,0x57c)]=_0x10a73d(0x564,0x59f,0x50a,0x518),_0x4a2ac8[_0x10a73d(0x574,0x575,0x598,0x578)]='none';function _0x10a73d(_0x518ad6,_0x44a1c9,_0x501926,_0x33639f){return _0x49bc53(_0x501926,_0x44a1c9-0xb3,_0x518ad6-0x2cd,_0x33639f-0x17b);}_0x4a2ac8[_0x10a73d(0x4be,0x4fc,0x4b1,0x52a)]='CDJjP',_0x4a2ac8[_0x10a73d(0x525,0x4d0,0x572,0x4fe)]=_0x10a73d(0x4b9,0x4c9,0x4c2,0x4d5)+'4',_0x4a2ac8[_0x197b60(0x4e5,0x536,0x51a,0x4f3)]=_0x10a73d(0x55b,0x545,0x573,0x54e);const _0x764e96=_0x4a2ac8;function _0x197b60(_0x32e82f,_0x5e042c,_0x562acf,_0x467657){return _0x10ba6a(_0x32e82f-0x145,_0x5e042c-0x15,_0x562acf,_0x467657-0x1c0);}const _0x220390=document['getElement'+_0x197b60(0x4b3,0x461,0x4b9,0x4de)](_0x197b60(0x53e,0x4e2,0x4e2,0x4e0)+_0x10a73d(0x4e2,0x48f,0x477,0x48d)),_0x5dea4f=document['querySelec'+_0x197b60(0x518,0x541,0x4e0,0x538)](_0x764e96[_0x10a73d(0x4e6,0x480,0x48d,0x4e1)]),_0x45901d=document[_0x197b60(0x4ca,0x4a1,0x4fc,0x48a)+_0x10a73d(0x4cc,0x51f,0x53c,0x47a)](_0x764e96['jaIxL']);_0x220390[_0x197b60(0x543,0x4d8,0x4d7,0x577)]&&_0x220390[_0x10a73d(0x55c,0x5c4,0x535,0x4fc)]['startsWith'](_0x764e96['lIqGb'])&&_0x764e96['CkOtx'](_0x220390[_0x10a73d(0x55c,0x551,0x581,0x5bd)],_0x3a7cd4)&&URL[_0x197b60(0x4e3,0x4fe,0x4d2,0x50a)+_0x197b60(0x516,0x570,0x581,0x52a)](_0x220390[_0x10a73d(0x55c,0x546,0x578,0x5b3)]);if(_0x3a7cd4)_0x220390[_0x197b60(0x543,0x540,0x4fa,0x546)]=_0x3a7cd4,_0x220390[_0x10a73d(0x560,0x558,0x504,0x5bf)][_0x197b60(0x49e,0x497,0x4c8,0x4a0)]=_0x764e96['HTRJx'],_0x5dea4f[_0x197b60(0x547,0x537,0x4fd,0x583)]['display']=_0x764e96['WaqOA'],_0x45901d['style'][_0x10a73d(0x4b7,0x45a,0x4e6,0x475)]=_0x197b60(0x50b,0x518,0x526,0x4b8)+'x';else{if(_0x764e96[_0x10a73d(0x522,0x57a,0x4e3,0x53f)](_0x764e96[_0x197b60(0x4a5,0x4a7,0x505,0x435)],_0x764e96[_0x197b60(0x4a5,0x510,0x50d,0x4c7)]))_0x4faaab[_0x197b60(0x4fa,0x4b8,0x501,0x48a)](_0x764e96[_0x10a73d(0x532,0x56b,0x4d1,0x4fd)],_0x49509e);else{const _0x483fda=_0x764e96[_0x197b60(0x50c,0x55a,0x545,0x4a0)]['split']('|');let _0x317090=-0xfd5+0x2*0xf97+0x1*-0xf59;while(!![]){switch(_0x483fda[_0x317090++]){case'0':_0x45901d['style'][_0x10a73d(0x4b7,0x4f8,0x46b,0x520)]=_0x764e96['WaqOA'];continue;case'1':_0x5dea4f[_0x10a73d(0x560,0x568,0x52e,0x53f)][_0x197b60(0x49e,0x43d,0x501,0x507)]=_0x764e96[_0x10a73d(0x4fe,0x555,0x497,0x4fc)];continue;case'2':_0x220390[_0x10a73d(0x560,0x55a,0x546,0x544)][_0x10a73d(0x4b7,0x4d5,0x45d,0x450)]=_0x764e96[_0x197b60(0x55b,0x4f2,0x524,0x530)];continue;case'3':_0x220390[_0x10a73d(0x55c,0x587,0x544,0x4ed)]='';continue;case'4':comfyuiImageObjectURL=null;continue;case'5':window[_0x197b60(0x52b,0x548,0x4ef,0x52b)+'kaotupian']=null;continue;}break;}}}}function removeComfyUIImage(){function _0x5f700d(_0x501439,_0x432744,_0x138e1b,_0x126163){return _0x49bc53(_0x126163,_0x432744-0x13b,_0x501439- -0x117,_0x126163-0x1df);}const _0x1229fc={'tFrwH':function(_0x2ffebb,_0x4bbd8a){return _0x2ffebb(_0x4bbd8a);}};function _0x6eab4d(_0x467897,_0x79cb6e,_0x10756,_0x58b8b6){return _0x49bc53(_0x467897,_0x79cb6e-0xf2,_0x58b8b6- -0x1d5,_0x58b8b6-0xc6);}_0x1229fc[_0x6eab4d(0x6,0x6e,-0xf,0x50)](updateComfyUIImagePreview,null),dbs[_0x5f700d(0xdd,0xfd,0xa7,0x130)+'e'](COMFYUI_REF_CACHE_KEY);}async function handleImageUpload2(_0x5a3631){const _0x81ab70={'vsppR':_0x340140(0x296,0x302,0x2ef,0x2fe),'OHtDv':_0x340140(0x20e,0x1c5,0x1f7,0x25f),'FCFjQ':function(_0x15214b,_0x10e854){return _0x15214b(_0x10e854);},'GvmGe':'image','UoHZj':function(_0x9d9f71,_0x427f12){return _0x9d9f71!==_0x427f12;},'riFrA':'请先设置ComfyU'+'I\x20API地址。','geZRE':function(_0x19770c,_0x959f9d,_0x317052){return _0x19770c(_0x959f9d,_0x317052);},'QcrXf':_0x4e90ef(0x2c7,0x2a8,0x2e5,0x28e),'deHyf':function(_0x153e1c,_0x4e0dcf){return _0x153e1c(_0x4e0dcf);},'Rkrtv':function(_0xc2302c,_0x126299){return _0xc2302c+_0x126299;},'SWafP':_0x4e90ef(0x276,0x284,0x25c,0x25a),'NBdeg':function(_0x3967b8,_0x212d2d){return _0x3967b8(_0x212d2d);},'TIASr':_0x4e90ef(0x282,0x25d,0x317,0x2c8)+':\x20','ahCFP':function(_0x476fff,_0x9f9154){return _0x476fff(_0x9f9154);},'NyrQO':function(_0x161f1f){return _0x161f1f();}},_0x27c6a1=extension_settings[extensionName];function _0x4e90ef(_0x3a4777,_0x43fd73,_0x388c88,_0x5945d9){return _0x10ba6a(_0x5945d9- -0x120,_0x43fd73-0x1c4,_0x43fd73,_0x5945d9-0x16a);}function _0x340140(_0x5e9806,_0x23d74d,_0x36a1e9,_0xd7c771){return _0x10ba6a(_0x5e9806- -0x170,_0x23d74d-0x33,_0x23d74d,_0xd7c771-0x1c1);}const _0x402b12=_0x5a3631['target'][_0x4e90ef(0x27c,0x219,0x1e3,0x246)][0x7*-0x9a+0x39*0x2b+0x1*-0x55d];if(!_0x402b12)return;try{const _0x5cd142=await _0x81ab70[_0x4e90ef(0x276,0x2ea,0x2da,0x29e)](processUploadedImageToBlob,_0x402b12),_0x765bd7=URL['createObje'+_0x4e90ef(0x249,0x2f1,0x291,0x2b1)](_0x5cd142);comfyuiImageObjectURL=_0x765bd7,_0x81ab70[_0x340140(0x24e,0x2ba,0x2bb,0x278)](updateComfyUIImagePreview,_0x765bd7);const _0x584ddf=new FormData();_0x584ddf[_0x340140(0x29c,0x278,0x2ef,0x250)](_0x81ab70[_0x4e90ef(0x2a8,0x333,0x312,0x2d5)],_0x5cd142,_0x402b12[_0x4e90ef(0x1f4,0x24a,0x250,0x254)]);let _0x5c6b3d=_0x27c6a1[_0x340140(0x1e5,0x23f,0x1d9,0x179)][_0x340140(0x297,0x293,0x2dc,0x2a0)]();if(!_0x5c6b3d){if(_0x81ab70['UoHZj'](_0x4e90ef(0x216,0x1f9,0x274,0x23f),_0x4e90ef(0x231,0x28e,0x218,0x23f))){_0x14d086['src']=_0x522099,_0x103e7a[_0x4e90ef(0x2ac,0x2b4,0x2cc,0x2e2)][_0x4e90ef(0x220,0x2a6,0x1f9,0x239)]=_0x81ab70['vsppR'],_0x590b30['style'][_0x4e90ef(0x21f,0x1e2,0x275,0x239)]=_0x81ab70[_0x340140(0x26c,0x23a,0x2d7,0x21a)],_0x44fefd['style'][_0x4e90ef(0x295,0x28d,0x25c,0x239)]=_0x4e90ef(0x2ff,0x2f8,0x2a0,0x2a6)+'x';const _0x9e15d6=_0x44a84a['split'](','),_0x13857e=_0x9e15d6[0x2*0xaf6+0x4*-0x1bf+-0xef0][_0x4e90ef(0x288,0x2f9,0x2ae,0x2a8)](':')[0xcaf+0xe11+-0x1abf][_0x340140(0x258,0x289,0x1f7,0x202)](';')[-0x1e45+0xc2b+-0xe*-0x14b];_0x4de0d2=_0x13857e,_0x1bd132[_0x340140(0x207,0x20e,0x1c9,0x21d)+'ansferImag'+'e']=_0x9e15d6[-0x11e5+0x40*0x36+0x233*0x2];const _0x543c8f={};_0x543c8f['id']=_0x14d13f,_0x543c8f['data']=_0x3c7be6,_0xf38e0d[_0x4e90ef(0x20d,0x22f,0x2df,0x275)+_0x340140(0x298,0x2cf,0x2cc,0x2dc)](_0x543c8f);}else{alert(_0x81ab70['riFrA']),removeComfyUIImage();return;}}const _0x337b5d=await _0x81ab70[_0x340140(0x26a,0x2af,0x203,0x26a)](fetch,_0x5c6b3d+(_0x340140(0x27c,0x2a3,0x212,0x2b0)+'age'),{'method':_0x81ab70[_0x4e90ef(0x29d,0x295,0x299,0x279)],'body':_0x584ddf});if(_0x337b5d['ok']){const _0x4a101b=await _0x337b5d[_0x340140(0x273,0x209,0x298,0x218)]();window[_0x4e90ef(0x2df,0x26c,0x2f8,0x2c6)+_0x340140(0x23f,0x2a7,0x250,0x263)]=_0x4a101b[_0x340140(0x204,0x1d5,0x1c6,0x1fe)],addLog(_0x340140(0x2ae,0x2dd,0x307,0x28f)+_0x340140(0x267,0x211,0x2a4,0x23e)+JSON[_0x340140(0x2ac,0x293,0x24d,0x255)](_0x4a101b)),console[_0x340140(0x290,0x2c2,0x2d8,0x289)]('上传成功,\x20服务器返'+_0x4e90ef(0x2b8,0x310,0x318,0x2ee),_0x4a101b);const _0x4f98ef=new FileReader();_0x4f98ef['onloadend']=()=>{const _0x502df6=_0x4f98ef[_0x404cea(-0x1b8,-0x1cd,-0x17d,-0x185)],_0x562b2d={};_0x562b2d[_0x404cea(-0x1a9,-0x158,-0x16e,-0x163)]=_0x502df6,_0x562b2d['serverFile'+_0x4ce9d0(0x16,0x71,-0x1d,0x1c)]=_0x4a101b[_0x404cea(-0x14f,-0x12c,-0x18a,-0x16a)];const _0x3edf4a=_0x562b2d,_0x6ab3ca={};function _0x4ce9d0(_0xd3e7b4,_0x452df7,_0x488c70,_0x20265a){return _0x340140(_0x20265a- -0x261,_0x452df7,_0x488c70-0xf3,_0x20265a-0x18b);}function _0x404cea(_0x280588,_0x2c20fb,_0x4b45d5,_0x2f5a71){return _0x4e90ef(_0x280588-0x15b,_0x2f5a71,_0x4b45d5-0x1c0,_0x4b45d5- -0x3de);}_0x6ab3ca['id']=COMFYUI_REF_CACHE_KEY,_0x6ab3ca[_0x404cea(-0x1b4,-0x1c8,-0x16e,-0x139)]=_0x3edf4a,dbs[_0x404cea(-0x100,-0x1b0,-0x169,-0x1cb)+'rite'](_0x6ab3ca);},_0x4f98ef[_0x340140(0x21d,0x288,0x1c2,0x1e6)+_0x340140(0x1fa,0x1ee,0x259,0x1c9)](_0x5cd142);}else{const _0x4b6f9b=await _0x337b5d['text']();_0x81ab70[_0x340140(0x219,0x1c3,0x205,0x1b7)](alert,_0x81ab70[_0x340140(0x23a,0x1f1,0x261,0x2a8)](_0x81ab70['SWafP'],_0x4b6f9b)),_0x81ab70[_0x340140(0x236,0x21b,0x24a,0x229)](addLog,'图片上传失败,\x20错误'+_0x4e90ef(0x296,0x227,0x237,0x253)+_0x4b6f9b),console[_0x340140(0x245,0x254,0x1fd,0x262)](_0x4e90ef(0x229,0x230,0x24f,0x249),_0x4b6f9b),removeComfyUIImage();}}catch(_0x3892a4){_0x81ab70[_0x4e90ef(0x217,0x276,0x2a3,0x269)](alert,_0x81ab70['Rkrtv'](_0x81ab70[_0x4e90ef(0x31d,0x348,0x2ec,0x2dc)],_0x3892a4['message'])),console[_0x4e90ef(0x2cc,0x262,0x25d,0x295)](_0x4e90ef(0x2f8,0x2f0,0x325,0x2c8)+':',_0x3892a4),_0x81ab70[_0x4e90ef(0x2dc,0x299,0x2e5,0x2c9)](addLog,_0x4e90ef(0x27c,0x28a,0x1d9,0x233)+_0x4e90ef(0x261,0x284,0x246,0x253)+JSON[_0x340140(0x2ac,0x284,0x2b4,0x272)](_0x3892a4)),_0x81ab70[_0x340140(0x24b,0x26b,0x23a,0x26a)](removeComfyUIImage);}}async function loadCachedImages(){const _0x36694e={'YMGam':function(_0xf8b58e,_0x9e0c62){return _0xf8b58e(_0x9e0c62);},'tVojh':_0x411813(0x4f0,0x47b,0x4e8,0x4ce),'ICfmy':function(_0x3fa837){return _0x3fa837();},'HshVS':_0x411813(0x52c,0x52d,0x537,0x51c),'GwBbn':_0x411813(0x52b,0x4c6,0x56d,0x521)+_0x12bc06(0x256,0x2bb,0x289,0x22e)+_0x411813(0x537,0x53d,0x4c5,0x532)+_0x411813(0x5a4,0x4ec,0x511,0x555),'ubTAw':'Error\x20load'+_0x12bc06(0x256,0x228,0x284,0x213)+_0x411813(0x503,0x4e9,0x513,0x52e)+'har\x20Ref\x20im'+_0x12bc06(0x221,0x25f,0x1e9,0x1c9),'jCVQD':_0x411813(0x5b0,0x578,0x593,0x566),'DkRuX':'mwKbA','VQJSR':function(_0x2c43b3,_0xf0ff2b){return _0x2c43b3(_0xf0ff2b);},'NeqJO':function(_0x3f4da1,_0x491020){return _0x3f4da1(_0x491020);},'TkhZT':function(_0x34e1f1,_0x3aed2a){return _0x34e1f1===_0x3aed2a;},'mmJGN':'string','HEoou':_0x411813(0x4d3,0x515,0x537,0x4df)+'fyUI\x20image'+_0x411813(0x5f3,0x5fd,0x54d,0x59f)+_0x12bc06(0x1dd,0x1d8,0x1d9,0x212)+_0x12bc06(0x1b4,0x1a6,0x21f,0x21c)+_0x12bc06(0x26f,0x2ae,0x2a2,0x215)+_0x411813(0x55c,0x56e,0x5aa,0x546)+_0x12bc06(0x281,0x22b,0x234,0x231)+_0x411813(0x58d,0x5a7,0x576,0x55b)+'rmat.','tnNhi':'Error\x20load'+_0x411813(0x526,0x5ce,0x56e,0x577)+_0x12bc06(0x1b6,0x19d,0x1eb,0x202)+_0x411813(0x496,0x502,0x537,0x4f5)};function _0x411813(_0x3553b2,_0x2bf7fa,_0xd2c3da,_0x433a45){return _0x49bc53(_0xd2c3da,_0x2bf7fa-0x1ae,_0x433a45-0x2f4,_0x433a45-0xfe);}function _0x12bc06(_0xeec332,_0x3408c1,_0x2316b3,_0x19a5d6){return _0x10ba6a(_0xeec332- -0x19c,_0x3408c1-0x1bf,_0x19a5d6,_0x19a5d6-0x161);}await dbs['openDB']();try{const _0x10a30d=await dbs['storeReadO'+_0x12bc06(0x241,0x24d,0x1de,0x235)](NAI_VIBE_CACHE_KEY);_0x10a30d&&_0x10a30d[_0x411813(0x506,0x4a9,0x4d6,0x515)]&&(_0x36694e['HshVS']!==_0x12bc06(0x263,0x278,0x259,0x26a)?_0x36694e[_0x12bc06(0x205,0x1e6,0x1d3,0x271)](updateNovelaiImagePreview,_0x10a30d[_0x12bc06(0x1f4,0x184,0x196,0x1f8)]):(_0x438e06['error'](_0x411813(0x488,0x4c3,0x552,0x4f6)+_0x12bc06(0x25a,0x24b,0x205,0x220)+_0x12bc06(0x1d0,0x183,0x1ce,0x190)+':',_0x1dd893),_0x36694e[_0x411813(0x4ec,0x528,0x519,0x526)](_0x183b30,_0x36694e[_0x12bc06(0x207,0x20b,0x20f,0x1fd)]+_0x398705[_0x411813(0x566,0x574,0x5f0,0x580)])));}catch(_0x41cc9e){console[_0x12bc06(0x219,0x1f0,0x247,0x1af)](_0x36694e[_0x411813(0x535,0x5a5,0x5b2,0x58a)],_0x41cc9e);}try{const _0x490ff5=await dbs['storeReadO'+_0x411813(0x50e,0x564,0x55d,0x562)](NAI_CHAR_REF_CACHE_KEY);_0x490ff5&&_0x490ff5[_0x411813(0x54f,0x4db,0x4f3,0x515)]&&_0x36694e[_0x411813(0x4d4,0x564,0x57b,0x526)](updateNovelaiCharRefImagePreview,_0x490ff5['data']);}catch(_0x1b7c65){console[_0x12bc06(0x219,0x230,0x22d,0x26a)](_0x36694e[_0x12bc06(0x1a8,0x164,0x1bc,0x183)],_0x1b7c65);}try{const _0x3e5d7a=await dbs['storeReadO'+_0x411813(0x5ad,0x541,0x58f,0x562)](COMFYUI_REF_CACHE_KEY);if(_0x3e5d7a&&_0x3e5d7a[_0x411813(0x4b2,0x4bd,0x553,0x515)]&&_0x3e5d7a['data'][_0x411813(0x4b8,0x584,0x523,0x515)]&&_0x3e5d7a['data']['serverFile'+'Name']){if(_0x36694e[_0x12bc06(0x1ea,0x258,0x21f,0x18f)]!==_0x36694e['DkRuX']){const _0x1834a0=_0x3e5d7a[_0x12bc06(0x1f4,0x1ed,0x250,0x1ff)],_0x4757e6=await _0x36694e['YMGam'](fetch,_0x1834a0['data']),_0x40b671=await _0x4757e6[_0x12bc06(0x203,0x212,0x1d2,0x210)](),_0x361a80=URL[_0x12bc06(0x242,0x295,0x233,0x28b)+'ctURL'](_0x40b671);_0x36694e[_0x411813(0x4ce,0x4dc,0x557,0x500)](updateComfyUIImagePreview,_0x361a80),comfyuiImageObjectURL=_0x361a80,window[_0x411813(0x587,0x558,0x5af,0x56b)+_0x12bc06(0x213,0x1ee,0x1d3,0x1aa)]=_0x1834a0[_0x12bc06(0x26d,0x263,0x284,0x28d)+_0x12bc06(0x251,0x26f,0x1e7,0x292)],_0x36694e[_0x12bc06(0x274,0x2a5,0x23c,0x243)](addLog,_0x12bc06(0x229,0x25b,0x272,0x1fb)+'UI图片:\x20'+_0x1834a0[_0x411813(0x573,0x5b6,0x5ba,0x58e)+_0x411813(0x584,0x5b1,0x585,0x572)]),console['log'](_0x12bc06(0x1be,0x1e2,0x1c2,0x16e)+_0x411813(0x4fa,0x52e,0x4ad,0x513)+_0x12bc06(0x252,0x1f4,0x2ba,0x23a)+'e:\x20'+_0x1834a0['serverFile'+_0x12bc06(0x251,0x21d,0x222,0x2b0)]);}else _0x36694e[_0x411813(0x511,0x4fb,0x4de,0x527)](_0x22287c);}else{if(_0x3e5d7a&&_0x36694e[_0x411813(0x4c2,0x54d,0x50d,0x530)](typeof _0x3e5d7a[_0x411813(0x4b1,0x580,0x4c7,0x515)],_0x36694e[_0x411813(0x509,0x510,0x55d,0x574)])){const _0x6ab793=await _0x36694e[_0x411813(0x5d3,0x603,0x584,0x595)](fetch,_0x3e5d7a[_0x12bc06(0x1f4,0x20f,0x1a4,0x1ee)]),_0xf6bb05=await _0x6ab793['blob'](),_0x394a3d=URL[_0x411813(0x50b,0x4f7,0x521,0x563)+_0x411813(0x546,0x5ac,0x511,0x556)](_0xf6bb05);updateComfyUIImagePreview(_0x394a3d),comfyuiImageObjectURL=_0x394a3d,console[_0x411813(0x4af,0x518,0x551,0x510)](_0x36694e[_0x12bc06(0x1b5,0x1b1,0x177,0x225)]);}}}catch(_0x122e07){console['error'](_0x36694e[_0x12bc06(0x231,0x1fc,0x23d,0x212)],_0x122e07);}}function _0x49bc53(_0x89a386,_0x58bb05,_0x522ee1,_0x4b51af){return _0x5824(_0x522ee1-0xcf,_0x89a386);}export function initImageUpload(_0x20a74d){const _0x9d2fff={'hlxrY':function(_0x221851,_0x1612c2){return _0x221851!==_0x1612c2;},'AiLRM':_0x40155e(0x334,0x384,0x348,0x3ca),'TkeNg':'MOMTb','YDTqV':function(_0x5ab6c9){return _0x5ab6c9();},'WEzUw':_0x3e1e48(-0xd,-0xae,-0x4f,-0x67)+'2','tWIif':_0x40155e(0x3a8,0x35a,0x37d,0x342)+_0x40155e(0x2de,0x34c,0x3b1,0x3a6)+_0x3e1e48(-0x124,-0x82,-0x71,-0xe1),'ftpCb':_0x3e1e48(-0xd6,-0x94,-0x83,-0x68),'PjSBt':_0x40155e(0x3b4,0x389,0x357,0x375)+_0x40155e(0x341,0x38f,0x3bb,0x350),'SAWAI':_0x40155e(0x38c,0x379,0x338,0x392),'HsQRf':_0x40155e(0x3cd,0x3dd,0x42f,0x38e)+_0x3e1e48(-0xb0,-0x56,-0x8,-0x5b)+_0x40155e(0x400,0x397,0x32e,0x355),'XGnDk':'#comfyui-s'+_0x40155e(0x2e4,0x34c,0x366,0x333)+_0x3e1e48(-0x138,-0xad,-0xe1,-0xe1),'XIULQ':'#imageInpu'+'t2','DICnL':_0x40155e(0x39e,0x3f0,0x3d0,0x424)+_0x40155e(0x3b8,0x41d,0x3ca,0x454)+_0x40155e(0x35a,0x397,0x3e2,0x351)};loadCachedImages(),_0x20a74d[_0x40155e(0x403,0x40f,0x3c3,0x3f6)](_0x9d2fff[_0x3e1e48(-0x5b,-0xe5,-0x68,-0xb9)])['on'](_0x9d2fff['ftpCb'],()=>{function _0x51c232(_0x385023,_0xe4c4f,_0x43df20,_0x3f69ae){return _0x40155e(_0x385023-0x167,_0x385023- -0x2cf,_0x43df20-0x86,_0xe4c4f);}function _0x6896aa(_0x3b1016,_0x1f6c7f,_0x2fe1ab,_0xaea756){return _0x3e1e48(_0x3b1016-0x7a,_0x1f6c7f-0x191,_0x2fe1ab,_0x3b1016- -0x1a4);}_0x9d2fff[_0x6896aa(-0x2d5,-0x299,-0x2e0,-0x2b2)](_0x9d2fff['AiLRM'],_0x9d2fff[_0x6896aa(-0x2a2,-0x273,-0x2d9,-0x2a0)])?document['getElement'+_0x6896aa(-0x2b1,-0x274,-0x300,-0x263)](_0x51c232(0x142,0x1af,0x152,0xf2)+_0x6896aa(-0x273,-0x263,-0x2bf,-0x262))[_0x51c232(0x141,0x12f,0xd2,0x15f)]():_0x27f0c2[_0x6896aa(-0x26a,-0x2b7,-0x273,-0x283)]('Error\x20load'+_0x6896aa(-0x22d,-0x21a,-0x1cd,-0x26b)+_0x51c232(0x80,0xc0,0x49,0xb3)+'mage:',_0x6e945c);});function _0x3e1e48(_0x163b21,_0x50a860,_0x43d23,_0x3115d6){return _0x10ba6a(_0x3115d6- -0x47b,_0x50a860-0x16d,_0x43d23,_0x3115d6-0x1e1);}_0x20a74d['find'](_0x9d2fff[_0x3e1e48(-0xf7,-0x17b,-0x17b,-0x125)])['on'](_0x9d2fff[_0x40155e(0x440,0x3e8,0x401,0x440)],handleNovelaiImageUpload),_0x20a74d[_0x3e1e48(-0x6e,-0x1b,-0xc8,-0x69)](_0x9d2fff[_0x40155e(0x466,0x407,0x40d,0x449)])['on'](_0x9d2fff[_0x40155e(0x39f,0x401,0x3ba,0x428)],()=>{function _0x41bf23(_0x38ea88,_0x28d063,_0x31e794,_0x289253){return _0x3e1e48(_0x38ea88-0x1a1,_0x28d063-0x11e,_0x31e794,_0x28d063-0x7d);}_0x9d2fff[_0x41bf23(-0x29,-0xa,-0x76,-0x6d)](removeNovelaiImage);});function _0x40155e(_0x50d76e,_0x14bc04,_0x448f4a,_0x3aaf94){return _0x10ba6a(_0x14bc04- -0x3,_0x14bc04-0x1a6,_0x3aaf94,_0x3aaf94-0x1ba);}_0x20a74d[_0x40155e(0x3e7,0x40f,0x403,0x403)](_0x40155e(0x364,0x35a,0x352,0x38e)+_0x3e1e48(-0x14e,-0x14e,-0x118,-0x117)+_0x40155e(0x347,0x354,0x393,0x357)+_0x3e1e48(-0x82,-0x104,-0x4c,-0xad))['on']('click',()=>{function _0x59b542(_0x241e74,_0x46cae5,_0x5240aa,_0x13f869){return _0x3e1e48(_0x241e74-0x1ab,_0x46cae5-0x137,_0x13f869,_0x241e74-0x70);}function _0x2f3207(_0x49d54c,_0x375029,_0x267b2d,_0x12ca45){return _0x3e1e48(_0x49d54c-0x1d1,_0x375029-0x57,_0x49d54c,_0x12ca45-0x1f4);}document[_0x2f3207(0x155,0x10f,0xfc,0xfe)+_0x59b542(-0x9d,-0xac,-0x99,-0x5f)](_0x2f3207(0x171,0x1a7,0x169,0x18d)+_0x2f3207(0xd9,0xe9,0x17b,0x114)+_0x59b542(0x10,-0x3c,0x5b,-0x3c))[_0x59b542(0x8,-0x1f,0x19,0x49)]();}),_0x20a74d['find'](_0x3e1e48(-0x105,-0x9c,-0x85,-0xef)+_0x40155e(0x3c0,0x3df,0x3cb,0x3c2)+_0x3e1e48(-0xb3,-0x72,-0x135,-0xca))['on'](_0x9d2fff['SAWAI'],handleNovelaiCharRefImageUpload),_0x20a74d[_0x3e1e48(-0xba,-0x79,-0x4,-0x69)](_0x3e1e48(-0xce,-0x53,-0x4c,-0x9b)+_0x40155e(0x3de,0x3d6,0x43d,0x437)+_0x3e1e48(-0xdb,-0xeb,-0xc5,-0x124)+_0x40155e(0x3e0,0x3cb,0x38a,0x3ff))['on'](_0x9d2fff[_0x40155e(0x3c3,0x401,0x42f,0x391)],()=>{removeNovelaiCharRefImage();}),_0x20a74d[_0x3e1e48(-0xcc,0x4,-0x58,-0x69)](_0x9d2fff['XGnDk'])['on'](_0x9d2fff[_0x40155e(0x3c7,0x401,0x3aa,0x3f9)],()=>{function _0x5c4561(_0x2986ed,_0x27fdeb,_0x3797b2,_0x3cc73b){return _0x3e1e48(_0x2986ed-0x0,_0x27fdeb-0xc4,_0x3cc73b,_0x3797b2-0x2d8);}function _0x2017a6(_0x490de0,_0x483d0e,_0x362130,_0x1d16b4){return _0x40155e(_0x490de0-0x1cf,_0x1d16b4- -0x48e,_0x362130-0x2b,_0x490de0);}document[_0x5c4561(0x1fe,0x1e5,0x1e2,0x21c)+_0x5c4561(0x225,0x15d,0x1cb,0x205)](_0x9d2fff[_0x2017a6(-0x130,-0xb5,-0xf9,-0x11b)])[_0x5c4561(0x265,0x245,0x270,0x25b)]();}),_0x20a74d[_0x40155e(0x426,0x40f,0x3df,0x41d)](_0x9d2fff[_0x3e1e48(-0x142,-0xda,-0x113,-0x116)])['on'](_0x3e1e48(-0xe5,-0xe8,-0xbb,-0xff),handleImageUpload2),_0x20a74d['find'](_0x9d2fff[_0x40155e(0x31a,0x359,0x324,0x3b4)])['on'](_0x9d2fff[_0x40155e(0x435,0x401,0x448,0x454)],()=>{function _0x4ceaa0(_0x55c43d,_0x4f9e62,_0x2849bd,_0x5cf1ea){return _0x3e1e48(_0x55c43d-0xee,_0x4f9e62-0x20,_0x5cf1ea,_0x2849bd-0x266);}_0x9d2fff[_0x4ceaa0(0x1e3,0x1fb,0x1df,0x1af)](removeComfyUIImage);});}export{updateNovelaiImagePreview,updateNovelaiCharRefImagePreview,updateComfyUIImagePreview,nai3VibeTransferImageMimeType,nai3CharRefImageMimeType,comfyuiImageObjectURL};
//# sourceMappingURL=http://localhost:8000/image_upload.js.map